<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-integrations/tardis" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Tardis | NautilusTrader 文档</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://nautilus.aloen.to/integrations/tardis"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Tardis | NautilusTrader 文档"><meta data-rh="true" name="description" content="Tardis 提供面向加密货币市场的细粒度数据，包括逐笔（tick-by-tick）的订单薄快照与增量更新、成交（trades）、持仓量（open interest）、资金费率（funding rates）、期权链（options chains）以及主流交易所的强制平仓/清算（liquidations）数据。"><meta data-rh="true" property="og:description" content="Tardis 提供面向加密货币市场的细粒度数据，包括逐笔（tick-by-tick）的订单薄快照与增量更新、成交（trades）、持仓量（open interest）、资金费率（funding rates）、期权链（options chains）以及主流交易所的强制平仓/清算（liquidations）数据。"><link data-rh="true" rel="icon" href="/logo.png"><link data-rh="true" rel="canonical" href="https://nautilus.aloen.to/integrations/tardis"><link data-rh="true" rel="alternate" href="https://nautilus.aloen.to/integrations/tardis" hreflang="zh"><link data-rh="true" rel="alternate" href="https://nautilus.aloen.to/integrations/tardis" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"集成","item":"https://nautilus.aloen.to/integrations/"},{"@type":"ListItem","position":2,"name":"Tardis","item":"https://nautilus.aloen.to/integrations/tardis"}]}</script><link rel="stylesheet" href="/assets/css/styles.33db920f.css">
<script src="/assets/js/runtime~main.f907132b.js" defer="defer"></script>
<script src="/assets/js/main.3352860b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/logo.png"><div role="region" aria-label="跳到主要内容"><a class="skipToContent__uWo" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/logo.png" alt="NautilusTrader Logo" class="themedComponent_WkLn themedComponent--light_cjoX"><img src="/logo.png" alt="NautilusTrader Logo" class="themedComponent_WkLn themedComponent--dark_jZId"></div><b class="navbar__title text--truncate">NautilusTrader</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/api_reference/">文档</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/Aloento/NautilusTraderDoc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_KfBJ"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_RWFU colorModeToggle_sA1q"><button class="clean-btn toggleButton_qjfc toggleButtonDisabled_cpNp" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_CetX lightToggleIcon_UYsV"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_CetX darkToggleIcon_i1s2"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_CetX systemToggleIcon_yIQx"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_PsjF"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_jk42"><div class="docsWrapper_KWBO"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_XpKL" type="button"></button><div class="docRoot_joIP"><aside class="theme-doc-sidebar-container docSidebarContainer_DOen"><div class="sidebarViewport_j7YP"><div class="sidebar_nPgc"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_MTDt"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/api_reference/"><span title="Python API" class="categoryLinkLabel_XKxb">Python API</span></a><button aria-label="展开侧边栏分类 &#x27;Python API&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/concepts/"><span title="Concepts" class="categoryLinkLabel_XKxb">Concepts</span></a><button aria-label="展开侧边栏分类 &#x27;Concepts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/developer_guide/"><span title="Developer Guide" class="categoryLinkLabel_XKxb">Developer Guide</span></a><button aria-label="展开侧边栏分类 &#x27;Developer Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/getting_started/"><span title="入门" class="categoryLinkLabel_XKxb">入门</span></a><button aria-label="展开侧边栏分类 &#x27;入门&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist menu__link--active" href="/integrations/"><span title="集成" class="categoryLinkLabel_XKxb">集成</span></a><button aria-label="折叠侧边栏分类 &#x27;集成&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/betfair"><span title="Betfair" class="linkLabel_CNtA">Betfair</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/binance"><span title="Binance" class="linkLabel_CNtA">Binance</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/bitmex"><span title="BitMEX" class="linkLabel_CNtA">BitMEX</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/blockchain"><span title="Blockchain" class="linkLabel_CNtA">Blockchain</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/bybit"><span title="Bybit" class="linkLabel_CNtA">Bybit</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/coinbase_intx"><span title="Coinbase International" class="linkLabel_CNtA">Coinbase International</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/databento"><span title="Databento" class="linkLabel_CNtA">Databento</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/dydx"><span title="dYdX" class="linkLabel_CNtA">dYdX</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/hyperliquid"><span title="Hyperliquid" class="linkLabel_CNtA">Hyperliquid</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/ib"><span title="Interactive Brokers" class="linkLabel_CNtA">Interactive Brokers</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/okx"><span title="OKX" class="linkLabel_CNtA">OKX</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/polymarket"><span title="Polymarket" class="linkLabel_CNtA">Polymarket</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/integrations/tardis"><span title="Tardis" class="linkLabel_CNtA">Tardis</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/tutorials/"><span title="教程" class="categoryLinkLabel_XKxb">教程</span></a><button aria-label="展开侧边栏分类 &#x27;教程&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_bw1l"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_PIhC"><div class="docItemContainer_pFw3"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_HRKZ" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_sX5c"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/integrations/"><span>集成</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Tardis</span></li></ul></nav><div class="tocCollapsible_DhUt theme-doc-toc-mobile tocMobile_Izjv"><button type="button" class="clean-btn tocCollapsibleButton_eYR5">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Tardis</h1></header>
<p>Tardis 提供面向加密货币市场的细粒度数据，包括逐笔（tick-by-tick）的订单薄快照与增量更新、成交（trades）、持仓量（open interest）、资金费率（funding rates）、期权链（options chains）以及主流交易所的强制平仓/清算（liquidations）数据。</p>
<p>NautilusTrader 提供与 Tardis API 及其数据格式的集成，便于无缝访问 Tardis 数据。该适配器的主要功能包括：</p>
<ul>
<li><code>TardisCSVDataLoader</code>：读取 Tardis 格式的 CSV 文件并转换为 Nautilus 数据，支持批量加载与内存友好的流式处理。</li>
<li><code>TardisMachineClient</code>：支持从 Tardis Machine WebSocket 服务的实时流与历史回放，将消息转换为 Nautilus 可用的数据结构。</li>
<li><code>TardisHttpClient</code>：向 Tardis HTTP API 请求 instrument 定义元数据，并解析为 Nautilus 的 instrument 定义。</li>
<li><code>TardisDataClient</code>：提供用于订阅来自 Tardis Machine WebSocket 的实时数据流的客户端。</li>
<li><code>TardisInstrumentProvider</code>：通过 Tardis 的 HTTP instrument 元数据 API 提供 instrument 定义。</li>
<li>数据管道函数（Data pipeline functions）：支持从 Tardis Machine 回放历史数据并将其写入 Nautilus 的 Parquet 格式，且可直接集成到 catalog 以简化数据管理（详见下文）。</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_lEzE alert alert--info"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_Vfkp"><p>使用该适配器需要提供 Tardis API key。另请参见 “环境变量（environment variables）” 小节。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="概览">概览<a href="#概览" class="hash-link" aria-label="概览的直接链接" title="概览的直接链接" translate="no">​</a></h2>
<p>该适配器以 Rust 实现，并提供可选的 Python 绑定，以便在 Python 工作流中更方便地使用。适配器本身不依赖任何外部的 Tardis 客户端库。</p>
<div class="theme-admonition theme-admonition-info admonition_lEzE alert alert--info"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_Vfkp"><p>无需对 <code>tardis</code> 做额外的安装步骤。适配器的核心组件以静态库方式编译，并在构建过程中自动链接。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="tardis-文档">Tardis 文档<a href="#tardis-文档" class="hash-link" aria-label="Tardis 文档的直接链接" title="Tardis 文档的直接链接" translate="no">​</a></h2>
<p>Tardis 提供详尽的用户<a href="https://docs.tardis.dev/" target="_blank" rel="noopener noreferrer">文档</a>。建议在使用本集成指南时，同时参考 Tardis 官方文档以获取更深入的细节。</p>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="支持的格式">支持的格式<a href="#支持的格式" class="hash-link" aria-label="支持的格式的直接链接" title="支持的格式的直接链接" translate="no">​</a></h2>
<p>Tardis 提供“归一化（normalized）”的市场数据——在所有支持的交易所之间保持统一格式。这种归一化非常有价值，因为单个解析器即可处理任何 <a href="#venues">Tardis 支持的交易所</a> 的数据，从而减少开发工作与复杂性。因此，NautilusTrader 暂不直接支持各交易所的原生市场数据格式，以避免为每个交易所实现各自解析器的不必要开销。</p>
<p>下列归一化的 Tardis 格式被 NautilusTrader 支持：</p>
<table><thead><tr><th style="text-align:left">Tardis 格式</th><th style="text-align:left">Nautilus 数据类型</th></tr></thead><tbody><tr><td style="text-align:left"><a href="https://docs.tardis.dev/api/tardis-machine#book_change" target="_blank" rel="noopener noreferrer">book_change</a></td><td style="text-align:left"><code>OrderBookDelta</code></td></tr><tr><td style="text-align:left"><a href="https://docs.tardis.dev/api/tardis-machine#book_snapshot_-number_of_levels-_-snapshot_interval-time_unit" target="_blank" rel="noopener noreferrer">book<em>snapshot</em>*</a></td><td style="text-align:left"><code>OrderBookDepth10</code></td></tr><tr><td style="text-align:left"><a href="https://docs.tardis.dev/api/tardis-machine#book_snapshot_-number_of_levels-_-snapshot_interval-time_unit" target="_blank" rel="noopener noreferrer">quote</a></td><td style="text-align:left"><code>QuoteTick</code></td></tr><tr><td style="text-align:left"><a href="https://docs.tardis.dev/api/tardis-machine#book_snapshot_-number_of_levels-_-snapshot_interval-time_unit" target="_blank" rel="noopener noreferrer">quote_10s</a></td><td style="text-align:left"><code>QuoteTick</code></td></tr><tr><td style="text-align:left"><a href="https://docs.tardis.dev/api/tardis-machine#trade" target="_blank" rel="noopener noreferrer">trade</a></td><td style="text-align:left"><code>Trade</code></td></tr><tr><td style="text-align:left"><a href="https://docs.tardis.dev/api/tardis-machine#trade_bar_-aggregation_interval-suffix" target="_blank" rel="noopener noreferrer">trade<em>bar</em>*</a></td><td style="text-align:left"><code>Bar</code></td></tr><tr><td style="text-align:left"><a href="https://docs.tardis.dev/api/instruments-metadata-api" target="_blank" rel="noopener noreferrer">instrument</a></td><td style="text-align:left"><code>CurrencyPair</code>, <code>CryptoFuture</code>, <code>CryptoPerpetual</code>, <code>OptionContract</code></td></tr><tr><td style="text-align:left"><a href="https://docs.tardis.dev/api/tardis-machine#derivative_ticker" target="_blank" rel="noopener noreferrer">derivative_ticker</a></td><td style="text-align:left"><em>尚未支持</em></td></tr><tr><td style="text-align:left"><a href="https://docs.tardis.dev/api/tardis-machine#disconnect" target="_blank" rel="noopener noreferrer">disconnect</a></td><td style="text-align:left"><em>不适用</em></td></tr></tbody></table>
<p><strong>注：</strong></p>
<ul>
<li><a href="https://docs.tardis.dev/api/tardis-machine#book_snapshot_-number_of_levels-_-snapshot_interval-time_unit" target="_blank" rel="noopener noreferrer">quote</a> 是 <a href="https://docs.tardis.dev/api/tardis-machine#book_snapshot_-number_of_levels-_-snapshot_interval-time_unit" target="_blank" rel="noopener noreferrer">book_snapshot_1_0ms</a> 的别名。</li>
<li><a href="https://docs.tardis.dev/api/tardis-machine#book_snapshot_-number_of_levels-_-snapshot_interval-time_unit" target="_blank" rel="noopener noreferrer">quote_10s</a> 是 <a href="https://docs.tardis.dev/api/tardis-machine#book_snapshot_-number_of_levels-_-snapshot_interval-time_unit" target="_blank" rel="noopener noreferrer">book_snapshot_1_10s</a> 的别名。</li>
<li>quote、quote_10s 以及一层快照（one-level snapshots）都会被解析为 <code>QuoteTick</code>。</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_lEzE alert alert--info"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_Vfkp"><p>另请参见 Tardis 的<a href="https://docs.tardis.dev/api/tardis-machine#normalized-market-data-apis" target="_blank" rel="noopener noreferrer">归一化市场数据 API</a>。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="bark-线">Bar（K 线）<a href="#bark-线" class="hash-link" aria-label="Bar（K 线）的直接链接" title="Bar（K 线）的直接链接" translate="no">​</a></h2>
<p>适配器会自动将 <a href="https://docs.tardis.dev/api/tardis-machine#trade_bar_-aggregation_interval-suffix" target="_blank" rel="noopener noreferrer">Tardis 的 trade bar 间隔与后缀</a> 转换为 Nautilus 的 <code>BarType</code>，包括：</p>
<table><thead><tr><th style="text-align:left">Tardis 后缀</th><th style="text-align:left">Nautilus bar 聚合单位</th></tr></thead><tbody><tr><td style="text-align:left"><a href="https://docs.tardis.dev/api/tardis-machine#trade_bar_-aggregation_interval-suffix" target="_blank" rel="noopener noreferrer">ms</a> - 毫秒</td><td style="text-align:left"><code>MILLISECOND</code></td></tr><tr><td style="text-align:left"><a href="https://docs.tardis.dev/api/tardis-machine#trade_bar_-aggregation_interval-suffix" target="_blank" rel="noopener noreferrer">s</a> - 秒</td><td style="text-align:left"><code>SECOND</code></td></tr><tr><td style="text-align:left"><a href="https://docs.tardis.dev/api/tardis-machine#trade_bar_-aggregation_interval-suffix" target="_blank" rel="noopener noreferrer">m</a> - 分钟</td><td style="text-align:left"><code>MINUTE</code></td></tr><tr><td style="text-align:left"><a href="https://docs.tardis.dev/api/tardis-machine#trade_bar_-aggregation_interval-suffix" target="_blank" rel="noopener noreferrer">ticks</a> - 以成交笔数为单位</td><td style="text-align:left"><code>TICK</code></td></tr><tr><td style="text-align:left"><a href="https://docs.tardis.dev/api/tardis-machine#trade_bar_-aggregation_interval-suffix" target="_blank" rel="noopener noreferrer">vol</a> - 成交量大小</td><td style="text-align:left"><code>VOLUME</code></td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="代码与符号规范symbology-and-normalization">代码与符号规范（Symbology and normalization）<a href="#代码与符号规范symbology-and-normalization" class="hash-link" aria-label="代码与符号规范（Symbology and normalization）的直接链接" title="代码与符号规范（Symbology and normalization）的直接链接" translate="no">​</a></h2>
<p>Tardis 集成通过一致的符号归一化，保证与 NautilusTrader 的加密货币交易所适配器无缝兼容。通常情况下，NautilusTrader 会采用 Tardis 提供的原生交易所命名规则。但对于某些交易所，原始符号会按照 Nautilus 的符号规范进行调整，具体如下：</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="通用规则">通用规则<a href="#通用规则" class="hash-link" aria-label="通用规则的直接链接" title="通用规则的直接链接" translate="no">​</a></h3>
<ul>
<li>所有符号会转换为大写。</li>
<li>对于某些交易所，会在市场类型后缀前添加连字符（hyphen）（详见<a href="#exchange-specific-normalizations">交易所特定的规范</a>）。</li>
<li>原始交易所符号会保留在 Nautilus instrument 定义的 <code>raw_symbol</code> 字段中。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="交易所特定的规范">交易所特定的规范<a href="#交易所特定的规范" class="hash-link" aria-label="交易所特定的规范的直接链接" title="交易所特定的规范的直接链接" translate="no">​</a></h3>
<ul>
<li><strong>Binance</strong>：Nautilus 会在所有永续合约符号后追加 <code>-PERP</code> 后缀。</li>
<li><strong>Bybit</strong>：Nautilus 使用特定的产品类别后缀，包括 <code>-SPOT</code>、<code>-LINEAR</code>、<code>-INVERSE</code>、<code>-OPTION</code>。</li>
<li><strong>dYdX</strong>：Nautilus 会在所有永续合约符号后追加 <code>-PERP</code> 后缀。</li>
<li><strong>Gate.io</strong>：Nautilus 会在所有永续合约符号后追加 <code>-PERP</code> 后缀。</li>
</ul>
<p>有关各交易所符号规范的详细说明，参见：</p>
<ul>
<li><a href="/integrations/binance#symbology">Binance 符号规范</a></li>
<li><a href="/integrations/bybit#symbology">Bybit 符号规范</a></li>
<li><a href="/integrations/dydx#symbology">dYdX 符号规范</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="venues交易场所">Venues（交易场所）<a href="#venues交易场所" class="hash-link" aria-label="Venues（交易场所）的直接链接" title="Venues（交易场所）的直接链接" translate="no">​</a></h2>
<p>Tardis 中的某些交易所在逻辑上被划分为多个 venue。下表列出了 Nautilus 的 venue 与对应的 Tardis 交易所映射关系：</p>
<table><thead><tr><th style="text-align:left">Nautilus venue</th><th style="text-align:left">Tardis 交易所(s)</th></tr></thead><tbody><tr><td style="text-align:left"><code>ASCENDEX</code></td><td style="text-align:left"><code>ascendex</code></td></tr><tr><td style="text-align:left"><code>BINANCE</code></td><td style="text-align:left"><code>binance</code>, <code>binance-dex</code>, <code>binance-european-options</code>, <code>binance-futures</code>, <code>binance-jersey</code>, <code>binance-options</code></td></tr><tr><td style="text-align:left"><code>BINANCE_DELIVERY</code></td><td style="text-align:left"><code>binance-delivery</code>（<em>币本位合约</em>）</td></tr><tr><td style="text-align:left"><code>BINANCE_US</code></td><td style="text-align:left"><code>binance-us</code></td></tr><tr><td style="text-align:left"><code>BITFINEX</code></td><td style="text-align:left"><code>bitfinex</code>, <code>bitfinex-derivatives</code></td></tr><tr><td style="text-align:left"><code>BITFLYER</code></td><td style="text-align:left"><code>bitflyer</code></td></tr><tr><td style="text-align:left"><code>BITGET</code></td><td style="text-align:left"><code>bitget</code>, <code>bitget-futures</code></td></tr><tr><td style="text-align:left"><code>BITMEX</code></td><td style="text-align:left"><code>bitmex</code></td></tr><tr><td style="text-align:left"><code>BITNOMIAL</code></td><td style="text-align:left"><code>bitnomial</code></td></tr><tr><td style="text-align:left"><code>BITSTAMP</code></td><td style="text-align:left"><code>bitstamp</code></td></tr><tr><td style="text-align:left"><code>BLOCKCHAIN_COM</code></td><td style="text-align:left"><code>blockchain-com</code></td></tr><tr><td style="text-align:left"><code>BYBIT</code></td><td style="text-align:left"><code>bybit</code>, <code>bybit-options</code>, <code>bybit-spot</code></td></tr><tr><td style="text-align:left"><code>COINBASE</code></td><td style="text-align:left"><code>coinbase</code></td></tr><tr><td style="text-align:left"><code>COINBASE_INTX</code></td><td style="text-align:left"><code>coinbase-international</code></td></tr><tr><td style="text-align:left"><code>COINFLEX</code></td><td style="text-align:left"><code>coinflex</code>（<em>用于历史研究</em>）</td></tr><tr><td style="text-align:left"><code>CRYPTO_COM</code></td><td style="text-align:left"><code>crypto-com</code>, <code>crypto-com-derivatives</code></td></tr><tr><td style="text-align:left"><code>CRYPTOFACILITIES</code></td><td style="text-align:left"><code>cryptofacilities</code></td></tr><tr><td style="text-align:left"><code>DELTA</code></td><td style="text-align:left"><code>delta</code></td></tr><tr><td style="text-align:left"><code>DERIBIT</code></td><td style="text-align:left"><code>deribit</code></td></tr><tr><td style="text-align:left"><code>DYDX</code></td><td style="text-align:left"><code>dydx</code></td></tr><tr><td style="text-align:left"><code>DYDX_V4</code></td><td style="text-align:left"><code>dydx-v4</code></td></tr><tr><td style="text-align:left"><code>FTX</code></td><td style="text-align:left"><code>ftx</code>, <code>ftx-us</code>（<em>用于历史研究</em>）</td></tr><tr><td style="text-align:left"><code>GATE_IO</code></td><td style="text-align:left"><code>gate-io</code>, <code>gate-io-futures</code></td></tr><tr><td style="text-align:left"><code>GEMINI</code></td><td style="text-align:left"><code>gemini</code></td></tr><tr><td style="text-align:left"><code>HITBTC</code></td><td style="text-align:left"><code>hitbtc</code></td></tr><tr><td style="text-align:left"><code>HUOBI</code></td><td style="text-align:left"><code>huobi</code>, <code>huobi-dm</code>, <code>huobi-dm-linear-swap</code>, <code>huobi-dm-options</code></td></tr><tr><td style="text-align:left"><code>HUOBI_DELIVERY</code></td><td style="text-align:left"><code>huobi-dm-swap</code></td></tr><tr><td style="text-align:left"><code>HYPERLIQUID</code></td><td style="text-align:left"><code>hyperliquid</code></td></tr><tr><td style="text-align:left"><code>KRAKEN</code></td><td style="text-align:left"><code>kraken</code></td></tr><tr><td style="text-align:left"><code>KUCOIN</code></td><td style="text-align:left"><code>kucoin</code>, <code>kucoin-futures</code></td></tr><tr><td style="text-align:left"><code>MANGO</code></td><td style="text-align:left"><code>mango</code></td></tr><tr><td style="text-align:left"><code>OKCOIN</code></td><td style="text-align:left"><code>okcoin</code></td></tr><tr><td style="text-align:left"><code>OKEX</code></td><td style="text-align:left"><code>okex</code>, <code>okex-futures</code>, <code>okex-options</code>, <code>okex-spreads</code>, <code>okex-swap</code></td></tr><tr><td style="text-align:left"><code>PHEMEX</code></td><td style="text-align:left"><code>phemex</code></td></tr><tr><td style="text-align:left"><code>POLONIEX</code></td><td style="text-align:left"><code>poloniex</code></td></tr><tr><td style="text-align:left"><code>SERUM</code></td><td style="text-align:left"><code>serum</code>（<em>用于历史研究</em>）</td></tr><tr><td style="text-align:left"><code>STAR_ATLAS</code></td><td style="text-align:left"><code>star-atlas</code></td></tr><tr><td style="text-align:left"><code>UPBIT</code></td><td style="text-align:left"><code>upbit</code></td></tr><tr><td style="text-align:left"><code>WOO_X</code></td><td style="text-align:left"><code>woo-x</code></td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="环境变量">环境变量<a href="#环境变量" class="hash-link" aria-label="环境变量的直接链接" title="环境变量的直接链接" translate="no">​</a></h2>
<p>下列环境变量用于配置 Tardis 与 NautilusTrader：</p>
<ul>
<li><code>TM_API_KEY</code>：Tardis Machine 的 API key。</li>
<li><code>TARDIS_API_KEY</code>：NautilusTrader Tardis 客户端使用的 API key。</li>
<li><code>TARDIS_MACHINE_WS_URL</code>（可选）：NautilusTrader 中 <code>TardisMachineClient</code> 使用的 WebSocket URL。</li>
<li><code>TARDIS_BASE_URL</code>（可选）：NautilusTrader 中 <code>TardisHttpClient</code> 使用的基础 URL。</li>
<li><code>NAUTILUS_PATH</code>（可选）：包含 <code>catalog/</code> 子目录的父目录，用于将回放数据以 Nautilus catalog 格式写入。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="运行-tardis-machine-的历史回放historical-replays">运行 Tardis Machine 的历史回放（historical replays）<a href="#运行-tardis-machine-的历史回放historical-replays" class="hash-link" aria-label="运行 Tardis Machine 的历史回放（historical replays）的直接链接" title="运行 Tardis Machine 的历史回放（historical replays）的直接链接" translate="no">​</a></h2>
<p><a href="https://docs.tardis.dev/api/tardis-machine" target="_blank" rel="noopener noreferrer">Tardis Machine Server</a> 是一个可在本地运行的服务，带有内置数据缓存，通过 HTTP 与 WebSocket API 提供逐 tick 的历史数据和实时汇总数据。</p>
<p>你可以执行完整的 Tardis Machine WebSocket 历史回放，并将结果输出为 Nautilus Parquet 格式，支持 Python 或 Rust 两种方式。由于回放功能在 Rust 中实现，无论从 Python 还是 Rust 调用，性能相同，你可以按工作流偏好来选择。</p>
<p>端到端的 <code>run_tardis_machine_replay</code> 数据管道函数会根据指定的<a href="#configuration">配置</a> 执行以下步骤：</p>
<ul>
<li>连接到 Tardis Machine 服务器。</li>
<li>向 Tardis 的 <a href="https://docs.tardis.dev/api/instruments-metadata-api" target="_blank" rel="noopener noreferrer">instruments metadata</a> HTTP API 请求并解析所需的 instrument 定义。</li>
<li>从 Tardis Machine 服务器按指定时间范围流式请求所有目标 instruments 与数据类型。</li>
<li>对于每个 instrument、数据类型和日期（UTC），生成一个符合 catalog 的 <code>.parquet</code> 文件。</li>
<li>断开与 Tardis Machine 的连接并结束进程。</li>
</ul>
<p><strong>文件命名约定</strong></p>
<p>按天、按 instrument 写入文件，使用 ISO 8601 时间戳范围以明确表示数据的时间跨度：</p>
<ul>
<li><strong>格式</strong>：<code>{start_timestamp}_{end_timestamp}.parquet</code></li>
<li><strong>示例</strong>：<code>2023-10-01T00-00-00-000000000Z_2023-10-01T23-59-59-999999999Z.parquet</code></li>
<li><strong>目录结构</strong>：<code>data/{data_type}/{instrument_id}/{filename}</code></li>
</ul>
<p>该格式与 Nautilus 数据 catalog 完全兼容，便于查询、合并与数据管理操作。</p>
<div class="theme-admonition theme-admonition-note admonition_lEzE alert alert--secondary"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_Vfkp"><p>对于每月的第一天，您可以在无需 API key 的情况下请求数据；其他日期则需要 Tardis Machine 的 API key。</p></div></div>
<p>此流程针对直接输出到 Nautilus Parquet 数据 catalog 进行了优化。请确保将 <code>NAUTILUS_PATH</code> 环境变量设置为包含 <code>catalog/</code> 子目录的父目录。Parquet 文件将按数据类型与 instrument 存放在 <code>&lt;NAUTILUS_PATH&gt;/catalog/data/</code> 的相应子目录下。</p>
<p>如果配置文件中未指定 <code>output_path</code> 且 <code>NAUTILUS_PATH</code> 未设置，则系统将默认使用当前工作目录。</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="操作步骤">操作步骤<a href="#操作步骤" class="hash-link" aria-label="操作步骤的直接链接" title="操作步骤的直接链接" translate="no">​</a></h3>
<p>首先，确保 <code>tardis-machine</code> 的 Docker 容器正在运行。可以使用如下命令启动：</p>
<div class="language-bash codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-bash codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">docker run -p 8000:8000 -p 8001:8001 -e &quot;TM_API_KEY=YOUR_API_KEY&quot; -d tardisdev/tardis-machine</span><br></span></code></pre></div></div>
<p>该命令会以无持久缓存的方式启动 <code>tardis-machine</code> 服务，可能影响性能。如需更好的性能，请考虑为容器挂载持久卷。更多信息请参见 Tardis 的 <a href="https://docs.tardis.dev/api/tardis-machine#docker" target="_blank" rel="noopener noreferrer">Docker 文档</a>。</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="配置">配置<a href="#配置" class="hash-link" aria-label="配置的直接链接" title="配置的直接链接" translate="no">​</a></h3>
<p>接下来，准备好一个 JSON 格式的配置文件。</p>
<p><strong>配置 JSON 格式</strong></p>
<table><thead><tr><th style="text-align:left">字段</th><th style="text-align:left">类型</th><th style="text-align:left">描述</th><th style="text-align:left">默认</th></tr></thead><tbody><tr><td style="text-align:left"><code>tardis_ws_url</code></td><td style="text-align:left">string (optional)</td><td style="text-align:left">Tardis Machine 的 WebSocket URL。</td><td style="text-align:left">若为 <code>null</code> 则使用环境变量 <code>TARDIS_MACHINE_WS_URL</code>。</td></tr><tr><td style="text-align:left"><code>normalize_symbols</code></td><td style="text-align:left">bool (optional)</td><td style="text-align:left">是否应用 Nautilus 的<a href="#symbology-and-normalization">符号归一化</a>。</td><td style="text-align:left">若为 <code>null</code> 则默认为 <code>true</code>。</td></tr><tr><td style="text-align:left"><code>output_path</code></td><td style="text-align:left">string (optional)</td><td style="text-align:left">写入 Nautilus Parquet 数据的输出目录路径。</td><td style="text-align:left">若为 <code>null</code> 则使用 <code>NAUTILUS_PATH</code> 环境变量，否则为当前工作目录。</td></tr><tr><td style="text-align:left"><code>options</code></td><td style="text-align:left">JSON[]</td><td style="text-align:left">一个 <a href="https://docs.tardis.dev/api/tardis-machine#replay-normalized-options" target="_blank" rel="noopener noreferrer">ReplayNormalizedRequestOptions</a> 对象数组。</td><td style="text-align:left"></td></tr></tbody></table>
<p>示例配置文件 <code>example_config.json</code> 可在此找到：<a href="https://github.com/nautechsystems/nautilus_trader/blob/develop/crates/adapters/tardis/bin/example_config.json" target="_blank" rel="noopener noreferrer">example_config.json</a>：</p>
<div class="language-json codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-json codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;tardis_ws_url&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ws://localhost:8001&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;output_path&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token null keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;options&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;exchange&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bitmex&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;symbols&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;xbtusd&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ethusd&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;data_types&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;trade&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;from&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2019-10-01&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;to&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2019-10-02&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="在-python-中执行回放">在 Python 中执行回放<a href="#在-python-中执行回放" class="hash-link" aria-label="在 Python 中执行回放的直接链接" title="在 Python 中执行回放的直接链接" translate="no">​</a></h3>
<p>在 Python 中运行回放可参考下列脚本：</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> asyncio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">core </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> nautilus_pyo3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config_filepath </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;YOUR_CONFIG_FILEPATH&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> nautilus_pyo3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run_tardis_machine_replay</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config_filepath</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;__main__&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    asyncio</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="在-rust-中执行回放">在 Rust 中执行回放<a href="#在-rust-中执行回放" class="hash-link" aria-label="在 Rust 中执行回放的直接链接" title="在 Rust 中执行回放的直接链接" translate="no">​</a></h3>
<p>在 Rust 中运行回放可参考下列示例：</p>
<div class="language-rust codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-rust codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">path</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">PathBuf</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">nautilus_adapters</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">tardis</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">replay</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token plain">run_tardis_machine_replay_from_config</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[tokio::main]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token namespace" style="opacity:0.7">tracing_subscriber</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token function" style="color:#d73a49">fmt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">with_max_level</span><span class="token punctuation" style="color:#393A34">(</span><span class="token namespace" style="opacity:0.7">tracing</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Level</span><span class="token punctuation" style="color:#393A34">::</span><span class="token constant" style="color:#36acaa">DEBUG</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> config_filepath </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">PathBuf</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;YOUR_CONFIG_FILEPATH&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">run_tardis_machine_replay_from_config</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">config_filepath</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>请确保启用 Rust 日志，例如在 shell 中设置：</p>
<div class="language-bash codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-bash codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">export RUST_LOG=debug</span><br></span></code></pre></div></div>
<p>可运行的示例二进制位于仓库：<a href="https://github.com/nautechsystems/nautilus_trader/blob/develop/crates/adapters/tardis/bin/example_replay.rs" target="_blank" rel="noopener noreferrer">example_replay.rs</a>。</p>
<p>也可以使用 cargo 运行：</p>
<div class="language-bash codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-bash codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin tardis-replay &lt;path_to_your_config&gt;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="加载-tardis-csv-数据">加载 Tardis CSV 数据<a href="#加载-tardis-csv-数据" class="hash-link" aria-label="加载 Tardis CSV 数据的直接链接" title="加载 Tardis CSV 数据的直接链接" translate="no">​</a></h2>
<p>Tardis 格式的 CSV 数据可以通过 Python 或 Rust 加载。加载器会读取磁盘上的 CSV 文本并将其解析为 Nautilus 数据。由于加载器在 Rust 中实现，因此无论从 Python 还是 Rust 调用，性能表现一致，可按个人工作流偏好选择。</p>
<p>你也可以为 <code>load_*</code> 函数/方法可选地指定 <code>limit</code> 参数，以限制加载的最大行数。</p>
<div class="theme-admonition theme-admonition-note admonition_lEzE alert alert--secondary"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_Vfkp"><p>混合多个 instrument 的 CSV 文件由于精度（precision）要求较高，存在较大挑战，不建议使用。请使用单一 instrument 的 CSV 文件（详见下文）。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="在-python-中加载-csv">在 Python 中加载 CSV<a href="#在-python-中加载-csv" class="hash-link" aria-label="在 Python 中加载 CSV的直接链接" title="在 Python 中加载 CSV的直接链接" translate="no">​</a></h3>
<p>可使用 <code>TardisCSVDataLoader</code> 在 Python 中加载 Tardis 格式的 CSV。
加载时可选地指定 instrument ID，但必须显式提供 price precision 与 size precision。指定 instrument ID 能提升加载性能，而精度参数是必需的，因为文本数据本身无法推断出精度。</p>
<p>示例用法：</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tardis </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> TardisCSVDataLoader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InstrumentId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instrument_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InstrumentId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;BTC-PERPETUAL.DERIBIT&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TardisCSVDataLoader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    price_precision</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    size_precision</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filepath </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;YOUR_CSV_DATA_PATH&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">limit </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deltas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> loader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load_deltas</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filepath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> limit</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="在-rust-中加载-csv">在 Rust 中加载 CSV<a href="#在-rust-中加载-csv" class="hash-link" aria-label="在 Rust 中加载 CSV的直接链接" title="在 Rust 中加载 CSV的直接链接" translate="no">​</a></h3>
<p>在 Rust 中可使用此处的加载函数：<a href="https://github.com/nautechsystems/nautilus_trader/blob/develop/crates/adapters/tardis/src/csv/mod.rs" target="_blank" rel="noopener noreferrer">csv 模块示例</a>。
加载时同样可以可选地指定 instrument ID，但必须提供 price precision 与 size precision。指定 instrument ID 能提升加载性能，而精度参数不可省略。</p>
<p>完整示例见仓库：<a href="https://github.com/nautechsystems/nautilus_trader/blob/develop/crates/adapters/tardis/bin/example_csv.rs" target="_blank" rel="noopener noreferrer">example_csv.rs</a>。</p>
<p>示例代码：</p>
<div class="language-rust codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-rust codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">path</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Path</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">nautilus_adapters</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token plain">tardis</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">nautilus_model</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">identifiers</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">InstrumentId</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[tokio::main]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 你必须指定精度以及 CSV 文件路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> price_precision </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> size_precision </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> filepath </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Path</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;YOUR_CSV_DATA_PATH&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 可选地指定 instrument ID 与/或 limit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> instrument_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">InstrumentId</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;BTC-PERPETUAL.DERIBIT&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> limit </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">None</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 根据工作流决定是否传播解析错误</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> _deltas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">tardis</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">csv</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token function" style="color:#d73a49">load_deltas</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        filepath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        price_precision</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        size_precision</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Some</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">instrument_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        limit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="流式处理-tardis-csv-数据">流式处理 Tardis CSV 数据<a href="#流式处理-tardis-csv-数据" class="hash-link" aria-label="流式处理 Tardis CSV 数据的直接链接" title="流式处理 Tardis CSV 数据的直接链接" translate="no">​</a></h2>
<p>为在内存受限的环境下高效处理大文件，Tardis 集成提供了流式处理能力：按配置的块（chunk）读取与处理数据，而非一次性将整个文件载入内存。这在处理数 GB 级别的 CSV 文件时尤为有用。</p>
<p>流式功能适用于所有支持的 Tardis 数据类型：</p>
<ul>
<li>订单薄增量（Order book deltas，<code>stream_deltas</code>）。</li>
<li>报价（Quote ticks，<code>stream_quotes</code>）。</li>
<li>成交（Trade ticks，<code>stream_trades</code>）。</li>
<li>订单薄深度快照（Order book depth snapshots，<code>stream_depth10</code>）。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="在-python-中流式读取-csv">在 Python 中流式读取 CSV<a href="#在-python-中流式读取-csv" class="hash-link" aria-label="在 Python 中流式读取 CSV的直接链接" title="在 Python 中流式读取 CSV的直接链接" translate="no">​</a></h3>
<p><code>TardisCSVDataLoader</code> 提供流式方法，按迭代器返回数据块。每个方法接受 <code>chunk_size</code> 参数，用于控制每个块读取的记录数：</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tardis </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> TardisCSVDataLoader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InstrumentId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instrument_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InstrumentId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;BTC-PERPETUAL.DERIBIT&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TardisCSVDataLoader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    price_precision</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    size_precision</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filepath </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;large_trades_file.csv&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chunk_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100_000</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 每块处理 100,000 条记录（默认值）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 分块流式处理成交数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> chunk </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> loader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stream_trades</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filepath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> chunk_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Processing chunk with </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation builtin">len</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">chunk</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> trades&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 仅该块数据在内存中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> trade </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> chunk</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 在此处实现你的处理逻辑</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">pass</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="流式处理订单薄数据">流式处理订单薄数据<a href="#流式处理订单薄数据" class="hash-link" aria-label="流式处理订单薄数据的直接链接" title="流式处理订单薄数据的直接链接" translate="no">​</a></h3>
<p>订单薄数据的流式支持包括增量（deltas）和深度快照（depth snapshots）：</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 流式处理订单薄增量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> chunk </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> loader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stream_deltas</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filepath</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Processing </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation builtin">len</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">chunk</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> deltas&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 处理 delta 块</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 流式处理 depth10 快照（levels 可选：5 或 25）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> chunk </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> loader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stream_depth10</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filepath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> levels</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Processing </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation builtin">len</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">chunk</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> depth snapshots&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 处理 depth 块</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="流式处理报价数据">流式处理报价数据<a href="#流式处理报价数据" class="hash-link" aria-label="流式处理报价数据的直接链接" title="流式处理报价数据的直接链接" translate="no">​</a></h3>
<p>报价数据的流式处理方式类似：</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 流式处理报价 ticks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> chunk </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> loader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stream_quotes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filepath</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Processing </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation builtin">len</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">chunk</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> quotes&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 处理报价块</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="内存效率优势">内存效率优势<a href="#内存效率优势" class="hash-link" aria-label="内存效率优势的直接链接" title="内存效率优势的直接链接" translate="no">​</a></h3>
<p>流式处理方式带来显著的内存效率优势：</p>
<ul>
<li>可控的内存占用：一次仅加载一个数据块。</li>
<li>可扩展的处理能力：可处理大于可用内存的文件。</li>
<li>支持配置块大小：根据系统内存与性能需求调整 <code>chunk_size</code>（默认 100,000）。</li>
</ul>
<div class="theme-admonition theme-admonition-warning admonition_lEzE alert alert--warning"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_Vfkp"><p>当在流式模式下使用精度推断（未显式提供精度）时，推断出的精度可能与对整个文件进行批量加载时得到的结果不同。因为精度推断基于块边界进行，不同块中可能包含不同的精度要求。为获得确定性行为，请在调用流式方法时显式提供 <code>price_precision</code> 与 <code>size_precision</code>。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="在-rust-中流式读取-csv">在 Rust 中流式读取 CSV<a href="#在-rust-中流式读取-csv" class="hash-link" aria-label="在 Rust 中流式读取 CSV的直接链接" title="在 Rust 中流式读取 CSV的直接链接" translate="no">​</a></h3>
<p>底层的流式功能由 Rust 实现，也可以直接在 Rust 中使用：</p>
<div class="language-rust codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-rust codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">path</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Path</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">nautilus_adapters</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">tardis</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">csv</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">stream_trades</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stream_deltas</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">nautilus_model</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">identifiers</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">InstrumentId</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[tokio::main]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> filepath </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Path</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;large_trades_file.csv&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> chunk_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100_000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> price_precision </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> size_precision </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> instrument_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">InstrumentId</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;BTC-PERPETUAL.DERIBIT&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 分块流式处理成交数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> stream </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">stream_trades</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        filepath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        chunk_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        price_precision</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        size_precision</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        instrument_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> chunk_result </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> stream </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">match</span><span class="token plain"> chunk_result </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">chunk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token macro property" style="color:#36acaa">println!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Processing chunk with {} trades&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> chunk</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// 处理该块</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">Err</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token macro property" style="color:#36acaa">eprintln!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Error processing chunk: {}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="请求-instrument-定义">请求 instrument 定义<a href="#请求-instrument-定义" class="hash-link" aria-label="请求 instrument 定义的直接链接" title="请求 instrument 定义的直接链接" translate="no">​</a></h2>
<p>你可以使用 <code>TardisHttpClient</code> 在 Python 与 Rust 中请求 instrument 定义。该客户端会调用 <a href="https://docs.tardis.dev/api/instruments-metadata-api" target="_blank" rel="noopener noreferrer">Tardis instruments metadata API</a> 并将 instrument 元数据解析为 Nautilus 的 instrument 定义。</p>
<p><code>TardisHttpClient</code> 的构造函数接受可选参数：<code>api_key</code>、<code>base_url</code> 与 <code>timeout_secs</code>（默认 60 秒）。</p>
<p>该客户端提供获取单个 <code>instrument</code> 或某个交易所上所有 <code>instruments</code> 的方法。请在引用 <a href="https://api.tardis.dev/v1/exchanges" target="_blank" rel="noopener noreferrer">Tardis 支持的交易所</a> 时使用 Tardis 的 lower-kebab 命名规范。</p>
<div class="theme-admonition theme-admonition-note admonition_lEzE alert alert--secondary"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_Vfkp"><p>访问 instruments metadata API 需要 Tardis 的 API key。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="在-python-中请求-instruments">在 Python 中请求 Instruments<a href="#在-python-中请求-instruments" class="hash-link" aria-label="在 Python 中请求 Instruments的直接链接" title="在 Python 中请求 Instruments的直接链接" translate="no">​</a></h3>
<p>在 Python 中获取 instrument 定义的示例：</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> asyncio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">core </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> nautilus_pyo3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    http_client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> nautilus_pyo3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">TardisHttpClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> http_client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;bitmex&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;xbtusd&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Received: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">instrument</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instruments </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> http_client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">instruments</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;bitmex&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Received: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation builtin">len</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">instruments</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> instruments&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;__main__&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    asyncio</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="在-rust-中请求-instruments">在 Rust 中请求 Instruments<a href="#在-rust-中请求-instruments" class="hash-link" aria-label="在 Rust 中请求 Instruments的直接链接" title="在 Rust 中请求 Instruments的直接链接" translate="no">​</a></h3>
<p>在 Rust 中获取 instrument 定义的示例：完整示例见仓库中的 <a href="https://github.com/nautechsystems/nautilus_trader/blob/develop/crates/adapters/tardis/bin/example_http.rs" target="_blank" rel="noopener noreferrer">example_http.rs</a>。</p>
<div class="language-rust codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-rust codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">nautilus_adapters</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">tardis</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token punctuation" style="color:#393A34">{</span><span class="token namespace" style="opacity:0.7">enums</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Exchange</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">http</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">client</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">TardisHttpClient</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[tokio::main]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token namespace" style="opacity:0.7">tracing_subscriber</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token function" style="color:#d73a49">fmt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">with_max_level</span><span class="token punctuation" style="color:#393A34">(</span><span class="token namespace" style="opacity:0.7">tracing</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Level</span><span class="token punctuation" style="color:#393A34">::</span><span class="token constant" style="color:#36acaa">DEBUG</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">TardisHttpClient</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Nautilus instrument definitions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> resp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">instruments</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Exchange</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Bitmex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property" style="color:#36acaa">println!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Received: {resp:?}&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> resp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">instrument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Exchange</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Bitmex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ETHUSDT&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property" style="color:#36acaa">println!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Received: {resp:?}&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="instrument-provider">Instrument provider<a href="#instrument-provider" class="hash-link" aria-label="Instrument provider的直接链接" title="Instrument provider的直接链接" translate="no">​</a></h2>
<p><code>TardisInstrumentProvider</code> 通过 HTTP instrument 元数据 API 请求并解析来自 Tardis 的 instrument 定义。由于存在多个 <a href="#venues">Tardis 支持的交易所</a>，在加载所有 instruments 时，需要使用 <code>InstrumentProviderConfig</code> 过滤出目标 venues：</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InstrumentProviderConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看支持的 venues: https://nautilustrader.io/docs/nightly/integrations/tardis#venues</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">venues </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;BINANCE&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;BYBIT&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filters </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;venues&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">frozenset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">venues</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instrument_provider_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InstrumentProviderConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">load_all</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> filters</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">filters</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>你也可以像平时一样加载特定的 instrument 定义：</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InstrumentProviderConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instrument_ids </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    InstrumentId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;BTCUSDT-PERP.BINANCE&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 将使用 &#x27;binance-futures&#x27; 交易所</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    InstrumentId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;BTCUSDT.BINANCE&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 将使用 &#x27;binance&#x27; 交易所</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instrument_provider_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InstrumentProviderConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">load_ids</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument_ids</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_lEzE alert alert--secondary"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_Vfkp"><p>订阅之前，所需的 instruments 必须已缓存可用。为简化流程，建议为计划订阅的 venues 预先加载所有 instruments。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="实时数据客户端">实时数据客户端<a href="#实时数据客户端" class="hash-link" aria-label="实时数据客户端的直接链接" title="实时数据客户端的直接链接" translate="no">​</a></h2>
<p><code>TardisDataClient</code> 允许将 Tardis Machine 集成到正在运行的 NautilusTrader 系统中。它支持订阅下列数据类型：</p>
<ul>
<li><code>OrderBookDelta</code>（来自 Tardis 的 L2 细粒度，包含所有变更或完整深度快照）</li>
<li><code>OrderBookDepth10</code>（来自 Tardis 的 L2 细粒度，提供最多 10 层快照）</li>
<li><code>QuoteTick</code></li>
<li><code>TradeTick</code></li>
<li><code>Bar</code>（基于 Tardis 支持的 bar 聚合）</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="数据-websocket">数据 WebSocket<a href="#数据-websocket" class="hash-link" aria-label="数据 WebSocket的直接链接" title="数据 WebSocket的直接链接" translate="no">​</a></h3>
<p>主 <code>TardisMachineClient</code> 的数据 WebSocket 在初始连接阶段负责管理所有接收到的流订阅，直到 <code>ws_connection_delay_secs</code> 指定的延迟时间结束。对于在此之后新增的订阅，会创建新的 <code>TardisMachineClient</code> 实例。该策略在启动时能让主 WebSocket 在单个流中处理数百个订阅，从而提高性能。</p>
<p>当设定了 <code>ws_connection_delay_secs</code> 的初始订阅延迟时，对这些流的取消订阅不会真正从 Tardis Machine 的流中移除订阅（因为 Tardis 不支持选择性取消订阅）。不过组件仍会如期从消息总线（message bus）的发布中取消订阅。</p>
<p>在任何初始延迟之后创建的订阅，将按常规行为正常取消并从 Tardis Machine 流中移除。</p>
<div class="theme-admonition theme-admonition-tip admonition_lEzE alert alert--success"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_Vfkp"><p>如果你预计会频繁地订阅与取消订阅，建议将 <code>ws_connection_delay_secs</code> 设为 0。这样每次初始订阅都会创建一个新的客户端，便于在取消订阅时单独关闭。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="限制与注意事项">限制与注意事项<a href="#限制与注意事项" class="hash-link" aria-label="限制与注意事项的直接链接" title="限制与注意事项的直接链接" translate="no">​</a></h2>
<p>已知的限制与注意事项包括：</p>
<ul>
<li>不支持单次的历史数据请求（historical data requests），因为每次请求至少需要从 Tardis Machine 做一天的回放，且可能需要附加筛选，这在实践中既不高效也不实用。</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_lEzE alert alert--info"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_Vfkp"><p>如需更多功能或希望为 Tardis 适配器贡献代码，请参见我们的<a href="https://github.com/nautechsystems/nautilus_trader/blob/develop/CONTRIBUTING.md" target="_blank" rel="noopener noreferrer">贡献指南</a>。</p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/Aloento/NautilusTraderDoc/tree/main/docs/integrations/tardis.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_F7ru" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_GNoA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/integrations/polymarket"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Polymarket</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/tutorials/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">教程</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_pg_n thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#概览" class="table-of-contents__link toc-highlight">概览</a></li><li><a href="#tardis-文档" class="table-of-contents__link toc-highlight">Tardis 文档</a></li><li><a href="#支持的格式" class="table-of-contents__link toc-highlight">支持的格式</a></li><li><a href="#bark-线" class="table-of-contents__link toc-highlight">Bar（K 线）</a></li><li><a href="#代码与符号规范symbology-and-normalization" class="table-of-contents__link toc-highlight">代码与符号规范（Symbology and normalization）</a><ul><li><a href="#通用规则" class="table-of-contents__link toc-highlight">通用规则</a></li><li><a href="#交易所特定的规范" class="table-of-contents__link toc-highlight">交易所特定的规范</a></li></ul></li><li><a href="#venues交易场所" class="table-of-contents__link toc-highlight">Venues（交易场所）</a></li><li><a href="#环境变量" class="table-of-contents__link toc-highlight">环境变量</a></li><li><a href="#运行-tardis-machine-的历史回放historical-replays" class="table-of-contents__link toc-highlight">运行 Tardis Machine 的历史回放（historical replays）</a><ul><li><a href="#操作步骤" class="table-of-contents__link toc-highlight">操作步骤</a></li><li><a href="#配置" class="table-of-contents__link toc-highlight">配置</a></li><li><a href="#在-python-中执行回放" class="table-of-contents__link toc-highlight">在 Python 中执行回放</a></li><li><a href="#在-rust-中执行回放" class="table-of-contents__link toc-highlight">在 Rust 中执行回放</a></li></ul></li><li><a href="#加载-tardis-csv-数据" class="table-of-contents__link toc-highlight">加载 Tardis CSV 数据</a><ul><li><a href="#在-python-中加载-csv" class="table-of-contents__link toc-highlight">在 Python 中加载 CSV</a></li><li><a href="#在-rust-中加载-csv" class="table-of-contents__link toc-highlight">在 Rust 中加载 CSV</a></li></ul></li><li><a href="#流式处理-tardis-csv-数据" class="table-of-contents__link toc-highlight">流式处理 Tardis CSV 数据</a><ul><li><a href="#在-python-中流式读取-csv" class="table-of-contents__link toc-highlight">在 Python 中流式读取 CSV</a></li><li><a href="#流式处理订单薄数据" class="table-of-contents__link toc-highlight">流式处理订单薄数据</a></li><li><a href="#流式处理报价数据" class="table-of-contents__link toc-highlight">流式处理报价数据</a></li><li><a href="#内存效率优势" class="table-of-contents__link toc-highlight">内存效率优势</a></li><li><a href="#在-rust-中流式读取-csv" class="table-of-contents__link toc-highlight">在 Rust 中流式读取 CSV</a></li></ul></li><li><a href="#请求-instrument-定义" class="table-of-contents__link toc-highlight">请求 instrument 定义</a><ul><li><a href="#在-python-中请求-instruments" class="table-of-contents__link toc-highlight">在 Python 中请求 Instruments</a></li><li><a href="#在-rust-中请求-instruments" class="table-of-contents__link toc-highlight">在 Rust 中请求 Instruments</a></li></ul></li><li><a href="#instrument-provider" class="table-of-contents__link toc-highlight">Instrument provider</a></li><li><a href="#实时数据客户端" class="table-of-contents__link toc-highlight">实时数据客户端</a><ul><li><a href="#数据-websocket" class="table-of-contents__link toc-highlight">数据 WebSocket</a></li></ul></li><li><a href="#限制与注意事项" class="table-of-contents__link toc-highlight">限制与注意事项</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 NautilusTrader Documentation.</div></div></div></footer></div>
</body>
</html>