<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-integrations/ib" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Interactive Brokers | NautilusTrader 文档</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://nautilus.aloen.to/integrations/ib"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Interactive Brokers | NautilusTrader 文档"><meta data-rh="true" name="description" content="Interactive Brokers (IB) is a trading platform providing market access across a wide range of financial instruments, including stocks, options, futures, currencies, bonds, funds, and cryptocurrencies. NautilusTrader offers an adapter to integrate with IB using their Trader Workstation (TWS) API through their Python library, ibapi."><meta data-rh="true" property="og:description" content="Interactive Brokers (IB) is a trading platform providing market access across a wide range of financial instruments, including stocks, options, futures, currencies, bonds, funds, and cryptocurrencies. NautilusTrader offers an adapter to integrate with IB using their Trader Workstation (TWS) API through their Python library, ibapi."><link data-rh="true" rel="icon" href="/logo.png"><link data-rh="true" rel="canonical" href="https://nautilus.aloen.to/integrations/ib"><link data-rh="true" rel="alternate" href="https://nautilus.aloen.to/integrations/ib" hreflang="zh"><link data-rh="true" rel="alternate" href="https://nautilus.aloen.to/integrations/ib" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Integrations","item":"https://nautilus.aloen.to/integrations/"},{"@type":"ListItem","position":2,"name":"Interactive Brokers","item":"https://nautilus.aloen.to/integrations/ib"}]}</script><link rel="stylesheet" href="/assets/css/styles.33db920f.css">
<script src="/assets/js/runtime~main.4ed1c191.js" defer="defer"></script>
<script src="/assets/js/main.3352860b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/logo.png"><div role="region" aria-label="跳到主要内容"><a class="skipToContent__uWo" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/logo.png" alt="NautilusTrader Logo" class="themedComponent_WkLn themedComponent--light_cjoX"><img src="/logo.png" alt="NautilusTrader Logo" class="themedComponent_WkLn themedComponent--dark_jZId"></div><b class="navbar__title text--truncate">NautilusTrader</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/api_reference/">文档</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/Aloento/NautilusTraderDoc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_KfBJ"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_RWFU colorModeToggle_sA1q"><button class="clean-btn toggleButton_qjfc toggleButtonDisabled_cpNp" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_CetX lightToggleIcon_UYsV"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_CetX darkToggleIcon_i1s2"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_CetX systemToggleIcon_yIQx"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_PsjF"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_jk42"><div class="docsWrapper_KWBO"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_XpKL" type="button"></button><div class="docRoot_joIP"><aside class="theme-doc-sidebar-container docSidebarContainer_DOen"><div class="sidebarViewport_j7YP"><div class="sidebar_nPgc"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_MTDt"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/api_reference/"><span title="Python API" class="categoryLinkLabel_XKxb">Python API</span></a><button aria-label="展开侧边栏分类 &#x27;Python API&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/concepts/"><span title="Concepts" class="categoryLinkLabel_XKxb">Concepts</span></a><button aria-label="展开侧边栏分类 &#x27;Concepts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/developer_guide/"><span title="Developer Guide" class="categoryLinkLabel_XKxb">Developer Guide</span></a><button aria-label="展开侧边栏分类 &#x27;Developer Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/getting_started/"><span title="入门" class="categoryLinkLabel_XKxb">入门</span></a><button aria-label="展开侧边栏分类 &#x27;入门&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist menu__link--active" href="/integrations/"><span title="Integrations" class="categoryLinkLabel_XKxb">Integrations</span></a><button aria-label="折叠侧边栏分类 &#x27;Integrations&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/betfair"><span title="Betfair" class="linkLabel_CNtA">Betfair</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/binance"><span title="Binance" class="linkLabel_CNtA">Binance</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/bitmex"><span title="BitMEX" class="linkLabel_CNtA">BitMEX</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/blockchain"><span title="Blockchain" class="linkLabel_CNtA">Blockchain</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/bybit"><span title="Bybit" class="linkLabel_CNtA">Bybit</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/coinbase_intx"><span title="Coinbase International" class="linkLabel_CNtA">Coinbase International</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/databento"><span title="Databento" class="linkLabel_CNtA">Databento</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/dydx"><span title="dYdX" class="linkLabel_CNtA">dYdX</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/hyperliquid"><span title="Hyperliquid" class="linkLabel_CNtA">Hyperliquid</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/integrations/ib"><span title="Interactive Brokers" class="linkLabel_CNtA">Interactive Brokers</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/okx"><span title="OKX" class="linkLabel_CNtA">OKX</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/polymarket"><span title="Polymarket" class="linkLabel_CNtA">Polymarket</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/integrations/tardis"><span title="Tardis" class="linkLabel_CNtA">Tardis</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/tutorials/"><span title="Tutorials" class="categoryLinkLabel_XKxb">Tutorials</span></a><button aria-label="展开侧边栏分类 &#x27;Tutorials&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_bw1l"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_PIhC"><div class="docItemContainer_pFw3"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_HRKZ" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_sX5c"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/integrations/"><span>Integrations</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Interactive Brokers</span></li></ul></nav><div class="tocCollapsible_DhUt theme-doc-toc-mobile tocMobile_Izjv"><button type="button" class="clean-btn tocCollapsibleButton_eYR5">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Interactive Brokers</h1></header>
<p>Interactive Brokers (IB) is a trading platform providing market access across a wide range of financial instruments, including stocks, options, futures, currencies, bonds, funds, and cryptocurrencies. NautilusTrader offers an adapter to integrate with IB using their <a href="https://ibkrcampus.com/ibkr-api-page/trader-workstation-api/" target="_blank" rel="noopener noreferrer">Trader Workstation (TWS) API</a> through their Python library, <a href="https://github.com/nautechsystems/ibapi" target="_blank" rel="noopener noreferrer">ibapi</a>.</p>
<p>The TWS API serves as an interface to IB&#x27;s standalone trading applications: TWS and IB Gateway. Both can be downloaded from the IB website. If you haven&#x27;t installed TWS or IB Gateway yet, refer to the <a href="https://ibkrcampus.com/ibkr-api-page/trader-workstation-api/#tws-download" target="_blank" rel="noopener noreferrer">Initial Setup</a> guide. In NautilusTrader, you&#x27;ll establish a connection to one of these applications via the <code>InteractiveBrokersClient</code>.</p>
<p>Alternatively, you can start with a <a href="https://github.com/gnzsnz/ib-gateway-docker" target="_blank" rel="noopener noreferrer">dockerized version</a> of the IB Gateway, which is particularly useful when deploying trading strategies on a hosted cloud platform. This requires having <a href="https://www.docker.com/" target="_blank" rel="noopener noreferrer">Docker</a> installed on your machine, along with the <a href="https://pypi.org/project/docker/" target="_blank" rel="noopener noreferrer">docker</a> Python package, which NautilusTrader conveniently includes as an extra package.</p>
<div class="theme-admonition theme-admonition-note admonition_lEzE alert alert--secondary"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_Vfkp"><p>The standalone TWS and IB Gateway applications require manually inputting username, password, and trading mode (live or paper) at startup. The dockerized version of the IB Gateway handles these steps programmatically.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="installation">Installation<a href="#installation" class="hash-link" aria-label="Installation的直接链接" title="Installation的直接链接" translate="no">​</a></h2>
<p>To install NautilusTrader with Interactive Brokers (and Docker) support:</p>
<div class="language-bash codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-bash codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">pip install --upgrade &quot;nautilus_trader[ib,docker]&quot;</span><br></span></code></pre></div></div>
<p>To build from source with all extras (including IB and Docker):</p>
<div class="language-bash codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-bash codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">uv sync --all-extras</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_lEzE alert alert--secondary"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_Vfkp"><p>Because IB does not provide wheels for <code>ibapi</code>, NautilusTrader <a href="https://pypi.org/project/nautilus-ibapi/" target="_blank" rel="noopener noreferrer">repackages</a> it for release on PyPI.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="examples">Examples<a href="#examples" class="hash-link" aria-label="Examples的直接链接" title="Examples的直接链接" translate="no">​</a></h2>
<p>You can find live example scripts <a href="https://github.com/nautechsystems/nautilus_trader/tree/develop/examples/live/interactive_brokers/" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="getting-started">Getting started<a href="#getting-started" class="hash-link" aria-label="Getting started的直接链接" title="Getting started的直接链接" translate="no">​</a></h2>
<p>Before implementing your trading strategies, make sure that either TWS (Trader Workstation) or IB Gateway is running. You can log in to one of these standalone applications with your credentials, or connect programmatically via <code>DockerizedIBGateway</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="connection-methods">Connection methods<a href="#connection-methods" class="hash-link" aria-label="Connection methods的直接链接" title="Connection methods的直接链接" translate="no">​</a></h3>
<p>There are two primary ways to connect to Interactive Brokers:</p>
<ol>
<li><strong>Connect to an existing TWS or IB Gateway instance</strong></li>
<li><strong>Use the dockerized IB Gateway (recommended for automated deployments)</strong></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="default-ports">Default ports<a href="#default-ports" class="hash-link" aria-label="Default ports的直接链接" title="Default ports的直接链接" translate="no">​</a></h3>
<p>Interactive Brokers uses different default ports depending on the application and trading mode:</p>
<table><thead><tr><th>Application</th><th>Paper Trading</th><th>Live Trading</th></tr></thead><tbody><tr><td>TWS</td><td>7497</td><td>7496</td></tr><tr><td>IB Gateway</td><td>4002</td><td>4001</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="establish-connection-to-an-existing-gateway-or-tws">Establish connection to an existing gateway or TWS<a href="#establish-connection-to-an-existing-gateway-or-tws" class="hash-link" aria-label="Establish connection to an existing gateway or TWS的直接链接" title="Establish connection to an existing gateway or TWS的直接链接" translate="no">​</a></h3>
<p>When connecting to a pre-existing gateway or TWS, specify the <code>ibg_host</code> and <code>ibg_port</code> parameters in both the <code>InteractiveBrokersDataClientConfig</code> and <code>InteractiveBrokersExecClientConfig</code>:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InteractiveBrokersDataClientConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InteractiveBrokersExecClientConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Example for TWS paper trading (default port 7497)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersDataClientConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_host</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">7497</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_client_id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersExecClientConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_host</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">7497</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_client_id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    account_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;DU123456&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Your paper trading account ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="establish-connection-to-dockerized-ib-gateway">Establish connection to Dockerized IB Gateway<a href="#establish-connection-to-dockerized-ib-gateway" class="hash-link" aria-label="Establish connection to Dockerized IB Gateway的直接链接" title="Establish connection to Dockerized IB Gateway的直接链接" translate="no">​</a></h3>
<p>For automated deployments, the dockerized gateway is recommended. Supply <code>dockerized_gateway</code> with an instance of <code>DockerizedIBGatewayConfig</code> in both client configurations. The <code>ibg_host</code> and <code>ibg_port</code> parameters are not needed as they&#x27;re managed automatically.</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> DockerizedIBGatewayConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gateway </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> DockerizedIBGateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gateway_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DockerizedIBGatewayConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    username</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;your_username&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Or set TWS_USERNAME env var</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    password</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;your_password&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Or set TWS_PASSWORD env var</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trading_mode</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;paper&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># &quot;paper&quot; or &quot;live&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    read_only_api</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Set to False to allow order execution</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">300</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">               </span><span class="token comment" style="color:#999988;font-style:italic"># Startup timeout in seconds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># This may take a short while to start up, especially the first time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gateway </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DockerizedIBGateway</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">gateway_config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gateway</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Confirm you are logged in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gateway</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">is_logged_in</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gateway</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">container</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Inspect the logs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gateway</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">container</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">logs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="environment-variables">Environment variables<a href="#environment-variables" class="hash-link" aria-label="Environment variables的直接链接" title="Environment variables的直接链接" translate="no">​</a></h3>
<p>To supply credentials to the Interactive Brokers Gateway, either pass the <code>username</code> and <code>password</code> to the <code>DockerizedIBGatewayConfig</code>, or set the following environment variables:</p>
<ul>
<li><code>TWS_USERNAME</code>: Your IB account username.</li>
<li><code>TWS_PASSWORD</code>: Your IB account password.</li>
<li><code>TWS_ACCOUNT</code>: Your IB account ID (used as the fallback for <code>account_id</code>).</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="connection-management">Connection management<a href="#connection-management" class="hash-link" aria-label="Connection management的直接链接" title="Connection management的直接链接" translate="no">​</a></h3>
<p>The adapter includes robust connection management features:</p>
<ul>
<li><strong>Automatic reconnection</strong>: Configure retries with the <code>IB_MAX_CONNECTION_ATTEMPTS</code> environment variable.</li>
<li><strong>Connection timeout</strong>: Adjust the timeout with the <code>connection_timeout</code> parameter (default: 300 seconds).</li>
<li><strong>Connection watchdog</strong>: Monitor connection health and trigger reconnection automatically when required.</li>
<li><strong>Graceful error handling</strong>: Handle diverse connection scenarios with comprehensive error classification.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Overview的直接链接" title="Overview的直接链接" translate="no">​</a></h2>
<p>The Interactive Brokers adapter provides a comprehensive integration with IB&#x27;s TWS API. The adapter includes several major components:</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="core-components">Core components<a href="#core-components" class="hash-link" aria-label="Core components的直接链接" title="Core components的直接链接" translate="no">​</a></h3>
<ul>
<li><strong><code>InteractiveBrokersClient</code></strong>: The central client that executes TWS API requests using <code>ibapi</code>. Manages connections, handles errors, and coordinates all API interactions.</li>
<li><strong><code>InteractiveBrokersDataClient</code></strong>: Connects to the Gateway for streaming market data including quotes, trades, and bars.</li>
<li><strong><code>InteractiveBrokersExecutionClient</code></strong>: Handles account information, order management, and trade execution.</li>
<li><strong><code>InteractiveBrokersInstrumentProvider</code></strong>: Retrieves and manages instrument definitions, including support for options and futures chains.</li>
<li><strong><code>HistoricInteractiveBrokersClient</code></strong>: Provides methods for retrieving instruments and historical data, useful for backtesting and research.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="supporting-components">Supporting components<a href="#supporting-components" class="hash-link" aria-label="Supporting components的直接链接" title="Supporting components的直接链接" translate="no">​</a></h3>
<ul>
<li><strong><code>DockerizedIBGateway</code></strong>: Manages dockerized IB Gateway instances for automated deployments.</li>
<li><strong>Configuration classes</strong>: Provide comprehensive configuration options for all components.</li>
<li><strong>Factory classes</strong>: Create and configure client instances with the necessary dependencies.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="supported-asset-classes">Supported asset classes<a href="#supported-asset-classes" class="hash-link" aria-label="Supported asset classes的直接链接" title="Supported asset classes的直接链接" translate="no">​</a></h3>
<p>The adapter supports trading across all major asset classes available through Interactive Brokers:</p>
<ul>
<li><strong>Equities</strong>: Stocks, ETFs, and equity options.</li>
<li><strong>Fixed income</strong>: Bonds and bond funds.</li>
<li><strong>Derivatives</strong>: Futures, options, and warrants.</li>
<li><strong>Foreign exchange</strong>: Spot FX and FX forwards.</li>
<li><strong>Cryptocurrencies</strong>: Bitcoin, Ethereum, and other digital assets.</li>
<li><strong>Commodities</strong>: Physical commodities and commodity futures.</li>
<li><strong>Indices</strong>: Index products and index options.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="the-interactive-brokers-client">The Interactive Brokers client<a href="#the-interactive-brokers-client" class="hash-link" aria-label="The Interactive Brokers client的直接链接" title="The Interactive Brokers client的直接链接" translate="no">​</a></h2>
<p>The <code>InteractiveBrokersClient</code> serves as the central component of the IB adapter, overseeing a range of critical functions. These include establishing and maintaining connections, handling API errors, executing trades, and gathering various types of data such as market data, contract/instrument data, and account details.</p>
<p>To ensure efficient management of these diverse responsibilities, the <code>InteractiveBrokersClient</code> is divided into several specialized mixin classes. This modular approach enhances manageability and clarity.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="client-architecture">Client architecture<a href="#client-architecture" class="hash-link" aria-label="Client architecture的直接链接" title="Client architecture的直接链接" translate="no">​</a></h3>
<p>The client uses a mixin-based architecture where each mixin handles a specific aspect of the IB API:</p>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="connection-management-interactivebrokersclientconnectionmixin">Connection management (<code>InteractiveBrokersClientConnectionMixin</code>)<a href="#connection-management-interactivebrokersclientconnectionmixin" class="hash-link" aria-label="connection-management-interactivebrokersclientconnectionmixin的直接链接" title="connection-management-interactivebrokersclientconnectionmixin的直接链接" translate="no">​</a></h4>
<ul>
<li>Establishes and maintains socket connections to TWS/Gateway.</li>
<li>Handles connection timeouts and reconnection logic.</li>
<li>Manages connection state and health monitoring.</li>
<li>Supports configurable reconnection attempts via <code>IB_MAX_CONNECTION_ATTEMPTS</code> environment variable.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="error-handling-interactivebrokersclienterrormixin">Error handling (<code>InteractiveBrokersClientErrorMixin</code>)<a href="#error-handling-interactivebrokersclienterrormixin" class="hash-link" aria-label="error-handling-interactivebrokersclienterrormixin的直接链接" title="error-handling-interactivebrokersclienterrormixin的直接链接" translate="no">​</a></h4>
<ul>
<li>Processes all API errors and warnings.</li>
<li>Categorizes errors by type (client errors, connectivity issues, request errors).</li>
<li>Handles subscription and request-specific error scenarios.</li>
<li>Provides comprehensive error logging and debugging information.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="account-management-interactivebrokersclientaccountmixin">Account management (<code>InteractiveBrokersClientAccountMixin</code>)<a href="#account-management-interactivebrokersclientaccountmixin" class="hash-link" aria-label="account-management-interactivebrokersclientaccountmixin的直接链接" title="account-management-interactivebrokersclientaccountmixin的直接链接" translate="no">​</a></h4>
<ul>
<li>Retrieves account information and balances.</li>
<li>Manages position data and portfolio updates.</li>
<li>Handles multi-account scenarios.</li>
<li>Processes account-related notifications.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="contractinstrument-management-interactivebrokersclientcontractmixin">Contract/instrument management (<code>InteractiveBrokersClientContractMixin</code>)<a href="#contractinstrument-management-interactivebrokersclientcontractmixin" class="hash-link" aria-label="contractinstrument-management-interactivebrokersclientcontractmixin的直接链接" title="contractinstrument-management-interactivebrokersclientcontractmixin的直接链接" translate="no">​</a></h4>
<ul>
<li>Retrieves contract details and specifications.</li>
<li>Handles instrument searches and lookups.</li>
<li>Manages contract validation and verification.</li>
<li>Supports complex instrument types (options chains, futures chains).</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="market-data-management-interactivebrokersclientmarketdatamixin">Market data management (<code>InteractiveBrokersClientMarketDataMixin</code>)<a href="#market-data-management-interactivebrokersclientmarketdatamixin" class="hash-link" aria-label="market-data-management-interactivebrokersclientmarketdatamixin的直接链接" title="market-data-management-interactivebrokersclientmarketdatamixin的直接链接" translate="no">​</a></h4>
<ul>
<li>Handles real-time and historical market data subscriptions.</li>
<li>Processes quotes, trades, and bar data.</li>
<li>Manages market data type settings (real-time, delayed, frozen).</li>
<li>Handles tick-by-tick data and market depth.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="order-management-interactivebrokersclientordermixin">Order management (<code>InteractiveBrokersClientOrderMixin</code>)<a href="#order-management-interactivebrokersclientordermixin" class="hash-link" aria-label="order-management-interactivebrokersclientordermixin的直接链接" title="order-management-interactivebrokersclientordermixin的直接链接" translate="no">​</a></h4>
<ul>
<li>Processes order placement, modification, and cancellation.</li>
<li>Handles order status updates and execution reports.</li>
<li>Manages order validation and error handling.</li>
<li>Supports complex order types and conditions.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="key-features">Key features<a href="#key-features" class="hash-link" aria-label="Key features的直接链接" title="Key features的直接链接" translate="no">​</a></h3>
<ul>
<li><strong>Asynchronous operation</strong>: All operations are fully asynchronous using Python&#x27;s asyncio.</li>
<li><strong>Robust error handling</strong>: Comprehensive error categorization and handling.</li>
<li><strong>Connection resilience</strong>: Automatic reconnection with configurable retry logic.</li>
<li><strong>Message processing</strong>: Efficient message queue processing for high-throughput scenarios.</li>
<li><strong>State management</strong>: Proper state tracking for connections, subscriptions, and requests.</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_lEzE alert alert--success"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_Vfkp"><p>To troubleshoot TWS API incoming message issues, consider starting at the <code>InteractiveBrokersClient._process_message</code> method, which acts as the primary gateway for processing all messages received from the API.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="symbology">Symbology<a href="#symbology" class="hash-link" aria-label="Symbology的直接链接" title="Symbology的直接链接" translate="no">​</a></h2>
<p>The <code>InteractiveBrokersInstrumentProvider</code> supports three methods for constructing <code>InstrumentId</code> instances, which can be configured via the <code>symbology_method</code> enum in <code>InteractiveBrokersInstrumentProviderConfig</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="symbology-methods">Symbology methods<a href="#symbology-methods" class="hash-link" aria-label="Symbology methods的直接链接" title="Symbology methods的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="1-simplified-symbology-ib_simplified---default">1. Simplified symbology (<code>IB_SIMPLIFIED</code>) - default<a href="#1-simplified-symbology-ib_simplified---default" class="hash-link" aria-label="1-simplified-symbology-ib_simplified---default的直接链接" title="1-simplified-symbology-ib_simplified---default的直接链接" translate="no">​</a></h4>
<p>When <code>symbology_method</code> is set to <code>IB_SIMPLIFIED</code> (the default setting), the system uses intuitive, human-readable symbology rules:</p>
<p><strong>Format Rules by Asset Class:</strong></p>
<ul>
<li><strong>Forex</strong>: <code>{symbol}/{currency}.{exchange}</code>
<ul>
<li>Example: <code>EUR/USD.IDEALPRO</code></li>
</ul>
</li>
<li><strong>Stocks</strong>: <code>{localSymbol}.{primaryExchange}</code>
<ul>
<li>Spaces in localSymbol are replaced with hyphens</li>
<li>Example: <code>BF-B.NYSE</code>, <code>SPY.ARCA</code></li>
</ul>
</li>
<li><strong>Futures</strong>: <code>{localSymbol}.{exchange}</code>
<ul>
<li>Individual contracts use single digit years</li>
<li>Example: <code>ESM4.CME</code>, <code>CLZ7.NYMEX</code></li>
</ul>
</li>
<li><strong>Continuous Futures</strong>: <code>{symbol}.{exchange}</code>
<ul>
<li>Represents front month, automatically rolling</li>
<li>Example: <code>ES.CME</code>, <code>CL.NYMEX</code></li>
</ul>
</li>
<li><strong>Options on Futures (FOP)</strong>: <code>{localSymbol}.{exchange}</code>
<ul>
<li>Format: <code>{symbol}{month}{year} {right}{strike}</code></li>
<li>Example: <code>ESM4 C4200.CME</code></li>
</ul>
</li>
<li><strong>Options</strong>: <code>{localSymbol}.{exchange}</code>
<ul>
<li>All spaces removed from localSymbol</li>
<li>Example: <code>AAPL230217P00155000.SMART</code></li>
</ul>
</li>
<li><strong>Indices</strong>: <code>^{localSymbol}.{exchange}</code>
<ul>
<li>Example: <code>^SPX.CBOE</code>, <code>^NDX.NASDAQ</code></li>
</ul>
</li>
<li><strong>Bonds</strong>: <code>{localSymbol}.{exchange}</code>
<ul>
<li>Example: <code>912828XE8.SMART</code></li>
</ul>
</li>
<li><strong>Cryptocurrencies</strong>: <code>{symbol}/{currency}.{exchange}</code>
<ul>
<li>Example: <code>BTC/USD.PAXOS</code>, <code>ETH/USD.PAXOS</code></li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="2-raw-symbology-ib_raw">2. Raw symbology (<code>IB_RAW</code>)<a href="#2-raw-symbology-ib_raw" class="hash-link" aria-label="2-raw-symbology-ib_raw的直接链接" title="2-raw-symbology-ib_raw的直接链接" translate="no">​</a></h4>
<p>Setting <code>symbology_method</code> to <code>IB_RAW</code> enforces stricter parsing rules that align directly with the fields defined in the IB API. This method provides maximum compatibility across all regions and instrument types:</p>
<p><strong>Format Rules:</strong></p>
<ul>
<li><strong>CFDs</strong>: <code>{localSymbol}={secType}.IBCFD</code></li>
<li><strong>Commodities</strong>: <code>{localSymbol}={secType}.IBCMDTY</code></li>
<li><strong>Default for Other Types</strong>: <code>{localSymbol}={secType}.{exchange}</code></li>
</ul>
<p><strong>Examples:</strong></p>
<ul>
<li><code>IBUS30=CFD.IBCFD</code></li>
<li><code>XAUUSD=CMDTY.IBCMDTY</code></li>
<li><code>AAPL=STK.SMART</code></li>
</ul>
<p>This configuration ensures explicit instrument identification and supports instruments from any region, especially those with non-standard symbology where simplified parsing may fail.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="mic-venue-conversion">MIC venue conversion<a href="#mic-venue-conversion" class="hash-link" aria-label="MIC venue conversion的直接链接" title="MIC venue conversion的直接链接" translate="no">​</a></h3>
<p>The adapter supports converting Interactive Brokers exchange codes to Market Identifier Codes (MIC) for standardized venue identification:</p>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="convert_exchange_to_mic_venue"><code>convert_exchange_to_mic_venue</code><a href="#convert_exchange_to_mic_venue" class="hash-link" aria-label="convert_exchange_to_mic_venue的直接链接" title="convert_exchange_to_mic_venue的直接链接" translate="no">​</a></h4>
<p>When set to <code>True</code>, the adapter automatically converts IB exchange codes to their corresponding MIC codes:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">instrument_provider_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersInstrumentProviderConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    convert_exchange_to_mic_venue</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Enable MIC conversion</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    symbology_method</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">SymbologyMethod</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">IB_SIMPLIFIED</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>Examples of MIC Conversion:</strong></p>
<ul>
<li><code>CME</code> → <code>XCME</code> (Chicago Mercantile Exchange)</li>
<li><code>NASDAQ</code> → <code>XNAS</code> (Nasdaq Stock Market)</li>
<li><code>NYSE</code> → <code>XNYS</code> (New York Stock Exchange)</li>
<li><code>LSE</code> → <code>XLON</code> (London Stock Exchange)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="symbol_to_mic_venue"><code>symbol_to_mic_venue</code><a href="#symbol_to_mic_venue" class="hash-link" aria-label="symbol_to_mic_venue的直接链接" title="symbol_to_mic_venue的直接链接" translate="no">​</a></h4>
<p>For custom venue mapping, use the <code>symbol_to_mic_venue</code> dictionary to override default conversions:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">instrument_provider_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersInstrumentProviderConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    convert_exchange_to_mic_venue</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    symbol_to_mic_venue</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;ES&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;XCME&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># All ES futures/options use CME MIC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;SPY&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ARCX&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># SPY specifically uses ARCA</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="supported-instrument-formats">Supported instrument formats<a href="#supported-instrument-formats" class="hash-link" aria-label="Supported instrument formats的直接链接" title="Supported instrument formats的直接链接" translate="no">​</a></h3>
<p>The adapter supports various instrument formats based on Interactive Brokers&#x27; contract specifications:</p>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="futures-month-codes">Futures month codes<a href="#futures-month-codes" class="hash-link" aria-label="Futures month codes的直接链接" title="Futures month codes的直接链接" translate="no">​</a></h4>
<ul>
<li><strong>F</strong> = January, <strong>G</strong> = February, <strong>H</strong> = March, <strong>J</strong> = April</li>
<li><strong>K</strong> = May, <strong>M</strong> = June, <strong>N</strong> = July, <strong>Q</strong> = August</li>
<li><strong>U</strong> = September, <strong>V</strong> = October, <strong>X</strong> = November, <strong>Z</strong> = December</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="supported-exchanges-by-asset-class">Supported exchanges by asset class<a href="#supported-exchanges-by-asset-class" class="hash-link" aria-label="Supported exchanges by asset class的直接链接" title="Supported exchanges by asset class的直接链接" translate="no">​</a></h4>
<p><strong>Futures Exchanges:</strong></p>
<ul>
<li><code>CME</code>, <code>CBOT</code>, <code>NYMEX</code>, <code>COMEX</code>, <code>KCBT</code>, <code>MGE</code>, <code>NYBOT</code>, <code>SNFE</code></li>
</ul>
<p><strong>Options Exchanges:</strong></p>
<ul>
<li><code>SMART</code> (IB&#x27;s smart routing)</li>
</ul>
<p><strong>Forex Exchanges:</strong></p>
<ul>
<li><code>IDEALPRO</code> (IB&#x27;s forex platform)</li>
</ul>
<p><strong>Cryptocurrency Exchanges:</strong></p>
<ul>
<li><code>PAXOS</code> (IB&#x27;s crypto platform)</li>
</ul>
<p><strong>CFD/Commodity Exchanges:</strong></p>
<ul>
<li><code>IBCFD</code>, <code>IBCMDTY</code> (IB&#x27;s internal routing)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="choosing-the-right-symbology-method">Choosing the right symbology method<a href="#choosing-the-right-symbology-method" class="hash-link" aria-label="Choosing the right symbology method的直接链接" title="Choosing the right symbology method的直接链接" translate="no">​</a></h3>
<ul>
<li><strong>Use <code>IB_SIMPLIFIED</code></strong> (default) for most use cases - provides clean, readable instrument IDs</li>
<li><strong>Use <code>IB_RAW</code></strong> when dealing with complex international instruments or when simplified parsing fails</li>
<li><strong>Enable <code>convert_exchange_to_mic_venue</code></strong> when you need standardized MIC venue codes for compliance or data consistency</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="instruments-and-contracts">Instruments and contracts<a href="#instruments-and-contracts" class="hash-link" aria-label="Instruments and contracts的直接链接" title="Instruments and contracts的直接链接" translate="no">​</a></h2>
<p>In Interactive Brokers, a NautilusTrader <code>Instrument</code> corresponds to an IB <a href="https://ibkrcampus.com/ibkr-api-page/trader-workstation-api/#contracts" target="_blank" rel="noopener noreferrer">Contract</a>. The adapter handles two types of contract representations:</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="contract-types">Contract types<a href="#contract-types" class="hash-link" aria-label="Contract types的直接链接" title="Contract types的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="basic-contract-ibcontract">Basic contract (<code>IBContract</code>)<a href="#basic-contract-ibcontract" class="hash-link" aria-label="basic-contract-ibcontract的直接链接" title="basic-contract-ibcontract的直接链接" translate="no">​</a></h4>
<ul>
<li>Contains essential contract identification fields</li>
<li>Used for contract searches and basic operations</li>
<li>Cannot be directly converted to a NautilusTrader <code>Instrument</code></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="contract-details-ibcontractdetails">Contract details (<code>IBContractDetails</code>)<a href="#contract-details-ibcontractdetails" class="hash-link" aria-label="contract-details-ibcontractdetails的直接链接" title="contract-details-ibcontractdetails的直接链接" translate="no">​</a></h4>
<ul>
<li>Contains comprehensive contract information including:<!-- -->
<ul>
<li>Order types supported</li>
<li>Trading hours and calendar</li>
<li>Margin requirements</li>
<li>Price increments and multipliers</li>
<li>Market data permissions</li>
</ul>
</li>
<li>Can be converted to a NautilusTrader <code>Instrument</code></li>
<li>Required for trading operations</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="contract-discovery">Contract discovery<a href="#contract-discovery" class="hash-link" aria-label="Contract discovery的直接链接" title="Contract discovery的直接链接" translate="no">​</a></h3>
<p>To search for contract information, use the <a href="https://pennies.interactivebrokers.com/cstools/contract_info/" target="_blank" rel="noopener noreferrer">IB Contract Information Center</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="loading-instruments">Loading instruments<a href="#loading-instruments" class="hash-link" aria-label="Loading instruments的直接链接" title="Loading instruments的直接链接" translate="no">​</a></h3>
<p>There are two primary methods for loading instruments:</p>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="1-using-load_ids-recommended">1. Using <code>load_ids</code> (recommended)<a href="#1-using-load_ids-recommended" class="hash-link" aria-label="1-using-load_ids-recommended的直接链接" title="1-using-load_ids-recommended的直接链接" translate="no">​</a></h4>
<p>Use <code>symbology_method=SymbologyMethod.IB_SIMPLIFIED</code> (default) with <code>load_ids</code> for clean, intuitive instrument identification:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InteractiveBrokersInstrumentProviderConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> SymbologyMethod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instrument_provider_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersInstrumentProviderConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    symbology_method</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">SymbologyMethod</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">IB_SIMPLIFIED</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    load_ids</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">frozenset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;EUR/USD.IDEALPRO&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Forex</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;SPY.ARCA&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># Stock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;ESM24.CME&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic"># Future</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;BTC/USD.PAXOS&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic"># Crypto</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;^SPX.CBOE&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic"># Index</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="2-using-load_contracts-for-complex-instruments">2. Using <code>load_contracts</code> (for complex instruments)<a href="#2-using-load_contracts-for-complex-instruments" class="hash-link" aria-label="2-using-load_contracts-for-complex-instruments的直接链接" title="2-using-load_contracts-for-complex-instruments的直接链接" translate="no">​</a></h4>
<p>Use <code>load_contracts</code> with <code>IBContract</code> instances for complex scenarios like options/futures chains:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">common </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> IBContract</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Load options chain for specific expiry</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">options_chain_expiry </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;IND&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;SPX&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;CBOE&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    build_options_chain</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastTradeDateOrContractMonth</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;20240718&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Load options chain for date range</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">options_chain_range </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;IND&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;SPX&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;CBOE&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    build_options_chain</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    min_expiry_days</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max_expiry_days</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Load futures chain</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">futures_chain </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;CONTFUT&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;CME&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;ES&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    build_futures_chain</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instrument_provider_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersInstrumentProviderConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    load_contracts</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">frozenset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        options_chain_expiry</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        options_chain_range</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        futures_chain</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="ibcontract-examples-by-asset-class">IBContract examples by asset class<a href="#ibcontract-examples-by-asset-class" class="hash-link" aria-label="IBContract examples by asset class的直接链接" title="IBContract examples by asset class的直接链接" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">common </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> IBContract</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Stocks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;STK&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;SMART&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> primaryExchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;ARCA&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;SPY&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;STK&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;SMART&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> primaryExchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;NASDAQ&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;AAPL&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Bonds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;BOND&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> secIdType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;ISIN&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> secId</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;US03076KAA60&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;BOND&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> secIdType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;CUSIP&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> secId</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;912828XE8&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Individual Options</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;OPT&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;SMART&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;SPY&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           lastTradeDateOrContractMonth</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;20251219&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> strike</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> right</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;C&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Options Chain (loads all strikes/expirations)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;STK&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;SMART&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> primaryExchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;ARCA&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;SPY&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           build_options_chain</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> min_expiry_days</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> max_expiry_days</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">60</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># CFDs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;CFD&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;IBUS30&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;CFD&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;DE40EUR&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;SMART&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Individual Futures</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;FUT&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;CME&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;ES&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           lastTradeDateOrContractMonth</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;20240315&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Futures Chain (loads all expirations)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;CONTFUT&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;CME&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;ES&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> build_futures_chain</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Options on Futures (FOP) - Individual</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;FOP&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;CME&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;ES&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           lastTradeDateOrContractMonth</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;20240315&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> strike</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4200</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> right</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;C&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Options on Futures Chain (loads all strikes/expirations)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;CONTFUT&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;CME&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;ES&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           build_options_chain</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> min_expiry_days</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> max_expiry_days</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">60</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Forex</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;CASH&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;IDEALPRO&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;EUR&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> currency</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;USD&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;CASH&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;IDEALPRO&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;GBP&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> currency</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;JPY&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Cryptocurrencies</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;CRYPTO&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;BTC&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;PAXOS&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> currency</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;USD&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;CRYPTO&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;ETH&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;PAXOS&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> currency</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;USD&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Indices</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;IND&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;SPX&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;CBOE&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;IND&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;NDX&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;NASDAQ&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Commodities</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;CMDTY&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;XAUUSD&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;SMART&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="advanced-configuration-options">Advanced configuration options<a href="#advanced-configuration-options" class="hash-link" aria-label="Advanced configuration options的直接链接" title="Advanced configuration options的直接链接" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Options chain with custom exchange</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;STK&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;AAPL&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;SMART&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    primaryExchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;NASDAQ&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    build_options_chain</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    options_chain_exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;CBOE&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Use CBOE for options instead of SMART</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    min_expiry_days</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max_expiry_days</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">45</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Futures chain with specific months</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;CONTFUT&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;NYMEX&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;CL&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Crude Oil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    build_futures_chain</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    min_expiry_days</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max_expiry_days</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">180</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="continuous-futures">Continuous futures<a href="#continuous-futures" class="hash-link" aria-label="Continuous futures的直接链接" title="Continuous futures的直接链接" translate="no">​</a></h3>
<p>For continuous futures contracts (using <code>secType=&#x27;CONTFUT&#x27;</code>), the adapter creates instrument IDs using just the symbol and venue:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Continuous futures examples</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;CONTFUT&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;CME&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;ES&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># → ES.CME</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;CONTFUT&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;NYMEX&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;CL&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># → CL.NYMEX</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># With MIC venue conversion enabled</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instrument_provider_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersInstrumentProviderConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    convert_exchange_to_mic_venue</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Results in:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ES.XCME (instead of ES.CME)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># CL.XNYM (instead of CL.NYMEX)</span><br></span></code></pre></div></div>
<p><strong>Continuous Futures vs Individual Futures:</strong></p>
<ul>
<li><strong>Continuous</strong>: <code>ES.CME</code> - Represents the front month contract, automatically rolls</li>
<li><strong>Individual</strong>: <code>ESM4.CME</code> - Specific March 2024 contract</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_lEzE alert alert--secondary"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_Vfkp"><p>When using <code>build_options_chain=True</code> or <code>build_futures_chain=True</code>, the <code>secType</code> and <code>symbol</code> should be specified for the underlying contract. The adapter will automatically discover and load all related derivative contracts within the specified expiry range.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="option-spreads">Option spreads<a href="#option-spreads" class="hash-link" aria-label="Option spreads的直接链接" title="Option spreads的直接链接" translate="no">​</a></h2>
<p>Interactive Brokers supports option spreads through BAG contracts, which combine multiple option legs into a single tradeable instrument. NautilusTrader provides comprehensive support for creating, loading, and trading option spreads.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="creating-option-spread-instrument-ids">Creating option spread instrument IDs<a href="#creating-option-spread-instrument-ids" class="hash-link" aria-label="Creating option spread instrument IDs的直接链接" title="Creating option spread instrument IDs的直接链接" translate="no">​</a></h3>
<p>Option spreads are created using the <code>InstrumentId.new_spread()</code> method, which combines individual option legs with their respective ratios:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">identifiers </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InstrumentId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Create individual option instrument IDs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">call_leg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InstrumentId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;SPY C400.SMART&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">put_leg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InstrumentId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;SPY P390.SMART&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Create a 1:1 call spread (long call, short call)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">call_spread_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InstrumentId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">new_spread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">call_leg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># Long 1 contract</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">put_leg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># Short 1 contract</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Create a 1:2 ratio spread</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ratio_spread_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InstrumentId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">new_spread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">call_leg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># Long 1 contract</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">put_leg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Long 2 contracts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="dynamic-spread-loading">Dynamic spread loading<a href="#dynamic-spread-loading" class="hash-link" aria-label="Dynamic spread loading的直接链接" title="Dynamic spread loading的直接链接" translate="no">​</a></h3>
<p>Option spreads must be requested before they can be traded or subscribed to for market data. Use the <code>request_instrument()</code> method to dynamically load spread instruments:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># In your strategy&#x27;s on_start method</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">on_start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Request the spread instrument</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">request_instrument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">spread_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">on_instrument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> instrument</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Handle the loaded spread instrument</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Loaded spread: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">instrument</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation builtin">id</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Now you can subscribe to market data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscribe_quote_ticks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># And place orders</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    order </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">order_factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">market</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        instrument_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        order_side</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">OrderSide</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BUY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        quantity</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">make_qty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        time_in_force</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">TimeInForce</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DAY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">submit_order</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">order</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="spread-trading-requirements">Spread trading requirements<a href="#spread-trading-requirements" class="hash-link" aria-label="Spread trading requirements的直接链接" title="Spread trading requirements的直接链接" translate="no">​</a></h3>
<ol>
<li><strong>Load individual legs first</strong>: Ensure the individual option legs are available before creating spreads.</li>
<li><strong>Request the spread instrument</strong>: Use <code>request_instrument()</code> to load the spread before trading.</li>
<li><strong>Subscribe to market data</strong>: Request quote ticks after the spread is loaded.</li>
<li><strong>Place orders</strong>: Any order type can be used once the spread is available.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="historical-data-and-backtesting">Historical data and backtesting<a href="#historical-data-and-backtesting" class="hash-link" aria-label="Historical data and backtesting的直接链接" title="Historical data and backtesting的直接链接" translate="no">​</a></h2>
<p>The <code>HistoricInteractiveBrokersClient</code> provides comprehensive methods for retrieving historical data from Interactive Brokers for backtesting and research purposes.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="supported-data-types">Supported data types<a href="#supported-data-types" class="hash-link" aria-label="Supported data types的直接链接" title="Supported data types的直接链接" translate="no">​</a></h3>
<ul>
<li><strong>Bar data</strong>: OHLCV bars with time, tick, and volume aggregations.</li>
<li><strong>Tick data</strong>: Trade ticks and quote ticks with microsecond precision.</li>
<li><strong>Instrument data</strong>: Complete contract specifications and trading rules.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="historical-data-client">Historical data client<a href="#historical-data-client" class="hash-link" aria-label="Historical data client的直接链接" title="Historical data client的直接链接" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">historical</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">client </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> HistoricInteractiveBrokersClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> ibapi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">common </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> MarketDataTypeEnum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Initialize the client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> HistoricInteractiveBrokersClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    host</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">7497</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client_id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    market_data_type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">MarketDataTypeEnum</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DELAYED_FROZEN</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Use delayed data if no subscription</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_level</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;INFO&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Connect to TWS/Gateway</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="retrieving-instruments">Retrieving instruments<a href="#retrieving-instruments" class="hash-link" aria-label="Retrieving instruments的直接链接" title="Retrieving instruments的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="basic-instrument-retrieval">Basic instrument retrieval<a href="#basic-instrument-retrieval" class="hash-link" aria-label="Basic instrument retrieval的直接链接" title="Basic instrument retrieval的直接链接" translate="no">​</a></h4>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">common </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> IBContract</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Define contracts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">contracts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;STK&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;AAPL&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;SMART&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> primaryExchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;NASDAQ&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;STK&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;MSFT&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;SMART&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> primaryExchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;NASDAQ&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;CASH&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;EUR&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> currency</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;USD&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;IDEALPRO&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Request instrument definitions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instruments </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">request_instruments</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">contracts</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">contracts</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="option-chain-retrieval-with-catalog-storage">Option chain retrieval with catalog storage<a href="#option-chain-retrieval-with-catalog-storage" class="hash-link" aria-label="Option chain retrieval with catalog storage的直接链接" title="Option chain retrieval with catalog storage的直接链接" translate="no">​</a></h4>
<p>You can download entire option chains using <code>request_instruments</code> in your strategy, with the added benefit of saving the data to the catalog using <code>update_catalog=True</code>:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># In your strategy&#x27;s on_start method</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">on_start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">request_instruments</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        venue</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">IB_VENUE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        update_catalog</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        params</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;update_catalog&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;ib_contracts&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># SPY options</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;secType&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;STK&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;symbol&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SPY&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;exchange&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SMART&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;primaryExchange&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ARCA&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;build_options_chain&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;min_expiry_days&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;max_expiry_days&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># QQQ options</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;secType&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;STK&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;symbol&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;QQQ&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;exchange&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SMART&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;primaryExchange&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;NASDAQ&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;build_options_chain&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;min_expiry_days&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;max_expiry_days&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># ES futures options</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;secType&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CONTFUT&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;exchange&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CME&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;symbol&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ES&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;build_options_chain&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;min_expiry_days&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;max_expiry_days&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="retrieving-historical-bars">Retrieving historical bars<a href="#retrieving-historical-bars" class="hash-link" aria-label="Retrieving historical bars的直接链接" title="Retrieving historical bars的直接链接" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> datetime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Request historical bars</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bars </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">request_bars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bar_specifications</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;1-MINUTE-LAST&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 1-minute bars using last price</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;5-MINUTE-MID&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># 5-minute bars using midpoint</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;1-HOUR-LAST&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 1-hour bars using last price</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;1-DAY-LAST&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic"># Daily bars using last price</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start_date_time</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">datetime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datetime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2023</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end_date_time</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">datetime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datetime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2023</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tz_name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;America/New_York&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    contracts</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">contracts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use_rth</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Regular Trading Hours only</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">120</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># Request timeout in seconds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="retrieving-historical-ticks">Retrieving historical ticks<a href="#retrieving-historical-ticks" class="hash-link" aria-label="Retrieving historical ticks的直接链接" title="Retrieving historical ticks的直接链接" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Request historical tick data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ticks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">request_ticks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tick_types</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;TRADES&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;BID_ASK&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Trade ticks and quote ticks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start_date_time</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">datetime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datetime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2023</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end_date_time</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">datetime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datetime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2023</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tz_name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;America/New_York&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    contracts</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">contracts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use_rth</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">120</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="bar-specifications">Bar specifications<a href="#bar-specifications" class="hash-link" aria-label="Bar specifications的直接链接" title="Bar specifications的直接链接" translate="no">​</a></h3>
<p>The adapter supports various bar specifications:</p>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="time-based-bars">Time-based bars<a href="#time-based-bars" class="hash-link" aria-label="Time-based bars的直接链接" title="Time-based bars的直接链接" translate="no">​</a></h4>
<ul>
<li><code>&quot;1-SECOND-LAST&quot;</code>, <code>&quot;5-SECOND-LAST&quot;</code>, <code>&quot;10-SECOND-LAST&quot;</code>, <code>&quot;15-SECOND-LAST&quot;</code>, <code>&quot;30-SECOND-LAST&quot;</code></li>
<li><code>&quot;1-MINUTE-LAST&quot;</code>, <code>&quot;2-MINUTE-LAST&quot;</code>, <code>&quot;3-MINUTE-LAST&quot;</code>, <code>&quot;5-MINUTE-LAST&quot;</code>, <code>&quot;10-MINUTE-LAST&quot;</code>, <code>&quot;15-MINUTE-LAST&quot;</code>, <code>&quot;20-MINUTE-LAST&quot;</code>, <code>&quot;30-MINUTE-LAST&quot;</code></li>
<li><code>&quot;1-HOUR-LAST&quot;</code>, <code>&quot;2-HOUR-LAST&quot;</code>, <code>&quot;3-HOUR-LAST&quot;</code>, <code>&quot;4-HOUR-LAST&quot;</code>, <code>&quot;8-HOUR-LAST&quot;</code></li>
<li><code>&quot;1-DAY-LAST&quot;</code>, <code>&quot;1-WEEK-LAST&quot;</code>, <code>&quot;1-MONTH-LAST&quot;</code></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="price-types">Price types<a href="#price-types" class="hash-link" aria-label="Price types的直接链接" title="Price types的直接链接" translate="no">​</a></h4>
<ul>
<li><code>LAST</code> - Last traded price</li>
<li><code>MID</code> - Midpoint of bid/ask</li>
<li><code>BID</code> - Bid price</li>
<li><code>ASK</code> - Ask price</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="complete-example">Complete example<a href="#complete-example" class="hash-link" aria-label="Complete example的直接链接" title="Complete example的直接链接" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> asyncio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> datetime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">common </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> IBContract</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">historical</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">client </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> HistoricInteractiveBrokersClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">persistence</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">catalog </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> ParquetDataCatalog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">download_historical_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Initialize client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> HistoricInteractiveBrokersClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        host</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">7497</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        client_id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Connect</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> asyncio</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Allow connection to stabilize</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Define contracts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    contracts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;STK&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;AAPL&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;SMART&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> primaryExchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;NASDAQ&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;CASH&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;EUR&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> currency</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;USD&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;IDEALPRO&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Request instruments</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instruments </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">request_instruments</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">contracts</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">contracts</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Request historical bars</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bars </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">request_bars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bar_specifications</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;1-HOUR-LAST&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1-DAY-LAST&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        start_date_time</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">datetime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datetime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2023</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end_date_time</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">datetime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datetime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2023</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tz_name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;America/New_York&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        contracts</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">contracts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        use_rth</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Request tick data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ticks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">request_ticks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tick_types</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;TRADES&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        start_date_time</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">datetime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datetime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2023</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">14</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end_date_time</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">datetime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datetime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2023</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tz_name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;America/New_York&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        contracts</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">contracts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Save to catalog</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catalog </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ParquetDataCatalog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./catalog&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">instruments</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bars</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ticks</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Downloaded </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation builtin">len</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">instruments</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> instruments&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Downloaded </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation builtin">len</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">bars</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> bars&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Downloaded </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation builtin">len</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">ticks</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> ticks&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Disconnect</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">disconnect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Run the example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;__main__&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    asyncio</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">download_historical_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="data-limitations">Data limitations<a href="#data-limitations" class="hash-link" aria-label="Data limitations的直接链接" title="Data limitations的直接链接" translate="no">​</a></h3>
<p>Be aware of Interactive Brokers&#x27; historical data limitations:</p>
<ul>
<li><strong>Rate Limits</strong>: IB enforces rate limits on historical data requests</li>
<li><strong>Data Availability</strong>: Historical data availability varies by instrument and subscription level</li>
<li><strong>Market Data Permissions</strong>: Some data requires specific market data subscriptions</li>
<li><strong>Time Ranges</strong>: Maximum lookback periods vary by bar size and instrument type</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="best-practices">Best practices<a href="#best-practices" class="hash-link" aria-label="Best practices的直接链接" title="Best practices的直接链接" translate="no">​</a></h3>
<ol>
<li><strong>Use Delayed Data</strong>: For backtesting, <code>MarketDataTypeEnum.DELAYED_FROZEN</code> is often sufficient</li>
<li><strong>Batch Requests</strong>: Group multiple instruments in single requests when possible</li>
<li><strong>Handle Timeouts</strong>: Set appropriate timeout values for large data requests</li>
<li><strong>Respect Rate Limits</strong>: Add delays between requests to avoid hitting rate limits</li>
<li><strong>Validate Data</strong>: Always check data quality and completeness before backtesting</li>
</ol>
<div class="theme-admonition theme-admonition-warning admonition_lEzE alert alert--warning"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_Vfkp"><p>Interactive Brokers enforces pacing limits; excessive historical-data or order requests trigger pacing violations and IB can disable the API session for several minutes.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="live-trading">Live trading<a href="#live-trading" class="hash-link" aria-label="Live trading的直接链接" title="Live trading的直接链接" translate="no">​</a></h2>
<p>Live trading with Interactive Brokers requires setting up a <code>TradingNode</code> that incorporates both <code>InteractiveBrokersDataClient</code> and <code>InteractiveBrokersExecutionClient</code>. These clients depend on the <code>InteractiveBrokersInstrumentProvider</code> for instrument management.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="architecture-overview">Architecture overview<a href="#architecture-overview" class="hash-link" aria-label="Architecture overview的直接链接" title="Architecture overview的直接链接" translate="no">​</a></h3>
<p>The live trading setup consists of three main components:</p>
<ol>
<li><strong>InstrumentProvider</strong>: Manages instrument definitions and contract details</li>
<li><strong>DataClient</strong>: Handles real-time market data subscriptions</li>
<li><strong>ExecutionClient</strong>: Manages orders, positions, and account information</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="instrumentprovider-configuration">InstrumentProvider configuration<a href="#instrumentprovider-configuration" class="hash-link" aria-label="InstrumentProvider configuration的直接链接" title="InstrumentProvider configuration的直接链接" translate="no">​</a></h3>
<p>The <code>InteractiveBrokersInstrumentProvider</code> serves as the bridge for accessing financial instrument data from IB. It supports loading individual instruments, options chains, and futures chains.</p>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="basic-configuration">Basic configuration<a href="#basic-configuration" class="hash-link" aria-label="Basic configuration的直接链接" title="Basic configuration的直接链接" translate="no">​</a></h4>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InteractiveBrokersInstrumentProviderConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> SymbologyMethod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">common </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> IBContract</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instrument_provider_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersInstrumentProviderConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    symbology_method</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">SymbologyMethod</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">IB_SIMPLIFIED</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    build_futures_chain</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Set to True if fetching futures chains</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    build_options_chain</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Set to True if fetching options chains</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    min_expiry_days</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic"># Minimum days to expiry for derivatives</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max_expiry_days</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">60</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic"># Maximum days to expiry for derivatives</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    convert_exchange_to_mic_venue</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Use MIC codes for venue mapping</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cache_validity_days</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Cache instrument data for 1 day</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    load_ids</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">frozenset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Individual instruments using simplified symbology</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;EUR/USD.IDEALPRO&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Forex</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;BTC/USD.PAXOS&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Cryptocurrency</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;SPY.ARCA&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic"># Stock ETF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;V.NYSE&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">               </span><span class="token comment" style="color:#999988;font-style:italic"># Individual stock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;ESM4.CME&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic"># Future contract (single digit year)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;^SPX.CBOE&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># Index</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    load_contracts</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">frozenset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Complex instruments using IBContract</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;STK&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;AAPL&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;SMART&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> primaryExchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;NASDAQ&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;CASH&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;GBP&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> currency</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;USD&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;IDEALPRO&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="advanced-configuration-for-derivatives">Advanced configuration for derivatives<a href="#advanced-configuration-for-derivatives" class="hash-link" aria-label="Advanced configuration for derivatives的直接链接" title="Advanced configuration for derivatives的直接链接" translate="no">​</a></h4>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Configuration for options and futures chains</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">advanced_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersInstrumentProviderConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    symbology_method</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">SymbologyMethod</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">IB_SIMPLIFIED</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    build_futures_chain</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># Enable futures chain loading</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    build_options_chain</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># Enable options chain loading</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    min_expiry_days</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># Load contracts expiring in 7+ days</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max_expiry_days</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">90</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic"># Load contracts expiring within 90 days</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    load_contracts</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">frozenset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Load SPY options chain</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;STK&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;SPY&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;SMART&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            primaryExchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;ARCA&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            build_options_chain</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Load ES futures chain</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IBContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            secType</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;CONTFUT&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            exchange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;CME&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;ES&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            build_futures_chain</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="integration-with-external-data-providers">Integration with external data providers<a href="#integration-with-external-data-providers" class="hash-link" aria-label="Integration with external data providers的直接链接" title="Integration with external data providers的直接链接" translate="no">​</a></h3>
<p>The Interactive Brokers adapter can be used alongside other data providers for enhanced market data coverage. When using multiple data sources:</p>
<ul>
<li>Use consistent symbology methods across providers</li>
<li>Consider using <code>convert_exchange_to_mic_venue=True</code> for standardized venue identification</li>
<li>Ensure instrument cache management is handled properly to avoid conflicts</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="data-client-configuration">Data client configuration<a href="#data-client-configuration" class="hash-link" aria-label="Data client configuration的直接链接" title="Data client configuration的直接链接" translate="no">​</a></h3>
<p>The <code>InteractiveBrokersDataClient</code> interfaces with IB for streaming and retrieving real-time market data. Upon connection, it configures the <a href="https://ibkrcampus.com/ibkr-api-page/trader-workstation-api/#delayed-market-data" target="_blank" rel="noopener noreferrer">market data type</a> and loads instruments based on the <code>InteractiveBrokersInstrumentProviderConfig</code> settings.</p>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="supported-data-types-1">Supported data types<a href="#supported-data-types-1" class="hash-link" aria-label="Supported data types的直接链接" title="Supported data types的直接链接" translate="no">​</a></h4>
<ul>
<li><strong>Quote Ticks</strong>: Real-time bid/ask prices and sizes</li>
<li><strong>Trade Ticks</strong>: Real-time trade prices and volumes</li>
<li><strong>Bar Data</strong>: Real-time OHLCV bars (1-second to 1-day intervals)</li>
<li><strong>Market Depth</strong>: Level 2 order book data (where available)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="market-data-types">Market data types<a href="#market-data-types" class="hash-link" aria-label="Market data types的直接链接" title="Market data types的直接链接" translate="no">​</a></h4>
<p>Interactive Brokers supports several market data types:</p>
<ul>
<li><code>REALTIME</code>: Live market data (requires market data subscriptions)</li>
<li><code>DELAYED</code>: 15-20 minute delayed data (free for most markets)</li>
<li><code>DELAYED_FROZEN</code>: Delayed data that doesn&#x27;t update (useful for testing)</li>
<li><code>FROZEN</code>: Last known real-time data (when market is closed)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="basic-data-client-configuration">Basic data client configuration<a href="#basic-data-client-configuration" class="hash-link" aria-label="Basic data client configuration的直接链接" title="Basic data client configuration的直接链接" translate="no">​</a></h4>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> IBMarketDataTypeEnum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InteractiveBrokersDataClientConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data_client_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersDataClientConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_host</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">7497</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># TWS paper trading port</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_client_id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use_regular_trading_hours</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># RTH only for stocks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    market_data_type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">IBMarketDataTypeEnum</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DELAYED_FROZEN</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Use delayed data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ignore_quote_tick_size_updates</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Include size-only updates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_provider</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument_provider_config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    connection_timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">300</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 5 minutes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    request_timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">60</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 1 minute</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="advanced-data-client-configuration">Advanced data client configuration<a href="#advanced-data-client-configuration" class="hash-link" aria-label="Advanced data client configuration的直接链接" title="Advanced data client configuration的直接链接" translate="no">​</a></h4>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Configuration for production with real-time data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">production_data_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersDataClientConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_host</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4001</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># IB Gateway live trading port</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_client_id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use_regular_trading_hours</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Include extended hours</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    market_data_type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">IBMarketDataTypeEnum</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">REALTIME</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Real-time data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ignore_quote_tick_size_updates</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Reduce tick volume</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handle_revised_bars</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Handle bar revisions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_provider</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument_provider_config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dockerized_gateway</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">dockerized_gateway_config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># If using Docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    connection_timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">300</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    request_timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">60</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="data-client-configuration-options">Data client configuration options<a href="#data-client-configuration-options" class="hash-link" aria-label="Data client configuration options的直接链接" title="Data client configuration options的直接链接" translate="no">​</a></h3>
<table><thead><tr><th>Option</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>instrument_provider</code></td><td><code>InteractiveBrokersInstrumentProviderConfig()</code></td><td>Instrument provider settings controlling which contracts load at startup.</td></tr><tr><td><code>ibg_host</code></td><td><code>127.0.0.1</code></td><td>Hostname or IP for TWS/IB Gateway.</td></tr><tr><td><code>ibg_port</code></td><td><code>None</code></td><td>Port for TWS/IB Gateway (<code>7497</code>/<code>7496</code> for TWS, <code>4002</code>/<code>4001</code> for IBG).</td></tr><tr><td><code>ibg_client_id</code></td><td><code>1</code></td><td>Unique client identifier used when connecting to TWS/IB Gateway.</td></tr><tr><td><code>use_regular_trading_hours</code></td><td><code>True</code></td><td>Request bars limited to regular trading hours when <code>True</code>.</td></tr><tr><td><code>market_data_type</code></td><td><code>REALTIME</code></td><td>Market data feed type (<code>REALTIME</code>, <code>DELAYED</code>, <code>DELAYED_FROZEN</code>, etc.).</td></tr><tr><td><code>ignore_quote_tick_size_updates</code></td><td><code>False</code></td><td>Suppress quote ticks where only size changes when <code>True</code>.</td></tr><tr><td><code>dockerized_gateway</code></td><td><code>None</code></td><td>Optional <code>DockerizedIBGatewayConfig</code> for containerized setups.</td></tr><tr><td><code>connection_timeout</code></td><td><code>300</code></td><td>Seconds to wait for the initial API connection.</td></tr><tr><td><code>request_timeout</code></td><td><code>60</code></td><td>Seconds to wait for historical data requests before timing out.</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="notes">Notes<a href="#notes" class="hash-link" aria-label="Notes的直接链接" title="Notes的直接链接" translate="no">​</a></h4>
<ul>
<li><strong><code>use_regular_trading_hours</code></strong>: When <code>True</code>, only requests data during regular trading hours. Primarily affects bar data for stocks.</li>
<li><strong><code>ignore_quote_tick_size_updates</code></strong>: When <code>True</code>, filters out quote ticks where only the size changed (not price), reducing data volume.</li>
<li><strong><code>handle_revised_bars</code></strong>: When <code>True</code>, processes bar revisions from IB (bars can be updated after initial publication).</li>
<li><strong><code>connection_timeout</code></strong>: Maximum time to wait for initial connection establishment.</li>
<li><strong><code>request_timeout</code></strong>: Maximum time to wait for historical data requests.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="execution-client-configuration-options">Execution client configuration options<a href="#execution-client-configuration-options" class="hash-link" aria-label="Execution client configuration options的直接链接" title="Execution client configuration options的直接链接" translate="no">​</a></h3>
<table><thead><tr><th>Option</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>instrument_provider</code></td><td><code>InteractiveBrokersInstrumentProviderConfig()</code></td><td>Instrument provider settings controlling which contracts load at startup.</td></tr><tr><td><code>ibg_host</code></td><td><code>127.0.0.1</code></td><td>Hostname or IP for TWS/IB Gateway.</td></tr><tr><td><code>ibg_port</code></td><td><code>None</code></td><td>Port for TWS/IB Gateway (<code>7497</code>/<code>7496</code> for TWS, <code>4002</code>/<code>4001</code> for IBG).</td></tr><tr><td><code>ibg_client_id</code></td><td><code>1</code></td><td>Unique client identifier used when connecting to TWS/IB Gateway.</td></tr><tr><td><code>account_id</code></td><td><code>None</code></td><td>Interactive Brokers account identifier (falls back to <code>TWS_ACCOUNT</code> env var).</td></tr><tr><td><code>dockerized_gateway</code></td><td><code>None</code></td><td>Optional <code>DockerizedIBGatewayConfig</code> for containerized setups.</td></tr><tr><td><code>connection_timeout</code></td><td><code>300</code></td><td>Seconds to wait for the initial API connection.</td></tr><tr><td><code>fetch_all_open_orders</code></td><td><code>False</code></td><td>When <code>True</code>, pulls open orders for every API client ID (not just this session).</td></tr><tr><td><code>track_option_exercise_from_position_update</code></td><td><code>False</code></td><td>Subscribe to real-time position updates to detect option exercises when <code>True</code>.</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="execution-client-configuration">Execution client configuration<a href="#execution-client-configuration" class="hash-link" aria-label="Execution client configuration的直接链接" title="Execution client configuration的直接链接" translate="no">​</a></h3>
<p>The <code>InteractiveBrokersExecutionClient</code> handles trade execution, order management, account information, and position tracking. It provides comprehensive order lifecycle management and real-time account updates.</p>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="supported-functionality">Supported functionality<a href="#supported-functionality" class="hash-link" aria-label="Supported functionality的直接链接" title="Supported functionality的直接链接" translate="no">​</a></h4>
<ul>
<li><strong>Order Management</strong>: Place, modify, and cancel orders</li>
<li><strong>Order Types</strong>: Market, limit, stop, stop-limit, trailing stop, and more</li>
<li><strong>Account Information</strong>: Real-time balance and margin updates</li>
<li><strong>Position Tracking</strong>: Real-time position updates and P&amp;L</li>
<li><strong>Trade Reporting</strong>: Execution reports and fill notifications</li>
<li><strong>Risk Management</strong>: Pre-trade risk checks and position limits</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="supported-order-types">Supported order types<a href="#supported-order-types" class="hash-link" aria-label="Supported order types的直接链接" title="Supported order types的直接链接" translate="no">​</a></h4>
<p>The adapter supports most Interactive Brokers order types:</p>
<ul>
<li><strong>Market Orders</strong>: <code>OrderType.MARKET</code></li>
<li><strong>Limit Orders</strong>: <code>OrderType.LIMIT</code></li>
<li><strong>Stop Orders</strong>: <code>OrderType.STOP_MARKET</code></li>
<li><strong>Stop-Limit Orders</strong>: <code>OrderType.STOP_LIMIT</code></li>
<li><strong>Market-If-Touched</strong>: <code>OrderType.MARKET_IF_TOUCHED</code></li>
<li><strong>Limit-If-Touched</strong>: <code>OrderType.LIMIT_IF_TOUCHED</code></li>
<li><strong>Trailing Stop Market</strong>: <code>OrderType.TRAILING_STOP_MARKET</code></li>
<li><strong>Trailing Stop Limit</strong>: <code>OrderType.TRAILING_STOP_LIMIT</code></li>
<li><strong>Market-on-Close</strong>: <code>OrderType.MARKET</code> with <code>TimeInForce.AT_THE_CLOSE</code></li>
<li><strong>Limit-on-Close</strong>: <code>OrderType.LIMIT</code> with <code>TimeInForce.AT_THE_CLOSE</code></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="time-in-force-options">Time in force options<a href="#time-in-force-options" class="hash-link" aria-label="Time in force options的直接链接" title="Time in force options的直接链接" translate="no">​</a></h4>
<ul>
<li><strong>Day Orders</strong>: <code>TimeInForce.DAY</code></li>
<li><strong>Good-Till-Canceled</strong>: <code>TimeInForce.GTC</code></li>
<li><strong>Immediate-or-Cancel</strong>: <code>TimeInForce.IOC</code></li>
<li><strong>Fill-or-Kill</strong>: <code>TimeInForce.FOK</code></li>
<li><strong>Good-Till-Date</strong>: <code>TimeInForce.GTD</code></li>
<li><strong>At-the-Open</strong>: <code>TimeInForce.AT_THE_OPEN</code></li>
<li><strong>At-the-Close</strong>: <code>TimeInForce.AT_THE_CLOSE</code></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="batch-operations">Batch operations<a href="#batch-operations" class="hash-link" aria-label="Batch operations的直接链接" title="Batch operations的直接链接" translate="no">​</a></h4>
<table><thead><tr><th>Operation</th><th>Supported</th><th>Notes</th></tr></thead><tbody><tr><td>Batch Submit</td><td>✓</td><td>Submit multiple orders in single request.</td></tr><tr><td>Batch Modify</td><td>✓</td><td>Modify multiple orders in single request.</td></tr><tr><td>Batch Cancel</td><td>✓</td><td>Cancel multiple orders in single request.</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="position-management">Position management<a href="#position-management" class="hash-link" aria-label="Position management的直接链接" title="Position management的直接链接" translate="no">​</a></h4>
<table><thead><tr><th>Feature</th><th>Supported</th><th>Notes</th></tr></thead><tbody><tr><td>Query positions</td><td>✓</td><td>Real-time position updates.</td></tr><tr><td>Position mode</td><td>✓</td><td>Net vs separate long/short positions.</td></tr><tr><td>Leverage control</td><td>✓</td><td>Account-level margin requirements.</td></tr><tr><td>Margin mode</td><td>✓</td><td>Portfolio vs individual margin.</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="order-querying">Order querying<a href="#order-querying" class="hash-link" aria-label="Order querying的直接链接" title="Order querying的直接链接" translate="no">​</a></h4>
<table><thead><tr><th>Feature</th><th>Supported</th><th>Notes</th></tr></thead><tbody><tr><td>Query open orders</td><td>✓</td><td>List all active orders.</td></tr><tr><td>Query order history</td><td>✓</td><td>Historical order data.</td></tr><tr><td>Order status updates</td><td>✓</td><td>Real-time order state changes.</td></tr><tr><td>Trade history</td><td>✓</td><td>Execution and fill reports.</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="contingent-orders">Contingent orders<a href="#contingent-orders" class="hash-link" aria-label="Contingent orders的直接链接" title="Contingent orders的直接链接" translate="no">​</a></h4>
<table><thead><tr><th>Feature</th><th>Supported</th><th>Notes</th></tr></thead><tbody><tr><td>Order lists</td><td>✓</td><td>Atomic multi-order submission.</td></tr><tr><td>OCO orders</td><td>✓</td><td>One-Cancels-Other with customizable OCA types (1, 2, 3).</td></tr><tr><td>Bracket orders</td><td>✓</td><td>Parent-child order relationships.</td></tr><tr><td>Conditional orders</td><td>✓</td><td>Advanced order conditions and triggers.</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="basic-execution-client-configuration">Basic execution client configuration<a href="#basic-execution-client-configuration" class="hash-link" aria-label="Basic execution client configuration的直接链接" title="Basic execution client configuration的直接链接" translate="no">​</a></h4>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InteractiveBrokersExecClientConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> RoutingConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec_client_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersExecClientConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_host</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">7497</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># TWS paper trading port</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_client_id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    account_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;DU123456&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Your IB account ID (paper or live)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_provider</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument_provider_config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    connection_timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">300</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    routing</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">RoutingConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Route all orders through this client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="advanced-execution-client-configuration">Advanced execution client configuration<a href="#advanced-execution-client-configuration" class="hash-link" aria-label="Advanced execution client configuration的直接链接" title="Advanced execution client configuration的直接链接" translate="no">​</a></h4>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Production configuration with dockerized gateway</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">production_exec_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersExecClientConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_host</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4001</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># IB Gateway live trading port</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_client_id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    account_id</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Will use TWS_ACCOUNT environment variable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_provider</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument_provider_config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dockerized_gateway</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">dockerized_gateway_config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    connection_timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">300</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    routing</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">RoutingConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="account-id-configuration">Account ID configuration<a href="#account-id-configuration" class="hash-link" aria-label="Account ID configuration的直接链接" title="Account ID configuration的直接链接" translate="no">​</a></h4>
<p>The <code>account_id</code> parameter is crucial and must match the account logged into TWS/Gateway:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Option 1: Specify directly in config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersExecClientConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    account_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;DU123456&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Paper trading account</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ... other parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Option 2: Use environment variable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;TWS_ACCOUNT&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;DU123456&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersExecClientConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    account_id</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Will use TWS_ACCOUNT env var</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ... other parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="order-tags-and-advanced-features">Order tags and advanced features<a href="#order-tags-and-advanced-features" class="hash-link" aria-label="Order tags and advanced features的直接链接" title="Order tags and advanced features的直接链接" translate="no">​</a></h4>
<p>The adapter supports IB-specific order parameters through order tags:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">common </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> IBOrderTags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Create order with IB-specific parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">order_tags </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> IBOrderTags</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    allOrNone</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic"># All-or-none order</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ocaGroup</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;MyGroup1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># One-cancels-all group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ocaType</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># Cancel with block</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    activeStartTime</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;20240315 09:30:00 EST&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># GTC activation time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    activeStopTime</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;20240315 16:00:00 EST&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># GTC deactivation time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    goodAfterTime</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;20240315 09:35:00 EST&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Good after time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Apply tags to an order</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">order </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> order_factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">limit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    order_side</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">OrderSide</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BUY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    quantity</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">make_qty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    price</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">make_price</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tags</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">order_tags</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="oca-one-cancels-all-orders">OCA (one-cancels-all) orders<a href="#oca-one-cancels-all-orders" class="hash-link" aria-label="OCA (one-cancels-all) orders的直接链接" title="OCA (one-cancels-all) orders的直接链接" translate="no">​</a></h4>
<p>The adapter provides comprehensive support for OCA orders through explicit configuration using <code>IBOrderTags</code>:</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="basic-oca-configuration">Basic OCA configuration<a href="#basic-oca-configuration" class="hash-link" aria-label="Basic OCA configuration的直接链接" title="Basic OCA configuration的直接链接" translate="no">​</a></h3>
<p>All OCA functionality must be explicitly configured using <code>IBOrderTags</code>:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">common </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> IBOrderTags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Create OCA configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">oca_tags </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> IBOrderTags</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ocaGroup</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;MY_OCA_GROUP&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ocaType</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Type 1: Cancel All with Block (recommended)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Apply to bracket orders</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bracket_order </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> order_factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bracket</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    order_side</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">OrderSide</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BUY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    quantity</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">make_qty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tp_price</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">make_price</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">110.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sl_trigger_price</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">make_price</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">90.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tp_tags</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">oca_tags</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Must explicitly add OCA tags</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sl_tags</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">oca_tags</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Must explicitly add OCA tags</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="advanced-oca-configuration">Advanced OCA configuration<a href="#advanced-oca-configuration" class="hash-link" aria-label="Advanced OCA configuration的直接链接" title="Advanced OCA configuration的直接链接" translate="no">​</a></h3>
<p>You can specify different OCA types and behaviors using <code>IBOrderTags</code>:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">common </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> IBOrderTags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Create custom OCA configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">custom_oca_tags </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> IBOrderTags</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ocaGroup</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;MY_CUSTOM_GROUP&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ocaType</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Use Type 2: Reduce with Block</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Apply to individual orders</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">order </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> order_factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">limit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    order_side</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">OrderSide</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BUY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    quantity</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">make_qty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    price</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">make_price</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tags</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">custom_oca_tags</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="oca-types">OCA types<a href="#oca-types" class="hash-link" aria-label="OCA types的直接链接" title="OCA types的直接链接" translate="no">​</a></h3>
<p>Interactive Brokers supports three OCA types:</p>
<table><thead><tr><th>Type</th><th>Name</th><th>Behavior</th><th>Use Case</th></tr></thead><tbody><tr><td><strong>1</strong></td><td>Cancel All with Block</td><td>Cancel all remaining orders with block protection</td><td><strong>Default</strong> - Safest option, prevents overfills</td></tr><tr><td><strong>2</strong></td><td>Reduce with Block</td><td>Proportionally reduce remaining orders with block protection</td><td>Partial fills with overfill protection</td></tr><tr><td><strong>3</strong></td><td>Reduce without Block</td><td>Proportionally reduce remaining orders without block protection</td><td>Fastest execution, higher overfill risk</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="multiple-orders-in-same-oca-group">Multiple orders in same OCA group<a href="#multiple-orders-in-same-oca-group" class="hash-link" aria-label="Multiple orders in same OCA group的直接链接" title="Multiple orders in same OCA group的直接链接" translate="no">​</a></h4>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Create multiple orders with the same OCA group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">oca_tags </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> IBOrderTags</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ocaGroup</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;MULTI_ORDER_GROUP&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ocaType</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Use Type 3: Reduce without Block</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">order1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> order_factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">limit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    order_side</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">OrderSide</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BUY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    quantity</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">make_qty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    price</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">make_price</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">99.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tags</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">oca_tags</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">order2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> order_factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">limit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    order_side</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">OrderSide</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BUY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    quantity</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">make_qty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    price</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">make_price</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">101.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tags</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">oca_tags</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="oca-configuration-requirements">OCA configuration requirements<a href="#oca-configuration-requirements" class="hash-link" aria-label="OCA configuration requirements的直接链接" title="OCA configuration requirements的直接链接" translate="no">​</a></h3>
<p>OCA functionality is <strong>only</strong> available through explicit configuration:</p>
<ol>
<li><strong>IBOrderTags Required</strong> - OCA settings must be explicitly specified in order tags</li>
<li><strong>No Automatic Detection</strong> - <code>ContingencyType.OCO</code> and <code>ContingencyType.OUO</code> do not automatically create OCA groups</li>
<li><strong>Manual Configuration</strong> - All OCA groups and types must be manually specified</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="conditional-orders">Conditional orders<a href="#conditional-orders" class="hash-link" aria-label="Conditional orders的直接链接" title="Conditional orders的直接链接" translate="no">​</a></h3>
<p>The adapter supports Interactive Brokers conditional orders through the <code>conditions</code> parameter in <code>IBOrderTags</code>. Conditional orders allow you to specify criteria that must be met before an order is transmitted or cancelled.</p>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="supported-condition-types">Supported condition types<a href="#supported-condition-types" class="hash-link" aria-label="Supported condition types的直接链接" title="Supported condition types的直接链接" translate="no">​</a></h4>
<ul>
<li><strong>Price Conditions</strong>: Trigger based on price movements of a specific instrument</li>
<li><strong>Time Conditions</strong>: Trigger at a specific date and time</li>
<li><strong>Volume Conditions</strong>: Trigger based on trading volume thresholds</li>
<li><strong>Execution Conditions</strong>: Trigger when trades occur for a specific instrument</li>
<li><strong>Margin Conditions</strong>: Trigger based on account margin levels</li>
<li><strong>Percent Change Conditions</strong>: Trigger based on percentage price changes</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="basic-conditional-order-example">Basic conditional order example<a href="#basic-conditional-order-example" class="hash-link" aria-label="Basic conditional order example的直接链接" title="Basic conditional order example的直接链接" translate="no">​</a></h4>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">common </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> IBOrderTags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Create a price condition: trigger when SPY goes above $250</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">price_condition </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;price&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;conId&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">265598</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># SPY contract ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;exchange&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SMART&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;isMore&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Trigger when price is greater than threshold</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;price&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">250.00</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;triggerMethod&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Default trigger method</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;conjunction&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;and&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Create order tags with condition</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">order_tags </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> IBOrderTags</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conditions</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">price_condition</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conditionsCancelOrder</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Transmit order when condition is met</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Apply to order</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">order </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> order_factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">limit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    order_side</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">OrderSide</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BUY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    quantity</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">make_qty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    price</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">make_price</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">251.00</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tags</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">order_tags</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="multiple-conditions-with-logic">Multiple conditions with logic<a href="#multiple-conditions-with-logic" class="hash-link" aria-label="Multiple conditions with logic的直接链接" title="Multiple conditions with logic的直接链接" translate="no">​</a></h4>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Create multiple conditions with AND/OR logic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conditions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;price&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;conId&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">265598</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;exchange&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SMART&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;isMore&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;price&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">250.00</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;triggerMethod&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;conjunction&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;and&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># AND with next condition</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;time&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;time&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;20250315-09:30:00&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;isMore&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;conjunction&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;or&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># OR with next condition</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;volume&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;conId&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">265598</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;exchange&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SMART&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;isMore&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;volume&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10000000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;conjunction&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;and&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">order_tags </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> IBOrderTags</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conditions</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">conditions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conditionsCancelOrder</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="condition-parameters">Condition parameters<a href="#condition-parameters" class="hash-link" aria-label="Condition parameters的直接链接" title="Condition parameters的直接链接" translate="no">​</a></h4>
<p><strong>Price Condition:</strong></p>
<ul>
<li><code>conId</code>: Contract ID of the instrument to monitor</li>
<li><code>exchange</code>: Exchange to monitor (e.g., &quot;SMART&quot;, &quot;NASDAQ&quot;)</li>
<li><code>isMore</code>: True for &gt;=, False for &lt;=- <code>price</code>: Price threshold</li>
<li><code>triggerMethod</code>: 0=Default, 1=DoubleBidAsk, 2=Last, 3=DoubleLast, 4=BidAsk, 7=LastBidAsk, 8=MidPoint</li>
</ul>
<p><strong>Time Condition:</strong></p>
<ul>
<li><code>time</code>: Time string in UTC format &quot;YYYYMMDD-HH:MM<!-- -->:SS<!-- -->&quot; (e.g., &quot;20250315-09:30:00&quot;)</li>
<li><code>isMore</code>: True for after time, False for before time</li>
</ul>
<p><strong>Volume Condition:</strong></p>
<ul>
<li><code>conId</code>: Contract ID of the instrument to monitor</li>
<li><code>exchange</code>: Exchange to monitor</li>
<li><code>isMore</code>: True for &gt;=, False for &lt;=- <code>volume</code>: Volume threshold</li>
</ul>
<p><strong>Execution Condition:</strong></p>
<ul>
<li><code>symbol</code>: Symbol to monitor for trades</li>
<li><code>secType</code>: Security type (e.g., &quot;STK&quot;, &quot;OPT&quot;, &quot;FUT&quot;)</li>
<li><code>exchange</code>: Exchange to monitor</li>
</ul>
<p><strong>Margin Condition:</strong></p>
<ul>
<li>
<p><code>percent</code>: Margin cushion percentage threshold</p>
</li>
<li>
<p><code>isMore</code>: True for &gt;=, False for &lt;=
<strong>Percent Change Condition:</strong></p>
</li>
<li>
<p><code>conId</code>: Contract ID of the instrument to monitor</p>
</li>
<li>
<p><code>exchange</code>: Exchange to monitor</p>
</li>
<li>
<p><code>isMore</code>: True for &gt;=, False for &lt;=- <code>changePercent</code>: Percentage change threshold</p>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="complete-example-all-condition-types">Complete example: all condition types<a href="#complete-example-all-condition-types" class="hash-link" aria-label="Complete example: all condition types的直接链接" title="Complete example: all condition types的直接链接" translate="no">​</a></h4>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Example showing all 6 supported condition types</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">common </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> IBOrderTags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 1. Price Condition - trigger when ES futures &gt; 6000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">price_condition </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;price&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;conId&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">495512563</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ES futures contract ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;exchange&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CME&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;isMore&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;price&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6000.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;triggerMethod&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;conjunction&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;and&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2. Time Condition - trigger at specific time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time_condition </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;time&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;time&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;20250315-09:30:00&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># UTC format</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;isMore&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;conjunction&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;and&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 3. Volume Condition - trigger when volume &gt; 100,000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">volume_condition </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;volume&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;conId&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">495512563</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;exchange&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CME&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;isMore&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;volume&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;conjunction&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;and&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 4. Execution Condition - trigger when SPY trades</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">execution_condition </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;execution&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;symbol&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SPY&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;secType&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;STK&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;exchange&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SMART&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;conjunction&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;and&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 5. Margin Condition - trigger when margin cushion &gt; 75%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">margin_condition </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;margin&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;percent&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">75</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;isMore&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;conjunction&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;and&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 6. Percent Change Condition - trigger when price changes &gt; 5%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">percent_change_condition </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;percent_change&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;conId&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">495512563</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;exchange&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CME&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;changePercent&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;isMore&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;conjunction&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;and&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Use any combination of conditions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">order_tags </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> IBOrderTags</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conditions</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">price_condition</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> time_condition</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Multiple conditions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conditionsCancelOrder</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Transmit when conditions met</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="order-behavior">Order behavior<a href="#order-behavior" class="hash-link" aria-label="Order behavior的直接链接" title="Order behavior的直接链接" translate="no">​</a></h4>
<p>Set <code>conditionsCancelOrder</code> to control what happens when conditions are met:</p>
<ul>
<li><code>False</code>: Transmit the order when conditions are satisfied</li>
<li><code>True</code>: Cancel the order when conditions are satisfied</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="implementation-notes">Implementation notes<a href="#implementation-notes" class="hash-link" aria-label="Implementation notes的直接链接" title="Implementation notes的直接链接" translate="no">​</a></h4>
<ul>
<li><strong>All 6 condition types are fully supported</strong> and tested with live Interactive Brokers orders</li>
<li><strong>Price conditions</strong> work correctly despite a known bug in the ibapi library where <code>PriceCondition.__str__</code> is incorrectly decorated as a property</li>
<li><strong>Time conditions</strong> use UTC format with dash separator (<code>YYYYMMDD-HH:MM:SS</code>) for reliable parsing</li>
<li><strong>Conjunction logic</strong> allows complex condition combinations using &quot;and&quot;/&quot;or&quot; operators</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="complete-trading-node-configuration">Complete trading node configuration<a href="#complete-trading-node-configuration" class="hash-link" aria-label="Complete trading node configuration的直接链接" title="Complete trading node configuration的直接链接" translate="no">​</a></h3>
<p>Setting up a complete trading environment involves configuring a <code>TradingNodeConfig</code> with all necessary components. Here are comprehensive examples for different scenarios.</p>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="paper-trading-configuration">Paper trading configuration<a href="#paper-trading-configuration" class="hash-link" aria-label="Paper trading configuration的直接链接" title="Paper trading configuration的直接链接" translate="no">​</a></h4>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">common </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> IB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">common </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> IB_VENUE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InteractiveBrokersDataClientConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InteractiveBrokersExecClientConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InteractiveBrokersInstrumentProviderConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> IBMarketDataTypeEnum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> SymbologyMethod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">factories </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InteractiveBrokersLiveDataClientFactory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">factories </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InteractiveBrokersLiveExecClientFactory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> LiveDataEngineConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> LoggingConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> RoutingConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> TradingNodeConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">live</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">node </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> TradingNode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Instrument provider configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instrument_provider_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersInstrumentProviderConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    symbology_method</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">SymbologyMethod</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">IB_SIMPLIFIED</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    load_ids</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">frozenset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;EUR/USD.IDEALPRO&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;GBP/USD.IDEALPRO&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;SPY.ARCA&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;QQQ.NASDAQ&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;AAPL.NASDAQ&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;MSFT.NASDAQ&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Data client configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data_client_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersDataClientConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_host</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">7497</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># TWS paper trading</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_client_id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use_regular_trading_hours</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    market_data_type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">IBMarketDataTypeEnum</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DELAYED_FROZEN</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_provider</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument_provider_config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Execution client configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec_client_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersExecClientConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_host</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">7497</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># TWS paper trading</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_client_id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    account_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;DU123456&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Your paper trading account</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_provider</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument_provider_config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    routing</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">RoutingConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Trading node configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config_node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TradingNodeConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trader_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;PAPER-TRADER-001&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logging</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">LoggingConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log_level</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;INFO&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_clients</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">IB</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> data_client_config</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exec_clients</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">IB</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> exec_client_config</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_engine</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">LiveDataEngineConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        time_bars_timestamp_on_close</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># IB standard: use bar open time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        validate_data_sequence</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic"># Discard out-of-sequence bars</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timeout_connection</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">90.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timeout_reconciliation</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timeout_portfolio</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timeout_disconnection</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timeout_post_stop</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Create and configure the trading node</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TradingNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">config_node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_data_client_factory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IB</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> InteractiveBrokersLiveDataClientFactory</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_exec_client_factory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IB</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> InteractiveBrokersLiveExecClientFactory</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">portfolio</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_specific_venue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IB_VENUE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;__main__&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">finally</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dispose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="live-trading-with-dockerized-gateway">Live trading with Dockerized gateway<a href="#live-trading-with-dockerized-gateway" class="hash-link" aria-label="Live trading with Dockerized gateway的直接链接" title="Live trading with Dockerized gateway的直接链接" translate="no">​</a></h2>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive_brokers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> DockerizedIBGatewayConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Dockerized gateway configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dockerized_gateway_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DockerizedIBGatewayConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    username</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;TWS_USERNAME&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    password</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;TWS_PASSWORD&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trading_mode</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;live&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># &quot;paper&quot; or &quot;live&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    read_only_api</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Allow order execution</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">300</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Data client with dockerized gateway</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data_client_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersDataClientConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_client_id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use_regular_trading_hours</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Include extended hours</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    market_data_type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">IBMarketDataTypeEnum</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">REALTIME</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_provider</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument_provider_config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dockerized_gateway</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">dockerized_gateway_config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Execution client with dockerized gateway</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec_client_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersExecClientConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_client_id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    account_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;TWS_ACCOUNT&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Live account ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_provider</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument_provider_config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dockerized_gateway</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">dockerized_gateway_config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    routing</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">RoutingConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Live trading node configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config_node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TradingNodeConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trader_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;LIVE-TRADER-001&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logging</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">LoggingConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log_level</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;INFO&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_clients</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">IB</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> data_client_config</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exec_clients</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">IB</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> exec_client_config</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_engine</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">LiveDataEngineConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        time_bars_timestamp_on_close</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        validate_data_sequence</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="multi-client-configuration">Multi-client configuration<a href="#multi-client-configuration" class="hash-link" aria-label="Multi-client configuration的直接链接" title="Multi-client configuration的直接链接" translate="no">​</a></h3>
<p>For advanced setups, you can configure multiple clients with different purposes:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Separate data and execution clients with different client IDs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data_client_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersDataClientConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_host</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">7497</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_client_id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Data client uses ID 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    market_data_type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">IBMarketDataTypeEnum</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">REALTIME</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_provider</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument_provider_config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec_client_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersExecClientConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_host</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">7497</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ibg_client_id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Execution client uses ID 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    account_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;DU123456&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_provider</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">instrument_provider_config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    routing</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">RoutingConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="running-the-trading-node">Running the trading node<a href="#running-the-trading-node" class="hash-link" aria-label="Running the trading node的直接链接" title="Running the trading node的直接链接" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run_trading_node</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Run the trading node with proper error handling.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Create and build node</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TradingNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">config_node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_data_client_factory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IB</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> InteractiveBrokersLiveDataClientFactory</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_exec_client_factory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IB</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> InteractiveBrokersLiveExecClientFactory</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Set venue for portfolio</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">portfolio</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_specific_venue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IB_VENUE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Add your strategies here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># node.trader.add_strategy(YourStrategy())</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Run the node</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">except</span><span class="token plain"> KeyboardInterrupt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Shutting down...&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">except</span><span class="token plain"> Exception </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Error: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">e</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">finally</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dispose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;__main__&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    run_trading_node</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="additional-configuration-options">Additional configuration options<a href="#additional-configuration-options" class="hash-link" aria-label="Additional configuration options的直接链接" title="Additional configuration options的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="environment-variables-1">Environment variables<a href="#environment-variables-1" class="hash-link" aria-label="Environment variables的直接链接" title="Environment variables的直接链接" translate="no">​</a></h4>
<p>Set these environment variables for easier configuration:</p>
<div class="language-bash codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-bash codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">export TWS_USERNAME=&quot;your_ib_username&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export TWS_PASSWORD=&quot;your_ib_password&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export TWS_ACCOUNT=&quot;your_account_id&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export IB_MAX_CONNECTION_ATTEMPTS=&quot;5&quot;  # Optional: limit reconnection attempts</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="logging-configuration">Logging configuration<a href="#logging-configuration" class="hash-link" aria-label="Logging configuration的直接链接" title="Logging configuration的直接链接" translate="no">​</a></h4>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Enhanced logging configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> LoggingConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_level</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;INFO&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_level_file</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;DEBUG&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_file_format</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;json&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># JSON format for structured logging</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_component_levels</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;InteractiveBrokersClient&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;DEBUG&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;InteractiveBrokersDataClient&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;INFO&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;InteractiveBrokersExecutionClient&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;INFO&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>You can find additional examples here: <a href="https://github.com/nautechsystems/nautilus_trader/tree/develop/examples/live/interactive_brokers" target="_blank" rel="noopener noreferrer">https://github.com/nautechsystems/nautilus_trader/tree/develop/examples/live/interactive_brokers</a></p>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Troubleshooting的直接链接" title="Troubleshooting的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="common-connection-issues">Common connection issues<a href="#common-connection-issues" class="hash-link" aria-label="Common connection issues的直接链接" title="Common connection issues的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="connection-refused">Connection refused<a href="#connection-refused" class="hash-link" aria-label="Connection refused的直接链接" title="Connection refused的直接链接" translate="no">​</a></h4>
<ul>
<li><strong>Cause</strong>: TWS/Gateway not running or wrong port</li>
<li><strong>Solution</strong>: Verify TWS/Gateway is running and check port configuration</li>
<li><strong>Default Ports</strong>: TWS (7497/7496), IB Gateway (4002/4001)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="authentication-errors">Authentication errors<a href="#authentication-errors" class="hash-link" aria-label="Authentication errors的直接链接" title="Authentication errors的直接链接" translate="no">​</a></h4>
<ul>
<li><strong>Cause</strong>: Incorrect credentials or account not logged in</li>
<li><strong>Solution</strong>: Verify username/password and ensure account is logged into TWS/Gateway</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="client-id-conflicts">Client ID conflicts<a href="#client-id-conflicts" class="hash-link" aria-label="Client ID conflicts的直接链接" title="Client ID conflicts的直接链接" translate="no">​</a></h4>
<ul>
<li><strong>Cause</strong>: Multiple clients using the same client ID</li>
<li><strong>Solution</strong>: Use unique client IDs for each connection</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="market-data-permissions">Market data permissions<a href="#market-data-permissions" class="hash-link" aria-label="Market data permissions的直接链接" title="Market data permissions的直接链接" translate="no">​</a></h4>
<ul>
<li><strong>Cause</strong>: Insufficient market data subscriptions</li>
<li><strong>Solution</strong>: Use <code>IBMarketDataTypeEnum.DELAYED_FROZEN</code> for testing or subscribe to required data feeds</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="error-codes">Error codes<a href="#error-codes" class="hash-link" aria-label="Error codes的直接链接" title="Error codes的直接链接" translate="no">​</a></h3>
<p>Interactive Brokers uses specific error codes. Common ones include:</p>
<ul>
<li><strong>200</strong>: No security definition found</li>
<li><strong>201</strong>: Order rejected - reason follows</li>
<li><strong>202</strong>: Order cancelled</li>
<li><strong>300</strong>: Can&#x27;t find EId with ticker ID</li>
<li><strong>354</strong>: Requested market data is not subscribed</li>
<li><strong>2104</strong>: Market data farm connection is OK</li>
<li><strong>2106</strong>: HMDS data farm connection is OK</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="performance-optimization">Performance optimization<a href="#performance-optimization" class="hash-link" aria-label="Performance optimization的直接链接" title="Performance optimization的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="reduce-data-volume">Reduce data volume<a href="#reduce-data-volume" class="hash-link" aria-label="Reduce data volume的直接链接" title="Reduce data volume的直接链接" translate="no">​</a></h4>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Reduce quote tick volume by ignoring size-only updates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersDataClientConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ignore_quote_tick_size_updates</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ... other config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="connection-management-1">Connection management<a href="#connection-management-1" class="hash-link" aria-label="Connection management的直接链接" title="Connection management的直接链接" translate="no">​</a></h4>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Set reasonable timeouts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InteractiveBrokersDataClientConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    connection_timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">300</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 5 minutes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    request_timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">60</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 1 minute</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ... other config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="memory-management">Memory management<a href="#memory-management" class="hash-link" aria-label="Memory management的直接链接" title="Memory management的直接链接" translate="no">​</a></h4>
<ul>
<li>Use appropriate bar sizes for your strategy</li>
<li>Limit the number of simultaneous subscriptions</li>
<li>Consider using historical data for backtesting instead of live data</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="best-practices-1">Best practices<a href="#best-practices-1" class="hash-link" aria-label="Best practices的直接链接" title="Best practices的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="security">Security<a href="#security" class="hash-link" aria-label="Security的直接链接" title="Security的直接链接" translate="no">​</a></h4>
<ul>
<li>Never hardcode credentials in source code</li>
<li>Use environment variables for sensitive information</li>
<li>Use paper trading for development and testing</li>
<li>Set <code>read_only_api=True</code> for data-only applications</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="development-workflow">Development workflow<a href="#development-workflow" class="hash-link" aria-label="Development workflow的直接链接" title="Development workflow的直接链接" translate="no">​</a></h4>
<ol>
<li><strong>Start with Paper Trading</strong>: Always test with paper trading first</li>
<li><strong>Use Delayed Data</strong>: Use <code>DELAYED_FROZEN</code> market data for development</li>
<li><strong>Implement Proper Error Handling</strong>: Handle connection losses and API errors gracefully</li>
<li><strong>Monitor Logs</strong>: Enable appropriate logging levels for debugging</li>
<li><strong>Test Reconnection</strong>: Test your strategy&#x27;s behavior during connection interruptions</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="production-deployment">Production deployment<a href="#production-deployment" class="hash-link" aria-label="Production deployment的直接链接" title="Production deployment的直接链接" translate="no">​</a></h4>
<ul>
<li>Use dockerized gateway for automated deployments</li>
<li>Implement proper monitoring and alerting</li>
<li>Set up log aggregation and analysis</li>
<li>Use real-time data subscriptions only when necessary</li>
<li>Implement circuit breakers and position limits</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="order-management">Order management<a href="#order-management" class="hash-link" aria-label="Order management的直接链接" title="Order management的直接链接" translate="no">​</a></h4>
<ul>
<li>Always validate orders before submission</li>
<li>Implement proper position sizing</li>
<li>Use appropriate order types for your strategy</li>
<li>Monitor order status and handle rejections</li>
<li>Implement timeout handling for order operations</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="debugging-tips">Debugging tips<a href="#debugging-tips" class="hash-link" aria-label="Debugging tips的直接链接" title="Debugging tips的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="enable-debug-logging">Enable debug logging<a href="#enable-debug-logging" class="hash-link" aria-label="Enable debug logging的直接链接" title="Enable debug logging的直接链接" translate="no">​</a></h4>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">logging_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> LoggingConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_level</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;DEBUG&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_component_levels</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;InteractiveBrokersClient&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;DEBUG&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="monitor-connection-status">Monitor connection status<a href="#monitor-connection-status" class="hash-link" aria-label="Monitor connection status的直接链接" title="Monitor connection status的直接链接" translate="no">​</a></h4>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Check connection status in your strategy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data_client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">is_connected</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">warning</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Data client disconnected&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="validate-instruments">Validate instruments<a href="#validate-instruments" class="hash-link" aria-label="Validate instruments的直接链接" title="Validate instruments的直接链接" translate="no">​</a></h4>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Ensure instruments are loaded before trading</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instruments </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">instruments</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> instruments</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;No instruments loaded&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="support-and-resources">Support and resources<a href="#support-and-resources" class="hash-link" aria-label="Support and resources的直接链接" title="Support and resources的直接链接" translate="no">​</a></h3>
<ul>
<li><strong>IB API Documentation</strong>: <a href="https://ibkrcampus.com/ibkr-api-page/trader-workstation-api/" target="_blank" rel="noopener noreferrer">TWS API Guide</a></li>
<li><strong>NautilusTrader Examples</strong>: <a href="https://github.com/nautechsystems/nautilus_trader/tree/develop/examples/live/interactive_brokers" target="_blank" rel="noopener noreferrer">GitHub Examples</a></li>
<li><strong>IB Contract Search</strong>: <a href="https://pennies.interactivebrokers.com/cstools/contract_info/" target="_blank" rel="noopener noreferrer">Contract Information Center</a></li>
<li><strong>Market Data Subscriptions</strong>: <a href="https://www.interactivebrokers.com/en/trading/market-data.php" target="_blank" rel="noopener noreferrer">IB Market Data</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/Aloento/NautilusTraderDoc/tree/main/docs/integrations/ib.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_F7ru" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_GNoA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/integrations/hyperliquid"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Hyperliquid</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/integrations/okx"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">OKX</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_pg_n thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#installation" class="table-of-contents__link toc-highlight">Installation</a></li><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a></li><li><a href="#getting-started" class="table-of-contents__link toc-highlight">Getting started</a><ul><li><a href="#connection-methods" class="table-of-contents__link toc-highlight">Connection methods</a></li><li><a href="#default-ports" class="table-of-contents__link toc-highlight">Default ports</a></li><li><a href="#establish-connection-to-an-existing-gateway-or-tws" class="table-of-contents__link toc-highlight">Establish connection to an existing gateway or TWS</a></li><li><a href="#establish-connection-to-dockerized-ib-gateway" class="table-of-contents__link toc-highlight">Establish connection to Dockerized IB Gateway</a></li><li><a href="#environment-variables" class="table-of-contents__link toc-highlight">Environment variables</a></li><li><a href="#connection-management" class="table-of-contents__link toc-highlight">Connection management</a></li></ul></li><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a><ul><li><a href="#core-components" class="table-of-contents__link toc-highlight">Core components</a></li><li><a href="#supporting-components" class="table-of-contents__link toc-highlight">Supporting components</a></li><li><a href="#supported-asset-classes" class="table-of-contents__link toc-highlight">Supported asset classes</a></li></ul></li><li><a href="#the-interactive-brokers-client" class="table-of-contents__link toc-highlight">The Interactive Brokers client</a><ul><li><a href="#client-architecture" class="table-of-contents__link toc-highlight">Client architecture</a></li><li><a href="#key-features" class="table-of-contents__link toc-highlight">Key features</a></li></ul></li><li><a href="#symbology" class="table-of-contents__link toc-highlight">Symbology</a><ul><li><a href="#symbology-methods" class="table-of-contents__link toc-highlight">Symbology methods</a></li><li><a href="#mic-venue-conversion" class="table-of-contents__link toc-highlight">MIC venue conversion</a></li><li><a href="#supported-instrument-formats" class="table-of-contents__link toc-highlight">Supported instrument formats</a></li><li><a href="#choosing-the-right-symbology-method" class="table-of-contents__link toc-highlight">Choosing the right symbology method</a></li></ul></li><li><a href="#instruments-and-contracts" class="table-of-contents__link toc-highlight">Instruments and contracts</a><ul><li><a href="#contract-types" class="table-of-contents__link toc-highlight">Contract types</a></li><li><a href="#contract-discovery" class="table-of-contents__link toc-highlight">Contract discovery</a></li><li><a href="#loading-instruments" class="table-of-contents__link toc-highlight">Loading instruments</a></li><li><a href="#ibcontract-examples-by-asset-class" class="table-of-contents__link toc-highlight">IBContract examples by asset class</a></li><li><a href="#advanced-configuration-options" class="table-of-contents__link toc-highlight">Advanced configuration options</a></li><li><a href="#continuous-futures" class="table-of-contents__link toc-highlight">Continuous futures</a></li></ul></li><li><a href="#option-spreads" class="table-of-contents__link toc-highlight">Option spreads</a><ul><li><a href="#creating-option-spread-instrument-ids" class="table-of-contents__link toc-highlight">Creating option spread instrument IDs</a></li><li><a href="#dynamic-spread-loading" class="table-of-contents__link toc-highlight">Dynamic spread loading</a></li><li><a href="#spread-trading-requirements" class="table-of-contents__link toc-highlight">Spread trading requirements</a></li></ul></li><li><a href="#historical-data-and-backtesting" class="table-of-contents__link toc-highlight">Historical data and backtesting</a><ul><li><a href="#supported-data-types" class="table-of-contents__link toc-highlight">Supported data types</a></li><li><a href="#historical-data-client" class="table-of-contents__link toc-highlight">Historical data client</a></li><li><a href="#retrieving-instruments" class="table-of-contents__link toc-highlight">Retrieving instruments</a></li><li><a href="#retrieving-historical-bars" class="table-of-contents__link toc-highlight">Retrieving historical bars</a></li><li><a href="#retrieving-historical-ticks" class="table-of-contents__link toc-highlight">Retrieving historical ticks</a></li><li><a href="#bar-specifications" class="table-of-contents__link toc-highlight">Bar specifications</a></li><li><a href="#complete-example" class="table-of-contents__link toc-highlight">Complete example</a></li><li><a href="#data-limitations" class="table-of-contents__link toc-highlight">Data limitations</a></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best practices</a></li></ul></li><li><a href="#live-trading" class="table-of-contents__link toc-highlight">Live trading</a><ul><li><a href="#architecture-overview" class="table-of-contents__link toc-highlight">Architecture overview</a></li><li><a href="#instrumentprovider-configuration" class="table-of-contents__link toc-highlight">InstrumentProvider configuration</a></li><li><a href="#integration-with-external-data-providers" class="table-of-contents__link toc-highlight">Integration with external data providers</a></li><li><a href="#data-client-configuration" class="table-of-contents__link toc-highlight">Data client configuration</a></li><li><a href="#data-client-configuration-options" class="table-of-contents__link toc-highlight">Data client configuration options</a></li><li><a href="#execution-client-configuration-options" class="table-of-contents__link toc-highlight">Execution client configuration options</a></li><li><a href="#execution-client-configuration" class="table-of-contents__link toc-highlight">Execution client configuration</a></li><li><a href="#basic-oca-configuration" class="table-of-contents__link toc-highlight">Basic OCA configuration</a></li><li><a href="#advanced-oca-configuration" class="table-of-contents__link toc-highlight">Advanced OCA configuration</a></li><li><a href="#oca-types" class="table-of-contents__link toc-highlight">OCA types</a></li><li><a href="#oca-configuration-requirements" class="table-of-contents__link toc-highlight">OCA configuration requirements</a></li><li><a href="#conditional-orders" class="table-of-contents__link toc-highlight">Conditional orders</a></li><li><a href="#complete-trading-node-configuration" class="table-of-contents__link toc-highlight">Complete trading node configuration</a></li></ul></li><li><a href="#live-trading-with-dockerized-gateway" class="table-of-contents__link toc-highlight">Live trading with Dockerized gateway</a><ul><li><a href="#multi-client-configuration" class="table-of-contents__link toc-highlight">Multi-client configuration</a></li><li><a href="#running-the-trading-node" class="table-of-contents__link toc-highlight">Running the trading node</a></li><li><a href="#additional-configuration-options" class="table-of-contents__link toc-highlight">Additional configuration options</a></li></ul></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a><ul><li><a href="#common-connection-issues" class="table-of-contents__link toc-highlight">Common connection issues</a></li><li><a href="#error-codes" class="table-of-contents__link toc-highlight">Error codes</a></li><li><a href="#performance-optimization" class="table-of-contents__link toc-highlight">Performance optimization</a></li><li><a href="#best-practices-1" class="table-of-contents__link toc-highlight">Best practices</a></li><li><a href="#debugging-tips" class="table-of-contents__link toc-highlight">Debugging tips</a></li><li><a href="#support-and-resources" class="table-of-contents__link toc-highlight">Support and resources</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 NautilusTrader Documentation.</div></div></div></footer></div>
</body>
</html>