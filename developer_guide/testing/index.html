<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-developer_guide/testing" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Testing | NautilusTrader 文档</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://nautilus.aloen.to/developer_guide/testing"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Testing | NautilusTrader 文档"><meta data-rh="true" name="description" content="Our automated tests serve as executable specifications for the trading platform."><meta data-rh="true" property="og:description" content="Our automated tests serve as executable specifications for the trading platform."><link data-rh="true" rel="icon" href="/logo.png"><link data-rh="true" rel="canonical" href="https://nautilus.aloen.to/developer_guide/testing"><link data-rh="true" rel="alternate" href="https://nautilus.aloen.to/developer_guide/testing" hreflang="zh"><link data-rh="true" rel="alternate" href="https://nautilus.aloen.to/developer_guide/testing" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Developer Guide","item":"https://nautilus.aloen.to/developer_guide/"},{"@type":"ListItem","position":2,"name":"Testing","item":"https://nautilus.aloen.to/developer_guide/testing"}]}</script><link rel="stylesheet" href="/assets/css/styles.33db920f.css">
<script src="/assets/js/runtime~main.f907132b.js" defer="defer"></script>
<script src="/assets/js/main.3352860b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/logo.png"><div role="region" aria-label="跳到主要内容"><a class="skipToContent__uWo" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/logo.png" alt="NautilusTrader Logo" class="themedComponent_WkLn themedComponent--light_cjoX"><img src="/logo.png" alt="NautilusTrader Logo" class="themedComponent_WkLn themedComponent--dark_jZId"></div><b class="navbar__title text--truncate">NautilusTrader</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/api_reference/">文档</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/Aloento/NautilusTraderDoc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_KfBJ"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_RWFU colorModeToggle_sA1q"><button class="clean-btn toggleButton_qjfc toggleButtonDisabled_cpNp" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_CetX lightToggleIcon_UYsV"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_CetX darkToggleIcon_i1s2"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_CetX systemToggleIcon_yIQx"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_PsjF"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_jk42"><div class="docsWrapper_KWBO"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_XpKL" type="button"></button><div class="docRoot_joIP"><aside class="theme-doc-sidebar-container docSidebarContainer_DOen"><div class="sidebarViewport_j7YP"><div class="sidebar_nPgc"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_MTDt"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/api_reference/"><span title="Python API" class="categoryLinkLabel_XKxb">Python API</span></a><button aria-label="展开侧边栏分类 &#x27;Python API&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/concepts/"><span title="Concepts" class="categoryLinkLabel_XKxb">Concepts</span></a><button aria-label="展开侧边栏分类 &#x27;Concepts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist menu__link--active" href="/developer_guide/"><span title="Developer Guide" class="categoryLinkLabel_XKxb">Developer Guide</span></a><button aria-label="折叠侧边栏分类 &#x27;Developer Guide&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developer_guide/adapters"><span title="Adapters" class="linkLabel_CNtA">Adapters</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developer_guide/benchmarking"><span title="Benchmarking" class="linkLabel_CNtA">Benchmarking</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developer_guide/coding_standards"><span title="Coding Standards" class="linkLabel_CNtA">Coding Standards</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developer_guide/cython"><span title="Cython" class="linkLabel_CNtA">Cython</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developer_guide/docs"><span title="Docs Style Guide" class="linkLabel_CNtA">Docs Style Guide</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developer_guide/environment_setup"><span title="Environment Setup" class="linkLabel_CNtA">Environment Setup</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developer_guide/ffi"><span title="FFI Memory Contract" class="linkLabel_CNtA">FFI Memory Contract</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developer_guide/packaged_data"><span title="Packaged Data" class="linkLabel_CNtA">Packaged Data</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developer_guide/rust"><span title="Rust Style Guide" class="linkLabel_CNtA">Rust Style Guide</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/developer_guide/testing"><span title="Testing" class="linkLabel_CNtA">Testing</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/getting_started/"><span title="入门" class="categoryLinkLabel_XKxb">入门</span></a><button aria-label="展开侧边栏分类 &#x27;入门&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/integrations/"><span title="集成" class="categoryLinkLabel_XKxb">集成</span></a><button aria-label="展开侧边栏分类 &#x27;集成&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/tutorials/"><span title="教程" class="categoryLinkLabel_XKxb">教程</span></a><button aria-label="展开侧边栏分类 &#x27;教程&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_bw1l"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_PIhC"><div class="docItemContainer_pFw3"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_HRKZ" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_sX5c"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/developer_guide/"><span>Developer Guide</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Testing</span></li></ul></nav><div class="tocCollapsible_DhUt theme-doc-toc-mobile tocMobile_Izjv"><button type="button" class="clean-btn tocCollapsibleButton_eYR5">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Testing</h1></header>
<p>Our automated tests serve as executable specifications for the trading platform.
A healthy suite documents intended behaviour, gives contributors confidence to refactor, and catches regressions before they reach production.
Tests also double as living examples that clarify complex flows and provide rapid CI feedback so issues surface early.</p>
<p>The suite covers these categories:</p>
<ul>
<li>Unit tests</li>
<li>Integration tests</li>
<li>Acceptance tests</li>
<li>Performance tests</li>
<li>Memory leak tests</li>
</ul>
<p>Performance tests help evolve performance-critical components.</p>
<p>Run tests with <a href="https://docs.pytest.org" target="_blank" rel="noopener noreferrer">pytest</a>, our primary test runner.
Use parametrized tests and fixtures (e.g., <code>@pytest.mark.parametrize</code>) to avoid repetitive code and improve clarity.</p>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="running-tests">Running tests<a href="#running-tests" class="hash-link" aria-label="Running tests的直接链接" title="Running tests的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="python-tests">Python tests<a href="#python-tests" class="hash-link" aria-label="Python tests的直接链接" title="Python tests的直接链接" translate="no">​</a></h3>
<p>From the repository root:</p>
<div class="language-bash codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-bash codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">make pytest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># or</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uv run --active --no-sync pytest --new-first --failed-first</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># or simply</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pytest</span><br></span></code></pre></div></div>
<p>For performance tests:</p>
<div class="language-bash codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-bash codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">make test-performance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># or</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uv run --active --no-sync pytest tests/performance_tests --benchmark-disable-gc --codspeed</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="rust-tests">Rust tests<a href="#rust-tests" class="hash-link" aria-label="Rust tests的直接链接" title="Rust tests的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-bash codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">make cargo-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># or</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cargo nextest run --workspace --features &quot;python,ffi,high-precision,defi&quot; --cargo-profile nextest</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="ide-integration">IDE integration<a href="#ide-integration" class="hash-link" aria-label="IDE integration的直接链接" title="IDE integration的直接链接" translate="no">​</a></h3>
<ul>
<li><strong>PyCharm</strong>: Right-click the tests folder or file → &quot;Run pytest&quot;.</li>
<li><strong>VS Code</strong>: Use the Python Test Explorer extension.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="test-style">Test style<a href="#test-style" class="hash-link" aria-label="Test style的直接链接" title="Test style的直接链接" translate="no">​</a></h2>
<ul>
<li>Name test functions after what they exercise; you do not need to encode the expected assertions in the name.</li>
<li>Add docstrings when they clarify setup, scenarios, or expectations.</li>
<li>Prefer pytest-style free functions for Python tests instead of test classes with setup methods.</li>
<li><strong>Group assertions</strong> when possible: perform all setup/act steps first, then assert together to avoid the act-assert-act smell.</li>
<li>Use <code>unwrap</code>, <code>expect</code>, or direct <code>panic!</code>/<code>assert</code> calls inside tests; clarity and conciseness matter more than defensive error handling here.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="waiting-for-asynchronous-effects">Waiting for asynchronous effects<a href="#waiting-for-asynchronous-effects" class="hash-link" aria-label="Waiting for asynchronous effects的直接链接" title="Waiting for asynchronous effects的直接链接" translate="no">​</a></h2>
<p>When waiting for background work to complete, prefer the polling helpers <code>await eventually(...)</code> from <code>nautilus_trader.test_kit.functions</code> and <code>wait_until_async(...)</code> from <code>nautilus_common::testing</code> instead of arbitrary sleeps. They surface failures faster and reduce flakiness in CI because they stop as soon as the condition is satisfied or time out with a useful error.</p>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="mocks">Mocks<a href="#mocks" class="hash-link" aria-label="Mocks的直接链接" title="Mocks的直接链接" translate="no">​</a></h2>
<p>Use lightweight collaborators as mocks to keep the suite simple and avoid heavy mocking frameworks.
We still rely on <code>MagicMock</code> in specific cases where it provides the most convenient tooling.</p>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="code-coverage">Code coverage<a href="#code-coverage" class="hash-link" aria-label="Code coverage的直接链接" title="Code coverage的直接链接" translate="no">​</a></h2>
<p>We generate coverage reports with <code>coverage</code> and publish them to <a href="https://about.codecov.io/" target="_blank" rel="noopener noreferrer">codecov</a>.</p>
<p>Aim for high coverage without sacrificing appropriate error handling or causing &quot;test induced damage&quot; to the architecture.</p>
<p>Some branches remain untestable without modifying production behaviour.
For example, a final condition in a defensive if-else block may only trigger for unexpected values; leave these checks in place so future changes can exercise them if needed.</p>
<p>Design-time exceptions can also be impractical to test, so 100% coverage is not the target.</p>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="excluded-code-coverage">Excluded code coverage<a href="#excluded-code-coverage" class="hash-link" aria-label="Excluded code coverage的直接链接" title="Excluded code coverage的直接链接" translate="no">​</a></h2>
<p>We use <code>pragma: no cover</code> comments to <a href="https://coverage.readthedocs.io/en/coverage-4.3.3/excluding.html" target="_blank" rel="noopener noreferrer">exclude code from coverage</a> when tests would be redundant.
Typical examples include:</p>
<ul>
<li>Asserting an abstract method raises <code>NotImplementedError</code> when called.</li>
<li>Asserting the final condition check of an if-else block when impossible to test (as above).</li>
</ul>
<p>Such tests are expensive to maintain because they must track refactors while providing little value.
Ensure concrete implementations of abstract methods remain fully covered.
Remove <code>pragma: no cover</code> when it no longer applies and restrict its use to the cases above.</p>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="debugging-rust-tests">Debugging Rust tests<a href="#debugging-rust-tests" class="hash-link" aria-label="Debugging Rust tests的直接链接" title="Debugging Rust tests的直接链接" translate="no">​</a></h2>
<p>Use the default test configuration to debug Rust tests.</p>
<p>To run the full suite with debug symbols for later, run <code>make cargo-test-debug</code> instead of <code>make cargo-test</code>.</p>
<p>In IntelliJ IDEA, adjust the run configuration for parametrised <code>#[rstest]</code> cases so it reads <code>test --package nautilus-model --lib data::bar::tests::test_get_time_bar_start::case_1</code>
(remove <code>-- --exact</code> and append <code>::case_n</code> where <code>n</code> starts at 1). This workaround matches the behaviour explained <a href="https://github.com/rust-lang/rust-analyzer/issues/8964#issuecomment-871592851" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>In VS Code you can pick the specific test case to debug directly.</p>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="python--rust-mixed-debugging">Python + Rust Mixed Debugging<a href="#python--rust-mixed-debugging" class="hash-link" aria-label="Python + Rust Mixed Debugging的直接链接" title="Python + Rust Mixed Debugging的直接链接" translate="no">​</a></h2>
<p>This workflow lets you debug Python and Rust code simultaneously from a Jupyter notebook inside VS Code.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="setup">Setup<a href="#setup" class="hash-link" aria-label="Setup的直接链接" title="Setup的直接链接" translate="no">​</a></h3>
<p>Install these VS Code extensions: Rust Analyzer, CodeLLDB, Python, Jupyter.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="step-0-compile-nautilus_trader-with-debug-symbols">Step 0: Compile <code>nautilus_trader</code> with debug symbols<a href="#step-0-compile-nautilus_trader-with-debug-symbols" class="hash-link" aria-label="step-0-compile-nautilus_trader-with-debug-symbols的直接链接" title="step-0-compile-nautilus_trader-with-debug-symbols的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-bash codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">cd nautilus_trader &amp;&amp; make build-debug-pyo3</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="step-1-set-up-debugging-configuration">Step 1: Set up debugging configuration<a href="#step-1-set-up-debugging-configuration" class="hash-link" aria-label="Step 1: Set up debugging configuration的直接链接" title="Step 1: Set up debugging configuration的直接链接" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">test_kit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">debug_helpers </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> setup_debugging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">setup_debugging</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>This command creates the required VS Code debugging configurations and starts a <code>debugpy</code> server for the Python debugger.</p>
<p>By default <code>setup_debugging()</code> expects the <code>.vscode</code> folder one level above the <code>nautilus_trader</code> root directory.
Adjust the target location if your workspace layout differs.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="step-2-set-breakpoints">Step 2: Set breakpoints<a href="#step-2-set-breakpoints" class="hash-link" aria-label="Step 2: Set breakpoints的直接链接" title="Step 2: Set breakpoints的直接链接" translate="no">​</a></h3>
<ul>
<li><strong>Python breakpoints:</strong> Set in VS Code in the Python source files.</li>
<li><strong>Rust breakpoints:</strong> Set in VS Code in the Rust source files.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="step-3-start-mixed-debugging">Step 3: Start mixed debugging<a href="#step-3-start-mixed-debugging" class="hash-link" aria-label="Step 3: Start mixed debugging的直接链接" title="Step 3: Start mixed debugging的直接链接" translate="no">​</a></h3>
<ol>
<li>In VS Code select the <strong>&quot;Debug Jupyter + Rust (Mixed)&quot;</strong> configuration.</li>
<li>Start debugging (F5) or press the green run arrow.</li>
<li>Both Python and Rust debuggers attach to your Jupyter session.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="step-4-execute-code">Step 4: Execute code<a href="#step-4-execute-code" class="hash-link" aria-label="Step 4: Execute code的直接链接" title="Step 4: Execute code的直接链接" translate="no">​</a></h3>
<p>Run Jupyter notebook cells that call Rust functions. The debugger stops at breakpoints in both Python and Rust code.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="available-configurations">Available configurations<a href="#available-configurations" class="hash-link" aria-label="Available configurations的直接链接" title="Available configurations的直接链接" translate="no">​</a></h3>
<p><code>setup_debugging()</code> creates these VS Code configurations:</p>
<ul>
<li><strong><code>Debug Jupyter + Rust (Mixed)</code></strong> - Mixed debugging for Jupyter notebooks.</li>
<li><strong><code>Jupyter Mixed Debugging (Python)</code></strong> - Python-only debugging for notebooks.</li>
<li><strong><code>Rust Debugger (for Jupyter debugging)</code></strong> - Rust-only debugging for notebooks.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="example">Example<a href="#example" class="hash-link" aria-label="Example的直接链接" title="Example的直接链接" translate="no">​</a></h3>
<p>Open and run the example notebook: <code>debug_mixed_jupyter.ipynb</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="reference">Reference<a href="#reference" class="hash-link" aria-label="Reference的直接链接" title="Reference的直接链接" translate="no">​</a></h3>
<ul>
<li><a href="https://pyo3.rs/v0.25.1/debugging.html?highlight=deb#debugging-from-jupyter-notebooks" target="_blank" rel="noopener noreferrer">PyO3 debugging</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/Aloento/NautilusTraderDoc/tree/main/docs/developer_guide/testing.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_F7ru" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_GNoA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/developer_guide/rust"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Rust Style Guide</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/getting_started/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">入门</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_pg_n thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#running-tests" class="table-of-contents__link toc-highlight">Running tests</a><ul><li><a href="#python-tests" class="table-of-contents__link toc-highlight">Python tests</a></li><li><a href="#rust-tests" class="table-of-contents__link toc-highlight">Rust tests</a></li><li><a href="#ide-integration" class="table-of-contents__link toc-highlight">IDE integration</a></li></ul></li><li><a href="#test-style" class="table-of-contents__link toc-highlight">Test style</a></li><li><a href="#waiting-for-asynchronous-effects" class="table-of-contents__link toc-highlight">Waiting for asynchronous effects</a></li><li><a href="#mocks" class="table-of-contents__link toc-highlight">Mocks</a></li><li><a href="#code-coverage" class="table-of-contents__link toc-highlight">Code coverage</a></li><li><a href="#excluded-code-coverage" class="table-of-contents__link toc-highlight">Excluded code coverage</a></li><li><a href="#debugging-rust-tests" class="table-of-contents__link toc-highlight">Debugging Rust tests</a></li><li><a href="#python--rust-mixed-debugging" class="table-of-contents__link toc-highlight">Python + Rust Mixed Debugging</a><ul><li><a href="#setup" class="table-of-contents__link toc-highlight">Setup</a></li><li><a href="#step-0-compile-nautilus_trader-with-debug-symbols" class="table-of-contents__link toc-highlight">Step 0: Compile <code>nautilus_trader</code> with debug symbols</a></li><li><a href="#step-1-set-up-debugging-configuration" class="table-of-contents__link toc-highlight">Step 1: Set up debugging configuration</a></li><li><a href="#step-2-set-breakpoints" class="table-of-contents__link toc-highlight">Step 2: Set breakpoints</a></li><li><a href="#step-3-start-mixed-debugging" class="table-of-contents__link toc-highlight">Step 3: Start mixed debugging</a></li><li><a href="#step-4-execute-code" class="table-of-contents__link toc-highlight">Step 4: Execute code</a></li><li><a href="#available-configurations" class="table-of-contents__link toc-highlight">Available configurations</a></li><li><a href="#example" class="table-of-contents__link toc-highlight">Example</a></li><li><a href="#reference" class="table-of-contents__link toc-highlight">Reference</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 NautilusTrader Documentation.</div></div></div></footer></div>
</body>
</html>