<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-concepts/data" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Data | NautilusTrader 文档</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://nautilus.aloen.to/concepts/data"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Data | NautilusTrader 文档"><meta data-rh="true" name="description" content="NautilusTrader provides a set of built-in data types specifically designed to represent a trading domain."><meta data-rh="true" property="og:description" content="NautilusTrader provides a set of built-in data types specifically designed to represent a trading domain."><link data-rh="true" rel="icon" href="/logo.png"><link data-rh="true" rel="canonical" href="https://nautilus.aloen.to/concepts/data"><link data-rh="true" rel="alternate" href="https://nautilus.aloen.to/concepts/data" hreflang="zh"><link data-rh="true" rel="alternate" href="https://nautilus.aloen.to/concepts/data" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Concepts","item":"https://nautilus.aloen.to/concepts/"},{"@type":"ListItem","position":2,"name":"Data","item":"https://nautilus.aloen.to/concepts/data"}]}</script><link rel="stylesheet" href="/assets/css/styles.33db920f.css">
<script src="/assets/js/runtime~main.461aeaee.js" defer="defer"></script>
<script src="/assets/js/main.3352860b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/logo.png"><div role="region" aria-label="跳到主要内容"><a class="skipToContent__uWo" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/logo.png" alt="NautilusTrader Logo" class="themedComponent_WkLn themedComponent--light_cjoX"><img src="/logo.png" alt="NautilusTrader Logo" class="themedComponent_WkLn themedComponent--dark_jZId"></div><b class="navbar__title text--truncate">NautilusTrader</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/api_reference/">文档</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/Aloento/NautilusTraderDoc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_KfBJ"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_RWFU colorModeToggle_sA1q"><button class="clean-btn toggleButton_qjfc toggleButtonDisabled_cpNp" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_CetX lightToggleIcon_UYsV"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_CetX darkToggleIcon_i1s2"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_CetX systemToggleIcon_yIQx"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_PsjF"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_jk42"><div class="docsWrapper_KWBO"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_XpKL" type="button"></button><div class="docRoot_joIP"><aside class="theme-doc-sidebar-container docSidebarContainer_DOen"><div class="sidebarViewport_j7YP"><div class="sidebar_nPgc"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_MTDt"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/api_reference/"><span title="Python API" class="categoryLinkLabel_XKxb">Python API</span></a><button aria-label="展开侧边栏分类 &#x27;Python API&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist menu__link--active" href="/concepts/"><span title="Concepts" class="categoryLinkLabel_XKxb">Concepts</span></a><button aria-label="折叠侧边栏分类 &#x27;Concepts&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/actors"><span title="Actors" class="linkLabel_CNtA">Actors</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/adapters"><span title="Adapters" class="linkLabel_CNtA">Adapters</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/architecture"><span title="Architecture" class="linkLabel_CNtA">Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/backtesting"><span title="Backtesting" class="linkLabel_CNtA">Backtesting</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/cache"><span title="Cache" class="linkLabel_CNtA">Cache</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/concepts/data"><span title="Data" class="linkLabel_CNtA">Data</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/execution"><span title="Execution" class="linkLabel_CNtA">Execution</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/instruments"><span title="Instruments" class="linkLabel_CNtA">Instruments</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/live"><span title="Live Trading" class="linkLabel_CNtA">Live Trading</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/logging"><span title="Logging" class="linkLabel_CNtA">Logging</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/message_bus"><span title="Message Bus" class="linkLabel_CNtA">Message Bus</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/orders"><span title="Orders" class="linkLabel_CNtA">Orders</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/overview"><span title="Overview" class="linkLabel_CNtA">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/portfolio"><span title="Portfolio" class="linkLabel_CNtA">Portfolio</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/positions"><span title="Positions" class="linkLabel_CNtA">Positions</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/reports"><span title="Reports" class="linkLabel_CNtA">Reports</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/strategies"><span title="Strategies" class="linkLabel_CNtA">Strategies</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/developer_guide/"><span title="开发者指南" class="categoryLinkLabel_XKxb">开发者指南</span></a><button aria-label="展开侧边栏分类 &#x27;开发者指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/getting_started/"><span title="入门" class="categoryLinkLabel_XKxb">入门</span></a><button aria-label="展开侧边栏分类 &#x27;入门&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/integrations/"><span title="集成" class="categoryLinkLabel_XKxb">集成</span></a><button aria-label="展开侧边栏分类 &#x27;集成&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/tutorials/"><span title="教程" class="categoryLinkLabel_XKxb">教程</span></a><button aria-label="展开侧边栏分类 &#x27;教程&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_bw1l"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_PIhC"><div class="docItemContainer_pFw3"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_HRKZ" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_sX5c"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/concepts/"><span>Concepts</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Data</span></li></ul></nav><div class="tocCollapsible_DhUt theme-doc-toc-mobile tocMobile_Izjv"><button type="button" class="clean-btn tocCollapsibleButton_eYR5">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Data</h1></header>
<p>NautilusTrader provides a set of built-in data types specifically designed to represent a trading domain.
These data types include:</p>
<ul>
<li><code>OrderBookDelta</code> (L1/L2/L3): Represents the most granular order book updates.</li>
<li><code>OrderBookDeltas</code> (L1/L2/L3): Batches multiple order book deltas for more efficient processing.</li>
<li><code>OrderBookDepth10</code>: Aggregated order book snapshot (up to 10 levels per bid and ask side).</li>
<li><code>QuoteTick</code>: Represents the best bid and ask prices along with their sizes at the top-of-book.</li>
<li><code>TradeTick</code>: A single trade/match event between counterparties.</li>
<li><code>Bar</code>: OHLCV (Open, High, Low, Close, Volume) bar/candle, aggregated using a specified <em>aggregation method</em>.</li>
<li><code>MarkPriceUpdate</code>: The current mark price for an instrument (typically used in derivatives trading).</li>
<li><code>IndexPriceUpdate</code>: The index price for an instrument (underlying price used for mark price calculations).</li>
<li><code>FundingRateUpdate</code>: The funding rate for perpetual contracts (periodic payments between long and short positions).</li>
<li><code>InstrumentStatus</code>: An instrument-level status event.</li>
<li><code>InstrumentClose</code>: The closing price of an instrument.</li>
</ul>
<p>NautilusTrader is designed primarily to operate on granular order book data, providing the highest realism
for execution simulations in backtesting.
However, backtests can also be conducted on any of the supported market data types, depending on the desired simulation fidelity.</p>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="order-books">Order books<a href="#order-books" class="hash-link" aria-label="Order books的直接链接" title="Order books的直接链接" translate="no">​</a></h2>
<p>A high-performance order book implemented in Rust is available to maintain order book state based on provided data.</p>
<p><code>OrderBook</code> instances are maintained per instrument for both backtesting and live trading, with the following book types available:</p>
<ul>
<li><code>L3_MBO</code>: <strong>Market by order (MBO)</strong> or L3 data, uses every order book event at every price level, keyed by order ID.</li>
<li><code>L2_MBP</code>: <strong>Market by price (MBP)</strong> or L2 data, aggregates order book events by price level.</li>
<li><code>L1_MBP</code>: <strong>Market by price (MBP)</strong> or L1 data, also known as best bid and offer (BBO), captures only top-level updates.</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_lEzE alert alert--secondary"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_Vfkp"><p>Top-of-book data, such as <code>QuoteTick</code>, <code>TradeTick</code> and <code>Bar</code>, can also be used for backtesting, with markets operating on <code>L1_MBP</code> book types.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="instruments">Instruments<a href="#instruments" class="hash-link" aria-label="Instruments的直接链接" title="Instruments的直接链接" translate="no">​</a></h2>
<p>The following instrument definitions are available:</p>
<ul>
<li><code>Betting</code>: Represents an instrument in a betting market.</li>
<li><code>BinaryOption</code>: Represents a generic binary option instrument.</li>
<li><code>Cfd</code>: Represents a Contract for Difference (CFD) instrument.</li>
<li><code>Commodity</code>:  Represents a commodity instrument in a spot/cash market.</li>
<li><code>CryptoFuture</code>: Represents a deliverable futures contract instrument, with crypto assets as underlying and for settlement.</li>
<li><code>CryptoPerpetual</code>: Represents a crypto perpetual futures contract instrument (a.k.a. perpetual swap).</li>
<li><code>CurrencyPair</code>: Represents a generic currency pair instrument in a spot/cash market.</li>
<li><code>Equity</code>: Represents a generic equity instrument.</li>
<li><code>FuturesContract</code>: Represents a generic deliverable futures contract instrument.</li>
<li><code>FuturesSpread</code>: Represents a generic deliverable futures spread instrument.</li>
<li><code>Index</code>: Represents a generic index instrument.</li>
<li><code>OptionContract</code>: Represents a generic option contract instrument.</li>
<li><code>OptionSpread</code>: Represents a generic option spread instrument.</li>
<li><code>Synthetic</code>: Represents a synthetic instrument with prices derived from component instruments using a formula.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="bars-and-aggregation">Bars and aggregation<a href="#bars-and-aggregation" class="hash-link" aria-label="Bars and aggregation的直接链接" title="Bars and aggregation的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="introduction-to-bars">Introduction to bars<a href="#introduction-to-bars" class="hash-link" aria-label="Introduction to bars的直接链接" title="Introduction to bars的直接链接" translate="no">​</a></h3>
<p>A <em>bar</em> (also known as a candle, candlestick or kline) is a data structure that represents
price and volume information over a specific period, including:</p>
<ul>
<li>Opening price</li>
<li>Highest price</li>
<li>Lowest price</li>
<li>Closing price</li>
<li>Traded volume (or ticks as a volume proxy)</li>
</ul>
<p>The system generates bars using an <em>aggregation method</em> that groups data by specific criteria.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="purpose-of-data-aggregation">Purpose of data aggregation<a href="#purpose-of-data-aggregation" class="hash-link" aria-label="Purpose of data aggregation的直接链接" title="Purpose of data aggregation的直接链接" translate="no">​</a></h3>
<p>Data aggregation in NautilusTrader transforms granular market data into structured bars or candles for several reasons:</p>
<ul>
<li>To provide data for technical indicators and strategy development.</li>
<li>Because time-aggregated data (like minute bars) are often sufficient for many strategies.</li>
<li>To reduce costs compared to high-frequency L1/L2/L3 market data.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="aggregation-methods">Aggregation methods<a href="#aggregation-methods" class="hash-link" aria-label="Aggregation methods的直接链接" title="Aggregation methods的直接链接" translate="no">​</a></h3>
<p>The platform implements various aggregation methods:</p>
<table><thead><tr><th style="text-align:left">Name</th><th style="text-align:left">Description</th><th style="text-align:left">Category</th></tr></thead><tbody><tr><td style="text-align:left"><code>TICK</code></td><td style="text-align:left">Aggregation of a number of ticks.</td><td style="text-align:left">Threshold</td></tr><tr><td style="text-align:left"><code>TICK_IMBALANCE</code></td><td style="text-align:left">Aggregation of the buy/sell imbalance of ticks.</td><td style="text-align:left">Threshold</td></tr><tr><td style="text-align:left"><code>TICK_RUNS</code></td><td style="text-align:left">Aggregation of sequential buy/sell runs of ticks.</td><td style="text-align:left">Information</td></tr><tr><td style="text-align:left"><code>VOLUME</code></td><td style="text-align:left">Aggregation of traded volume.</td><td style="text-align:left">Threshold</td></tr><tr><td style="text-align:left"><code>VOLUME_IMBALANCE</code></td><td style="text-align:left">Aggregation of the buy/sell imbalance of traded volume.</td><td style="text-align:left">Threshold</td></tr><tr><td style="text-align:left"><code>VOLUME_RUNS</code></td><td style="text-align:left">Aggregation of sequential runs of buy/sell traded volume.</td><td style="text-align:left">Information</td></tr><tr><td style="text-align:left"><code>VALUE</code></td><td style="text-align:left">Aggregation of the notional value of trades (also known as &quot;Dollar bars&quot;).</td><td style="text-align:left">Threshold</td></tr><tr><td style="text-align:left"><code>VALUE_IMBALANCE</code></td><td style="text-align:left">Aggregation of the buy/sell imbalance of trading by notional value.</td><td style="text-align:left">Information</td></tr><tr><td style="text-align:left"><code>VALUE_RUNS</code></td><td style="text-align:left">Aggregation of sequential buy/sell runs of trading by notional value.</td><td style="text-align:left">Threshold</td></tr><tr><td style="text-align:left"><code>RENKO</code></td><td style="text-align:left">Aggregation based on fixed price movements (brick size in ticks).</td><td style="text-align:left">Threshold</td></tr><tr><td style="text-align:left"><code>MILLISECOND</code></td><td style="text-align:left">Aggregation of time intervals with millisecond granularity.</td><td style="text-align:left">Time</td></tr><tr><td style="text-align:left"><code>SECOND</code></td><td style="text-align:left">Aggregation of time intervals with second granularity.</td><td style="text-align:left">Time</td></tr><tr><td style="text-align:left"><code>MINUTE</code></td><td style="text-align:left">Aggregation of time intervals with minute granularity.</td><td style="text-align:left">Time</td></tr><tr><td style="text-align:left"><code>HOUR</code></td><td style="text-align:left">Aggregation of time intervals with hour granularity.</td><td style="text-align:left">Time</td></tr><tr><td style="text-align:left"><code>DAY</code></td><td style="text-align:left">Aggregation of time intervals with day granularity.</td><td style="text-align:left">Time</td></tr><tr><td style="text-align:left"><code>WEEK</code></td><td style="text-align:left">Aggregation of time intervals with week granularity.</td><td style="text-align:left">Time</td></tr><tr><td style="text-align:left"><code>MONTH</code></td><td style="text-align:left">Aggregation of time intervals with month granularity.</td><td style="text-align:left">Time</td></tr><tr><td style="text-align:left"><code>YEAR</code></td><td style="text-align:left">Aggregation of time intervals with year granularity.</td><td style="text-align:left">Time</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-note admonition_lEzE alert alert--secondary"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_Vfkp"><p>The following bar aggregations are not currently implemented:</p><ul>
<li><code>VOLUME_IMBALANCE</code></li>
<li><code>VOLUME_RUNS</code></li>
<li><code>VALUE_IMBALANCE</code></li>
<li><code>VALUE_RUNS</code></li>
</ul></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="types-of-aggregation">Types of aggregation<a href="#types-of-aggregation" class="hash-link" aria-label="Types of aggregation的直接链接" title="Types of aggregation的直接链接" translate="no">​</a></h3>
<p>NautilusTrader implements three distinct data aggregation methods:</p>
<ol>
<li>
<p><strong>Trade-to-bar aggregation</strong>: Creates bars from <code>TradeTick</code> objects (executed trades)</p>
<ul>
<li>Use case: For strategies analyzing execution prices or when working directly with trade data.</li>
<li>Always uses the <code>LAST</code> price type in the bar specification.</li>
</ul>
</li>
<li>
<p><strong>Quote-to-bar aggregation</strong>: Creates bars from <code>QuoteTick</code> objects (bid/ask prices)</p>
<ul>
<li>Use case: For strategies focusing on bid/ask spreads or market depth analysis.</li>
<li>Uses <code>BID</code>, <code>ASK</code>, or <code>MID</code> price types in the bar specification.</li>
</ul>
</li>
<li>
<p><strong>Bar-to-bar aggregation</strong>: Creates larger-timeframe <code>Bar</code> objects from smaller-timeframe <code>Bar</code> objects</p>
<ul>
<li>Use case: For resampling existing smaller timeframe bars (1-minute) into larger timeframes (5-minute, hourly).</li>
<li>Always requires the <code>@</code> symbol in the specification.</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="bar-types">Bar types<a href="#bar-types" class="hash-link" aria-label="Bar types的直接链接" title="Bar types的直接链接" translate="no">​</a></h3>
<p>NautilusTrader defines a unique <em>bar type</em> (<code>BarType</code> class) based on the following components:</p>
<ul>
<li><strong>Instrument ID</strong> (<code>InstrumentId</code>): Specifies the particular instrument for the bar.</li>
<li><strong>Bar Specification</strong> (<code>BarSpecification</code>):<!-- -->
<ul>
<li><code>step</code>: Defines the interval or frequency of each bar.</li>
<li><code>aggregation</code>: Specifies the method used for data aggregation (see the above table).</li>
<li><code>price_type</code>: Indicates the price basis of the bar (e.g., bid, ask, mid, last).</li>
</ul>
</li>
<li><strong>Aggregation Source</strong> (<code>AggregationSource</code>): Indicates whether the bar was aggregated internally (within Nautilus).</li>
<li>or externally (by a trading venue or data provider).</li>
</ul>
<p>Bar types can also be classified as either <em>standard</em> or <em>composite</em>:</p>
<ul>
<li><strong>Standard</strong>: Generated from granular market data, such as quote-ticks or trade-ticks.</li>
<li><strong>Composite</strong>: Derived from a higher-granularity bar type through subsampling (like 5-MINUTE bars aggregate from 1-MINUTE bars).</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="aggregation-sources">Aggregation sources<a href="#aggregation-sources" class="hash-link" aria-label="Aggregation sources的直接链接" title="Aggregation sources的直接链接" translate="no">​</a></h3>
<p>Bar data aggregation can be either <em>internal</em> or <em>external</em>:</p>
<ul>
<li><code>INTERNAL</code>: The bar is aggregated inside the local Nautilus system boundary.</li>
<li><code>EXTERNAL</code>: The bar is aggregated outside the local Nautilus system boundary (typically by a trading venue or data provider).</li>
</ul>
<p>For bar-to-bar aggregation, the target bar type is always <code>INTERNAL</code> (since you&#x27;re doing the aggregation within NautilusTrader),
but the source bars can be either <code>INTERNAL</code> or <code>EXTERNAL</code>, i.e., you can aggregate externally provided bars or already
aggregated internal bars.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="defining-bar-types-with-string-syntax">Defining bar types with <em>string syntax</em><a href="#defining-bar-types-with-string-syntax" class="hash-link" aria-label="defining-bar-types-with-string-syntax的直接链接" title="defining-bar-types-with-string-syntax的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="standard-bars">Standard bars<a href="#standard-bars" class="hash-link" aria-label="Standard bars的直接链接" title="Standard bars的直接链接" translate="no">​</a></h4>
<p>You can define standard bar types from strings using the following convention:</p>
<p><code>{instrument_id}-{step}-{aggregation}-{price_type}-{INTERNAL | EXTERNAL}</code></p>
<p>For example, to define a <code>BarType</code> for AAPL trades (last price) on Nasdaq (XNAS) using a 5-minute interval
aggregated from trades locally by Nautilus:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">bar_type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BarType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;AAPL.XNAS-5-MINUTE-LAST-INTERNAL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="composite-bars">Composite bars<a href="#composite-bars" class="hash-link" aria-label="Composite bars的直接链接" title="Composite bars的直接链接" translate="no">​</a></h4>
<p>Composite bars are derived by aggregating higher-granularity bars into the desired bar type. To define a composite bar,
use this convention:</p>
<p><code>{instrument_id}-{step}-{aggregation}-{price_type}-INTERNAL@{step}-{aggregation}-{INTERNAL | EXTERNAL}</code></p>
<p><strong>Notes</strong>:</p>
<ul>
<li>The derived bar type must use an <code>INTERNAL</code> aggregation source (since this is how the bar is aggregated).</li>
<li>The sampled bar type must have a higher granularity than the derived bar type.</li>
<li>The sampled instrument ID is inferred to match that of the derived bar type.</li>
<li>Composite bars can be aggregated <em>from</em> <code>INTERNAL</code> or <code>EXTERNAL</code> aggregation sources.</li>
</ul>
<p>For example, to define a <code>BarType</code> for AAPL trades (last price) on Nasdaq (XNAS) using a 5-minute interval
aggregated locally by Nautilus, from 1-minute interval bars aggregated externally:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">bar_type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BarType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;AAPL.XNAS-5-MINUTE-LAST-INTERNAL@1-MINUTE-EXTERNAL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="aggregation-syntax-examples">Aggregation syntax examples<a href="#aggregation-syntax-examples" class="hash-link" aria-label="Aggregation syntax examples的直接链接" title="Aggregation syntax examples的直接链接" translate="no">​</a></h3>
<p>The <code>BarType</code> string format encodes both the target bar type and, optionally, the source data type:</p>
<div class="language-text codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-text codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">{instrument_id}-{step}-{aggregation}-{price_type}-{source}@{step}-{aggregation}-{source}</span><br></span></code></pre></div></div>
<p>The part after the <code>@</code> symbol is optional and only used for bar-to-bar aggregation:</p>
<ul>
<li><strong>Without <code>@</code></strong>: Aggregates from <code>TradeTick</code> objects (when price_type is <code>LAST</code>) or <code>QuoteTick</code> objects (when price_type is <code>BID</code>, <code>ASK</code>, or <code>MID</code>).</li>
<li><strong>With <code>@</code></strong>: Aggregates from existing <code>Bar</code> objects (specifying the source bar type).</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="trade-to-bar-example">Trade-to-bar example<a href="#trade-to-bar-example" class="hash-link" aria-label="Trade-to-bar example的直接链接" title="Trade-to-bar example的直接链接" translate="no">​</a></h4>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">on_start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Define a bar type for aggregating from TradeTick objects</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Uses price_type=LAST which indicates TradeTick data as source</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bar_type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BarType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;6EH4.XCME-50-VOLUME-LAST-INTERNAL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Request historical data (will receive bars in on_historical_data handler)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">request_bars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bar_type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Subscribe to live data (will receive bars in on_bar handler)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscribe_bars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bar_type</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="quote-to-bar-example">Quote-to-bar example<a href="#quote-to-bar-example" class="hash-link" aria-label="Quote-to-bar example的直接链接" title="Quote-to-bar example的直接链接" translate="no">​</a></h4>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">on_start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Create 1-minute bars from ASK prices (in QuoteTick objects)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bar_type_ask </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BarType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;6EH4.XCME-1-MINUTE-ASK-INTERNAL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Create 1-minute bars from BID prices (in QuoteTick objects)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bar_type_bid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BarType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;6EH4.XCME-1-MINUTE-BID-INTERNAL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Create 1-minute bars from MID prices (middle between ASK and BID prices in QuoteTick objects)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bar_type_mid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BarType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;6EH4.XCME-1-MINUTE-MID-INTERNAL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Request historical data and subscribe to live data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">request_bars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bar_type_ask</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Historical bars processed in on_historical_data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscribe_bars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bar_type_ask</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Live bars processed in on_bar</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="bar-to-bar-example">Bar-to-bar example<a href="#bar-to-bar-example" class="hash-link" aria-label="Bar-to-bar example的直接链接" title="Bar-to-bar example的直接链接" translate="no">​</a></h4>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">on_start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Create 5-minute bars from 1-minute bars (Bar objects)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Format: target_bar_type@source_bar_type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Note: price type (LAST) is only needed on the left target side, not on the source side</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bar_type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BarType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;6EH4.XCME-5-MINUTE-LAST-INTERNAL@1-MINUTE-EXTERNAL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Request historical data (processed in on_historical_data(...) handler)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">request_bars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bar_type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Subscribe to live updates (processed in on_bar(...) handler)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscribe_bars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bar_type</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="advanced-bar-to-bar-example">Advanced bar-to-bar example<a href="#advanced-bar-to-bar-example" class="hash-link" aria-label="Advanced bar-to-bar example的直接链接" title="Advanced bar-to-bar example的直接链接" translate="no">​</a></h4>
<p>You can create complex aggregation chains where you aggregate from already aggregated bars:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># First create 1-minute bars from TradeTick objects (LAST indicates TradeTick source)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">primary_bar_type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BarType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;6EH4.XCME-1-MINUTE-LAST-INTERNAL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Then create 5-minute bars from 1-minute bars</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Note the @1-MINUTE-INTERNAL part identifying the source bars</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">intermediate_bar_type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BarType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;6EH4.XCME-5-MINUTE-LAST-INTERNAL@1-MINUTE-INTERNAL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Then create hourly bars from 5-minute bars</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Note the @5-MINUTE-INTERNAL part identifying the source bars</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hourly_bar_type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BarType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;6EH4.XCME-1-HOUR-LAST-INTERNAL@5-MINUTE-INTERNAL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="working-with-bars-request-vs-subscribe">Working with bars: request vs. subscribe<a href="#working-with-bars-request-vs-subscribe" class="hash-link" aria-label="Working with bars: request vs. subscribe的直接链接" title="Working with bars: request vs. subscribe的直接链接" translate="no">​</a></h3>
<p>NautilusTrader provides two distinct operations for working with bars:</p>
<ul>
<li><strong><code>request_bars()</code></strong>: Fetches historical data processed by the <code>on_historical_data()</code> handler.</li>
<li><strong><code>subscribe_bars()</code></strong>: Establishes a real-time data feed processed by the <code>on_bar()</code> handler.</li>
</ul>
<p>These methods work together in a typical workflow:</p>
<ol>
<li>First, <code>request_bars()</code> loads historical data to initialize indicators or state of strategy with past market behavior.</li>
<li>Then, <code>subscribe_bars()</code> ensures the strategy continues receiving new bars as they form in real-time.</li>
</ol>
<p>Example usage in <code>on_start()</code>:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">on_start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Define bar type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bar_type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BarType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;6EH4.XCME-5-MINUTE-LAST-INTERNAL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Request historical data to initialize indicators</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># These bars will be delivered to the on_historical_data(...) handler in strategy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">request_bars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bar_type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Subscribe to real-time updates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># New bars will be delivered to the on_bar(...) handler in strategy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscribe_bars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bar_type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Register indicators to receive bar updates (they will be automatically updated)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">register_indicator_for_bars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bar_type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">my_indicator</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>Required handlers in your strategy to receive the data:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">on_historical_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Processes batches of historical bars from request_bars()</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Note: indicators registered with register_indicator_for_bars</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># are updated automatically with historical data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pass</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">on_bar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bar</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Processes individual bars in real-time from subscribe_bars()</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Indicators registered with this bar type will update automatically and they will be updated before this handler is called</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pass</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="historical-data-requests-with-aggregation">Historical data requests with aggregation<a href="#historical-data-requests-with-aggregation" class="hash-link" aria-label="Historical data requests with aggregation的直接链接" title="Historical data requests with aggregation的直接链接" translate="no">​</a></h3>
<p>When requesting historical bars for backtesting or initializing indicators, you can use the <code>request_bars()</code> method, which supports both direct requests and aggregation:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Request raw 1-minute bars (aggregated from TradeTick objects as indicated by LAST price type)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">request_bars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BarType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;6EH4.XCME-1-MINUTE-LAST-EXTERNAL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Request 5-minute bars aggregated from 1-minute bars</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">request_bars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BarType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;6EH4.XCME-5-MINUTE-LAST-INTERNAL@1-MINUTE-EXTERNAL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>If historical aggregated bars are needed, you can use specialized request <code>request_aggregated_bars()</code> method:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Request bars that are aggregated from historical trade ticks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">request_aggregated_bars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">BarType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;6EH4.XCME-100-VOLUME-LAST-INTERNAL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Request bars that are aggregated from other bars</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">request_aggregated_bars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">BarType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;6EH4.XCME-5-MINUTE-LAST-INTERNAL@1-MINUTE-EXTERNAL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="common-pitfalls">Common pitfalls<a href="#common-pitfalls" class="hash-link" aria-label="Common pitfalls的直接链接" title="Common pitfalls的直接链接" translate="no">​</a></h3>
<p><strong>Register indicators before requesting data</strong>: Ensure indicators are registered before requesting historical data so they get updated properly.</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Correct order</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">register_indicator_for_bars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bar_type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ema</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">request_bars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bar_type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Incorrect order</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">request_bars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bar_type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Indicator won&#x27;t receive historical data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">register_indicator_for_bars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bar_type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ema</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="timestamps">Timestamps<a href="#timestamps" class="hash-link" aria-label="Timestamps的直接链接" title="Timestamps的直接链接" translate="no">​</a></h2>
<p>The platform uses two fundamental timestamp fields that appear across many objects, including market data, orders, and events.
These timestamps serve distinct purposes and help maintain precise timing information throughout the system:</p>
<ul>
<li><code>ts_event</code>: UNIX timestamp (nanoseconds) representing when an event actually occurred.</li>
<li><code>ts_init</code>: UNIX timestamp (nanoseconds) representing when Nautilus created the internal object representing that event.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="examples">Examples<a href="#examples" class="hash-link" aria-label="Examples的直接链接" title="Examples的直接链接" translate="no">​</a></h3>
<table><thead><tr><th><strong>Event Type</strong></th><th><strong><code>ts_event</code></strong></th><th><strong><code>ts_init</code></strong></th></tr></thead><tbody><tr><td><code>TradeTick</code></td><td>Time when trade occurred at the exchange.</td><td>Time when Nautilus received the trade data.</td></tr><tr><td><code>QuoteTick</code></td><td>Time when quote occurred at the exchange.</td><td>Time when Nautilus received the quote data.</td></tr><tr><td><code>OrderBookDelta</code></td><td>Time when order book update occurred at the exchange.</td><td>Time when Nautilus received the order book update.</td></tr><tr><td><code>Bar</code></td><td>Time of the bar&#x27;s closing (exact minute/hour).</td><td>Time when Nautilus generated (for internal bars) or received the bar data (for external bars).</td></tr><tr><td><code>OrderFilled</code></td><td>Time when order was filled at the exchange.</td><td>Time when Nautilus received and processed the fill confirmation.</td></tr><tr><td><code>OrderCanceled</code></td><td>Time when cancellation was processed at the exchange.</td><td>Time when Nautilus received and processed the cancellation confirmation.</td></tr><tr><td><code>NewsEvent</code></td><td>Time when the news was published.</td><td>Time when the event object was created (if internal event) or received (if external event) in Nautilus.</td></tr><tr><td>Custom event</td><td>Time when event conditions actually occurred.</td><td>Time when the event object was created (if internal event) or received (if external event) in Nautilus.</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-note admonition_lEzE alert alert--secondary"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_Vfkp"><p>The <code>ts_init</code> field represents a more general concept than just the &quot;time of reception&quot; for events.
It denotes the timestamp when an object, such as a data point or command, was initialized within Nautilus.
This distinction is important because <code>ts_init</code> is not exclusive to &quot;received events&quot; — it applies to any internal
initialization process.</p><p>For example, the <code>ts_init</code> field is also used for commands, where the concept of reception does not apply.
This broader definition ensures consistent handling of initialization timestamps across various object types in the system.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="latency-analysis">Latency analysis<a href="#latency-analysis" class="hash-link" aria-label="Latency analysis的直接链接" title="Latency analysis的直接链接" translate="no">​</a></h3>
<p>The dual timestamp system enables latency analysis within the platform:</p>
<ul>
<li>Latency can be calculated as <code>ts_init - ts_event</code>.</li>
<li>This difference represents total system latency, including network transmission time, processing overhead, and any queueing delays.</li>
<li>It&#x27;s important to remember that the clocks producing these timestamps are likely not synchronized.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="environment-specific-behavior">Environment-specific behavior<a href="#environment-specific-behavior" class="hash-link" aria-label="Environment-specific behavior的直接链接" title="Environment-specific behavior的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="backtesting-environment">Backtesting environment<a href="#backtesting-environment" class="hash-link" aria-label="Backtesting environment的直接链接" title="Backtesting environment的直接链接" translate="no">​</a></h4>
<ul>
<li>Data is ordered by <code>ts_init</code> using a stable sort.</li>
<li>This behavior ensures deterministic processing order and simulates realistic system behavior, including latencies.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="live-trading-environment">Live trading environment<a href="#live-trading-environment" class="hash-link" aria-label="Live trading environment的直接链接" title="Live trading environment的直接链接" translate="no">​</a></h4>
<ul>
<li>The system processes data as it arrives to minimize latency and enable real-time decisions.<!-- -->
<ul>
<li><code>ts_init</code> field records the exact moment when data is received by Nautilus in real-time.</li>
<li><code>ts_event</code> reflects the time the event occurred externally, enabling accurate comparisons between external event timing and system reception.</li>
</ul>
</li>
<li>We can use the difference between <code>ts_init</code> and <code>ts_event</code> to detect network or processing delays.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="other-notes-and-considerations">Other notes and considerations<a href="#other-notes-and-considerations" class="hash-link" aria-label="Other notes and considerations的直接链接" title="Other notes and considerations的直接链接" translate="no">​</a></h3>
<ul>
<li>For data from external sources, <code>ts_init</code> is always the same as or later than <code>ts_event</code>.</li>
<li>For data created within Nautilus, <code>ts_init</code> and <code>ts_event</code> can be the same because the object is initialized at the same time the event happens.</li>
<li>Not every type with a <code>ts_init</code> field necessarily has a <code>ts_event</code> field. This reflects cases where:<!-- -->
<ul>
<li>The initialization of an object happens at the same time as the event itself.</li>
<li>The concept of an external event time does not apply.</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="persisted-data">Persisted data<a href="#persisted-data" class="hash-link" aria-label="Persisted data的直接链接" title="Persisted data的直接链接" translate="no">​</a></h4>
<p>The <code>ts_init</code> field indicates when the message was originally received.</p>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="data-flow">Data flow<a href="#data-flow" class="hash-link" aria-label="Data flow的直接链接" title="Data flow的直接链接" translate="no">​</a></h2>
<p>The platform ensures consistency by flowing data through the same pathways across all system <a href="/concepts/architecture#environment-contexts">environment contexts</a>
(e.g., <code>backtest</code>, <code>sandbox</code>, <code>live</code>). Data is primarily transported via the <code>MessageBus</code> to the <code>DataEngine</code>
and then distributed to subscribed or registered handlers.</p>
<p>For users who need more flexibility, the platform also supports the creation of custom data types.
For details on how to implement user-defined data types, see the <a href="#custom-data">Custom Data</a> section below.</p>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="loading-data">Loading data<a href="#loading-data" class="hash-link" aria-label="Loading data的直接链接" title="Loading data的直接链接" translate="no">​</a></h2>
<p>NautilusTrader facilitates data loading and conversion for three main use cases:</p>
<ul>
<li>Providing data for a <code>BacktestEngine</code> to run backtests.</li>
<li>Persisting the Nautilus-specific Parquet format for the data catalog via <code>ParquetDataCatalog.write_data(...)</code> to be later used with a <code>BacktestNode</code>.</li>
<li>For research purposes (to ensure data is consistent between research and backtesting).</li>
</ul>
<p>Regardless of the destination, the process remains the same: converting diverse external data formats into Nautilus data structures.</p>
<p>To achieve this, two main components are necessary:</p>
<ul>
<li>A type of DataLoader (normally specific per raw source/format) which can read the data and return a <code>pd.DataFrame</code> with the correct schema for the desired Nautilus object.</li>
<li>A type of DataWrangler (specific per data type) which takes this <code>pd.DataFrame</code> and returns a <code>list[Data]</code> of Nautilus objects.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="data-loaders">Data loaders<a href="#data-loaders" class="hash-link" aria-label="Data loaders的直接链接" title="Data loaders的直接链接" translate="no">​</a></h3>
<p>Data loader components are typically specific for the raw source/format and per integration. For instance, Binance order book data is stored in its raw CSV file form with
an entirely different format to <a href="https://databento.com/docs/knowledge-base/new-users/dbn-encoding/getting-started-with-dbn" target="_blank" rel="noopener noreferrer">Databento Binary Encoding (DBN)</a> files.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="data-wranglers">Data wranglers<a href="#data-wranglers" class="hash-link" aria-label="Data wranglers的直接链接" title="Data wranglers的直接链接" translate="no">​</a></h3>
<p>Data wranglers are implemented per specific Nautilus data type, and can be found in the <code>nautilus_trader.persistence.wranglers</code> module.
Currently there exists:</p>
<ul>
<li><code>OrderBookDeltaDataWrangler</code></li>
<li><code>OrderBookDepth10DataWrangler</code></li>
<li><code>QuoteTickDataWrangler</code></li>
<li><code>TradeTickDataWrangler</code></li>
<li><code>BarDataWrangler</code></li>
</ul>
<div class="theme-admonition theme-admonition-warning admonition_lEzE alert alert--warning"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_Vfkp"><p>There are a number of <strong>DataWrangler v2</strong> components, which will take a <code>pd.DataFrame</code> typically
with a different fixed width Nautilus Arrow v2 schema, and output PyO3 Nautilus objects which are only compatible with the new version
of the Nautilus core, currently in development.</p><p><strong>These PyO3 provided data objects are not compatible where the legacy Cython objects are currently used (e.g., adding directly to a <code>BacktestEngine</code>).</strong></p></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="transformation-pipeline">Transformation pipeline<a href="#transformation-pipeline" class="hash-link" aria-label="Transformation pipeline的直接链接" title="Transformation pipeline的直接链接" translate="no">​</a></h3>
<p><strong>Process flow</strong>:</p>
<ol>
<li>Raw data (e.g., CSV) is input into the pipeline.</li>
<li>DataLoader processes the raw data and converts it into a <code>pd.DataFrame</code>.</li>
<li>DataWrangler further processes the <code>pd.DataFrame</code> to generate a list of Nautilus objects.</li>
<li>The Nautilus <code>list[Data]</code> is the output of the data loading process.</li>
</ol>
<p>The following diagram illustrates how raw data is transformed into Nautilus data structures:</p>
<div class="language-text codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-text codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">  ┌──────────┐    ┌──────────────────────┐                  ┌──────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │          │    │                      │                  │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │          │    │                      │                  │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ Raw data │    │                      │  `pd.DataFrame`  │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ (CSV)    ├───►│      DataLoader      ├─────────────────►│     DataWrangler     ├───► Nautilus `list[Data]`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │          │    │                      │                  │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │          │    │                      │                  │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │          │    │                      │                  │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └──────────┘    └──────────────────────┘                  └──────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>Concretely, this would involve:</p>
<ul>
<li><code>BinanceOrderBookDeltaDataLoader.load(...)</code> which reads CSV files provided by Binance from disk, and returns a <code>pd.DataFrame</code>.</li>
<li><code>OrderBookDeltaDataWrangler.process(...)</code> which takes the <code>pd.DataFrame</code> and returns <code>list[OrderBookDelta]</code>.</li>
</ul>
<p>The following example shows how to accomplish the above in Python:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> TEST_DATA_DIR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">binance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loaders </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> BinanceOrderBookDeltaDataLoader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">persistence</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">wranglers </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> OrderBookDeltaDataWrangler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">test_kit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">providers </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> TestInstrumentProvider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Load raw data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TEST_DATA_DIR </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;binance&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;btcusdt-depth-snap.csv&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BinanceOrderBookDeltaDataLoader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Set up a wrangler</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instrument </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TestInstrumentProvider</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">btcusdt_binance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wrangler </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> OrderBookDeltaDataWrangler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Process to a list `OrderBookDelta` Nautilus objects</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deltas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> wrangler</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="data-catalog">Data catalog<a href="#data-catalog" class="hash-link" aria-label="Data catalog的直接链接" title="Data catalog的直接链接" translate="no">​</a></h2>
<p>The data catalog is a central store for Nautilus data, persisted in the <a href="https://parquet.apache.org" target="_blank" rel="noopener noreferrer">Parquet</a> file format. It serves as the primary data management system for both backtesting and live trading scenarios, providing efficient storage, retrieval, and streaming capabilities for market data.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="overview-and-architecture">Overview and architecture<a href="#overview-and-architecture" class="hash-link" aria-label="Overview and architecture的直接链接" title="Overview and architecture的直接链接" translate="no">​</a></h3>
<p>The NautilusTrader data catalog is built on a dual-backend architecture that combines the performance of Rust with the flexibility of Python:</p>
<p><strong>Core components:</strong></p>
<ul>
<li><strong>ParquetDataCatalog</strong>: The main Python interface for data operations.</li>
<li><strong>Rust backend</strong>: High-performance query engine for core data types (OrderBookDelta, QuoteTick, TradeTick, Bar, MarkPriceUpdate).</li>
<li><strong>PyArrow backend</strong>: Flexible fallback for custom data types and advanced filtering.</li>
<li><strong>fsspec integration</strong>: Support for local and cloud storage (S3, GCS, Azure, etc.).</li>
</ul>
<p><strong>Key benefits</strong>:</p>
<ul>
<li><strong>Performance</strong>: Rust backend provides optimized query performance for core market data types.</li>
<li><strong>Flexibility</strong>: PyArrow backend handles custom data types and complex filtering scenarios.</li>
<li><strong>Scalability</strong>: Efficient compression and columnar storage reduce storage costs and improve I/O performance.</li>
<li><strong>Cloud native</strong>: Built-in support for cloud storage providers through fsspec.</li>
<li><strong>No dependencies</strong>: Self-contained solution requiring no external databases or services.</li>
</ul>
<p><strong>Storage format advantages:</strong></p>
<ul>
<li>Superior compression ratio and read performance compared to CSV/JSON/HDF5.</li>
<li>Columnar storage enables efficient filtering and aggregation.</li>
<li>Schema evolution support for data model changes.</li>
<li>Cross-language compatibility (Python, Rust, Java, C++, etc.).</li>
</ul>
<p>The Arrow schemas used for the Parquet format are primarily single-sourced in the core <code>persistence</code> Rust crate, with some legacy schemas available from the <code>/serialization/arrow/schema.py</code> module.</p>
<div class="theme-admonition theme-admonition-note admonition_lEzE alert alert--secondary"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_Vfkp"><p>The current plan is to eventually phase out the Python schemas module, so that all schemas are single sourced in the Rust core for consistency and performance.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="initializing">Initializing<a href="#initializing" class="hash-link" aria-label="Initializing的直接链接" title="Initializing的直接链接" translate="no">​</a></h3>
<p>The data catalog can be initialized from a <code>NAUTILUS_PATH</code> environment variable, or by explicitly passing in a path like object.</p>
<div class="theme-admonition theme-admonition-note admonition_lEzE alert alert--secondary"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>NAUTILUS_PATH environment variable</div><div class="admonitionContent_Vfkp"><p>The <code>NAUTILUS_PATH</code> environment variable should point to the <strong>root</strong> directory containing your Nautilus data. The catalog will automatically append <code>/catalog</code> to this path.</p><p>For example:</p><ul>
<li>If <code>NAUTILUS_PATH=/home/user/trading_data</code>.</li>
<li>Then the catalog will be located at <code>/home/user/trading_data/catalog</code>.</li>
</ul><p>This is a common pattern when using <code>ParquetDataCatalog.from_env()</code> - make sure your <code>NAUTILUS_PATH</code> points to the parent directory, not the catalog directory itself.</p></div></div>
<p>The following example shows how to initialize a data catalog where there is pre-existing data already written to disk at the given path.</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> pathlib </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">persistence</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">catalog </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> ParquetDataCatalog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CATALOG_PATH </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cwd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;catalog&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Create a new catalog instance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ParquetDataCatalog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CATALOG_PATH</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Alternative: Environment-based initialization</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ParquetDataCatalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_env</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Uses NAUTILUS_PATH environment variable</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="filesystem-protocols-and-storage-options">Filesystem protocols and storage options<a href="#filesystem-protocols-and-storage-options" class="hash-link" aria-label="Filesystem protocols and storage options的直接链接" title="Filesystem protocols and storage options的直接链接" translate="no">​</a></h3>
<p>The catalog supports multiple filesystem protocols through fsspec integration, enabling seamless operation across local and cloud storage systems.</p>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="supported-filesystem-protocols">Supported filesystem protocols<a href="#supported-filesystem-protocols" class="hash-link" aria-label="Supported filesystem protocols的直接链接" title="Supported filesystem protocols的直接链接" translate="no">​</a></h4>
<p><strong>Local filesystem (<code>file</code>):</strong></p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">catalog </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ParquetDataCatalog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/path/to/catalog&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fs_protocol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;file&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Default protocol</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>Amazon S3 (<code>s3</code>):</strong></p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">catalog </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ParquetDataCatalog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;s3://my-bucket/nautilus-data/&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fs_protocol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;s3&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fs_storage_options</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;key&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;your-access-key-id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;secret&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;your-secret-access-key&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;region&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;us-east-1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;endpoint_url&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://s3.amazonaws.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Optional custom endpoint</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>Google Cloud Storage (<code>gcs</code>):</strong></p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">catalog </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ParquetDataCatalog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;gcs://my-bucket/nautilus-data/&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fs_protocol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;gcs&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fs_storage_options</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;project&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;my-project-id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;token&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/path/to/service-account.json&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Or &quot;cloud&quot; for default credentials</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>Azure Blob Storage (<code>abfs</code>):</strong></p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">catalog </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ParquetDataCatalog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;abfs://container@account.dfs.core.windows.net/nautilus-data/&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fs_protocol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;abfs&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fs_storage_options</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;account_name&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;your-storage-account&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;account_key&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;your-account-key&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Or use SAS token: &quot;sas_token&quot;: &quot;your-sas-token&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="uri-based-initialization">URI-based initialization<a href="#uri-based-initialization" class="hash-link" aria-label="URI-based initialization的直接链接" title="URI-based initialization的直接链接" translate="no">​</a></h4>
<p>For convenience, you can use URI strings that automatically parse protocol and storage options:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Local filesystem</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ParquetDataCatalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_uri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/path/to/catalog&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># S3 bucket</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ParquetDataCatalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_uri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;s3://my-bucket/nautilus-data/&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># With storage options</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ParquetDataCatalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_uri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;s3://my-bucket/nautilus-data/&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    storage_options</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;region&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;us-east-1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;access_key_id&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;your-key&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;secret_access_key&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;your-secret&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="writing-data">Writing data<a href="#writing-data" class="hash-link" aria-label="Writing data的直接链接" title="Writing data的直接链接" translate="no">​</a></h3>
<p>Store data in the catalog using the <code>write_data()</code> method. All Nautilus built-in <code>Data</code> objects are supported, and any data which inherits from <code>Data</code> can be written.</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Write a list of data objects</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">quote_ticks</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Write with custom timestamp range</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trade_ticks</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1704067200000000000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Optional start timestamp override (UNIX nanoseconds)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1704153600000000000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Optional end timestamp override (UNIX nanoseconds)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Skip disjoint check for overlapping data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bars</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> skip_disjoint_check</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="file-naming-and-data-organization">File naming and data organization<a href="#file-naming-and-data-organization" class="hash-link" aria-label="File naming and data organization的直接链接" title="File naming and data organization的直接链接" translate="no">​</a></h3>
<p>The catalog automatically generates filenames based on the timestamp range of the data being written. Files are named using the pattern <code>{start_timestamp}_{end_timestamp}.parquet</code> where timestamps are in ISO format.</p>
<p>Data is organized in directories by data type and instrument ID:</p>
<div class="language-text codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-text codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">catalog/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── data/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── quote_ticks/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   └── eurusd.sim/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │       └── 20240101T000000000000000_20240101T235959999999999.parquet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── trade_ticks/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       └── btcusd.binance/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           └── 20240101T000000000000000_20240101T235959999999999.parquet</span><br></span></code></pre></div></div>
<p><strong>Rust backend data types (enhanced performance):</strong></p>
<p>The following data types use optimized Rust implementations:</p>
<ul>
<li><code>OrderBookDelta</code>.</li>
<li><code>OrderBookDeltas</code>.</li>
<li><code>OrderBookDepth10</code>.</li>
<li><code>QuoteTick</code>.</li>
<li><code>TradeTick</code>.</li>
<li><code>Bar</code>.</li>
<li><code>MarkPriceUpdate</code>.</li>
</ul>
<div class="theme-admonition theme-admonition-warning admonition_lEzE alert alert--warning"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_Vfkp"><p>By default, data that overlaps with existing files will cause an assertion error to maintain data integrity. Use <code>skip_disjoint_check=True</code> in <code>write_data()</code> to bypass this check when needed.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="reading-data">Reading data<a href="#reading-data" class="hash-link" aria-label="Reading data的直接链接" title="Reading data的直接链接" translate="no">​</a></h3>
<p>Use the <code>query()</code> method to read data back from the catalog:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> QuoteTick</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> TradeTick</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Query quote ticks for a specific instrument and time range</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">quotes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_cls</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">QuoteTick</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    identifiers</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;EUR/USD.SIM&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-01T00:00:00Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-02T00:00:00Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Query trade ticks with filtering</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">trades </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_cls</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">TradeTick</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    identifiers</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;BTC/USD.BINANCE&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-01&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-02&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;price &gt; 50000&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="backtestdataconfig---data-specification-for-backtests"><code>BacktestDataConfig</code> - data specification for backtests<a href="#backtestdataconfig---data-specification-for-backtests" class="hash-link" aria-label="backtestdataconfig---data-specification-for-backtests的直接链接" title="backtestdataconfig---data-specification-for-backtests的直接链接" translate="no">​</a></h3>
<p>The <code>BacktestDataConfig</code> class is the primary mechanism for specifying data requirements before a backtest starts. It defines what data should be loaded from the catalog and how it should be filtered and processed during the backtest execution.</p>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="core-parameters">Core parameters<a href="#core-parameters" class="hash-link" aria-label="Core parameters的直接链接" title="Core parameters的直接链接" translate="no">​</a></h4>
<p><strong>Required parameters:</strong></p>
<ul>
<li><code>catalog_path</code>: Path to the data catalog directory.</li>
<li><code>data_cls</code>: The data type class (e.g., QuoteTick, TradeTick, OrderBookDelta, Bar).</li>
</ul>
<p><strong>Optional parameters:</strong></p>
<ul>
<li><code>catalog_fs_protocol</code>: Filesystem protocol (&#x27;file&#x27;, &#x27;s3&#x27;, &#x27;gcs&#x27;, etc.).</li>
<li><code>catalog_fs_storage_options</code>: Storage-specific options (credentials, region, etc.).</li>
<li><code>instrument_id</code>: Specific instrument to load data for.</li>
<li><code>instrument_ids</code>: List of instruments (alternative to single instrument_id).</li>
<li><code>start_time</code>: Start time for data filtering (ISO string or UNIX nanoseconds).</li>
<li><code>end_time</code>: End time for data filtering (ISO string or UNIX nanoseconds).</li>
<li><code>filter_expr</code>: Additional PyArrow filter expressions.</li>
<li><code>client_id</code>: Client ID for custom data types.</li>
<li><code>metadata</code>: Additional metadata for data queries.</li>
<li><code>bar_spec</code>: Bar specification for bar data (e.g., &quot;1-MINUTE-LAST&quot;).</li>
<li><code>bar_types</code>: List of bar types (alternative to bar_spec).</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="basic-usage-examples">Basic usage examples<a href="#basic-usage-examples" class="hash-link" aria-label="Basic usage examples的直接链接" title="Basic usage examples的直接链接" translate="no">​</a></h4>
<p><strong>Loading quote ticks:</strong></p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> BacktestDataConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> QuoteTick</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> InstrumentId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BacktestDataConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catalog_path</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/path/to/catalog&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_cls</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">QuoteTick</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">InstrumentId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;EUR/USD.SIM&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start_time</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-01T00:00:00Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end_time</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-02T00:00:00Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>Loading multiple instruments:</strong></p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">data_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BacktestDataConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catalog_path</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/path/to/catalog&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_cls</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">TradeTick</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_ids</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;BTC/USD.BINANCE&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ETH/USD.BINANCE&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start_time</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-01T00:00:00Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end_time</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-02T00:00:00Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>Loading Bar Data:</strong></p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">data_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BacktestDataConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catalog_path</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/path/to/catalog&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_cls</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Bar</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">InstrumentId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;AAPL.NASDAQ&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bar_spec</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;5-MINUTE-LAST&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start_time</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-01&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end_time</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-31&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="advanced-configuration-examples">Advanced configuration examples<a href="#advanced-configuration-examples" class="hash-link" aria-label="Advanced configuration examples的直接链接" title="Advanced configuration examples的直接链接" translate="no">​</a></h4>
<p><strong>Cloud Storage with Custom Filtering:</strong></p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">data_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BacktestDataConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catalog_path</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;s3://my-bucket/nautilus-data/&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catalog_fs_protocol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;s3&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catalog_fs_storage_options</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;key&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;your-access-key&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;secret&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;your-secret-key&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;region&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;us-east-1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_cls</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">OrderBookDelta</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">InstrumentId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;BTC/USD.COINBASE&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start_time</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-01T09:30:00Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end_time</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-01T16:00:00Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    filter_expr</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;side == &#x27;BUY&#x27;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Only buy-side deltas</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>Custom Data with Client ID:</strong></p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">data_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BacktestDataConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catalog_path</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/path/to/catalog&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_cls</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;my_package.data.NewsEventData&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;NewsClient&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;source&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;reuters&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;category&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;earnings&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start_time</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-01&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end_time</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-31&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="integration-with-backtestrunconfig">Integration with BacktestRunConfig<a href="#integration-with-backtestrunconfig" class="hash-link" aria-label="Integration with BacktestRunConfig的直接链接" title="Integration with BacktestRunConfig的直接链接" translate="no">​</a></h4>
<p>The <code>BacktestDataConfig</code> objects are integrated into the backtesting framework through <code>BacktestRunConfig</code>:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> BacktestRunConfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BacktestVenueConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Define multiple data configurations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data_configs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BacktestDataConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        catalog_path</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/path/to/catalog&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data_cls</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">QuoteTick</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        instrument_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;EUR/USD.SIM&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        start_time</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-01&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end_time</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-02&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BacktestDataConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        catalog_path</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/path/to/catalog&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data_cls</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">TradeTick</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        instrument_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;EUR/USD.SIM&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        start_time</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-01&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end_time</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-02&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Create backtest run configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BacktestRunConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    venues</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">BacktestVenueConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;SIM&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> oms_type</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;HEDGING&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">data_configs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># List of data configurations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-01T00:00:00Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-02T00:00:00Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="data-loading-process">Data loading process<a href="#data-loading-process" class="hash-link" aria-label="Data loading process的直接链接" title="Data loading process的直接链接" translate="no">​</a></h4>
<p>When a backtest runs, the <code>BacktestNode</code> processes each <code>BacktestDataConfig</code>:</p>
<ol>
<li><strong>Catalog Loading</strong>: Creates a <code>ParquetDataCatalog</code> instance from the config.</li>
<li><strong>Query Construction</strong>: Builds query parameters from config attributes.</li>
<li><strong>Data Retrieval</strong>: Executes catalog queries using the appropriate backend.</li>
<li><strong>Instrument Loading</strong>: Loads instrument definitions if needed.</li>
<li><strong>Engine Integration</strong>: Adds data to the backtest engine with proper sorting.</li>
</ol>
<p>The system automatically handles:</p>
<ul>
<li>Instrument ID resolution and validation.</li>
<li>Data type validation and conversion.</li>
<li>Memory-efficient streaming for large datasets.</li>
<li>Error handling and logging.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="datacatalogconfig---on-the-fly-data-loading">DataCatalogConfig - on-the-fly data loading<a href="#datacatalogconfig---on-the-fly-data-loading" class="hash-link" aria-label="DataCatalogConfig - on-the-fly data loading的直接链接" title="DataCatalogConfig - on-the-fly data loading的直接链接" translate="no">​</a></h3>
<p>The <code>DataCatalogConfig</code> class provides configuration for on-the-fly data loading scenarios, particularly useful for backtests where the number of possible instruments is vast,
Unlike <code>BacktestDataConfig</code> which pre-specifies data for backtests, <code>DataCatalogConfig</code> enables flexible catalog access during runtime.
Catalogs defined this way can also be used for requesting historical data.</p>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="core-parameters-1">Core parameters<a href="#core-parameters-1" class="hash-link" aria-label="Core parameters的直接链接" title="Core parameters的直接链接" translate="no">​</a></h4>
<p><strong>Required Parameters:</strong></p>
<ul>
<li><code>path</code>: Path to the data catalog directory.</li>
</ul>
<p><strong>Optional Parameters:</strong></p>
<ul>
<li><code>fs_protocol</code>: Filesystem protocol (&#x27;file&#x27;, &#x27;s3&#x27;, &#x27;gcs&#x27;, &#x27;azure&#x27;, etc.).</li>
<li><code>fs_storage_options</code>: Protocol-specific storage options.</li>
<li><code>name</code>: Optional name identifier for the catalog configuration.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="basic-usage-examples-1">Basic usage examples<a href="#basic-usage-examples-1" class="hash-link" aria-label="Basic usage examples的直接链接" title="Basic usage examples的直接链接" translate="no">​</a></h4>
<p><strong>Local Catalog Configuration:</strong></p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">persistence</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> DataCatalogConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DataCatalogConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/path/to/catalog&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fs_protocol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;file&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;local_market_data&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Convert to catalog instance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> catalog_config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">as_catalog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>Cloud storage configuration:</strong></p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">catalog_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DataCatalogConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;s3://my-bucket/market-data/&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fs_protocol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;s3&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fs_storage_options</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;key&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;your-access-key&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;secret&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;your-secret-key&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;region&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;us-west-2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;endpoint_url&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://s3.us-west-2.amazonaws.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;cloud_market_data&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="integration-with-live-trading">Integration with live trading<a href="#integration-with-live-trading" class="hash-link" aria-label="Integration with live trading的直接链接" title="Integration with live trading的直接链接" translate="no">​</a></h4>
<p><code>DataCatalogConfig</code> is commonly used in live trading configurations for historical data access:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> TradingNodeConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">persistence</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> DataCatalogConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Configure catalog for live system</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DataCatalogConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/data/nautilus/catalog&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fs_protocol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;file&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;historical_data&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Use in trading node configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TradingNodeConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ... other configurations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catalog</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">catalog_config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Enable historical data access</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="streaming-configuration">Streaming configuration<a href="#streaming-configuration" class="hash-link" aria-label="Streaming configuration的直接链接" title="Streaming configuration的直接链接" translate="no">​</a></h4>
<p>For streaming data to catalogs during live trading or backtesting, use <code>StreamingConfig</code>:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">persistence</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> StreamingConfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RotationMode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">streaming_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> StreamingConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catalog_path</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/path/to/streaming/catalog&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fs_protocol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;file&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    flush_interval_ms</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Flush every second</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    replace_existing</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rotation_mode</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">RotationMode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DAILY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rotation_interval</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Timedelta</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hours</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max_file_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 100MB max file size</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="use-cases">Use cases<a href="#use-cases" class="hash-link" aria-label="Use cases的直接链接" title="Use cases的直接链接" translate="no">​</a></h4>
<p><strong>Historical Data Analysis:</strong></p>
<ul>
<li>Load historical data during live trading for strategy calculations.</li>
<li>Access reference data for instrument lookups.</li>
<li>Retrieve past performance metrics.</li>
</ul>
<p><strong>Dynamic data loading:</strong></p>
<ul>
<li>Load data based on runtime conditions.</li>
<li>Implement custom data loading strategies.</li>
<li>Support multiple catalog sources.</li>
</ul>
<p><strong>Research and development:</strong></p>
<ul>
<li>Interactive data exploration in Jupyter notebooks.</li>
<li>Ad-hoc analysis and backtesting.</li>
<li>Data quality validation and monitoring.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="query-system-and-dual-backend-architecture">Query system and dual backend architecture<a href="#query-system-and-dual-backend-architecture" class="hash-link" aria-label="Query system and dual backend architecture的直接链接" title="Query system and dual backend architecture的直接链接" translate="no">​</a></h3>
<p>The catalog&#x27;s query system leverages a sophisticated dual-backend architecture that automatically selects the optimal query engine based on data type and query parameters.</p>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="backend-selection-logic">Backend selection logic<a href="#backend-selection-logic" class="hash-link" aria-label="Backend selection logic的直接链接" title="Backend selection logic的直接链接" translate="no">​</a></h4>
<p><strong>Rust backend (high performance):</strong></p>
<ul>
<li><strong>Supported Types</strong>: OrderBookDelta, OrderBookDeltas, OrderBookDepth10, QuoteTick, TradeTick, Bar, MarkPriceUpdate.</li>
<li><strong>Conditions</strong>: Used when <code>files</code> parameter is None (automatic file discovery).</li>
<li><strong>Benefits</strong>: Optimized performance, memory efficiency, native Arrow integration.</li>
</ul>
<p><strong>PyArrow backend (flexible):</strong></p>
<ul>
<li><strong>Supported Types</strong>: All data types including custom data classes.</li>
<li><strong>Conditions</strong>: Used for custom data types or when <code>files</code> parameter is specified.</li>
<li><strong>Benefits</strong>: Advanced filtering, custom data support, complex query expressions.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="query-methods-and-parameters">Query methods and parameters<a href="#query-methods-and-parameters" class="hash-link" aria-label="Query methods and parameters的直接链接" title="Query methods and parameters的直接链接" translate="no">​</a></h4>
<p><strong>Core query parameters:</strong></p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_cls</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">QuoteTick</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic"># Data type to query</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    identifiers</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;EUR/USD.SIM&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic"># Instrument identifiers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-01T00:00:00Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic"># Start time (various formats supported)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-02T00:00:00Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic"># End time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;bid &gt; 1.1000&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                 </span><span class="token comment" style="color:#999988;font-style:italic"># PyArrow filter expression</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    files</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                           </span><span class="token comment" style="color:#999988;font-style:italic"># Specific files (forces PyArrow backend)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>Time format support:</strong></p>
<ul>
<li>ISO 8601 strings: <code>&quot;2024-01-01T00:00:00Z&quot;</code>.</li>
<li>UNIX nanoseconds: <code>1704067200000000000</code> (or ISO format: <code>&quot;2024-01-01T00:00:00Z&quot;</code>).</li>
<li>Pandas Timestamps: <code>pd.Timestamp(&quot;2024-01-01&quot;, tz=&quot;UTC&quot;)</code>.</li>
<li>Python datetime objects (timezone-aware recommended).</li>
</ul>
<p><strong>Advanced filtering examples:</strong></p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Complex PyArrow expressions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_cls</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">TradeTick</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    identifiers</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;BTC/USD.BINANCE&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;price &gt; 50000 AND size &gt; 1.0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-01&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-02&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Multiple instruments with metadata filtering</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_cls</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Bar</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    identifiers</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;AAPL.NASDAQ&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;MSFT.NASDAQ&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;volume &gt; 1000000&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;bar_type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1-MINUTE-LAST&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="catalog-operations">Catalog operations<a href="#catalog-operations" class="hash-link" aria-label="Catalog operations的直接链接" title="Catalog operations的直接链接" translate="no">​</a></h3>
<p>The catalog provides several operation functions for maintaining and organizing data files. These operations help optimize storage, improve query performance, and ensure data integrity.</p>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="reset-file-names">Reset file names<a href="#reset-file-names" class="hash-link" aria-label="Reset file names的直接链接" title="Reset file names的直接链接" translate="no">​</a></h4>
<p>Reset parquet file names to match their actual content timestamps. This ensures filename-based filtering works correctly.</p>
<p><strong>Reset all files in catalog:</strong></p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Reset all parquet files in the catalog</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reset_all_file_names</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>Reset specific data type:</strong></p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Reset filenames for all quote tick files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reset_data_file_names</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">QuoteTick</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Reset filenames for specific instrument&#x27;s trade files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reset_data_file_names</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TradeTick</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;BTC/USD.BINANCE&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="consolidate-catalog">Consolidate catalog<a href="#consolidate-catalog" class="hash-link" aria-label="Consolidate catalog的直接链接" title="Consolidate catalog的直接链接" translate="no">​</a></h4>
<p>Combine multiple small parquet files into larger files to improve query performance and reduce storage overhead.</p>
<p><strong>Consolidate entire catalog:</strong></p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Consolidate all files in the catalog</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">consolidate_catalog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Consolidate files within a specific time range</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">consolidate_catalog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-01T00:00:00Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-02T00:00:00Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ensure_contiguous_files</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>Consolidate specific data type:</strong></p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Consolidate all quote tick files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">consolidate_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">QuoteTick</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Consolidate specific instrument&#x27;s files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">consolidate_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TradeTick</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    identifier</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;BTC/USD.BINANCE&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-01&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-31&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="consolidate-catalog-by-period">Consolidate catalog by period<a href="#consolidate-catalog-by-period" class="hash-link" aria-label="Consolidate catalog by period的直接链接" title="Consolidate catalog by period的直接链接" translate="no">​</a></h4>
<p>Split data files into fixed time periods for standardized file organization.</p>
<p><strong>Consolidate entire catalog by period:</strong></p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Consolidate all files by 1-day periods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">consolidate_catalog_by_period</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    period</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Timedelta</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">days</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Consolidate by 1-hour periods within time range</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">consolidate_catalog_by_period</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    period</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Timedelta</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hours</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-01T00:00:00Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-02T00:00:00Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>Consolidate specific data by period:</strong></p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Consolidate quote data by 4-hour periods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">consolidate_data_by_period</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_cls</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">QuoteTick</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    period</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Timedelta</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hours</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Consolidate specific instrument by 30-minute periods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">consolidate_data_by_period</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_cls</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">TradeTick</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    identifier</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;EUR/USD.SIM&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    period</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Timedelta</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">minutes</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-01&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-31&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="delete-data-range">Delete data range<a href="#delete-data-range" class="hash-link" aria-label="Delete data range的直接链接" title="Delete data range的直接链接" translate="no">​</a></h4>
<p>Remove data within a specified time range for specific data types and instruments. This operation permanently deletes data and handles file intersections intelligently.</p>
<p><strong>Delete entire catalog range:</strong></p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Delete all data within a time range across the entire catalog</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">delete_catalog_range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-01T00:00:00Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-02T00:00:00Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Delete all data from the beginning up to a specific time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">delete_catalog_range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">end</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-01T00:00:00Z&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>Delete specific data type:</strong></p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Delete all quote tick data for a specific instrument</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">delete_data_range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_cls</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">QuoteTick</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    identifier</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;BTC/USD.BINANCE&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Delete trade data within a specific time range</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">delete_data_range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_cls</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">TradeTick</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    identifier</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;EUR/USD.SIM&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-01T00:00:00Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-31T23:59:59Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_lEzE alert alert--warning"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_Vfkp"><p>Delete operations permanently remove data and cannot be undone. Files that partially overlap the deletion range are split to preserve data outside the range.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="feather-streaming-and-conversion">Feather streaming and conversion<a href="#feather-streaming-and-conversion" class="hash-link" aria-label="Feather streaming and conversion的直接链接" title="Feather streaming and conversion的直接链接" translate="no">​</a></h3>
<p>The catalog supports streaming data to temporary feather files during backtests, which can then be converted to permanent parquet format for efficient querying.</p>
<p><strong>Example: option greeks streaming</strong></p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> option_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">greeks </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> GreeksData</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">persistence</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> StreamingConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 1. Configure streaming for custom data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">streaming </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> StreamingConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catalog_path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    include_types</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">GreeksData</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    flush_interval_ms</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2. Run backtest with streaming enabled</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">engine_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BacktestEngineConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">streaming</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">streaming</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 3. Convert streamed data to permanent catalog</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">convert_stream_to_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    results</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">instance_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GreeksData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 4. Query converted data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">greeks_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_cls</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">GreeksData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-01&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2024-01-31&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;delta &gt; 0.5&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="catalog-summary">Catalog summary<a href="#catalog-summary" class="hash-link" aria-label="Catalog summary的直接链接" title="Catalog summary的直接链接" translate="no">​</a></h3>
<p>The NautilusTrader data catalog provides comprehensive market data management:</p>
<p><strong>Core features</strong>:</p>
<ul>
<li><strong>Dual Backend</strong>: Rust performance + Python flexibility.</li>
<li><strong>Multi-Protocol</strong>: Local, S3, GCS, Azure storage.</li>
<li><strong>Streaming</strong>: Feather → Parquet conversion pipeline.</li>
<li><strong>Operations</strong>: Reset file names, consolidate data, period-based organization.</li>
</ul>
<p><strong>Key use cases</strong>:</p>
<ul>
<li><strong>Backtesting</strong>: Pre-configured data loading via BacktestDataConfig.</li>
<li><strong>Live Trading</strong>: On-demand data access via DataCatalogConfig.</li>
<li><strong>Maintenance</strong>: File consolidation and organization operations.</li>
<li><strong>Research</strong>: Interactive querying and analysis.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="data-migrations">Data migrations<a href="#data-migrations" class="hash-link" aria-label="Data migrations的直接链接" title="Data migrations的直接链接" translate="no">​</a></h2>
<p>NautilusTrader defines an internal data format specified in the <code>nautilus_model</code> crate.
These models are serialized into Arrow record batches and written to Parquet files.
Nautilus backtesting is most efficient when using these Nautilus-format Parquet files.</p>
<p>However, migrating the data model between <a href="/getting_started/installation#precision-mode">precision modes</a> and schema changes can be challenging.
This guide explains how to handle data migrations using our utility tools.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="migration-tools">Migration tools<a href="#migration-tools" class="hash-link" aria-label="Migration tools的直接链接" title="Migration tools的直接链接" translate="no">​</a></h3>
<p>The <code>nautilus_persistence</code> crate provides two key utilities:</p>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="to_json"><code>to_json</code><a href="#to_json" class="hash-link" aria-label="to_json的直接链接" title="to_json的直接链接" translate="no">​</a></h4>
<p>Converts Parquet files to JSON while preserving metadata:</p>
<ul>
<li>
<p>Creates two files:</p>
<ul>
<li><code>&lt;input&gt;.json</code>: Contains the deserialized data</li>
<li><code>&lt;input&gt;.metadata.json</code>: Contains schema metadata and row group configuration</li>
</ul>
</li>
<li>
<p>Automatically detects data type from filename:</p>
<ul>
<li><code>OrderBookDelta</code> (contains &quot;deltas&quot; or &quot;order_book_delta&quot;)</li>
<li><code>QuoteTick</code> (contains &quot;quotes&quot; or &quot;quote_tick&quot;)</li>
<li><code>TradeTick</code> (contains &quot;trades&quot; or &quot;trade_tick&quot;)</li>
<li><code>Bar</code> (contains &quot;bars&quot;)</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="to_parquet"><code>to_parquet</code><a href="#to_parquet" class="hash-link" aria-label="to_parquet的直接链接" title="to_parquet的直接链接" translate="no">​</a></h4>
<p>Converts JSON back to Parquet format:</p>
<ul>
<li>Reads both the data JSON and metadata JSON files.</li>
<li>Preserves row group sizes from original metadata.</li>
<li>Uses ZSTD compression.</li>
<li>Creates <code>&lt;input&gt;.parquet</code>.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="migration-process">Migration process<a href="#migration-process" class="hash-link" aria-label="Migration process的直接链接" title="Migration process的直接链接" translate="no">​</a></h3>
<p>The following migration examples both use trades data (you can also migrate the other data types in the same way).
All commands should be run from the root of the <code>persistence</code> crate directory.</p>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="migrating-from-standard-precision-64-bit-to-high-precision-128-bit">Migrating from standard-precision (64-bit) to high-precision (128-bit)<a href="#migrating-from-standard-precision-64-bit-to-high-precision-128-bit" class="hash-link" aria-label="Migrating from standard-precision (64-bit) to high-precision (128-bit)的直接链接" title="Migrating from standard-precision (64-bit) to high-precision (128-bit)的直接链接" translate="no">​</a></h4>
<p>This example describes a scenario where you want to migrate from standard-precision schema to high-precision schema.</p>
<div class="theme-admonition theme-admonition-note admonition_lEzE alert alert--secondary"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_Vfkp"><p>If you&#x27;re migrating from a catalog that used the <code>Int64</code> and <code>UInt64</code> Arrow data types for prices and sizes,
be sure to check out commit <a href="https://github.com/nautechsystems/nautilus_trader/commit/e284162cf27a3222115aeb5d10d599c8cf09cf50" target="_blank" rel="noopener noreferrer">e284162</a>
<strong>before</strong> compiling the code that writes the initial JSON.</p></div></div>
<p><strong>1. Convert from standard-precision Parquet to JSON</strong>:</p>
<div class="language-bash codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-bash codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin to_json trades.parquet</span><br></span></code></pre></div></div>
<p>This will create <code>trades.json</code> and <code>trades.metadata.json</code> files.</p>
<p><strong>2. Convert from JSON to high-precision Parquet</strong>:</p>
<p>Add the <code>--features high-precision</code> flag to write data as high-precision (128-bit) schema Parquet.</p>
<div class="language-bash codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-bash codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --features high-precision --bin to_parquet trades.json</span><br></span></code></pre></div></div>
<p>This will create a <code>trades.parquet</code> file with high-precision schema data.</p>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="migrating-schema-changes">Migrating schema changes<a href="#migrating-schema-changes" class="hash-link" aria-label="Migrating schema changes的直接链接" title="Migrating schema changes的直接链接" translate="no">​</a></h4>
<p>This example describes a scenario where you want to migrate from one schema version to another.</p>
<p><strong>1. Convert from old schema Parquet to JSON</strong>:</p>
<p>Add the <code>--features high-precision</code> flag if the source data uses a high-precision (128-bit) schema.</p>
<div class="language-bash codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-bash codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin to_json trades.parquet</span><br></span></code></pre></div></div>
<p>This will create <code>trades.json</code> and <code>trades.metadata.json</code> files.</p>
<p><strong>2. Switch to new schema version</strong>:</p>
<div class="language-bash codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-bash codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">git checkout &lt;new-version&gt;</span><br></span></code></pre></div></div>
<p><strong>3. Convert from JSON back to new schema Parquet</strong>:</p>
<div class="language-bash codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-bash codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --features high-precision --bin to_parquet trades.json</span><br></span></code></pre></div></div>
<p>This will create a <code>trades.parquet</code> file with the new schema.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="best-practices">Best practices<a href="#best-practices" class="hash-link" aria-label="Best practices的直接链接" title="Best practices的直接链接" translate="no">​</a></h3>
<ul>
<li>Always test migrations with a small dataset first.</li>
<li>Maintain backups of original files.</li>
<li>Verify data integrity after migration.</li>
<li>Perform migrations in a staging environment before applying them to production data.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="custom-data">Custom data<a href="#custom-data" class="hash-link" aria-label="Custom data的直接链接" title="Custom data的直接链接" translate="no">​</a></h2>
<p>Due to the modular nature of the Nautilus design, it is possible to set up systems
with very flexible data streams, including custom user-defined data types. This
guide covers some possible use cases for this functionality.</p>
<p>It&#x27;s possible to create custom data types within the Nautilus system. First you
will need to define your data by subclassing from <code>Data</code>.</p>
<div class="theme-admonition theme-admonition-info admonition_lEzE alert alert--info"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_Vfkp"><p>As <code>Data</code> holds no state, it is not strictly necessary to call <code>super().__init__()</code>.</p></div></div>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">core </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">MyDataPoint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    This is an example of a user-defined data class, inheriting from the base class `Data`.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    The fields `label`, `x`, `y`, and `z` in this class are examples of arbitrary user data.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        label</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        z</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ts_event</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ts_init</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">label </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> label</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">z </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_ts_event </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ts_event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_ts_init </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ts_init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@property</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ts_event</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        UNIX timestamp (nanoseconds) when the data event occurred.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Returns</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        -------</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        int</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_ts_event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@property</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ts_init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        UNIX timestamp (nanoseconds) when the object was initialized.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Returns</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        -------</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        int</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_ts_init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>The <code>Data</code> abstract base class acts as a contract within the system and requires two properties
for all types of data: <code>ts_event</code> and <code>ts_init</code>. These represent the UNIX nanosecond timestamps
for when the event occurred and when the object was initialized, respectively.</p>
<p>The recommended approach to satisfy the contract is to assign <code>ts_event</code> and <code>ts_init</code>
to backing fields, and then implement the <code>@property</code> for each as shown above
(for completeness, the docstrings are copied from the <code>Data</code> base class).</p>
<div class="theme-admonition theme-admonition-info admonition_lEzE alert alert--info"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_Vfkp"><p>These timestamps enable Nautilus to correctly order data streams for backtests
using monotonically increasing <code>ts_init</code> UNIX nanoseconds.</p></div></div>
<p>We can now work with this data type for backtesting and live trading. For instance,
we could now create an adapter which is able to parse and create objects of this
type - and send them back to the <code>DataEngine</code> for consumption by subscribers.</p>
<p>You can publish a custom data type within your actor/strategy using the message bus
in the following way:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">publish_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DataType</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MyDataPoint</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> metadata</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;some_optional_category&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MyDataPoint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>The <code>metadata</code> dictionary optionally adds more granular information that is used in the
topic name to publish data with the message bus.</p>
<p>Extra metadata information can also be passed to a <code>BacktestDataConfig</code> configuration object in order to
enrich and describe custom data objects used in a backtesting context:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> BacktestDataConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BacktestDataConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catalog_path</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_cls</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">MyDataPoint</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;some_optional_category&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>You can subscribe to custom data types within your actor/strategy in the following way:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscribe_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">DataType</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MyDataPoint</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;some_optional_category&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ClientId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;MY_ADAPTER&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>The <code>client_id</code> provides an identifier to route the data subscription to a specific client.</p>
<p>This will result in your actor/strategy passing these received <code>MyDataPoint</code>
objects to your <code>on_data</code> method. You will need to check the type, as this
method acts as a flexible handler for all custom data.</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">on_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># First check the type of data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token builtin">isinstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> MyDataPoint</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Do something with the data</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="publishing-and-receiving-signal-data">Publishing and receiving signal data<a href="#publishing-and-receiving-signal-data" class="hash-link" aria-label="Publishing and receiving signal data的直接链接" title="Publishing and receiving signal data的直接链接" translate="no">​</a></h3>
<p>Here is an example of publishing and receiving signal data using the <code>MessageBus</code> from an actor or strategy.
A signal is an automatically generated custom data identified by a name containing only one value of a basic type
(str, float, int, bool or bytes).</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">publish_signal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;signal_name&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ts_event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscribe_signal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;signal_name&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">on_signal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> signal</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Signal&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="option-greeks-example">Option greeks example<a href="#option-greeks-example" class="hash-link" aria-label="Option greeks example的直接链接" title="Option greeks example的直接链接" translate="no">​</a></h3>
<p>This example demonstrates how to create a custom data type for option Greeks, specifically the delta.
By following these steps, you can create custom data types, subscribe to them, publish them, and store
them in the <code>Cache</code> or <code>ParquetDataCatalog</code> for efficient retrieval.</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> msgspec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">core </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">core</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datetime </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> unix_nanos_to_iso8601</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> DataType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">serialization</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">base </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> register_serializable_type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">serialization</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">arrow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">serializer </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> register_arrow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pyarrow </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InstrumentId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">core</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datetime </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> dt_to_unix_nanos</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unix_nanos_to_dt</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> format_iso8601</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">GreeksData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> instrument_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InstrumentId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InstrumentId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;ES.GLBX&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ts_event</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ts_init</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        delta</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">instrument_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> instrument_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_ts_event </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ts_event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_ts_init </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ts_init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">delta </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> delta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__repr__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;GreeksData(ts_init=</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">unix_nanos_to_iso8601</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">_ts_init</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, instrument_id=</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">instrument_id</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, delta=</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">delta</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">)&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@property</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ts_event</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_ts_event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@property</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ts_init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_ts_init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">to_dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;instrument_id&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">instrument_id</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;ts_event&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_ts_event</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;ts_init&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_ts_init</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;delta&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">delta</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@classmethod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">from_dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cls</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> GreeksData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">InstrumentId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;instrument_id&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;ts_event&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;ts_init&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;delta&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">to_bytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> msgspec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">msgpack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@classmethod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">from_bytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cls</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">bytes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> cls</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msgspec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">msgpack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">decode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">to_catalog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> pa</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RecordBatch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_pylist</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> schema</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">GreeksData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">schema</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@classmethod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">from_catalog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cls</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> table</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pa</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Table</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">GreeksData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> d </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> table</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_pylist</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@classmethod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">schema</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cls</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> pa</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">schema</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;instrument_id&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pa</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;ts_event&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pa</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">int64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;ts_init&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pa</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">int64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;delta&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pa</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">float64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="publishing-and-receiving-data">Publishing and receiving data<a href="#publishing-and-receiving-data" class="hash-link" aria-label="Publishing and receiving data的直接链接" title="Publishing and receiving data的直接链接" translate="no">​</a></h4>
<p>Here is an example of publishing and receiving data using the <code>MessageBus</code> from an actor or strategy:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">register_serializable_type</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GreeksData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GreeksData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_dict</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GreeksData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_dict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">publish_greeks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> greeks_data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> GreeksData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">publish_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DataType</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GreeksData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> greeks_data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">subscribe_to_greeks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscribe_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DataType</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GreeksData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">on_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token builtin">isinstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GreeksData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Data&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="writing-and-reading-data-using-the-cache">Writing and reading data using the cache<a href="#writing-and-reading-data-using-the-cache" class="hash-link" aria-label="Writing and reading data using the cache的直接链接" title="Writing and reading data using the cache的直接链接" translate="no">​</a></h4>
<p>Here is an example of writing and reading data using the <code>Cache</code> from an actor or strategy:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">greeks_key</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">instrument_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InstrumentId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">instrument_id</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">_GREEKS&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cache_greeks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> greeks_data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> GreeksData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">greeks_key</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">greeks_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">instrument_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> greeks_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_bytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">greeks_from_cache</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> instrument_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InstrumentId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> GreeksData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_bytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">greeks_key</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">instrument_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="writing-and-reading-data-using-a-catalog">Writing and reading data using a catalog<a href="#writing-and-reading-data-using-a-catalog" class="hash-link" aria-label="Writing and reading data using a catalog的直接链接" title="Writing and reading data using a catalog的直接链接" translate="no">​</a></h4>
<p>For streaming custom data to feather files or writing it to parquet files in a catalog
(<code>register_arrow</code> needs to be used):</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">register_arrow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GreeksData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GreeksData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">schema</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GreeksData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_catalog</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GreeksData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_catalog</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">persistence</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">catalog </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> ParquetDataCatalog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ParquetDataCatalog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;.&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">GreeksData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="creating-a-custom-data-class-automatically">Creating a custom data class automatically<a href="#creating-a-custom-data-class-automatically" class="hash-link" aria-label="Creating a custom data class automatically的直接链接" title="Creating a custom data class automatically的直接链接" translate="no">​</a></h3>
<p>The <code>@customdataclass</code> decorator enables the creation of a custom data class with default
implementations for all the features described above.</p>
<p>Each method can also be overridden if needed. Here is an example of its usage:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">custom </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> customdataclass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@customdataclass</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">GreeksTestData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InstrumentId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InstrumentId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;ES.GLBX&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    delta</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GreeksTestData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">InstrumentId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;CL.GLBX&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    delta</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1000.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ts_event</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ts_init</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_RpWm" id="custom-data-type-stub">Custom data type stub<a href="#custom-data-type-stub" class="hash-link" aria-label="Custom data type stub的直接链接" title="Custom data type stub的直接链接" translate="no">​</a></h4>
<p>To enhance development convenience and improve code suggestions in your IDE, you can create a <code>.pyi</code>
stub file with the proper constructor signature for your custom data types as well as type hints for attributes.
This is particularly useful when the constructor is dynamically generated at runtime, as it allows the IDE to recognize
and provide suggestions for the class&#x27;s methods and attributes.</p>
<p>For instance, if you have a custom data class defined in <code>greeks.py</code>, you can create a corresponding <code>greeks.pyi</code> file
with the following constructor signature:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">core </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InstrumentId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">GreeksData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InstrumentId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    delta</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ts_event</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ts_init</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        instrument_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InstrumentId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InstrumentId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;ES.GLBX&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        delta</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> GreeksData</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/Aloento/NautilusTraderDoc/tree/main/docs/concepts/data.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_F7ru" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_GNoA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/concepts/cache"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Cache</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/concepts/execution"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Execution</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_pg_n thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#order-books" class="table-of-contents__link toc-highlight">Order books</a></li><li><a href="#instruments" class="table-of-contents__link toc-highlight">Instruments</a></li><li><a href="#bars-and-aggregation" class="table-of-contents__link toc-highlight">Bars and aggregation</a><ul><li><a href="#introduction-to-bars" class="table-of-contents__link toc-highlight">Introduction to bars</a></li><li><a href="#purpose-of-data-aggregation" class="table-of-contents__link toc-highlight">Purpose of data aggregation</a></li><li><a href="#aggregation-methods" class="table-of-contents__link toc-highlight">Aggregation methods</a></li><li><a href="#types-of-aggregation" class="table-of-contents__link toc-highlight">Types of aggregation</a></li><li><a href="#bar-types" class="table-of-contents__link toc-highlight">Bar types</a></li><li><a href="#aggregation-sources" class="table-of-contents__link toc-highlight">Aggregation sources</a></li><li><a href="#defining-bar-types-with-string-syntax" class="table-of-contents__link toc-highlight">Defining bar types with <em>string syntax</em></a></li><li><a href="#aggregation-syntax-examples" class="table-of-contents__link toc-highlight">Aggregation syntax examples</a></li><li><a href="#working-with-bars-request-vs-subscribe" class="table-of-contents__link toc-highlight">Working with bars: request vs. subscribe</a></li><li><a href="#historical-data-requests-with-aggregation" class="table-of-contents__link toc-highlight">Historical data requests with aggregation</a></li><li><a href="#common-pitfalls" class="table-of-contents__link toc-highlight">Common pitfalls</a></li></ul></li><li><a href="#timestamps" class="table-of-contents__link toc-highlight">Timestamps</a><ul><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a></li><li><a href="#latency-analysis" class="table-of-contents__link toc-highlight">Latency analysis</a></li><li><a href="#environment-specific-behavior" class="table-of-contents__link toc-highlight">Environment-specific behavior</a></li><li><a href="#other-notes-and-considerations" class="table-of-contents__link toc-highlight">Other notes and considerations</a></li></ul></li><li><a href="#data-flow" class="table-of-contents__link toc-highlight">Data flow</a></li><li><a href="#loading-data" class="table-of-contents__link toc-highlight">Loading data</a><ul><li><a href="#data-loaders" class="table-of-contents__link toc-highlight">Data loaders</a></li><li><a href="#data-wranglers" class="table-of-contents__link toc-highlight">Data wranglers</a></li><li><a href="#transformation-pipeline" class="table-of-contents__link toc-highlight">Transformation pipeline</a></li></ul></li><li><a href="#data-catalog" class="table-of-contents__link toc-highlight">Data catalog</a><ul><li><a href="#overview-and-architecture" class="table-of-contents__link toc-highlight">Overview and architecture</a></li><li><a href="#initializing" class="table-of-contents__link toc-highlight">Initializing</a></li><li><a href="#filesystem-protocols-and-storage-options" class="table-of-contents__link toc-highlight">Filesystem protocols and storage options</a></li><li><a href="#writing-data" class="table-of-contents__link toc-highlight">Writing data</a></li><li><a href="#file-naming-and-data-organization" class="table-of-contents__link toc-highlight">File naming and data organization</a></li><li><a href="#reading-data" class="table-of-contents__link toc-highlight">Reading data</a></li><li><a href="#backtestdataconfig---data-specification-for-backtests" class="table-of-contents__link toc-highlight"><code>BacktestDataConfig</code> - data specification for backtests</a></li><li><a href="#datacatalogconfig---on-the-fly-data-loading" class="table-of-contents__link toc-highlight">DataCatalogConfig - on-the-fly data loading</a></li><li><a href="#query-system-and-dual-backend-architecture" class="table-of-contents__link toc-highlight">Query system and dual backend architecture</a></li><li><a href="#catalog-operations" class="table-of-contents__link toc-highlight">Catalog operations</a></li><li><a href="#feather-streaming-and-conversion" class="table-of-contents__link toc-highlight">Feather streaming and conversion</a></li><li><a href="#catalog-summary" class="table-of-contents__link toc-highlight">Catalog summary</a></li></ul></li><li><a href="#data-migrations" class="table-of-contents__link toc-highlight">Data migrations</a><ul><li><a href="#migration-tools" class="table-of-contents__link toc-highlight">Migration tools</a></li><li><a href="#migration-process" class="table-of-contents__link toc-highlight">Migration process</a></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best practices</a></li></ul></li><li><a href="#custom-data" class="table-of-contents__link toc-highlight">Custom data</a><ul><li><a href="#publishing-and-receiving-signal-data" class="table-of-contents__link toc-highlight">Publishing and receiving signal data</a></li><li><a href="#option-greeks-example" class="table-of-contents__link toc-highlight">Option greeks example</a></li><li><a href="#creating-a-custom-data-class-automatically" class="table-of-contents__link toc-highlight">Creating a custom data class automatically</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 NautilusTrader Documentation.</div></div></div></footer></div>
</body>
</html>