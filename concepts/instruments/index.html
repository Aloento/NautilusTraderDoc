<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-concepts/instruments" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">合约与交易品种 | NautilusTrader 文档</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://nautilus.aloen.to/concepts/instruments"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="合约与交易品种 | NautilusTrader 文档"><meta data-rh="true" name="description" content="Instrument 基类定义了任何可交易资产/合约的核心规范。平台目前包含多个子类，用于表示不同的资产类别和合约类型："><meta data-rh="true" property="og:description" content="Instrument 基类定义了任何可交易资产/合约的核心规范。平台目前包含多个子类，用于表示不同的资产类别和合约类型："><link data-rh="true" rel="icon" href="/logo.png"><link data-rh="true" rel="canonical" href="https://nautilus.aloen.to/concepts/instruments"><link data-rh="true" rel="alternate" href="https://nautilus.aloen.to/concepts/instruments" hreflang="zh"><link data-rh="true" rel="alternate" href="https://nautilus.aloen.to/concepts/instruments" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"概念","item":"https://nautilus.aloen.to/concepts/"},{"@type":"ListItem","position":2,"name":"合约与交易品种","item":"https://nautilus.aloen.to/concepts/instruments"}]}</script><link rel="stylesheet" href="/assets/css/styles.33db920f.css">
<script src="/assets/js/runtime~main.7f15ce23.js" defer="defer"></script>
<script src="/assets/js/main.7a54437b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/logo.png"><div role="region" aria-label="跳到主要内容"><a class="skipToContent__uWo" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/logo.png" alt="NautilusTrader Logo" class="themedComponent_WkLn themedComponent--light_cjoX"><img src="/logo.png" alt="NautilusTrader Logo" class="themedComponent_WkLn themedComponent--dark_jZId"></div><b class="navbar__title text--truncate">NautilusTrader</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/api_reference/">文档</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/Aloento/NautilusTraderDoc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_KfBJ"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_RWFU colorModeToggle_sA1q"><button class="clean-btn toggleButton_qjfc toggleButtonDisabled_cpNp" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_CetX lightToggleIcon_UYsV"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_CetX darkToggleIcon_i1s2"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_CetX systemToggleIcon_yIQx"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_PsjF"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_jk42"><div class="docsWrapper_KWBO"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_XpKL" type="button"></button><div class="docRoot_joIP"><aside class="theme-doc-sidebar-container docSidebarContainer_DOen"><div class="sidebarViewport_j7YP"><div class="sidebar_nPgc"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_MTDt"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/api_reference/"><span title="Python API" class="categoryLinkLabel_XKxb">Python API</span></a><button aria-label="展开侧边栏分类 &#x27;Python API&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist menu__link--active" href="/concepts/"><span title="概念" class="categoryLinkLabel_XKxb">概念</span></a><button aria-label="折叠侧边栏分类 &#x27;概念&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/actors"><span title="Actors" class="linkLabel_CNtA">Actors</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/adapters"><span title="适配器" class="linkLabel_CNtA">适配器</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/architecture"><span title="架构" class="linkLabel_CNtA">架构</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/backtesting"><span title="回测" class="linkLabel_CNtA">回测</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/cache"><span title="Cache" class="linkLabel_CNtA">Cache</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/data"><span title="数据" class="linkLabel_CNtA">数据</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/execution"><span title="执行" class="linkLabel_CNtA">执行</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/concepts/instruments"><span title="合约与交易品种" class="linkLabel_CNtA">合约与交易品种</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/live"><span title="Live 交易" class="linkLabel_CNtA">Live 交易</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/logging"><span title="日志" class="linkLabel_CNtA">日志</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/message_bus"><span title="消息总线" class="linkLabel_CNtA">消息总线</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/orders"><span title="订单" class="linkLabel_CNtA">订单</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/overview"><span title="概览" class="linkLabel_CNtA">概览</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/portfolio"><span title="投资组合" class="linkLabel_CNtA">投资组合</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/positions"><span title="持仓" class="linkLabel_CNtA">持仓</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/reports"><span title="报告" class="linkLabel_CNtA">报告</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/strategies"><span title="策略" class="linkLabel_CNtA">策略</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/developer_guide/"><span title="开发者指南" class="categoryLinkLabel_XKxb">开发者指南</span></a><button aria-label="展开侧边栏分类 &#x27;开发者指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/getting_started/"><span title="入门" class="categoryLinkLabel_XKxb">入门</span></a><button aria-label="展开侧边栏分类 &#x27;入门&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/integrations/"><span title="集成" class="categoryLinkLabel_XKxb">集成</span></a><button aria-label="展开侧边栏分类 &#x27;集成&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/tutorials/"><span title="教程" class="categoryLinkLabel_XKxb">教程</span></a><button aria-label="展开侧边栏分类 &#x27;教程&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_bw1l"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_PIhC"><div class="docItemContainer_pFw3"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_HRKZ" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_sX5c"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/concepts/"><span>概念</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">合约与交易品种</span></li></ul></nav><div class="tocCollapsible_DhUt theme-doc-toc-mobile tocMobile_Izjv"><button type="button" class="clean-btn tocCollapsibleButton_eYR5">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>合约与交易品种</h1></header>
<p><code>Instrument</code> 基类定义了任何可交易资产/合约的核心规范。平台目前包含多个子类，用于表示不同的<em>资产类别</em>和<em>合约类型</em>：</p>
<ul>
<li><code>Equity</code>：在现金市场交易的上市股票或 ETF</li>
<li><code>FuturesContract</code>：有实物/现金交割的期货合约，具有明确的标的、到期日和乘数</li>
<li><code>FuturesSpread</code>：交易所定义的多腿期货策略（例如日历展期或跨品种），作为单一工具报价</li>
<li><code>OptionContract</code>：交易所上市的期权（看涨或看跌），具有行权价和到期日</li>
<li><code>OptionSpread</code>：交易所定义的多腿期权策略（例如垂直价差、日历、跨式），作为单一工具报价</li>
<li><code>BinaryOption</code>：按二元结果结算为 0 或 1 的固定收益期权</li>
<li><code>Cfd</code>：场外交易的差价合约（Contract for Difference），跟踪标的并以现金结算</li>
<li><code>Commodity</code>：现货商品（例如黄金或原油），在现货/现金市场交易</li>
<li><code>CurrencyPair</code>：以 BASE/QUOTE 格式表示的现货外汇或加密货币交易对</li>
<li><code>CryptoOption</code>：以加密货币为标的且以加密货币计价/结算的期权，支持 inverse 或 quanto 风格</li>
<li><code>CryptoPerpetual</code>：无到期日的加密永续合约（perpetual swap），可为 inverse 或 quanto 结算</li>
<li><code>CryptoFuture</code>：有固定到期日、以加密货币为标的并以某种结算货币结算的加密期货合约</li>
<li><code>IndexInstrument</code>：由成分计算得出的现货指数，用作参考价，通常不可直接交易</li>
<li><code>BettingInstrument</code>：体育或博彩市场的一个选择（例如某队或某名选手），可在博彩场所交易</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="记号与标识symbology">记号与标识（Symbology）<a href="#记号与标识symbology" class="hash-link" aria-label="记号与标识（Symbology）的直接链接" title="记号与标识（Symbology）的直接链接" translate="no">​</a></h2>
<p>所有合约都应具有唯一的 <code>InstrumentId</code>，由本地符号（native symbol）和市场/交易所 ID（venue ID）通过小数点分隔组成。
例如，在 Binance Futures（加密）上，以太坊永续合约的 InstrumentId 为 <code>ETHUSDT-PERP.BINANCE</code>。</p>
<p>通常每个交易场所的本地符号应当是唯一的（但并非在所有场景都成立，例如 Binance 在现货与期货间可能复用相同符号），
而 <code>{symbol.venue}</code> 的组合在整个 Nautilus 系统中<strong>必须</strong>唯一。</p>
<div class="theme-admonition theme-admonition-warning admonition_lEzE alert alert--warning"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_Vfkp"><p>必须将合约与对应的市场数据集（如 tick 或 order book 数据）正确匹配，才能保证逻辑上的正确性。
错误的合约定义可能导致数据被截断或出现意外结果。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="回测backtesting">回测（Backtesting）<a href="#回测backtesting" class="hash-link" aria-label="回测（Backtesting）的直接链接" title="回测（Backtesting）的直接链接" translate="no">​</a></h2>
<p>通用的测试合约可以通过 <code>TestInstrumentProvider</code> 实例化：</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">test_kit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">providers </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> TestInstrumentProvider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">audusd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TestInstrumentProvider</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">default_fx_ccy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;AUD/USD&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>针对特定交易所的合约可以通过适配器提供的 <code>InstrumentProvider</code> 从实时交易所数据中发现：</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adapters</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">binance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spot</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">providers </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> BinanceSpotInstrumentProvider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InstrumentId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">provider </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BinanceSpotInstrumentProvider</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">client</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">binance_http_client</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> provider</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load_all_async</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">btcusdt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InstrumentId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;BTCUSDT.BINANCE&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instrument </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> provider</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">btcusdt</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>或者用户也可以直接通过 <code>Instrument</code> 构造函数或其更具体的子类灵活地定义合约：</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">instruments </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Instrument</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instrument </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Instrument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># &lt;-- 提供所有必要参数</span><br></span></code></pre></div></div>
<p>完整的合约 API 参考见：<a href="/api_reference/model/instruments">API Reference</a>。</p>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="实盘交易live-trading">实盘交易（Live trading）<a href="#实盘交易live-trading" class="hash-link" aria-label="实盘交易（Live trading）的直接链接" title="实盘交易（Live trading）的直接链接" translate="no">​</a></h2>
<p>实盘集成适配器提供了 <code>InstrumentProvider</code> 类，用于自动缓存交易所的最新合约定义。需要在数据或执行相关方法中引用某个 <code>Instrument</code> 时，
使用对应的 <code>InstrumentId</code> 来进行识别与传参。</p>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="查找合约finding-instruments">查找合约（Finding instruments）<a href="#查找合约finding-instruments" class="hash-link" aria-label="查找合约（Finding instruments）的直接链接" title="查找合约（Finding instruments）的直接链接" translate="no">​</a></h2>
<p>由于同一套 actor/strategy 类可以用于回测与实盘，你可以通过中央缓存以完全相同的方式获取合约：</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InstrumentId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instrument_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InstrumentId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;ETHUSDT-PERP.BINANCE&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instrument </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">instrument_id</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>你也可以订阅某个合约的变更：</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscribe_instrument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">instrument_id</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>或者订阅整个交易场所（venue）上所有合约的变更：</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Venue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">binance </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Venue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;BINANCE&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscribe_instruments</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">binance</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>当 <code>DataEngine</code> 收到合约更新时，该对象会传入 actor/strategy 的 <code>on_instrument()</code> 方法。用户可以重写此方法以对合约更新执行自定义操作：</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">instruments </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Instrument</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">on_instrument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> instrument</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Instrument</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 在合约更新时执行某些操作</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pass</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="精度与增量precisions-and-increments">精度与增量（Precisions and increments）<a href="#精度与增量precisions-and-increments" class="hash-link" aria-label="精度与增量（Precisions and increments）的直接链接" title="精度与增量（Precisions and increments）的直接链接" translate="no">​</a></h2>
<p>合约对象以<em>只读</em>属性的形式组织合约规范，提供了正确的价格与数量精度、最小价格与数量增量、乘数和标准手数等信息。</p>
<div class="theme-admonition theme-admonition-note admonition_lEzE alert alert--secondary"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_Vfkp"><p>大多数这些限制项会由 Nautilus 的 <code>RiskEngine</code> 进行校验，否则价格或数量的不合法值可能导致交易所拒单。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="限制limits">限制（Limits）<a href="#限制limits" class="hash-link" aria-label="限制（Limits）的直接链接" title="限制（Limits）的直接链接" translate="no">​</a></h2>
<p>某些限制字段在合约中是可选的（可能为 <code>None</code>），这取决于交易所，常见的包括：</p>
<ul>
<li><code>max_quantity</code>（单笔订单允许的最大数量）</li>
<li><code>min_quantity</code>（单笔订单允许的最小数量）</li>
<li><code>max_notional</code>（单笔订单允许的最大名义价值）</li>
<li><code>min_notional</code>（单笔订单允许的最小名义价值）</li>
<li><code>max_price</code>（允许的最大报价或订单价格）</li>
<li><code>min_price</code>（允许的最小报价或订单价格）</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_lEzE alert alert--secondary"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_Vfkp"><p>大多数这些限制也会由 Nautilus 的 <code>RiskEngine</code> 进行校验，超出交易所发布的限制可能导致交易所拒单。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="价格与数量的创建prices-and-quantities">价格与数量的创建（Prices and quantities）<a href="#价格与数量的创建prices-and-quantities" class="hash-link" aria-label="价格与数量的创建（Prices and quantities）的直接链接" title="价格与数量的创建（Prices and quantities）的直接链接" translate="no">​</a></h2>
<p>合约对象还提供便捷方法，用于根据给定值创建合法的价格和数量：</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">instrument </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">instrument_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">price </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">make_price</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.90500</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">quantity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> instrument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">make_qty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">150</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_lEzE alert alert--success"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_Vfkp"><p>以上方法是创建合法价格与数量的推荐方式，例如在将其传递给订单工厂（order factory）时使用。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="保证金与费用margins-and-fees">保证金与费用（Margins and fees）<a href="#保证金与费用margins-and-fees" class="hash-link" aria-label="保证金与费用（Margins and fees）的直接链接" title="保证金与费用（Margins and fees）的直接链接" translate="no">​</a></h2>
<p>保证金计算由 <code>MarginAccount</code> 类负责。下文说明了保证金的工作方式并介绍了关键概念。</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="何时适用保证金">何时适用保证金？<a href="#何时适用保证金" class="hash-link" aria-label="何时适用保证金？的直接链接" title="何时适用保证金？的直接链接" translate="no">​</a></h3>
<p>不同交易所（例如 CME 或 Binance）采用特定的账户类型来决定是否需要进行保证金计算。
在设置交易场所时，你需要指定以下账户类型之一：</p>
<ul>
<li><code>AccountType.MARGIN</code>：适用保证金计算的账户类型</li>
<li><code>AccountType.CASH</code>：不适用保证金计算的现金账户</li>
<li><code>AccountType.BETTING</code>：用于博彩类型的账户，也不涉及保证金计算</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="术语说明vocabulary">术语说明（Vocabulary）<a href="#术语说明vocabulary" class="hash-link" aria-label="术语说明（Vocabulary）的直接链接" title="术语说明（Vocabulary）的直接链接" translate="no">​</a></h3>
<p>为便于理解保证金交易，先介绍若干关键术语：</p>
<p><strong>名义价值（Notional Value）</strong>：以计价货币表示的合约总价值，代表你持仓的市场总价值。例如在 CME 的 EUR/USD 期货（代码 6E）：</p>
<ul>
<li>每份合约代表 125,000 EUR（EUR 为 base，USD 为 quote）</li>
<li>若当前市场价为 1.1000，则名义价值为 125,000 EUR × 1.1000（EUR/USD 价格）= 137,500 USD</li>
</ul>
<p><strong>杠杆（Leverage）</strong>：决定相对于账户保证金你可以控制多少市值敞口的比率。例如 10× 杠杆意味着用 1,000 USD 的保证金可以控制 10,000 USD 的头寸。</p>
<p><strong>初始保证金（Initial Margin，<code>margin_init</code>）</strong>：开仓所需的保证金率，表示在开仓前账户中需要满足的最低可用资金（这通常是一个预检，资金并非真正冻结）。</p>
<p><strong>维持保证金（Maintenance Margin，<code>margin_maint</code>）</strong>：维持仓位所需的保证金率，此金额会在账户中被锁定以维持仓位，通常低于初始保证金。你可以在策略中通过以下接口查看被锁定的总保证金（对所有未平仓位的维持保证金求和）：</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">portfolio</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">balances_locked</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">venue</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>Maker/Taker 费用</strong>：交易所基于订单对市场的贡献类型收取的费用：</p>
<ul>
<li>Maker 费（<code>maker_fee</code>）：当你的挂单为订单簿提供流动性并最终成交时收取（通常较低）</li>
<li>Taker 费（<code>taker_fee</code>）：当你的订单立即成交、移除流动性时收取（通常较高）</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_lEzE alert alert--success"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_Vfkp"><p>并非所有交易所或合约都实现 maker/taker 费率。若不存在该机制，请在 <code>Instrument</code> 中将 <code>maker_fee</code> 与 <code>taker_fee</code> 都设为 0（例如对 <code>FuturesContract</code>、<code>Equity</code>、<code>CurrencyPair</code>、<code>Commodity</code>、<code>Cfd</code>、<code>BinaryOption</code>、<code>BettingInstrument</code>）。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="保证金计算公式">保证金计算公式<a href="#保证金计算公式" class="hash-link" aria-label="保证金计算公式的直接链接" title="保证金计算公式的直接链接" translate="no">​</a></h3>
<p><code>MarginAccount</code> 使用如下公式计算保证金：</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Initial margin calculation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">margin_init </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">notional_value </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> leverage </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> margin_init</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">notional_value </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> leverage </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> taker_fee</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Maintenance margin calculation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">margin_maint </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">notional_value </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> leverage </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> margin_maint</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">notional_value </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> leverage </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> taker_fee</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>要点说明：</p>
<ul>
<li>两个公式结构相同，但分别使用对应的保证金率（<code>margin_init</code> 与 <code>margin_maint</code>）。</li>
<li>每个公式包括两部分：<!-- -->
<ul>
<li><strong>基础保证金计算</strong>：基于名义价值、杠杆与保证金率</li>
<li><strong>费用调整</strong>：将 maker/taker 费用纳入考虑</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="实现细节">实现细节<a href="#实现细节" class="hash-link" aria-label="实现细节的直接链接" title="实现细节的直接链接" translate="no">​</a></h3>
<p>若需查看具体实现，请参考：</p>
<ul>
<li><a href="https://github.com/nautechsystems/nautilus_trader/blob/develop/nautilus_trader/accounting/accounts/margin.pyx" target="_blank" rel="noopener noreferrer">nautilus_trader/accounting/accounts/margin.pyx</a></li>
<li>关键方法：<code>calculate_margin_init(self, ...)</code> 与 <code>calculate_margin_maint(self, ...)</code></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="佣金commissions">佣金（Commissions）<a href="#佣金commissions" class="hash-link" aria-label="佣金（Commissions）的直接链接" title="佣金（Commissions）的直接链接" translate="no">​</a></h2>
<p>交易佣金是交易所或经纪商为执行交易收取的费用。在加密市场常见 maker/taker 结构，而传统交易所（如 CME）常采用按合约计费的结构。
NautilusTrader 支持多种佣金模型以适配不同市场的费率结构。</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="内置费率模型">内置费率模型<a href="#内置费率模型" class="hash-link" aria-label="内置费率模型的直接链接" title="内置费率模型的直接链接" translate="no">​</a></h3>
<p>框架内提供两种常见的内置费率模型实现：</p>
<ol>
<li><code>MakerTakerFeeModel</code>：实现加密货币交易所常见的 maker/taker 费率结构，费用按成交金额的一定比例计算。</li>
<li><code>FixedFeeModel</code>：按单笔交易收取固定费用，与交易规模无关。</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="自定义费率模型">自定义费率模型<a href="#自定义费率模型" class="hash-link" aria-label="自定义费率模型的直接链接" title="自定义费率模型的直接链接" translate="no">​</a></h3>
<p>尽管内置模型覆盖大多数场景，但某些交易所可能需要按合约收费等特殊结构。NautilusTrader 的可扩展架构允许通过继承基类 <code>FeeModel</code> 实现自定义费率模型。</p>
<p>例如，在如 CME 这类按合约收费的场景中，可以实现按合约计费的模型。注意 <code>FeeModel</code> 在内部为 Cython 实现，为了性能其方法参数命名采用了带类型前缀的命名约定（例如 <code>Order_order</code> 或 <code>Quantity_fill_qty</code>）。</p>
<p>下面示例展示了如何实现一个按合约计费的自定义模型（代码保持原样）：</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">PerContractFeeModel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FeeModel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> commission</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Money</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">commission </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> commission</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_commission</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Order_order</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Quantity_fill_qty</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Price_fill_px</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Instrument_instrument</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        total_commission </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Money</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">commission </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> Quantity_fill_qty</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">commission</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">currency</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> total_commission</span><br></span></code></pre></div></div>
<p>该实现通过将“每份合约的固定费用”乘以成交合约数量来计算总佣金。<code>get_commission(...)</code> 方法接收订单、成交数量、成交价格和合约等信息，从而支持灵活的佣金计算。</p>
<p>由于 <code>PerContractFeeModel</code> 继承自用 Cython 实现的 <code>FeeModel</code>，方法签名中会出现 Cython 风格的参数命名：</p>
<ul>
<li><code>Order_order</code>：订单对象，带有类型前缀 <code>Order_</code></li>
<li><code>Quantity_fill_qty</code>：成交数量，带有类型前缀 <code>Quantity_</code></li>
<li><code>Price_fill_px</code>：成交价格，带有类型前缀 <code>Price_</code></li>
<li><code>Instrument_instrument</code>：合约对象，带有类型前缀 <code>Instrument_</code></li>
</ul>
<p>这种命名约定虽然相比常规 Python 命名显得冗长，但有助于与框架中 Cython 代码保持一致性和类型清晰性。</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="在实际中使用费率模型">在实际中使用费率模型<a href="#在实际中使用费率模型" class="hash-link" aria-label="在实际中使用费率模型的直接链接" title="在实际中使用费率模型的直接链接" translate="no">​</a></h3>
<p>在设置交易场所（venue）时指定想要的费率模型（内置或自定义）。例如使用前述的按合约计费模型：</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">currencies </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> USD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">objects </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Money</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Currency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">engine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_venue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    venue</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">venue</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    oms_type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">OmsType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">NETTING</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    account_type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">AccountType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MARGIN</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    base_currency</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">USD</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fee_model</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">PerContractFeeModel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Money</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2.50</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> USD</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 2.50 USD per contract</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    starting_balances</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Money</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1_000_000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> USD</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Starting with 1,000,000 USD balance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_lEzE alert alert--success"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_Vfkp"><p>实现自定义费率模型时，请确保模型与目标交易所的费率结构一致。即便是小幅差异，也可能在回测结果中对绩效度量产生显著影响。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="额外信息">额外信息<a href="#额外信息" class="hash-link" aria-label="额外信息的直接链接" title="额外信息的直接链接" translate="no">​</a></h3>
<p>交易所提供的原始合约定义（通常为 JSON 序列化数据）也会以通用的 Python 字典形式保留在合约对象中，便于在运行时通过 <code>.info</code> 属性访问那些并非统一 Nautilus API 一部分的额外信息。</p>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="合成synthetic合约">合成（Synthetic）合约<a href="#合成synthetic合约" class="hash-link" aria-label="合成（Synthetic）合约的直接链接" title="合成（Synthetic）合约的直接链接" translate="no">​</a></h2>
<p>平台支持创建自定义的合成合约（synthetic instruments），它们可以生成合成报价和成交，用途包括：</p>
<ul>
<li>允许 <code>Actor</code> 与 <code>Strategy</code> 组件订阅合成的报价或成交流</li>
<li>触发仿真（emulated）订单</li>
<li>用合成报价/成交构建 K 线/Bar</li>
</ul>
<p>合成合约不能被直接交易（它们仅在平台本地存在），主要作为分析工具，用来基于其组成合约计算有用的指标。</p>
<p>未来计划支持基于合成合约行为的订单管理——即根据合成合约的变化去交易其组成合约。</p>
<div class="theme-admonition theme-admonition-info admonition_lEzE alert alert--info"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_Vfkp"><p>合成合约的 venue 恒定标记为 <code>&#x27;SYNTH&#x27;</code>。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="公式formula">公式（Formula）<a href="#公式formula" class="hash-link" aria-label="公式（Formula）的直接链接" title="公式（Formula）的直接链接" translate="no">​</a></h3>
<p>一个合成合约由两个或更多组成合约（可跨多个交易场所）以及一个“派生公式（derivation formula）”构成。
平台通过内嵌的动态表达式引擎（基于 Rust 的 <a href="https://github.com/ISibboI/evalexpr" target="_blank" rel="noopener noreferrer">evalexpr</a> crate）来评估公式，从而根据各组成合约的最新价格计算出合成的最新价格 tick。</p>
<p>有关可用操作符与优先级的完整说明，请参阅 <code>evalexpr</code> 文档。</p>
<div class="theme-admonition theme-admonition-tip admonition_lEzE alert alert--success"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_Vfkp"><p>在定义新的合成合约前，请确保所有组成合约已定义并存在于缓存中。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="订阅subscribing">订阅（Subscribing）<a href="#订阅subscribing" class="hash-link" aria-label="订阅（Subscribing）的直接链接" title="订阅（Subscribing）的直接链接" translate="no">​</a></h3>
<p>下面示例演示如何在 actor/strategy 中创建一个新的合成合约。该例子表示在 Binance 上 BTC 与 ETH 现货价之间的简单价差，假设 <code>BTCUSDT.BINANCE</code> 与 <code>ETHUSDT.BINANCE</code> 已存在缓存中。</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">instruments </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> SyntheticInstrument</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">btcusdt_binance_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InstrumentId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;BTCUSDT.BINANCE&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ethusdt_binance_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InstrumentId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;ETHUSDT.BINANCE&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Define the synthetic instrument</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">synthetic </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SyntheticInstrument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    symbol</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Symbol</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;BTC-ETH:BINANCE&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    price_precision</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    components</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        btcusdt_binance_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ethusdt_binance_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    formula</span><span class="token operator" style="color:#393A34">=</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">btcusdt_binance_id</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> - </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">ethusdt_binance_id</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ts_event</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">timestamp_ns</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ts_init</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">timestamp_ns</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Recommended to store the synthetic instruments ID somewhere</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_synthetic_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> synthetic</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Add the synthetic instrument for use by other components</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_synthetic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">synthetic</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Subscribe to quotes for the synthetic instrument</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscribe_quote_ticks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_synthetic_id</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_lEzE alert alert--secondary"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_Vfkp"><p>上例中合成合约的 <code>instrument_id</code> 将以 <code>{symbol}.{SYNTH}</code> 的格式生成，例如 <code>&#x27;BTC-ETH:BINANCE.SYNTH&#x27;</code>。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="更新公式updating-formulas">更新公式（Updating formulas）<a href="#更新公式updating-formulas" class="hash-link" aria-label="更新公式（Updating formulas）的直接链接" title="更新公式（Updating formulas）的直接链接" translate="no">​</a></h3>
<p>合成合约的公式可以随时更新。下面示例展示如何在 actor/strategy 中更新公式：</p>
<div class="language-text codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-text codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain"># 从缓存中取回合成合约（假设已保存 synthetic_id）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">synthetic = self.cache.synthetic(self._synthetic_id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 更新公式，这里以计算平均值为例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">new_formula = &quot;(BTCUSDT.BINANCE + ETHUSDT.BINANCE) / 2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">synthetic.change_formula(new_formula)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 提交合成合约的更新</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">self.update_synthetic(synthetic)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="触发合约-idtrigger-instrument-ids">触发合约 ID（Trigger instrument IDs）<a href="#触发合约-idtrigger-instrument-ids" class="hash-link" aria-label="触发合约 ID（Trigger instrument IDs）的直接链接" title="触发合约 ID（Trigger instrument IDs）的直接链接" translate="no">​</a></h3>
<p>平台允许根据合成合约价格触发仿真订单。下面基于此前例子演示如何提交一个仿真订单：该订单将在仿真器中被保留，直到合成报价触发器释放它，然后以 MARKET 订单发送到 Binance。</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">order </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">strategy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">order_factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">limit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ETHUSDT_BINANCE</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    order_side</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">OrderSide</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BUY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    quantity</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Quantity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;1.5&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    price</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Price</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;30000.00000000&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># &lt;-- Synthetic instrument price</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    emulation_trigger</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">TriggerType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DEFAULT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trigger_instrument_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_synthetic_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># &lt;-- Synthetic instrument identifier</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">strategy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">submit_order</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">order</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="错误处理error-handling">错误处理（Error handling）<a href="#错误处理error-handling" class="hash-link" aria-label="错误处理（Error handling）的直接链接" title="错误处理（Error handling）的直接链接" translate="no">​</a></h3>
<p>对合成合约的输入（包括派生公式）已做了大量验证工作，但仍需谨慎。无效或错误的输入可能导致未定义行为。</p>
<div class="theme-admonition theme-admonition-info admonition_lEzE alert alert--info"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_Vfkp"><p>详见 <code>SyntheticInstrument</code> 的 <a href="/api_reference/model/instruments#class-syntheticinstrument-1">API 参考</a>，了解输入要求与可能抛出的异常。</p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/Aloento/NautilusTraderDoc/tree/main/docs/concepts/instruments.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_F7ru" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_GNoA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/concepts/execution"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">执行</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/concepts/live"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Live 交易</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_pg_n thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#记号与标识symbology" class="table-of-contents__link toc-highlight">记号与标识（Symbology）</a></li><li><a href="#回测backtesting" class="table-of-contents__link toc-highlight">回测（Backtesting）</a></li><li><a href="#实盘交易live-trading" class="table-of-contents__link toc-highlight">实盘交易（Live trading）</a></li><li><a href="#查找合约finding-instruments" class="table-of-contents__link toc-highlight">查找合约（Finding instruments）</a></li><li><a href="#精度与增量precisions-and-increments" class="table-of-contents__link toc-highlight">精度与增量（Precisions and increments）</a></li><li><a href="#限制limits" class="table-of-contents__link toc-highlight">限制（Limits）</a></li><li><a href="#价格与数量的创建prices-and-quantities" class="table-of-contents__link toc-highlight">价格与数量的创建（Prices and quantities）</a></li><li><a href="#保证金与费用margins-and-fees" class="table-of-contents__link toc-highlight">保证金与费用（Margins and fees）</a><ul><li><a href="#何时适用保证金" class="table-of-contents__link toc-highlight">何时适用保证金？</a></li><li><a href="#术语说明vocabulary" class="table-of-contents__link toc-highlight">术语说明（Vocabulary）</a></li><li><a href="#保证金计算公式" class="table-of-contents__link toc-highlight">保证金计算公式</a></li><li><a href="#实现细节" class="table-of-contents__link toc-highlight">实现细节</a></li></ul></li><li><a href="#佣金commissions" class="table-of-contents__link toc-highlight">佣金（Commissions）</a><ul><li><a href="#内置费率模型" class="table-of-contents__link toc-highlight">内置费率模型</a></li><li><a href="#自定义费率模型" class="table-of-contents__link toc-highlight">自定义费率模型</a></li><li><a href="#在实际中使用费率模型" class="table-of-contents__link toc-highlight">在实际中使用费率模型</a></li><li><a href="#额外信息" class="table-of-contents__link toc-highlight">额外信息</a></li></ul></li><li><a href="#合成synthetic合约" class="table-of-contents__link toc-highlight">合成（Synthetic）合约</a><ul><li><a href="#公式formula" class="table-of-contents__link toc-highlight">公式（Formula）</a></li><li><a href="#订阅subscribing" class="table-of-contents__link toc-highlight">订阅（Subscribing）</a></li><li><a href="#更新公式updating-formulas" class="table-of-contents__link toc-highlight">更新公式（Updating formulas）</a></li><li><a href="#触发合约-idtrigger-instrument-ids" class="table-of-contents__link toc-highlight">触发合约 ID（Trigger instrument IDs）</a></li><li><a href="#错误处理error-handling" class="table-of-contents__link toc-highlight">错误处理（Error handling）</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/nautechsystems/nautilus_trader" target="_blank" rel="noopener noreferrer" class="footer__link-item">Official GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_KfBJ"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://nautilustrader.io/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Official Documentation<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_KfBJ"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2025 Nautech Systems Pty Ltd. All rights reserved.</div></div></div></footer></div>
</body>
</html>