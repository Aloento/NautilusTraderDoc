<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-concepts/positions" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Positions | NautilusTrader 文档</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://nautilus.aloen.to/concepts/positions"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Positions | NautilusTrader 文档"><meta data-rh="true" name="description" content="This guide explains how positions work in NautilusTrader, including their lifecycle, aggregation"><meta data-rh="true" property="og:description" content="This guide explains how positions work in NautilusTrader, including their lifecycle, aggregation"><link data-rh="true" rel="icon" href="/logo.png"><link data-rh="true" rel="canonical" href="https://nautilus.aloen.to/concepts/positions"><link data-rh="true" rel="alternate" href="https://nautilus.aloen.to/concepts/positions" hreflang="zh"><link data-rh="true" rel="alternate" href="https://nautilus.aloen.to/concepts/positions" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Concepts","item":"https://nautilus.aloen.to/concepts/"},{"@type":"ListItem","position":2,"name":"Positions","item":"https://nautilus.aloen.to/concepts/positions"}]}</script><link rel="stylesheet" href="/assets/css/styles.33db920f.css">
<script src="/assets/js/runtime~main.f907132b.js" defer="defer"></script>
<script src="/assets/js/main.3352860b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/logo.png"><div role="region" aria-label="跳到主要内容"><a class="skipToContent__uWo" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/logo.png" alt="NautilusTrader Logo" class="themedComponent_WkLn themedComponent--light_cjoX"><img src="/logo.png" alt="NautilusTrader Logo" class="themedComponent_WkLn themedComponent--dark_jZId"></div><b class="navbar__title text--truncate">NautilusTrader</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/api_reference/">文档</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/Aloento/NautilusTraderDoc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_KfBJ"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_RWFU colorModeToggle_sA1q"><button class="clean-btn toggleButton_qjfc toggleButtonDisabled_cpNp" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_CetX lightToggleIcon_UYsV"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_CetX darkToggleIcon_i1s2"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_CetX systemToggleIcon_yIQx"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_PsjF"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_jk42"><div class="docsWrapper_KWBO"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_XpKL" type="button"></button><div class="docRoot_joIP"><aside class="theme-doc-sidebar-container docSidebarContainer_DOen"><div class="sidebarViewport_j7YP"><div class="sidebar_nPgc"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_MTDt"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/api_reference/"><span title="Python API" class="categoryLinkLabel_XKxb">Python API</span></a><button aria-label="展开侧边栏分类 &#x27;Python API&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist menu__link--active" href="/concepts/"><span title="Concepts" class="categoryLinkLabel_XKxb">Concepts</span></a><button aria-label="折叠侧边栏分类 &#x27;Concepts&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/actors"><span title="Actors" class="linkLabel_CNtA">Actors</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/adapters"><span title="Adapters" class="linkLabel_CNtA">Adapters</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/architecture"><span title="Architecture" class="linkLabel_CNtA">Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/backtesting"><span title="Backtesting" class="linkLabel_CNtA">Backtesting</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/cache"><span title="Cache" class="linkLabel_CNtA">Cache</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/data"><span title="Data" class="linkLabel_CNtA">Data</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/execution"><span title="Execution" class="linkLabel_CNtA">Execution</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/instruments"><span title="Instruments" class="linkLabel_CNtA">Instruments</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/live"><span title="Live Trading" class="linkLabel_CNtA">Live Trading</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/logging"><span title="Logging" class="linkLabel_CNtA">Logging</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/message_bus"><span title="Message Bus" class="linkLabel_CNtA">Message Bus</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/orders"><span title="Orders" class="linkLabel_CNtA">Orders</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/overview"><span title="Overview" class="linkLabel_CNtA">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/portfolio"><span title="Portfolio" class="linkLabel_CNtA">Portfolio</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/concepts/positions"><span title="Positions" class="linkLabel_CNtA">Positions</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/reports"><span title="Reports" class="linkLabel_CNtA">Reports</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/strategies"><span title="Strategies" class="linkLabel_CNtA">Strategies</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/developer_guide/"><span title="Developer Guide" class="categoryLinkLabel_XKxb">Developer Guide</span></a><button aria-label="展开侧边栏分类 &#x27;Developer Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/getting_started/"><span title="入门" class="categoryLinkLabel_XKxb">入门</span></a><button aria-label="展开侧边栏分类 &#x27;入门&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/integrations/"><span title="集成" class="categoryLinkLabel_XKxb">集成</span></a><button aria-label="展开侧边栏分类 &#x27;集成&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/tutorials/"><span title="教程" class="categoryLinkLabel_XKxb">教程</span></a><button aria-label="展开侧边栏分类 &#x27;教程&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_bw1l"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_PIhC"><div class="docItemContainer_pFw3"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_HRKZ" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_sX5c"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/concepts/"><span>Concepts</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Positions</span></li></ul></nav><div class="tocCollapsible_DhUt theme-doc-toc-mobile tocMobile_Izjv"><button type="button" class="clean-btn tocCollapsibleButton_eYR5">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Positions</h1></header>
<p>This guide explains how positions work in NautilusTrader, including their lifecycle, aggregation
from order fills, profit and loss calculations, and the important concept of position snapshotting
for netting OMS configurations.</p>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Overview的直接链接" title="Overview的直接链接" translate="no">​</a></h2>
<p>A position represents an open exposure to a particular instrument in the market. Positions are
fundamental to tracking trading performance and risk, as they aggregate all fills for a particular
instrument and continuously calculate metrics like unrealized PnL, average entry price, and total
exposure.</p>
<p>The system automatically creates positions when orders fill and tracks them
from open to close. The platform supports both netting
and hedging position management styles through its OMS (Order Management System) configuration.</p>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="position-lifecycle">Position lifecycle<a href="#position-lifecycle" class="hash-link" aria-label="Position lifecycle的直接链接" title="Position lifecycle的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="creation">Creation<a href="#creation" class="hash-link" aria-label="Creation的直接链接" title="Creation的直接链接" translate="no">​</a></h3>
<p>The system opens a position on the first fill:</p>
<ul>
<li><strong>NETTING OMS</strong>: Opens on first fill for an instrument (one position per instrument).</li>
<li><strong>HEDGING OMS</strong>: Opens on first fill for a new <code>position_id</code> (multiple positions per instrument).</li>
</ul>
<p>A position tracks:</p>
<ul>
<li>Opening order and fill details.</li>
<li>Entry side (<code>LONG</code> or <code>SHORT</code>).</li>
<li>Initial quantity and average price.</li>
<li>Timestamps for initialization and opening.</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_lEzE alert alert--success"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_Vfkp"><p>You can access positions through the Cache using <code>self.cache.position(position_id)</code> or
<code>self.cache.positions(instrument_id=instrument_id)</code> from within your actors/strategies.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="updates">Updates<a href="#updates" class="hash-link" aria-label="Updates的直接链接" title="Updates的直接链接" translate="no">​</a></h3>
<p>As additional fills occur, the position:</p>
<ul>
<li>Aggregates quantities from buy and sell fills.</li>
<li>Recalculates average entry and exit prices.</li>
<li>Updates peak quantity (maximum exposure reached).</li>
<li>Tracks all associated order IDs and trade IDs.</li>
<li>Accumulates commissions by currency.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="closure">Closure<a href="#closure" class="hash-link" aria-label="Closure的直接链接" title="Closure的直接链接" translate="no">​</a></h3>
<p>A position closes when the net quantity becomes zero (<code>FLAT</code>). At closure:</p>
<ul>
<li>The closing order ID is recorded.</li>
<li>Duration is calculated from open to close.</li>
<li>Final realized PnL is computed.</li>
<li>In <code>NETTING</code> OMS, the engine preserves closed position state through snapshots to maintain historical PnL (see <a href="#position-snapshotting">Position snapshotting</a>).</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="order-fill-aggregation">Order fill aggregation<a href="#order-fill-aggregation" class="hash-link" aria-label="Order fill aggregation的直接链接" title="Order fill aggregation的直接链接" translate="no">​</a></h2>
<p>Positions aggregate order fills to maintain an accurate view of market exposure. The aggregation
process handles both sides of trading activity:</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="buy-fills">Buy fills<a href="#buy-fills" class="hash-link" aria-label="Buy fills的直接链接" title="Buy fills的直接链接" translate="no">​</a></h3>
<p>When a BUY order fills:</p>
<ul>
<li>Increases long exposure or reduces short exposure.</li>
<li>Updates average entry price for opening trades.</li>
<li>Updates average exit price for closing trades.</li>
<li>Calculates realized PnL for any closed portion.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="sell-fills">Sell fills<a href="#sell-fills" class="hash-link" aria-label="Sell fills的直接链接" title="Sell fills的直接链接" translate="no">​</a></h3>
<p>When a SELL order fills:</p>
<ul>
<li>Increases short exposure or reduces long exposure.</li>
<li>Updates average entry price for opening trades.</li>
<li>Updates average exit price for closing trades.</li>
<li>Calculates realized PnL for any closed portion.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="net-position-calculation">Net position calculation<a href="#net-position-calculation" class="hash-link" aria-label="Net position calculation的直接链接" title="Net position calculation的直接链接" translate="no">​</a></h3>
<p>The position maintains a <code>signed_qty</code> field representing the net exposure:</p>
<ul>
<li>Positive values indicate <code>LONG</code> positions.</li>
<li>Negative values indicate <code>SHORT</code> positions.</li>
<li>Zero indicates a <code>FLAT</code> (closed) position.</li>
</ul>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Example: Position aggregation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Initial BUY 100 units at $50</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signed_qty </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">100</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># LONG position</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Subsequent SELL 150 units at $55</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signed_qty </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">50</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># Now SHORT position</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Final BUY 50 units at $52</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signed_qty </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Position FLAT (closed)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="oms-types-and-position-management">OMS types and position management<a href="#oms-types-and-position-management" class="hash-link" aria-label="OMS types and position management的直接链接" title="OMS types and position management的直接链接" translate="no">​</a></h2>
<p>NautilusTrader supports two primary OMS types that fundamentally affect how positions are tracked
and managed. An <code>OmsType.UNSPECIFIED</code> option also exists, which defaults to the component&#x27;s
context. For comprehensive details, see the <a href="/concepts/execution#order-management-system-oms">Execution guide</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="netting"><code>NETTING</code><a href="#netting" class="hash-link" aria-label="netting的直接链接" title="netting的直接链接" translate="no">​</a></h3>
<p>In <code>NETTING</code> mode, all fills for an instrument are aggregated into a single position:</p>
<ul>
<li>One position per instrument ID.</li>
<li>All fills contribute to the same position.</li>
<li>Position flips from <code>LONG</code> to <code>SHORT</code> (or vice versa) as net quantity changes.</li>
<li>Historical snapshots preserve closed position states.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="hedging"><code>HEDGING</code><a href="#hedging" class="hash-link" aria-label="hedging的直接链接" title="hedging的直接链接" translate="no">​</a></h3>
<p>In <code>HEDGING</code> mode, multiple positions can exist for the same instrument:</p>
<ul>
<li>Multiple simultaneous <code>LONG</code> and <code>SHORT</code> positions.</li>
<li>Each position has a unique position ID.</li>
<li>Positions are tracked independently.</li>
<li>No automatic netting across positions.</li>
</ul>
<div class="theme-admonition theme-admonition-warning admonition_lEzE alert alert--warning"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_Vfkp"><p>When using <code>HEDGING</code> mode, be aware of increased margin requirements as each position
consumes margin independently. Some venues may not support true hedging mode and will
net positions automatically.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="strategy-vs-venue-oms">Strategy vs venue OMS<a href="#strategy-vs-venue-oms" class="hash-link" aria-label="Strategy vs venue OMS的直接链接" title="Strategy vs venue OMS的直接链接" translate="no">​</a></h3>
<p>The platform allows different OMS configurations for strategies and venues:</p>
<table><thead><tr><th>Strategy OMS</th><th>Venue OMS</th><th>Behavior</th></tr></thead><tbody><tr><td><code>NETTING</code></td><td><code>NETTING</code></td><td>Single position per instrument at both strategy and venue.</td></tr><tr><td><code>HEDGING</code></td><td><code>HEDGING</code></td><td>Multiple positions supported at both levels.</td></tr><tr><td><code>NETTING</code></td><td><code>HEDGING</code></td><td>Venue tracks multiple, Nautilus maintains single position.</td></tr><tr><td><code>HEDGING</code></td><td><code>NETTING</code></td><td>Venue tracks single, Nautilus maintains virtual positions.</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-tip admonition_lEzE alert alert--success"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_Vfkp"><p>For most trading scenarios, keeping strategy and venue OMS types aligned simplifies
position management. Override configurations are primarily useful for prop trading
desks or when interfacing with legacy systems. See the <a href="/concepts/live">Live guide</a>
for venue-specific OMS configuration.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="position-snapshotting">Position snapshotting<a href="#position-snapshotting" class="hash-link" aria-label="Position snapshotting的直接链接" title="Position snapshotting的直接链接" translate="no">​</a></h2>
<p>Position snapshotting is an important feature for <code>NETTING</code> OMS configurations that preserves
the state of closed positions for accurate PnL tracking and reporting.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="why-snapshotting-matters">Why snapshotting matters<a href="#why-snapshotting-matters" class="hash-link" aria-label="Why snapshotting matters的直接链接" title="Why snapshotting matters的直接链接" translate="no">​</a></h3>
<p>In a <code>NETTING</code> system, when a position closes (becomes <code>FLAT</code>) and then reopens with a new trade,
the position object is reset to track the new exposure. Without snapshotting, the historical
realized PnL from the previous position cycle would be lost.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="how-it-works">How it works<a href="#how-it-works" class="hash-link" aria-label="How it works的直接链接" title="How it works的直接链接" translate="no">​</a></h3>
<p>When a <code>NETTING</code> position closes and then receives a new fill for the same instrument, the execution
engine snapshots the closed position state before resetting it, preserving:</p>
<ul>
<li>Final quantities and prices.</li>
<li>Realized PnL.</li>
<li>All fill events.</li>
<li>Commission totals.</li>
</ul>
<p>This snapshot is stored in the cache indexed by position ID. The position then resets for the new
cycle while previous snapshots remain accessible. The Portfolio aggregates PnL across all snapshots
for accurate totals.</p>
<div class="theme-admonition theme-admonition-note admonition_lEzE alert alert--secondary"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_Vfkp"><p>This historical snapshot mechanism differs from optional position state snapshots (<code>snapshot_positions</code>),
which periodically record open-position state for telemetry. See the <a href="/concepts/live">Live guide</a> for
<code>snapshot_positions</code> and <code>snapshot_positions_interval_secs</code> settings.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="example-scenario">Example scenario<a href="#example-scenario" class="hash-link" aria-label="Example scenario的直接链接" title="Example scenario的直接链接" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># NETTING OMS Example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Cycle 1: Open LONG position</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BUY </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> units at $</span><span class="token number" style="color:#36acaa">50</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># Position opens</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELL </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> units at $</span><span class="token number" style="color:#36acaa">55</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Position closes, PnL = $500</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Snapshot taken preserving $500 realized PnL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Cycle 2: Open SHORT position</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELL </span><span class="token number" style="color:#36acaa">50</span><span class="token plain"> units at $</span><span class="token number" style="color:#36acaa">54</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># Position reopens (SHORT)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BUY </span><span class="token number" style="color:#36acaa">50</span><span class="token plain"> units at $</span><span class="token number" style="color:#36acaa">52</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Position closes, PnL = $100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Snapshot taken preserving $100 realized PnL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Total realized PnL = $500 + $100 = $600 (from snapshots)</span><br></span></code></pre></div></div>
<p>Without snapshotting, only the most recent cycle&#x27;s PnL would be available, leading to
incorrect reporting and analysis.</p>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="pnl-calculations">PnL calculations<a href="#pnl-calculations" class="hash-link" aria-label="PnL calculations的直接链接" title="PnL calculations的直接链接" translate="no">​</a></h2>
<p>NautilusTrader provides comprehensive PnL calculations that account for instrument
specifications and market conventions.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="realized-pnl">Realized PnL<a href="#realized-pnl" class="hash-link" aria-label="Realized PnL的直接链接" title="Realized PnL的直接链接" translate="no">​</a></h3>
<p>Calculated when positions are partially or fully closed:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># For standard instruments</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">realized_pnl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">exit_price </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> entry_price</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> closed_quantity </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> multiplier</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># For inverse instruments (side-aware)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># LONG: realized_pnl = closed_quantity * multiplier * (1/entry_price - 1/exit_price)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># SHORT: realized_pnl = closed_quantity * multiplier * (1/exit_price - 1/entry_price)</span><br></span></code></pre></div></div>
<p>The engine automatically applies the correct formula based on position side.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="unrealized-pnl">Unrealized PnL<a href="#unrealized-pnl" class="hash-link" aria-label="Unrealized PnL的直接链接" title="Unrealized PnL的直接链接" translate="no">​</a></h3>
<p>Calculated using current market prices for open positions. The <code>price</code> parameter accepts any
reference price (bid, ask, mid, last, or mark):</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">position</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">unrealized_pnl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">last_price</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Using last traded price</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">position</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">unrealized_pnl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bid_price</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># Conservative for LONG positions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">position</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">unrealized_pnl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ask_price</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># Conservative for SHORT positions</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="total-pnl">Total PnL<a href="#total-pnl" class="hash-link" aria-label="Total PnL的直接链接" title="Total PnL的直接链接" translate="no">​</a></h3>
<p>Combines realized and unrealized components:</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">total_pnl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> position</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">total_pnl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current_price</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Returns realized_pnl + unrealized_pnl</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="currency-considerations">Currency considerations<a href="#currency-considerations" class="hash-link" aria-label="Currency considerations的直接链接" title="Currency considerations的直接链接" translate="no">​</a></h3>
<ul>
<li>PnL is calculated in the instrument&#x27;s settlement currency.</li>
<li>For Forex, this is typically the quote currency.</li>
<li>For inverse contracts, PnL may be in the base currency.</li>
<li>Portfolio aggregates realized PnL per instrument in settlement currency.</li>
<li>Multi-currency totals require conversion outside the Position class.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="commissions-and-costs">Commissions and costs<a href="#commissions-and-costs" class="hash-link" aria-label="Commissions and costs的直接链接" title="Commissions and costs的直接链接" translate="no">​</a></h2>
<p>Positions track all trading costs:</p>
<ul>
<li>Commissions are accumulated by currency.</li>
<li>Each fill&#x27;s commission is added to the running total.</li>
<li>Multiple commission currencies are supported.</li>
<li>Realized PnL includes commissions only when denominated in the settlement currency.</li>
<li>Other commissions are tracked separately and may require conversion.</li>
</ul>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">commissions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> position</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">commissions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Returns list[Money] with aggregated commission totals per currency</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">notional </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> position</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">notional_value</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current_price</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Returns Money in quote currency (standard) or base currency (inverse)</span><br></span></code></pre></div></div>
<p><strong>Limitations:</strong></p>
<ul>
<li>Panics if inverse instrument has no <code>base_currency</code> set.</li>
<li>Does not handle quanto contracts (returns quote currency instead of settlement currency).</li>
<li>For quanto instruments, use <code>instrument.calculate_notional_value()</code> instead.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="position-properties-and-state">Position properties and state<a href="#position-properties-and-state" class="hash-link" aria-label="Position properties and state的直接链接" title="Position properties and state的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="identifiers">Identifiers<a href="#identifiers" class="hash-link" aria-label="Identifiers的直接链接" title="Identifiers的直接链接" translate="no">​</a></h3>
<ul>
<li><code>id</code>: Unique position identifier.</li>
<li><code>instrument_id</code>: The traded instrument.</li>
<li><code>account_id</code>: Account where position is held.</li>
<li><code>trader_id</code>: The trader who owns the position.</li>
<li><code>strategy_id</code>: The strategy managing the position.</li>
<li><code>opening_order_id</code>: Client order ID that opened the position.</li>
<li><code>closing_order_id</code>: Client order ID that closed the position.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="position-state">Position state<a href="#position-state" class="hash-link" aria-label="Position state的直接链接" title="Position state的直接链接" translate="no">​</a></h3>
<ul>
<li><code>side</code>: Current position side (<code>LONG</code>, <code>SHORT</code>, or <code>FLAT</code>).</li>
<li><code>entry</code>: Direction of the currently open position (<code>Buy</code> for <code>LONG</code>, <code>Sell</code> for <code>SHORT</code>). Updates when position flips direction.</li>
<li><code>quantity</code>: Current absolute position size.</li>
<li><code>signed_qty</code>: Signed position size (positive for <code>LONG</code>, negative for <code>SHORT</code>).</li>
<li><code>peak_qty</code>: Maximum quantity reached during position lifetime.</li>
<li><code>is_open</code>: Whether position is currently open.</li>
<li><code>is_closed</code>: Whether position is closed (<code>FLAT</code>).</li>
<li><code>is_long</code>: Whether position side is <code>LONG</code>.</li>
<li><code>is_short</code>: Whether position side is <code>SHORT</code>.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="pricing-and-valuation">Pricing and valuation<a href="#pricing-and-valuation" class="hash-link" aria-label="Pricing and valuation的直接链接" title="Pricing and valuation的直接链接" translate="no">​</a></h3>
<ul>
<li><code>avg_px_open</code>: Average entry price.</li>
<li><code>avg_px_close</code>: Average exit price when closing.</li>
<li><code>realized_pnl</code>: Realized profit/loss.</li>
<li><code>realized_return</code>: Realized return as decimal (e.g., 0.05 for 5%).</li>
<li><code>quote_currency</code>: Quote currency of the instrument.</li>
<li><code>base_currency</code>: Base currency if applicable.</li>
<li><code>settlement_currency</code>: Currency for PnL settlement.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="instrument-specifications">Instrument specifications<a href="#instrument-specifications" class="hash-link" aria-label="Instrument specifications的直接链接" title="Instrument specifications的直接链接" translate="no">​</a></h3>
<ul>
<li><code>multiplier</code>: Contract multiplier.</li>
<li><code>price_precision</code>: Decimal precision for prices.</li>
<li><code>size_precision</code>: Decimal precision for quantities.</li>
<li><code>is_inverse</code>: Whether instrument is inverse.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="timestamps">Timestamps<a href="#timestamps" class="hash-link" aria-label="Timestamps的直接链接" title="Timestamps的直接链接" translate="no">​</a></h3>
<ul>
<li><code>ts_init</code>: When position was initialized.</li>
<li><code>ts_opened</code>: When position was opened.</li>
<li><code>ts_last</code>: Last update timestamp.</li>
<li><code>ts_closed</code>: When position was closed.</li>
<li><code>duration_ns</code>: Duration from open to close in nanoseconds.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="associated-data">Associated data<a href="#associated-data" class="hash-link" aria-label="Associated data的直接链接" title="Associated data的直接链接" translate="no">​</a></h3>
<ul>
<li><code>symbol</code>: The instrument&#x27;s ticker symbol.</li>
<li><code>venue</code>: The trading venue.</li>
<li><code>client_order_ids</code>: All client order IDs associated with position.</li>
<li><code>venue_order_ids</code>: All venue order IDs associated with position.</li>
<li><code>trade_ids</code>: All trade/fill IDs from venue.</li>
<li><code>events</code>: All order fill events applied to position.</li>
<li><code>event_count</code>: Total number of fill events applied.</li>
<li><code>last_event</code>: Most recent fill event.</li>
<li><code>last_trade_id</code>: Most recent trade ID.</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_lEzE alert alert--info"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_Vfkp"><p>For complete type information and detailed property documentation, see the Position
<a href="/api_reference/model/position#class-position">API Reference</a>.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="events-and-tracking">Events and tracking<a href="#events-and-tracking" class="hash-link" aria-label="Events and tracking的直接链接" title="Events and tracking的直接链接" translate="no">​</a></h2>
<p>Positions maintain a complete history of events:</p>
<ul>
<li>All order fill events are stored chronologically.</li>
<li>Associated client order IDs are tracked.</li>
<li>Trade IDs from the venue are preserved.</li>
<li>Event count indicates total fills applied.</li>
</ul>
<p>This historical data enables:</p>
<ul>
<li>Detailed position analysis.</li>
<li>Trade reconciliation.</li>
<li>Performance attribution.</li>
<li>Audit trails.</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_lEzE alert alert--success"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_Vfkp"><p>Use <code>position.events</code> to access the full history of fills for reconciliation.
The <code>position.trade_ids</code> property helps match against broker statements.
See the <a href="/concepts/execution">Execution guide</a> for reconciliation best practices.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="numerical-precision">Numerical precision<a href="#numerical-precision" class="hash-link" aria-label="Numerical precision的直接链接" title="Numerical precision的直接链接" translate="no">​</a></h2>
<p>Position calculations use 64-bit floating-point (<code>f64</code>) arithmetic for PnL and average price computations.
While fixed-point types (<code>Price</code>, <code>Quantity</code>, <code>Money</code>) preserve exact precision at configured decimal places,
internal calculations convert to <code>f64</code> for performance and overflow safety.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="design-rationale">Design rationale<a href="#design-rationale" class="hash-link" aria-label="Design rationale的直接链接" title="Design rationale的直接链接" translate="no">​</a></h3>
<p>The platform uses <code>f64</code> for position calculations to balance performance and accuracy:</p>
<ul>
<li>Floating-point operations are significantly faster than arbitrary-precision arithmetic.</li>
<li>Raw integer multiplication can overflow even with 128-bit integers.</li>
<li>Each calculation starts from precise fixed-point values, avoiding cumulative error.</li>
<li>IEEE-754 double precision provides ~15 decimal digits of accuracy.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="validated-precision-characteristics">Validated precision characteristics<a href="#validated-precision-characteristics" class="hash-link" aria-label="Validated precision characteristics的直接链接" title="Validated precision characteristics的直接链接" translate="no">​</a></h3>
<p>Testing confirms <code>f64</code> arithmetic maintains accuracy for typical trading scenarios:</p>
<ul>
<li>Standard amounts: No precision loss for amounts ≥ 0.01 in standard currencies.</li>
<li>High-precision instruments: 9-decimal crypto prices preserved within 1e-6 tolerance.</li>
<li>Sequential fills: 100 fills show no drift (commission accuracy to 1e-10).</li>
<li>Extreme prices: Handles range from 0.00001 to 99,999.99999 without overflow.</li>
<li>Round-trip trades: Opening and closing at same price produces exact PnL (commissions only).</li>
</ul>
<p>For implementation details, see <code>test_position_pnl_precision_*</code> tests in <code>crates/model/src/position.rs</code>.</p>
<div class="theme-admonition theme-admonition-note admonition_lEzE alert alert--secondary"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_Vfkp"><p>For regulatory compliance or audit trails requiring exact decimal arithmetic, consider using <code>Decimal</code>
types from external libraries. Very small amounts below <code>f64</code> epsilon (~1e-15) may round to zero,
though this does not affect realistic trading scenarios with standard currency precisions.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="integration-with-other-components">Integration with other components<a href="#integration-with-other-components" class="hash-link" aria-label="Integration with other components的直接链接" title="Integration with other components的直接链接" translate="no">​</a></h2>
<p>Positions interact with several key components:</p>
<ul>
<li><strong>Portfolio</strong>: Aggregates positions across instruments and strategies.</li>
<li><strong>ExecutionEngine</strong>: Creates and updates positions from fills.</li>
<li><strong>Cache</strong>: Stores position state and snapshots.</li>
<li><strong>RiskEngine</strong>: Monitors position limits and exposure.</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_lEzE alert alert--secondary"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_Vfkp"><p>Positions are not created for spread instruments. While contingent orders can still trigger for spreads,
they operate without position linkage. The engine handles spread instruments separately from regular positions.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Summary的直接链接" title="Summary的直接链接" translate="no">​</a></h2>
<p>Positions are central to tracking trading activity and performance in NautilusTrader. Understanding
how positions aggregate fills, calculate PnL, and handle different OMS configurations is essential
for building robust trading strategies. The position snapshotting mechanism ensures accurate
historical tracking in <code>NETTING</code> mode, while the comprehensive event history supports detailed
analysis and reconciliation.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/Aloento/NautilusTraderDoc/tree/main/docs/concepts/positions.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_F7ru" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_GNoA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/concepts/portfolio"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Portfolio</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/concepts/reports"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Reports</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_pg_n thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#position-lifecycle" class="table-of-contents__link toc-highlight">Position lifecycle</a><ul><li><a href="#creation" class="table-of-contents__link toc-highlight">Creation</a></li><li><a href="#updates" class="table-of-contents__link toc-highlight">Updates</a></li><li><a href="#closure" class="table-of-contents__link toc-highlight">Closure</a></li></ul></li><li><a href="#order-fill-aggregation" class="table-of-contents__link toc-highlight">Order fill aggregation</a><ul><li><a href="#buy-fills" class="table-of-contents__link toc-highlight">Buy fills</a></li><li><a href="#sell-fills" class="table-of-contents__link toc-highlight">Sell fills</a></li><li><a href="#net-position-calculation" class="table-of-contents__link toc-highlight">Net position calculation</a></li></ul></li><li><a href="#oms-types-and-position-management" class="table-of-contents__link toc-highlight">OMS types and position management</a><ul><li><a href="#netting" class="table-of-contents__link toc-highlight"><code>NETTING</code></a></li><li><a href="#hedging" class="table-of-contents__link toc-highlight"><code>HEDGING</code></a></li><li><a href="#strategy-vs-venue-oms" class="table-of-contents__link toc-highlight">Strategy vs venue OMS</a></li></ul></li><li><a href="#position-snapshotting" class="table-of-contents__link toc-highlight">Position snapshotting</a><ul><li><a href="#why-snapshotting-matters" class="table-of-contents__link toc-highlight">Why snapshotting matters</a></li><li><a href="#how-it-works" class="table-of-contents__link toc-highlight">How it works</a></li><li><a href="#example-scenario" class="table-of-contents__link toc-highlight">Example scenario</a></li></ul></li><li><a href="#pnl-calculations" class="table-of-contents__link toc-highlight">PnL calculations</a><ul><li><a href="#realized-pnl" class="table-of-contents__link toc-highlight">Realized PnL</a></li><li><a href="#unrealized-pnl" class="table-of-contents__link toc-highlight">Unrealized PnL</a></li><li><a href="#total-pnl" class="table-of-contents__link toc-highlight">Total PnL</a></li><li><a href="#currency-considerations" class="table-of-contents__link toc-highlight">Currency considerations</a></li></ul></li><li><a href="#commissions-and-costs" class="table-of-contents__link toc-highlight">Commissions and costs</a></li><li><a href="#position-properties-and-state" class="table-of-contents__link toc-highlight">Position properties and state</a><ul><li><a href="#identifiers" class="table-of-contents__link toc-highlight">Identifiers</a></li><li><a href="#position-state" class="table-of-contents__link toc-highlight">Position state</a></li><li><a href="#pricing-and-valuation" class="table-of-contents__link toc-highlight">Pricing and valuation</a></li><li><a href="#instrument-specifications" class="table-of-contents__link toc-highlight">Instrument specifications</a></li><li><a href="#timestamps" class="table-of-contents__link toc-highlight">Timestamps</a></li><li><a href="#associated-data" class="table-of-contents__link toc-highlight">Associated data</a></li></ul></li><li><a href="#events-and-tracking" class="table-of-contents__link toc-highlight">Events and tracking</a></li><li><a href="#numerical-precision" class="table-of-contents__link toc-highlight">Numerical precision</a><ul><li><a href="#design-rationale" class="table-of-contents__link toc-highlight">Design rationale</a></li><li><a href="#validated-precision-characteristics" class="table-of-contents__link toc-highlight">Validated precision characteristics</a></li></ul></li><li><a href="#integration-with-other-components" class="table-of-contents__link toc-highlight">Integration with other components</a></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 NautilusTrader Documentation.</div></div></div></footer></div>
</body>
</html>