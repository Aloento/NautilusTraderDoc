<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-concepts/execution" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Execution | NautilusTrader 文档</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://nautilus.aloen.to/concepts/execution"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Execution | NautilusTrader 文档"><meta data-rh="true" name="description" content="NautilusTrader can handle trade execution and order management for multiple strategies and venues"><meta data-rh="true" property="og:description" content="NautilusTrader can handle trade execution and order management for multiple strategies and venues"><link data-rh="true" rel="icon" href="/logo.png"><link data-rh="true" rel="canonical" href="https://nautilus.aloen.to/concepts/execution"><link data-rh="true" rel="alternate" href="https://nautilus.aloen.to/concepts/execution" hreflang="zh"><link data-rh="true" rel="alternate" href="https://nautilus.aloen.to/concepts/execution" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Concepts","item":"https://nautilus.aloen.to/concepts/"},{"@type":"ListItem","position":2,"name":"Execution","item":"https://nautilus.aloen.to/concepts/execution"}]}</script><link rel="stylesheet" href="/assets/css/styles.33db920f.css">
<script src="/assets/js/runtime~main.eefcc7db.js" defer="defer"></script>
<script src="/assets/js/main.3352860b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/logo.png"><div role="region" aria-label="跳到主要内容"><a class="skipToContent__uWo" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/logo.png" alt="NautilusTrader Logo" class="themedComponent_WkLn themedComponent--light_cjoX"><img src="/logo.png" alt="NautilusTrader Logo" class="themedComponent_WkLn themedComponent--dark_jZId"></div><b class="navbar__title text--truncate">NautilusTrader</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/api_reference/">文档</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/Aloento/NautilusTraderDoc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_KfBJ"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_RWFU colorModeToggle_sA1q"><button class="clean-btn toggleButton_qjfc toggleButtonDisabled_cpNp" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_CetX lightToggleIcon_UYsV"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_CetX darkToggleIcon_i1s2"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_CetX systemToggleIcon_yIQx"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_PsjF"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_jk42"><div class="docsWrapper_KWBO"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_XpKL" type="button"></button><div class="docRoot_joIP"><aside class="theme-doc-sidebar-container docSidebarContainer_DOen"><div class="sidebarViewport_j7YP"><div class="sidebar_nPgc"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_MTDt"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/api_reference/"><span title="Python API" class="categoryLinkLabel_XKxb">Python API</span></a><button aria-label="展开侧边栏分类 &#x27;Python API&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist menu__link--active" href="/concepts/"><span title="Concepts" class="categoryLinkLabel_XKxb">Concepts</span></a><button aria-label="折叠侧边栏分类 &#x27;Concepts&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/actors"><span title="Actors" class="linkLabel_CNtA">Actors</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/adapters"><span title="Adapters" class="linkLabel_CNtA">Adapters</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/architecture"><span title="Architecture" class="linkLabel_CNtA">Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/backtesting"><span title="Backtesting" class="linkLabel_CNtA">Backtesting</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/cache"><span title="Cache" class="linkLabel_CNtA">Cache</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/data"><span title="Data" class="linkLabel_CNtA">Data</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/concepts/execution"><span title="Execution" class="linkLabel_CNtA">Execution</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/instruments"><span title="Instruments" class="linkLabel_CNtA">Instruments</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/live"><span title="Live Trading" class="linkLabel_CNtA">Live Trading</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/logging"><span title="Logging" class="linkLabel_CNtA">Logging</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/message_bus"><span title="Message Bus" class="linkLabel_CNtA">Message Bus</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/orders"><span title="Orders" class="linkLabel_CNtA">Orders</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/overview"><span title="Overview" class="linkLabel_CNtA">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/portfolio"><span title="Portfolio" class="linkLabel_CNtA">Portfolio</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/positions"><span title="Positions" class="linkLabel_CNtA">Positions</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/reports"><span title="Reports" class="linkLabel_CNtA">Reports</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/strategies"><span title="Strategies" class="linkLabel_CNtA">Strategies</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/developer_guide/"><span title="Developer Guide" class="categoryLinkLabel_XKxb">Developer Guide</span></a><button aria-label="展开侧边栏分类 &#x27;Developer Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/getting_started/"><span title="入门" class="categoryLinkLabel_XKxb">入门</span></a><button aria-label="展开侧边栏分类 &#x27;入门&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/integrations/"><span title="Integrations" class="categoryLinkLabel_XKxb">Integrations</span></a><button aria-label="展开侧边栏分类 &#x27;Integrations&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_GgI9 menu__link menu__link--sublist" href="/tutorials/"><span title="教程" class="categoryLinkLabel_XKxb">教程</span></a><button aria-label="展开侧边栏分类 &#x27;教程&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_bw1l"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_PIhC"><div class="docItemContainer_pFw3"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_HRKZ" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_sX5c"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/concepts/"><span>Concepts</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Execution</span></li></ul></nav><div class="tocCollapsible_DhUt theme-doc-toc-mobile tocMobile_Izjv"><button type="button" class="clean-btn tocCollapsibleButton_eYR5">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Execution</h1></header>
<p>NautilusTrader can handle trade execution and order management for multiple strategies and venues
simultaneously (per instance). Several interacting components are involved in execution, making it
crucial to understand the possible flows of execution messages (commands and events).</p>
<p>The main execution-related components include:</p>
<ul>
<li><code>Strategy</code></li>
<li><code>ExecAlgorithm</code> (execution algorithms)</li>
<li><code>OrderEmulator</code></li>
<li><code>RiskEngine</code></li>
<li><code>ExecutionEngine</code> or <code>LiveExecutionEngine</code></li>
<li><code>ExecutionClient</code> or <code>LiveExecutionClient</code></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="execution-flow">Execution flow<a href="#execution-flow" class="hash-link" aria-label="Execution flow的直接链接" title="Execution flow的直接链接" translate="no">​</a></h2>
<p>The <code>Strategy</code> base class inherits from <code>Actor</code> and so contains all of the common data related
methods. It also provides methods for managing orders and trade execution:</p>
<ul>
<li><code>submit_order(...)</code></li>
<li><code>submit_order_list(...)</code></li>
<li><code>modify_order(...)</code></li>
<li><code>cancel_order(...)</code></li>
<li><code>cancel_orders(...)</code></li>
<li><code>cancel_all_orders(...)</code></li>
<li><code>close_position(...)</code></li>
<li><code>close_all_positions(...)</code></li>
<li><code>query_account(...)</code></li>
<li><code>query_order(...)</code></li>
</ul>
<p>These methods create the necessary execution commands under the hood and send them on the message
bus to the relevant components (point-to-point), as well as publishing any events (such as the
initialization of new orders i.e. <code>OrderInitialized</code> events).</p>
<p>The general execution flow looks like the following (each arrow indicates movement across the message bus):</p>
<p><code>Strategy</code> -&gt; <code>OrderEmulator</code> -&gt; <code>ExecAlgorithm</code> -&gt; <code>RiskEngine</code> -&gt; <code>ExecutionEngine</code> -&gt; <code>ExecutionClient</code></p>
<p>The <code>OrderEmulator</code> and <code>ExecAlgorithm</code>(s) components are optional in the flow, depending on
individual order parameters (as explained below).</p>
<p>This diagram illustrates message flow (commands and events) across the Nautilus execution components.</p>
<div class="language-text codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-text codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">                  ┌───────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  │                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  │                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  │                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ┌───────►   OrderEmulator   ├────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          │       │                   │            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          │       │                   │            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          │       │                   │            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────┴──┐    └─────▲──────┬──────┘            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            │          │      │           ┌───────▼────────┐   ┌─────────────────────┐   ┌─────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            │          │      │           │                │   │                     │   │                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            ├──────────┼──────┼───────────►                ├───►                     ├───►                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Strategy  │          │      │           │                │   │                     │   │                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            │          │      │           │   RiskEngine   │   │   ExecutionEngine   │   │   ExecutionClient   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            ◄──────────┼──────┼───────────┤                ◄───┤                     ◄───┤                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            │          │      │           │                │   │                     │   │                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            │          │      │           │                │   │                     │   │                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────┬──┘    ┌─────┴──────▼──────┐    └───────▲────────┘   └─────────────────────┘   └─────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          │       │                   │            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          │       │                   │            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          │       │                   │            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          └───────►   ExecAlgorithm   ├────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  │                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  │                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  │                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  └───────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="order-management-system-oms">Order Management System (OMS)<a href="#order-management-system-oms" class="hash-link" aria-label="Order Management System (OMS)的直接链接" title="Order Management System (OMS)的直接链接" translate="no">​</a></h2>
<p>An order management system (OMS) type refers to the method used for assigning orders to positions and tracking those positions for an instrument.
OMS types apply to both strategies and venues (simulated and real). Even if a venue doesn&#x27;t explicitly
state the method in use, an OMS type is always in effect. The OMS type for a component can be specified
using the <code>OmsType</code> enum.</p>
<p>The <code>OmsType</code> enum has three variants:</p>
<ul>
<li><code>UNSPECIFIED</code>: The OMS type defaults based on where it is applied (details below)</li>
<li><code>NETTING</code>: Positions are combined into a single position per instrument ID</li>
<li><code>HEDGING</code>: Multiple positions per instrument ID are supported (both long and short)</li>
</ul>
<p>The table below describes different configuration combinations and their applicable scenarios.
When the strategy and venue OMS types differ, the <code>ExecutionEngine</code> handles this by overriding or assigning <code>position_id</code> values for received <code>OrderFilled</code> events.
A &quot;virtual position&quot; refers to a position ID that exists within the Nautilus system but not on the venue in
reality.</p>
<table><thead><tr><th style="text-align:left">Strategy OMS</th><th style="text-align:left">Venue OMS</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left"><code>NETTING</code></td><td style="text-align:left"><code>NETTING</code></td><td style="text-align:left">The strategy uses the venues native OMS type, with a single position ID per instrument ID.</td></tr><tr><td style="text-align:left"><code>HEDGING</code></td><td style="text-align:left"><code>HEDGING</code></td><td style="text-align:left">The strategy uses the venues native OMS type, with multiple position IDs per instrument ID (both <code>LONG</code> and <code>SHORT</code>).</td></tr><tr><td style="text-align:left"><code>NETTING</code></td><td style="text-align:left"><code>HEDGING</code></td><td style="text-align:left">The strategy <strong>overrides</strong> the venues native OMS type. The venue tracks multiple positions per instrument ID, but Nautilus maintains a single position ID.</td></tr><tr><td style="text-align:left"><code>HEDGING</code></td><td style="text-align:left"><code>NETTING</code></td><td style="text-align:left">The strategy <strong>overrides</strong> the venues native OMS type. The venue tracks a single position per instrument ID, but Nautilus maintains multiple position IDs.</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-note admonition_lEzE alert alert--secondary"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_Vfkp"><p>Configuring OMS types separately for strategies and venues increases platform complexity but allows
for a wide range of trading styles and preferences (see below).</p></div></div>
<p>OMS config examples:</p>
<ul>
<li>Most cryptocurrency exchanges use a <code>NETTING</code> OMS type, representing a single position per market. It may be desirable for a trader to track multiple &quot;virtual&quot; positions for a strategy.</li>
<li>Some FX ECNs or brokers use a <code>HEDGING</code> OMS type, tracking multiple positions both <code>LONG</code> and <code>SHORT</code>. The trader may only care about the NET position per currency pair.</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_lEzE alert alert--info"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_Vfkp"><p>Nautilus does not yet support venue-side hedging modes such as Binance <code>BOTH</code> vs. <code>LONG/SHORT</code> where the venue nets per direction.
It is advised to keep Binance account configurations as <code>BOTH</code> so that a single position is netted.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="oms-configuration">OMS configuration<a href="#oms-configuration" class="hash-link" aria-label="OMS configuration的直接链接" title="OMS configuration的直接链接" translate="no">​</a></h3>
<p>If a strategy OMS type is not explicitly set using the <code>oms_type</code> configuration option,
it will default to <code>UNSPECIFIED</code>. This means the <code>ExecutionEngine</code> will not override any venue <code>position_id</code>s,
and the OMS type will follow the venue&#x27;s OMS type.</p>
<div class="theme-admonition theme-admonition-tip admonition_lEzE alert alert--success"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_Vfkp"><p>When configuring a backtest, you can specify the <code>oms_type</code> for the venue. To enhance backtest
accuracy, it is recommended to match this with the actual OMS type used by the venue in practice.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="risk-engine">Risk engine<a href="#risk-engine" class="hash-link" aria-label="Risk engine的直接链接" title="Risk engine的直接链接" translate="no">​</a></h2>
<p>The <code>RiskEngine</code> is a core component of every Nautilus system, including backtest, sandbox, and live environments.
Every order command and event passes through the <code>RiskEngine</code> unless specifically bypassed in the <code>RiskEngineConfig</code>.</p>
<p>The <code>RiskEngine</code> includes several built-in pre-trade risk checks, including:</p>
<ul>
<li>Price precisions correct for the instrument.</li>
<li>Prices are positive (unless an option type instrument)</li>
<li>Quantity precisions correct for the instrument.</li>
<li>Below maximum notional for the instrument.</li>
<li>Within maximum or minimum quantity for the instrument.</li>
<li>Only reducing position when a <code>reduce_only</code> execution instruction is specified for the order.</li>
</ul>
<p>If any risk check fails, the system generates an <code>OrderDenied</code> event, effectively closing the order and
preventing it from progressing further. This event includes a human-readable reason for the denial.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="trading-state">Trading state<a href="#trading-state" class="hash-link" aria-label="Trading state的直接链接" title="Trading state的直接链接" translate="no">​</a></h3>
<p>Additionally, the current trading state of a Nautilus system affects order flow.</p>
<p>The <code>TradingState</code> enum has three variants:</p>
<ul>
<li><code>ACTIVE</code>: Operates normally.</li>
<li><code>HALTED</code>: Does not process further order commands until state changes.</li>
<li><code>REDUCING</code>: Only processes cancels or commands that reduce open positions.</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_lEzE alert alert--info"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_Vfkp"><p>See the <code>RiskEngineConfig</code> <a href="/api_reference/config#risk">API Reference</a> for further details.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="execution-algorithms">Execution algorithms<a href="#execution-algorithms" class="hash-link" aria-label="Execution algorithms的直接链接" title="Execution algorithms的直接链接" translate="no">​</a></h2>
<p>The platform supports customized execution algorithm components and provides some built-in
algorithms, such as the Time-Weighted Average Price (TWAP) algorithm.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="twap-time-weighted-average-price">TWAP (Time-Weighted Average Price)<a href="#twap-time-weighted-average-price" class="hash-link" aria-label="TWAP (Time-Weighted Average Price)的直接链接" title="TWAP (Time-Weighted Average Price)的直接链接" translate="no">​</a></h3>
<p>The TWAP execution algorithm aims to execute orders by evenly spreading them over a specified
time horizon. The algorithm receives a primary order representing the total size and direction
then splits this by spawning smaller child orders, which are then executed at regular intervals
throughout the time horizon.</p>
<p>This helps to reduce the impact of the full size of the primary order on the market, by
minimizing the concentration of trade size at any given time.</p>
<p>The algorithm will immediately submit the first order, with the final order submitted being the
primary order at the end of the horizon period.</p>
<p>Using the TWAP algorithm as an example (found in <code>/examples/algorithms/twap.py</code>), this example
demonstrates how to initialize and register a TWAP execution algorithm directly with a
<code>BacktestEngine</code> (assuming an engine is already initialized):</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">examples</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">algorithms</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">twap </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> TWAPExecAlgorithm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># `engine` is an initialized BacktestEngine instance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec_algorithm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TWAPExecAlgorithm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">engine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_exec_algorithm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">exec_algorithm</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>For this particular algorithm, two parameters must be specified:</p>
<ul>
<li><code>horizon_secs</code></li>
<li><code>interval_secs</code></li>
</ul>
<p>The <code>horizon_secs</code> parameter determines the time period over which the algorithm will execute, while
the <code>interval_secs</code> parameter sets the time between individual order executions. These parameters
determine how a primary order is split into a series of spawned orders.</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> decimal </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Decimal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> BarType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">test_kit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">providers </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> TestInstrumentProvider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">examples</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">strategies</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ema_cross_twap </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> EMACrossTWAP</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EMACrossTWAPConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Configure your strategy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> EMACrossTWAPConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">TestInstrumentProvider</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ethusdt_binance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bar_type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">BarType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;ETHUSDT.BINANCE-250-TICK-LAST-INTERNAL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trade_size</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Decimal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;0.05&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fast_ema_period</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    slow_ema_period</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    twap_horizon_secs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># execution algorithm parameter (total horizon in seconds)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    twap_interval_secs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># execution algorithm parameter (seconds between orders)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Instantiate your strategy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">strategy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> EMACrossTWAP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>Alternatively, you can specify these parameters dynamically per order, determining them based on
actual market conditions. In this case, the strategy configuration parameters could be provided to
an execution model which determines the horizon and interval.</p>
<div class="theme-admonition theme-admonition-info admonition_lEzE alert alert--info"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_Vfkp"><p>There is no limit to the number of execution algorithm parameters you can create. The parameters
just need to be a dictionary with string keys and primitive values (values that can be serialized
over the wire, such as ints, floats, and strings).</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="writing-execution-algorithms">Writing execution algorithms<a href="#writing-execution-algorithms" class="hash-link" aria-label="Writing execution algorithms的直接链接" title="Writing execution algorithms的直接链接" translate="no">​</a></h3>
<p>To implement a custom execution algorithm you must define a class which inherits from <code>ExecAlgorithm</code>.</p>
<p>An execution algorithm is a type of <code>Actor</code>, so it&#x27;s capable of the following:</p>
<ul>
<li>Request and subscribe to data.</li>
<li>Access the <code>Cache</code>.</li>
<li>Set time alerts and/or timers using a <code>Clock</code>.</li>
</ul>
<p>Additionally it can:</p>
<ul>
<li>Access the central <code>Portfolio</code>.</li>
<li>Spawn secondary orders from a received primary (original) order.</li>
</ul>
<p>Once an execution algorithm is registered, and the system is running, it will receive orders off the
messages bus which are addressed to its <code>ExecAlgorithmId</code> via the <code>exec_algorithm_id</code> order parameter.
The order may also carry the <code>exec_algorithm_params</code> being a <code>dict[str, Any]</code>.</p>
<div class="theme-admonition theme-admonition-warning admonition_lEzE alert alert--warning"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_Vfkp"><p>Because of the flexibility of the <code>exec_algorithm_params</code> dictionary. It&#x27;s important to thoroughly
validate all of the key value pairs for correct operation of the algorithm (for starters that the
dictionary is not <code>None</code> and all necessary parameters actually exist).</p></div></div>
<p>Received orders will arrive via the following <code>on_order(...)</code> method. These received orders are
know as &quot;primary&quot; (original) orders when being handled by an execution algorithm.</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nautilus_trader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">orders</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">base </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Order</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">on_order</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> order</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Order</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Handle the order here</span><br></span></code></pre></div></div>
<p>When the algorithm is ready to spawn a secondary order, it can use one of the following methods:</p>
<ul>
<li><code>spawn_market(...)</code> (spawns a <code>MARKET</code> order)</li>
<li><code>spawn_market_to_limit(...)</code> (spawns a <code>MARKET_TO_LIMIT</code> order)</li>
<li><code>spawn_limit(...)</code> (spawns a <code>LIMIT</code> order)</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_lEzE alert alert--secondary"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_Vfkp"><p>Additional order types will be implemented in future versions, as the need arises.</p></div></div>
<p>Each of these methods takes the primary (original) <code>Order</code> as the first argument. The primary order
quantity will be reduced by the <code>quantity</code> passed in (becoming the spawned orders quantity).</p>
<div class="theme-admonition theme-admonition-warning admonition_lEzE alert alert--warning"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_Vfkp"><p>There must be enough primary order quantity remaining (this is validated).</p></div></div>
<p>Once the desired number of secondary orders have been spawned, and the execution routine is over,
the intention is that the algorithm will then finally send the primary (original) order.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="spawned-orders">Spawned orders<a href="#spawned-orders" class="hash-link" aria-label="Spawned orders的直接链接" title="Spawned orders的直接链接" translate="no">​</a></h3>
<p>All secondary orders spawned from an execution algorithm will carry a <code>exec_spawn_id</code> which is
simply the <code>ClientOrderId</code> of the primary (original) order, and whose <code>client_order_id</code>
derives from this original identifier with the following convention:</p>
<ul>
<li><code>exec_spawn_id</code> (primary order <code>client_order_id</code> value)</li>
<li><code>spawn_sequence</code> (the sequence number for the spawned order)</li>
</ul>
<div class="language-text codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-text codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token plain">{exec_spawn_id}-E{spawn_sequence}</span><br></span></code></pre></div></div>
<p>e.g. <code>O-20230404-001-000-E1</code> (for the first spawned order)</p>
<div class="theme-admonition theme-admonition-note admonition_lEzE alert alert--secondary"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_Vfkp"><p>The &quot;primary&quot; and &quot;secondary&quot; / &quot;spawn&quot; terminology was specifically chosen to avoid conflict
or confusion with the &quot;parent&quot; and &quot;child&quot; contingent orders terminology (an execution algorithm may also deal with contingent orders).</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="managing-execution-algorithm-orders">Managing execution algorithm orders<a href="#managing-execution-algorithm-orders" class="hash-link" aria-label="Managing execution algorithm orders的直接链接" title="Managing execution algorithm orders的直接链接" translate="no">​</a></h3>
<p>The <code>Cache</code> provides several methods to aid in managing (keeping track of) the activity of
an execution algorithm. Calling the below method will return all execution algorithm orders
for the given query filters.</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">orders_for_exec_algorithm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exec_algorithm_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ExecAlgorithmId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    venue</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Venue </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instrument_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InstrumentId </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    strategy_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StrategyId </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    side</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OrderSide </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> OrderSide</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">NO_ORDER_SIDE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Order</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><br></span></code></pre></div></div>
<p>As well as more specifically querying the orders for a certain execution series/spawn.
Calling the below method will return all orders for the given <code>exec_spawn_id</code> (if found).</p>
<div class="language-python codeBlockContainer_euGm theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zF3K"><pre tabindex="0" class="prism-code language-python codeBlock_G1mO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_QZRj"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">orders_for_exec_spawn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exec_spawn_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClientOrderId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Order</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_lEzE alert alert--secondary"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_Vfkp"><p>This also includes the primary (original) order.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_RpWm" id="own-order-books">Own order books<a href="#own-order-books" class="hash-link" aria-label="Own order books的直接链接" title="Own order books的直接链接" translate="no">​</a></h2>
<p>Own order books are L3 order books that track only your own (user) orders organized by price level, maintained separately from the venue&#x27;s public order books.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="purpose">Purpose<a href="#purpose" class="hash-link" aria-label="Purpose的直接链接" title="Purpose的直接链接" translate="no">​</a></h3>
<p>Own order books serve several purposes:</p>
<ul>
<li>Monitor the state of your orders within the venue&#x27;s public book in real-time.</li>
<li>Validate order placement by checking available liquidity at price levels before submission.</li>
<li>Help prevent self-trading by identifying price levels where your own orders already exist.</li>
<li>Support advanced order management strategies that depend on queue position.</li>
<li>Enable reconciliation between internal state and venue state during live trading.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="lifecycle">Lifecycle<a href="#lifecycle" class="hash-link" aria-label="Lifecycle的直接链接" title="Lifecycle的直接链接" translate="no">​</a></h3>
<p>Own order books are maintained per instrument and automatically updated as orders transition through their lifecycle.
Orders are added when submitted or accepted, updated when modified, and removed when filled, canceled, rejected, or expired.</p>
<p>Only orders with prices can be represented in own order books. Market orders and other order types without explicit prices are excluded since they cannot be positioned at specific price levels.</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="safe-cancellation-queries">Safe cancellation queries<a href="#safe-cancellation-queries" class="hash-link" aria-label="Safe cancellation queries的直接链接" title="Safe cancellation queries的直接链接" translate="no">​</a></h3>
<p>When querying own order books for orders to cancel, use a <code>status</code> filter that <strong>excludes</strong> <code>PENDING_CANCEL</code> to avoid processing orders already being cancelled.</p>
<div class="theme-admonition theme-admonition-warning admonition_lEzE alert alert--warning"><div class="admonitionHeading_aAf0"><span class="admonitionIcon_xtBN"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_Vfkp"><p>Including <code>PENDING_CANCEL</code> in status filters can cause:</p><ul>
<li>Duplicate cancel attempts on the same order.</li>
<li>Inflated open order counts (orders in <code>PENDING_CANCEL</code> remain &quot;open&quot; until confirmed canceled).</li>
<li>Order state explosion when multiple strategies attempt to cancel the same orders.</li>
</ul></div></div>
<p>The optional <code>accepted_buffer_ns</code> many methods expose is a time-based guard that only returns orders whose <code>ts_accepted</code> is at least that many nanoseconds in the past. Orders that have not yet been accepted by the venue still have <code>ts_accepted = 0</code>, so they are included once the buffer window elapses. To exclude those inflight orders you must pair the buffer with an explicit status filter (for example, restrict to <code>ACCEPTED</code> / <code>PARTIALLY_FILLED</code>).</p>
<h3 class="anchor anchorWithStickyNavbar_RpWm" id="auditing">Auditing<a href="#auditing" class="hash-link" aria-label="Auditing的直接链接" title="Auditing的直接链接" translate="no">​</a></h3>
<p>During live trading, own order books can be periodically audited against the cache&#x27;s order indexes to ensure consistency.
The audit mechanism verifies that closed orders are properly removed and that inflight orders (submitted but not yet accepted) remain tracked during venue latency windows.</p>
<p>The audit interval can be configured using the <code>own_books_audit_interval_secs</code> parameter in live trading configurations.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/Aloento/NautilusTraderDoc/tree/main/docs/concepts/execution.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_F7ru" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_GNoA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/concepts/data"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Data</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/concepts/instruments"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Instruments</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_pg_n thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#execution-flow" class="table-of-contents__link toc-highlight">Execution flow</a></li><li><a href="#order-management-system-oms" class="table-of-contents__link toc-highlight">Order Management System (OMS)</a><ul><li><a href="#oms-configuration" class="table-of-contents__link toc-highlight">OMS configuration</a></li></ul></li><li><a href="#risk-engine" class="table-of-contents__link toc-highlight">Risk engine</a><ul><li><a href="#trading-state" class="table-of-contents__link toc-highlight">Trading state</a></li></ul></li><li><a href="#execution-algorithms" class="table-of-contents__link toc-highlight">Execution algorithms</a><ul><li><a href="#twap-time-weighted-average-price" class="table-of-contents__link toc-highlight">TWAP (Time-Weighted Average Price)</a></li><li><a href="#writing-execution-algorithms" class="table-of-contents__link toc-highlight">Writing execution algorithms</a></li><li><a href="#spawned-orders" class="table-of-contents__link toc-highlight">Spawned orders</a></li><li><a href="#managing-execution-algorithm-orders" class="table-of-contents__link toc-highlight">Managing execution algorithm orders</a></li></ul></li><li><a href="#own-order-books" class="table-of-contents__link toc-highlight">Own order books</a><ul><li><a href="#purpose" class="table-of-contents__link toc-highlight">Purpose</a></li><li><a href="#lifecycle" class="table-of-contents__link toc-highlight">Lifecycle</a></li><li><a href="#safe-cancellation-queries" class="table-of-contents__link toc-highlight">Safe cancellation queries</a></li><li><a href="#auditing" class="table-of-contents__link toc-highlight">Auditing</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 NautilusTrader Documentation.</div></div></div></footer></div>
</body>
</html>