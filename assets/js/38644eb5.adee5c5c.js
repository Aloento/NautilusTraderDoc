"use strict";(globalThis.webpackChunknautilus_trader=globalThis.webpackChunknautilus_trader||[]).push([[2578],{2266:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"concepts/positions","title":"Positions","description":"This guide explains how positions work in NautilusTrader, including their lifecycle, aggregation","source":"@site/docs/concepts/positions.md","sourceDirName":"concepts","slug":"/concepts/positions","permalink":"/concepts/positions","draft":false,"unlisted":false,"editUrl":"https://github.com/Aloento/NautilusTraderDoc/tree/main/docs/concepts/positions.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Portfolio","permalink":"/concepts/portfolio"},"next":{"title":"Reports","permalink":"/concepts/reports"}}');var t=i(7259),r=i(9087);const o={},l="Positions",c={},d=[{value:"Overview",id:"overview",level:2},{value:"Position lifecycle",id:"position-lifecycle",level:2},{value:"Creation",id:"creation",level:3},{value:"Updates",id:"updates",level:3},{value:"Closure",id:"closure",level:3},{value:"Order fill aggregation",id:"order-fill-aggregation",level:2},{value:"Buy fills",id:"buy-fills",level:3},{value:"Sell fills",id:"sell-fills",level:3},{value:"Net position calculation",id:"net-position-calculation",level:3},{value:"OMS types and position management",id:"oms-types-and-position-management",level:2},{value:"<code>NETTING</code>",id:"netting",level:3},{value:"<code>HEDGING</code>",id:"hedging",level:3},{value:"Strategy vs venue OMS",id:"strategy-vs-venue-oms",level:3},{value:"Position snapshotting",id:"position-snapshotting",level:2},{value:"Why snapshotting matters",id:"why-snapshotting-matters",level:3},{value:"How it works",id:"how-it-works",level:3},{value:"Example scenario",id:"example-scenario",level:3},{value:"PnL calculations",id:"pnl-calculations",level:2},{value:"Realized PnL",id:"realized-pnl",level:3},{value:"Unrealized PnL",id:"unrealized-pnl",level:3},{value:"Total PnL",id:"total-pnl",level:3},{value:"Currency considerations",id:"currency-considerations",level:3},{value:"Commissions and costs",id:"commissions-and-costs",level:2},{value:"Position properties and state",id:"position-properties-and-state",level:2},{value:"Identifiers",id:"identifiers",level:3},{value:"Position state",id:"position-state",level:3},{value:"Pricing and valuation",id:"pricing-and-valuation",level:3},{value:"Instrument specifications",id:"instrument-specifications",level:3},{value:"Timestamps",id:"timestamps",level:3},{value:"Associated data",id:"associated-data",level:3},{value:"Events and tracking",id:"events-and-tracking",level:2},{value:"Numerical precision",id:"numerical-precision",level:2},{value:"Design rationale",id:"design-rationale",level:3},{value:"Validated precision characteristics",id:"validated-precision-characteristics",level:3},{value:"Integration with other components",id:"integration-with-other-components",level:2},{value:"Summary",id:"summary",level:2}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"positions",children:"Positions"})}),"\n",(0,t.jsx)(n.p,{children:"This guide explains how positions work in NautilusTrader, including their lifecycle, aggregation\nfrom order fills, profit and loss calculations, and the important concept of position snapshotting\nfor netting OMS configurations."}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"A position represents an open exposure to a particular instrument in the market. Positions are\nfundamental to tracking trading performance and risk, as they aggregate all fills for a particular\ninstrument and continuously calculate metrics like unrealized PnL, average entry price, and total\nexposure."}),"\n",(0,t.jsx)(n.p,{children:"The system automatically creates positions when orders fill and tracks them\nfrom open to close. The platform supports both netting\nand hedging position management styles through its OMS (Order Management System) configuration."}),"\n",(0,t.jsx)(n.h2,{id:"position-lifecycle",children:"Position lifecycle"}),"\n",(0,t.jsx)(n.h3,{id:"creation",children:"Creation"}),"\n",(0,t.jsx)(n.p,{children:"The system opens a position on the first fill:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"NETTING OMS"}),": Opens on first fill for an instrument (one position per instrument)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"HEDGING OMS"}),": Opens on first fill for a new ",(0,t.jsx)(n.code,{children:"position_id"})," (multiple positions per instrument)."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"A position tracks:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Opening order and fill details."}),"\n",(0,t.jsxs)(n.li,{children:["Entry side (",(0,t.jsx)(n.code,{children:"LONG"})," or ",(0,t.jsx)(n.code,{children:"SHORT"}),")."]}),"\n",(0,t.jsx)(n.li,{children:"Initial quantity and average price."}),"\n",(0,t.jsx)(n.li,{children:"Timestamps for initialization and opening."}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["You can access positions through the Cache using ",(0,t.jsx)(n.code,{children:"self.cache.position(position_id)"})," or\n",(0,t.jsx)(n.code,{children:"self.cache.positions(instrument_id=instrument_id)"})," from within your actors/strategies."]})}),"\n",(0,t.jsx)(n.h3,{id:"updates",children:"Updates"}),"\n",(0,t.jsx)(n.p,{children:"As additional fills occur, the position:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Aggregates quantities from buy and sell fills."}),"\n",(0,t.jsx)(n.li,{children:"Recalculates average entry and exit prices."}),"\n",(0,t.jsx)(n.li,{children:"Updates peak quantity (maximum exposure reached)."}),"\n",(0,t.jsx)(n.li,{children:"Tracks all associated order IDs and trade IDs."}),"\n",(0,t.jsx)(n.li,{children:"Accumulates commissions by currency."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"closure",children:"Closure"}),"\n",(0,t.jsxs)(n.p,{children:["A position closes when the net quantity becomes zero (",(0,t.jsx)(n.code,{children:"FLAT"}),"). At closure:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The closing order ID is recorded."}),"\n",(0,t.jsx)(n.li,{children:"Duration is calculated from open to close."}),"\n",(0,t.jsx)(n.li,{children:"Final realized PnL is computed."}),"\n",(0,t.jsxs)(n.li,{children:["In ",(0,t.jsx)(n.code,{children:"NETTING"})," OMS, the engine preserves closed position state through snapshots to maintain historical PnL (see ",(0,t.jsx)(n.a,{href:"#position-snapshotting",children:"Position snapshotting"}),")."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"order-fill-aggregation",children:"Order fill aggregation"}),"\n",(0,t.jsx)(n.p,{children:"Positions aggregate order fills to maintain an accurate view of market exposure. The aggregation\nprocess handles both sides of trading activity:"}),"\n",(0,t.jsx)(n.h3,{id:"buy-fills",children:"Buy fills"}),"\n",(0,t.jsx)(n.p,{children:"When a BUY order fills:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Increases long exposure or reduces short exposure."}),"\n",(0,t.jsx)(n.li,{children:"Updates average entry price for opening trades."}),"\n",(0,t.jsx)(n.li,{children:"Updates average exit price for closing trades."}),"\n",(0,t.jsx)(n.li,{children:"Calculates realized PnL for any closed portion."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"sell-fills",children:"Sell fills"}),"\n",(0,t.jsx)(n.p,{children:"When a SELL order fills:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Increases short exposure or reduces long exposure."}),"\n",(0,t.jsx)(n.li,{children:"Updates average entry price for opening trades."}),"\n",(0,t.jsx)(n.li,{children:"Updates average exit price for closing trades."}),"\n",(0,t.jsx)(n.li,{children:"Calculates realized PnL for any closed portion."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"net-position-calculation",children:"Net position calculation"}),"\n",(0,t.jsxs)(n.p,{children:["The position maintains a ",(0,t.jsx)(n.code,{children:"signed_qty"})," field representing the net exposure:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Positive values indicate ",(0,t.jsx)(n.code,{children:"LONG"})," positions."]}),"\n",(0,t.jsxs)(n.li,{children:["Negative values indicate ",(0,t.jsx)(n.code,{children:"SHORT"})," positions."]}),"\n",(0,t.jsxs)(n.li,{children:["Zero indicates a ",(0,t.jsx)(n.code,{children:"FLAT"})," (closed) position."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"# Example: Position aggregation\n# Initial BUY 100 units at $50\nsigned_qty = +100  # LONG position\n\n# Subsequent SELL 150 units at $55\nsigned_qty = -50   # Now SHORT position\n\n# Final BUY 50 units at $52\nsigned_qty = 0     # Position FLAT (closed)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"oms-types-and-position-management",children:"OMS types and position management"}),"\n",(0,t.jsxs)(n.p,{children:["NautilusTrader supports two primary OMS types that fundamentally affect how positions are tracked\nand managed. An ",(0,t.jsx)(n.code,{children:"OmsType.UNSPECIFIED"})," option also exists, which defaults to the component's\ncontext. For comprehensive details, see the ",(0,t.jsx)(n.a,{href:"/concepts/execution#order-management-system-oms",children:"Execution guide"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"netting",children:(0,t.jsx)(n.code,{children:"NETTING"})}),"\n",(0,t.jsxs)(n.p,{children:["In ",(0,t.jsx)(n.code,{children:"NETTING"})," mode, all fills for an instrument are aggregated into a single position:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"One position per instrument ID."}),"\n",(0,t.jsx)(n.li,{children:"All fills contribute to the same position."}),"\n",(0,t.jsxs)(n.li,{children:["Position flips from ",(0,t.jsx)(n.code,{children:"LONG"})," to ",(0,t.jsx)(n.code,{children:"SHORT"})," (or vice versa) as net quantity changes."]}),"\n",(0,t.jsx)(n.li,{children:"Historical snapshots preserve closed position states."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"hedging",children:(0,t.jsx)(n.code,{children:"HEDGING"})}),"\n",(0,t.jsxs)(n.p,{children:["In ",(0,t.jsx)(n.code,{children:"HEDGING"})," mode, multiple positions can exist for the same instrument:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Multiple simultaneous ",(0,t.jsx)(n.code,{children:"LONG"})," and ",(0,t.jsx)(n.code,{children:"SHORT"})," positions."]}),"\n",(0,t.jsx)(n.li,{children:"Each position has a unique position ID."}),"\n",(0,t.jsx)(n.li,{children:"Positions are tracked independently."}),"\n",(0,t.jsx)(n.li,{children:"No automatic netting across positions."}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.p,{children:["When using ",(0,t.jsx)(n.code,{children:"HEDGING"})," mode, be aware of increased margin requirements as each position\nconsumes margin independently. Some venues may not support true hedging mode and will\nnet positions automatically."]})}),"\n",(0,t.jsx)(n.h3,{id:"strategy-vs-venue-oms",children:"Strategy vs venue OMS"}),"\n",(0,t.jsx)(n.p,{children:"The platform allows different OMS configurations for strategies and venues:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Strategy OMS"}),(0,t.jsx)(n.th,{children:"Venue OMS"}),(0,t.jsx)(n.th,{children:"Behavior"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"NETTING"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"NETTING"})}),(0,t.jsx)(n.td,{children:"Single position per instrument at both strategy and venue."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"HEDGING"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"HEDGING"})}),(0,t.jsx)(n.td,{children:"Multiple positions supported at both levels."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"NETTING"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"HEDGING"})}),(0,t.jsx)(n.td,{children:"Venue tracks multiple, Nautilus maintains single position."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"HEDGING"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"NETTING"})}),(0,t.jsx)(n.td,{children:"Venue tracks single, Nautilus maintains virtual positions."})]})]})]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["For most trading scenarios, keeping strategy and venue OMS types aligned simplifies\nposition management. Override configurations are primarily useful for prop trading\ndesks or when interfacing with legacy systems. See the ",(0,t.jsx)(n.a,{href:"/concepts/live",children:"Live guide"}),"\nfor venue-specific OMS configuration."]})}),"\n",(0,t.jsx)(n.h2,{id:"position-snapshotting",children:"Position snapshotting"}),"\n",(0,t.jsxs)(n.p,{children:["Position snapshotting is an important feature for ",(0,t.jsx)(n.code,{children:"NETTING"})," OMS configurations that preserves\nthe state of closed positions for accurate PnL tracking and reporting."]}),"\n",(0,t.jsx)(n.h3,{id:"why-snapshotting-matters",children:"Why snapshotting matters"}),"\n",(0,t.jsxs)(n.p,{children:["In a ",(0,t.jsx)(n.code,{children:"NETTING"})," system, when a position closes (becomes ",(0,t.jsx)(n.code,{children:"FLAT"}),") and then reopens with a new trade,\nthe position object is reset to track the new exposure. Without snapshotting, the historical\nrealized PnL from the previous position cycle would be lost."]}),"\n",(0,t.jsx)(n.h3,{id:"how-it-works",children:"How it works"}),"\n",(0,t.jsxs)(n.p,{children:["When a ",(0,t.jsx)(n.code,{children:"NETTING"})," position closes and then receives a new fill for the same instrument, the execution\nengine snapshots the closed position state before resetting it, preserving:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Final quantities and prices."}),"\n",(0,t.jsx)(n.li,{children:"Realized PnL."}),"\n",(0,t.jsx)(n.li,{children:"All fill events."}),"\n",(0,t.jsx)(n.li,{children:"Commission totals."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This snapshot is stored in the cache indexed by position ID. The position then resets for the new\ncycle while previous snapshots remain accessible. The Portfolio aggregates PnL across all snapshots\nfor accurate totals."}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["This historical snapshot mechanism differs from optional position state snapshots (",(0,t.jsx)(n.code,{children:"snapshot_positions"}),"),\nwhich periodically record open-position state for telemetry. See the ",(0,t.jsx)(n.a,{href:"/concepts/live",children:"Live guide"})," for\n",(0,t.jsx)(n.code,{children:"snapshot_positions"})," and ",(0,t.jsx)(n.code,{children:"snapshot_positions_interval_secs"})," settings."]})}),"\n",(0,t.jsx)(n.h3,{id:"example-scenario",children:"Example scenario"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"# NETTING OMS Example\n# Cycle 1: Open LONG position\nBUY 100 units at $50   # Position opens\nSELL 100 units at $55  # Position closes, PnL = $500\n# Snapshot taken preserving $500 realized PnL\n\n# Cycle 2: Open SHORT position\nSELL 50 units at $54   # Position reopens (SHORT)\nBUY 50 units at $52    # Position closes, PnL = $100\n# Snapshot taken preserving $100 realized PnL\n\n# Total realized PnL = $500 + $100 = $600 (from snapshots)\n"})}),"\n",(0,t.jsx)(n.p,{children:"Without snapshotting, only the most recent cycle's PnL would be available, leading to\nincorrect reporting and analysis."}),"\n",(0,t.jsx)(n.h2,{id:"pnl-calculations",children:"PnL calculations"}),"\n",(0,t.jsx)(n.p,{children:"NautilusTrader provides comprehensive PnL calculations that account for instrument\nspecifications and market conventions."}),"\n",(0,t.jsx)(n.h3,{id:"realized-pnl",children:"Realized PnL"}),"\n",(0,t.jsx)(n.p,{children:"Calculated when positions are partially or fully closed:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"# For standard instruments\nrealized_pnl = (exit_price - entry_price) * closed_quantity * multiplier\n\n# For inverse instruments (side-aware)\n# LONG: realized_pnl = closed_quantity * multiplier * (1/entry_price - 1/exit_price)\n# SHORT: realized_pnl = closed_quantity * multiplier * (1/exit_price - 1/entry_price)\n"})}),"\n",(0,t.jsx)(n.p,{children:"The engine automatically applies the correct formula based on position side."}),"\n",(0,t.jsx)(n.h3,{id:"unrealized-pnl",children:"Unrealized PnL"}),"\n",(0,t.jsxs)(n.p,{children:["Calculated using current market prices for open positions. The ",(0,t.jsx)(n.code,{children:"price"})," parameter accepts any\nreference price (bid, ask, mid, last, or mark):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"position.unrealized_pnl(last_price)  # Using last traded price\nposition.unrealized_pnl(bid_price)   # Conservative for LONG positions\nposition.unrealized_pnl(ask_price)   # Conservative for SHORT positions\n"})}),"\n",(0,t.jsx)(n.h3,{id:"total-pnl",children:"Total PnL"}),"\n",(0,t.jsx)(n.p,{children:"Combines realized and unrealized components:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"total_pnl = position.total_pnl(current_price)\n# Returns realized_pnl + unrealized_pnl\n"})}),"\n",(0,t.jsx)(n.h3,{id:"currency-considerations",children:"Currency considerations"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"PnL is calculated in the instrument's settlement currency."}),"\n",(0,t.jsx)(n.li,{children:"For Forex, this is typically the quote currency."}),"\n",(0,t.jsx)(n.li,{children:"For inverse contracts, PnL may be in the base currency."}),"\n",(0,t.jsx)(n.li,{children:"Portfolio aggregates realized PnL per instrument in settlement currency."}),"\n",(0,t.jsx)(n.li,{children:"Multi-currency totals require conversion outside the Position class."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"commissions-and-costs",children:"Commissions and costs"}),"\n",(0,t.jsx)(n.p,{children:"Positions track all trading costs:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Commissions are accumulated by currency."}),"\n",(0,t.jsx)(n.li,{children:"Each fill's commission is added to the running total."}),"\n",(0,t.jsx)(n.li,{children:"Multiple commission currencies are supported."}),"\n",(0,t.jsx)(n.li,{children:"Realized PnL includes commissions only when denominated in the settlement currency."}),"\n",(0,t.jsx)(n.li,{children:"Other commissions are tracked separately and may require conversion."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"commissions = position.commissions()\n# Returns list[Money] with aggregated commission totals per currency\n\nnotional = position.notional_value(current_price)\n# Returns Money in quote currency (standard) or base currency (inverse)\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Limitations:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Panics if inverse instrument has no ",(0,t.jsx)(n.code,{children:"base_currency"})," set."]}),"\n",(0,t.jsx)(n.li,{children:"Does not handle quanto contracts (returns quote currency instead of settlement currency)."}),"\n",(0,t.jsxs)(n.li,{children:["For quanto instruments, use ",(0,t.jsx)(n.code,{children:"instrument.calculate_notional_value()"})," instead."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"position-properties-and-state",children:"Position properties and state"}),"\n",(0,t.jsx)(n.h3,{id:"identifiers",children:"Identifiers"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"id"}),": Unique position identifier."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"instrument_id"}),": The traded instrument."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"account_id"}),": Account where position is held."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"trader_id"}),": The trader who owns the position."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"strategy_id"}),": The strategy managing the position."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"opening_order_id"}),": Client order ID that opened the position."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"closing_order_id"}),": Client order ID that closed the position."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"position-state",children:"Position state"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"side"}),": Current position side (",(0,t.jsx)(n.code,{children:"LONG"}),", ",(0,t.jsx)(n.code,{children:"SHORT"}),", or ",(0,t.jsx)(n.code,{children:"FLAT"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"entry"}),": Direction of the currently open position (",(0,t.jsx)(n.code,{children:"Buy"})," for ",(0,t.jsx)(n.code,{children:"LONG"}),", ",(0,t.jsx)(n.code,{children:"Sell"})," for ",(0,t.jsx)(n.code,{children:"SHORT"}),"). Updates when position flips direction."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"quantity"}),": Current absolute position size."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"signed_qty"}),": Signed position size (positive for ",(0,t.jsx)(n.code,{children:"LONG"}),", negative for ",(0,t.jsx)(n.code,{children:"SHORT"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"peak_qty"}),": Maximum quantity reached during position lifetime."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"is_open"}),": Whether position is currently open."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"is_closed"}),": Whether position is closed (",(0,t.jsx)(n.code,{children:"FLAT"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"is_long"}),": Whether position side is ",(0,t.jsx)(n.code,{children:"LONG"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"is_short"}),": Whether position side is ",(0,t.jsx)(n.code,{children:"SHORT"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"pricing-and-valuation",children:"Pricing and valuation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"avg_px_open"}),": Average entry price."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"avg_px_close"}),": Average exit price when closing."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"realized_pnl"}),": Realized profit/loss."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"realized_return"}),": Realized return as decimal (e.g., 0.05 for 5%)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"quote_currency"}),": Quote currency of the instrument."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"base_currency"}),": Base currency if applicable."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"settlement_currency"}),": Currency for PnL settlement."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"instrument-specifications",children:"Instrument specifications"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"multiplier"}),": Contract multiplier."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"price_precision"}),": Decimal precision for prices."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"size_precision"}),": Decimal precision for quantities."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"is_inverse"}),": Whether instrument is inverse."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"timestamps",children:"Timestamps"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ts_init"}),": When position was initialized."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ts_opened"}),": When position was opened."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ts_last"}),": Last update timestamp."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ts_closed"}),": When position was closed."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"duration_ns"}),": Duration from open to close in nanoseconds."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"associated-data",children:"Associated data"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"symbol"}),": The instrument's ticker symbol."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"venue"}),": The trading venue."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"client_order_ids"}),": All client order IDs associated with position."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"venue_order_ids"}),": All venue order IDs associated with position."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"trade_ids"}),": All trade/fill IDs from venue."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"events"}),": All order fill events applied to position."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"event_count"}),": Total number of fill events applied."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"last_event"}),": Most recent fill event."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"last_trade_id"}),": Most recent trade ID."]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["For complete type information and detailed property documentation, see the Position\n",(0,t.jsx)(n.a,{href:"/api_reference/model/position#class-position",children:"API Reference"}),"."]})}),"\n",(0,t.jsx)(n.h2,{id:"events-and-tracking",children:"Events and tracking"}),"\n",(0,t.jsx)(n.p,{children:"Positions maintain a complete history of events:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"All order fill events are stored chronologically."}),"\n",(0,t.jsx)(n.li,{children:"Associated client order IDs are tracked."}),"\n",(0,t.jsx)(n.li,{children:"Trade IDs from the venue are preserved."}),"\n",(0,t.jsx)(n.li,{children:"Event count indicates total fills applied."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This historical data enables:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Detailed position analysis."}),"\n",(0,t.jsx)(n.li,{children:"Trade reconciliation."}),"\n",(0,t.jsx)(n.li,{children:"Performance attribution."}),"\n",(0,t.jsx)(n.li,{children:"Audit trails."}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["Use ",(0,t.jsx)(n.code,{children:"position.events"})," to access the full history of fills for reconciliation.\nThe ",(0,t.jsx)(n.code,{children:"position.trade_ids"})," property helps match against broker statements.\nSee the ",(0,t.jsx)(n.a,{href:"/concepts/execution",children:"Execution guide"})," for reconciliation best practices."]})}),"\n",(0,t.jsx)(n.h2,{id:"numerical-precision",children:"Numerical precision"}),"\n",(0,t.jsxs)(n.p,{children:["Position calculations use 64-bit floating-point (",(0,t.jsx)(n.code,{children:"f64"}),") arithmetic for PnL and average price computations.\nWhile fixed-point types (",(0,t.jsx)(n.code,{children:"Price"}),", ",(0,t.jsx)(n.code,{children:"Quantity"}),", ",(0,t.jsx)(n.code,{children:"Money"}),") preserve exact precision at configured decimal places,\ninternal calculations convert to ",(0,t.jsx)(n.code,{children:"f64"})," for performance and overflow safety."]}),"\n",(0,t.jsx)(n.h3,{id:"design-rationale",children:"Design rationale"}),"\n",(0,t.jsxs)(n.p,{children:["The platform uses ",(0,t.jsx)(n.code,{children:"f64"})," for position calculations to balance performance and accuracy:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Floating-point operations are significantly faster than arbitrary-precision arithmetic."}),"\n",(0,t.jsx)(n.li,{children:"Raw integer multiplication can overflow even with 128-bit integers."}),"\n",(0,t.jsx)(n.li,{children:"Each calculation starts from precise fixed-point values, avoiding cumulative error."}),"\n",(0,t.jsx)(n.li,{children:"IEEE-754 double precision provides ~15 decimal digits of accuracy."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"validated-precision-characteristics",children:"Validated precision characteristics"}),"\n",(0,t.jsxs)(n.p,{children:["Testing confirms ",(0,t.jsx)(n.code,{children:"f64"})," arithmetic maintains accuracy for typical trading scenarios:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Standard amounts: No precision loss for amounts \u2265 0.01 in standard currencies."}),"\n",(0,t.jsx)(n.li,{children:"High-precision instruments: 9-decimal crypto prices preserved within 1e-6 tolerance."}),"\n",(0,t.jsx)(n.li,{children:"Sequential fills: 100 fills show no drift (commission accuracy to 1e-10)."}),"\n",(0,t.jsx)(n.li,{children:"Extreme prices: Handles range from 0.00001 to 99,999.99999 without overflow."}),"\n",(0,t.jsx)(n.li,{children:"Round-trip trades: Opening and closing at same price produces exact PnL (commissions only)."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["For implementation details, see ",(0,t.jsx)(n.code,{children:"test_position_pnl_precision_*"})," tests in ",(0,t.jsx)(n.code,{children:"crates/model/src/position.rs"}),"."]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["For regulatory compliance or audit trails requiring exact decimal arithmetic, consider using ",(0,t.jsx)(n.code,{children:"Decimal"}),"\ntypes from external libraries. Very small amounts below ",(0,t.jsx)(n.code,{children:"f64"})," epsilon (~1e-15) may round to zero,\nthough this does not affect realistic trading scenarios with standard currency precisions."]})}),"\n",(0,t.jsx)(n.h2,{id:"integration-with-other-components",children:"Integration with other components"}),"\n",(0,t.jsx)(n.p,{children:"Positions interact with several key components:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Portfolio"}),": Aggregates positions across instruments and strategies."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"ExecutionEngine"}),": Creates and updates positions from fills."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Cache"}),": Stores position state and snapshots."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"RiskEngine"}),": Monitors position limits and exposure."]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsx)(n.p,{children:"Positions are not created for spread instruments. While contingent orders can still trigger for spreads,\nthey operate without position linkage. The engine handles spread instruments separately from regular positions."})}),"\n",(0,t.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsxs)(n.p,{children:["Positions are central to tracking trading activity and performance in NautilusTrader. Understanding\nhow positions aggregate fills, calculate PnL, and handle different OMS configurations is essential\nfor building robust trading strategies. The position snapshotting mechanism ensures accurate\nhistorical tracking in ",(0,t.jsx)(n.code,{children:"NETTING"})," mode, while the comprehensive event history supports detailed\nanalysis and reconciliation."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},9087:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>l});var s=i(6363);const t={},r=s.createContext(t);function o(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);