"use strict";(globalThis.webpackChunknautilus_trader=globalThis.webpackChunknautilus_trader||[]).push([[4914],{8941:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"tutorials/loading_external_data","title":"Loading external data","description":"This tutorial demonstrates how to load external data into the ParquetDataCatalog, and then use this to run a one-shot backtest using a BacktestNode.","source":"@site/docs/tutorials/loading_external_data.md","sourceDirName":"tutorials","slug":"/tutorials/loading_external_data","permalink":"/tutorials/loading_external_data","draft":false,"unlisted":false,"editUrl":"https://github.com/Aloento/NautilusTraderDoc/tree/main/docs/tutorials/loading_external_data.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Databento overview","permalink":"/tutorials/databento_overview"},"next":{"title":"Parquet Explorer","permalink":"/tutorials/parquet_explorer"}}');var r=n(7259),s=n(9087);const o={},i="Loading external data",l={},d=[];function c(t){const e={blockquote:"blockquote",code:"code",h1:"h1",header:"header",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...t.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"loading-external-data",children:"Loading external data"})}),"\n",(0,r.jsxs)(e.p,{children:["This tutorial demonstrates how to load external data into the ",(0,r.jsx)(e.code,{children:"ParquetDataCatalog"}),", and then use this to run a one-shot backtest using a ",(0,r.jsx)(e.code,{children:"BacktestNode"}),"."]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Warning"}),":"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Intended to be run on bare metal (not in the jupyterlab docker container)"})}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"import os\nimport shutil\nfrom decimal import Decimal\nfrom pathlib import Path\n\nimport pandas as pd\n\nfrom nautilus_trader.backtest.node import BacktestDataConfig\nfrom nautilus_trader.backtest.node import BacktestEngineConfig\nfrom nautilus_trader.backtest.node import BacktestNode\nfrom nautilus_trader.backtest.node import BacktestRunConfig\nfrom nautilus_trader.backtest.node import BacktestVenueConfig\nfrom nautilus_trader.config import ImportableStrategyConfig\nfrom nautilus_trader.core.datetime import dt_to_unix_nanos\nfrom nautilus_trader.model import BarType\nfrom nautilus_trader.model import QuoteTick\nfrom nautilus_trader.persistence.catalog import ParquetDataCatalog\nfrom nautilus_trader.persistence.wranglers import QuoteTickDataWrangler\nfrom nautilus_trader.test_kit.providers import CSVTickDataLoader\nfrom nautilus_trader.test_kit.providers import TestInstrumentProvider\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'DATA_DIR = "~/Downloads/Data/"\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'path = Path(DATA_DIR).expanduser() / "HISTDATA"\nraw_files = list(path.iterdir())\nassert raw_files, f"Unable to find any histdata files in directory {path}"\nraw_files\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'# Here we just take the first data file found and load into a pandas DataFrame\ndf = CSVTickDataLoader.load(raw_files[0], index_col=0, datetime_format="%Y%m%d %H%M%S%f")\ndf.columns = ["timestamp", "bid_price", "ask_price"]\n\n# Process quotes using a wrangler\nEURUSD = TestInstrumentProvider.default_fx_ccy("EUR/USD")\nwrangler = QuoteTickDataWrangler(EURUSD)\n\nticks = wrangler.process(df)\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'CATALOG_PATH = os.getcwd() + "/catalog"\n\n# Clear if it already exists, then create fresh\nif os.path.exists(CATALOG_PATH):\n    shutil.rmtree(CATALOG_PATH)\nos.mkdir(CATALOG_PATH)\n\n# Create a catalog instance\ncatalog = ParquetDataCatalog(CATALOG_PATH)\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"# Write instrument and ticks to catalog\ncatalog.write_data([EURUSD])\ncatalog.write_data(ticks)\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"# Fetch all instruments from catalog (as a check)\ncatalog.instruments()\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'start = dt_to_unix_nanos(pd.Timestamp("2020-01-03", tz="UTC"))\nend =  dt_to_unix_nanos(pd.Timestamp("2020-01-04", tz="UTC"))\n\nticks = catalog.quote_ticks(instrument_ids=[EURUSD.id.value], start=start, end=end)\nticks[:10]\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'instrument = catalog.instruments()[0]\n\nvenue_configs = [\n    BacktestVenueConfig(\n        name="SIM",\n        oms_type="HEDGING",\n        account_type="MARGIN",\n        base_currency="USD",\n        starting_balances=["1000000 USD"],\n    ),\n]\n\ndata_configs = [\n    BacktestDataConfig(\n        catalog_path=str(catalog.path),\n        data_cls=QuoteTick,\n        instrument_id=instrument.id,\n        start_time=start,\n        end_time=end,\n    ),\n]\n\nstrategies = [\n    ImportableStrategyConfig(\n        strategy_path="nautilus_trader.examples.strategies.ema_cross:EMACross",\n        config_path="nautilus_trader.examples.strategies.ema_cross:EMACrossConfig",\n        config={\n            "instrument_id": instrument.id,\n            "bar_type": BarType.from_str(f"{instrument.id.value}-15-MINUTE-BID-INTERNAL"),\n            "fast_ema_period": 10,\n            "slow_ema_period": 20,\n            "trade_size": Decimal(1_000_000),\n        },\n    ),\n]\n\nconfig = BacktestRunConfig(\n    engine=BacktestEngineConfig(strategies=strategies),\n    data=data_configs,\n    venues=venue_configs,\n)\n\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"node = BacktestNode(configs=[config])\n\n[result] = node.run()\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"result\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python"})})]})}function u(t={}){const{wrapper:e}={...(0,s.R)(),...t.components};return e?(0,r.jsx)(e,{...t,children:(0,r.jsx)(c,{...t})}):c(t)}},9087:(t,e,n)=>{n.d(e,{R:()=>o,x:()=>i});var a=n(6363);const r={},s=a.createContext(r);function o(t){const e=a.useContext(s);return a.useMemo(function(){return"function"==typeof t?t(e):{...e,...t}},[e,t])}function i(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(r):t.components||r:o(t.components),a.createElement(s.Provider,{value:e},t.children)}}}]);