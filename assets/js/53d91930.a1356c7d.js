"use strict";(globalThis.webpackChunknautilus_trader=globalThis.webpackChunknautilus_trader||[]).push([[6473],{2682:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"concepts/message_bus","title":"Message Bus","description":"The MessageBus is a fundamental part of the platform, enabling communication between system components","source":"@site/docs/concepts/message_bus.md","sourceDirName":"concepts","slug":"/concepts/message_bus","permalink":"/concepts/message_bus","draft":false,"unlisted":false,"editUrl":"https://github.com/Aloento/NautilusTraderDoc/tree/main/docs/concepts/message_bus.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Logging","permalink":"/concepts/logging"},"next":{"title":"Orders","permalink":"/concepts/orders"}}');var t=n(7259),a=n(9087);const r={},l="Message Bus",d={},c=[{value:"Data and signal publishing",id:"data-and-signal-publishing",level:2},{value:"Direct access",id:"direct-access",level:2},{value:"Messaging styles",id:"messaging-styles",level:2},{value:"MessageBus publish/subscribe to topics",id:"messagebus-publishsubscribe-to-topics",level:3},{value:"Concept",id:"concept",level:4},{value:"Key benefits and use cases",id:"key-benefits-and-use-cases",level:4},{value:"Considerations",id:"considerations",level:4},{value:"Quick overview code",id:"quick-overview-code",level:4},{value:"Full example",id:"full-example",level:4},{value:"Actor-based publish/subscribe data",id:"actor-based-publishsubscribe-data",level:3},{value:"Concept",id:"concept-1",level:4},{value:"Key Benefits and Use Cases",id:"key-benefits-and-use-cases-1",level:4},{value:"Considerations",id:"considerations-1",level:4},{value:"Inheriting from <code>Data</code> vs. using <code>@customdataclass</code>",id:"inheriting-from-data-vs-using-customdataclass",level:4},{value:"Quick overview code",id:"quick-overview-code-1",level:4},{value:"Full example",id:"full-example-1",level:4},{value:"Actor-based publish/subscribe signal",id:"actor-based-publishsubscribe-signal",level:3},{value:"Concept",id:"concept-2",level:4},{value:"Key Benefits and Use Cases",id:"key-benefits-and-use-cases-2",level:4},{value:"Considerations",id:"considerations-2",level:4},{value:"Quick overview code",id:"quick-overview-code-2",level:4},{value:"Full example",id:"full-example-2",level:4},{value:"Summary and decision guide",id:"summary-and-decision-guide",level:3},{value:"Decision guide: Which style to choose?",id:"decision-guide-which-style-to-choose",level:4},{value:"External publishing",id:"external-publishing",level:2},{value:"Serialization",id:"serialization",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Database config",id:"database-config",level:3},{value:"Encoding",id:"encoding",level:3},{value:"Timestamp formatting",id:"timestamp-formatting",level:3},{value:"Message stream keys",id:"message-stream-keys",level:3},{value:"Trader prefix",id:"trader-prefix",level:4},{value:"Trader ID",id:"trader-id",level:4},{value:"Instance ID",id:"instance-id",level:4},{value:"Streams prefix",id:"streams-prefix",level:4},{value:"Stream per topic",id:"stream-per-topic",level:4},{value:"Types filtering",id:"types-filtering",level:3},{value:"Stream auto-trimming",id:"stream-auto-trimming",level:3},{value:"External streams",id:"external-streams",level:2},{value:"Example configuration",id:"example-configuration",level:3},{value:"Producer node",id:"producer-node",level:4},{value:"Consumer node",id:"consumer-node",level:4}];function o(e){const s={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"message-bus",children:"Message Bus"})}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"MessageBus"})," is a fundamental part of the platform, enabling communication between system components\nthrough message passing. This design creates a loosely coupled architecture where components can interact\nwithout direct dependencies."]}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.em,{children:"messaging patterns"})," include:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Point-to-Point"}),"\n",(0,t.jsx)(s.li,{children:"Publish/Subscribe"}),"\n",(0,t.jsx)(s.li,{children:"Request/Response"}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["Messages exchanged via the ",(0,t.jsx)(s.code,{children:"MessageBus"})," fall into three categories:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Data"}),"\n",(0,t.jsx)(s.li,{children:"Events"}),"\n",(0,t.jsx)(s.li,{children:"Commands"}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"data-and-signal-publishing",children:"Data and signal publishing"}),"\n",(0,t.jsxs)(s.p,{children:["While the ",(0,t.jsx)(s.code,{children:"MessageBus"})," is a lower-level component that users typically interact with indirectly,\n",(0,t.jsx)(s.code,{children:"Actor"})," and ",(0,t.jsx)(s.code,{children:"Strategy"})," classes provide convenient methods built on top of it:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:"def publish_data(self, data_type: DataType, data: Data) -> None:\ndef publish_signal(self, name: str, value, ts_event: int | None = None) -> None:\n"})}),"\n",(0,t.jsxs)(s.p,{children:["These methods allow you to publish custom data and signals efficiently without needing to work directly with the ",(0,t.jsx)(s.code,{children:"MessageBus"})," interface."]}),"\n",(0,t.jsx)(s.h2,{id:"direct-access",children:"Direct access"}),"\n",(0,t.jsxs)(s.p,{children:["For advanced users or specialized use cases, direct access to the message bus is available within ",(0,t.jsx)(s.code,{children:"Actor"})," and ",(0,t.jsx)(s.code,{children:"Strategy"}),"\nclasses through the ",(0,t.jsx)(s.code,{children:"self.msgbus"})," reference, which provides the full message bus interface."]}),"\n",(0,t.jsxs)(s.p,{children:["To publish a custom message directly, you can specify a topic as a ",(0,t.jsx)(s.code,{children:"str"})," and any Python ",(0,t.jsx)(s.code,{children:"object"})," as the message payload, for example:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:'\nself.msgbus.publish("MyTopic", "MyMessage")\n'})}),"\n",(0,t.jsx)(s.h2,{id:"messaging-styles",children:"Messaging styles"}),"\n",(0,t.jsxs)(s.p,{children:["NautilusTrader is an ",(0,t.jsx)(s.strong,{children:"event-driven"})," framework where components communicate by sending and receiving messages.\nUnderstanding the different messaging styles is crucial for building effective trading systems."]}),"\n",(0,t.jsx)(s.p,{children:"This guide explains the three primary messaging patterns available in NautilusTrader:"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{style:{textAlign:"left"},children:(0,t.jsx)(s.strong,{children:"Messaging Style"})}),(0,t.jsx)(s.th,{style:{textAlign:"left"},children:(0,t.jsx)(s.strong,{children:"Purpose"})}),(0,t.jsx)(s.th,{style:{textAlign:"left"},children:(0,t.jsx)(s.strong,{children:"Best For"})})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.strong,{children:"MessageBus - Publish/Subscribe to topics"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"Low-level, direct access to the message bus"}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"Custom events, system-level communication"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.strong,{children:"Actor-Based - Publish/Subscribe Data"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"Structured trading data exchange"}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"Trading metrics, indicators, data needing persistence"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.strong,{children:"Actor-Based - Publish/Subscribe Signal"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"Lightweight notifications"}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"Simple alerts, flags, status updates"})]})]})]}),"\n",(0,t.jsx)(s.p,{children:"Each approach serves different purposes and offers unique advantages. This guide will help you decide which messaging\npattern to use in your NautilusTrader applications."}),"\n",(0,t.jsx)(s.h3,{id:"messagebus-publishsubscribe-to-topics",children:"MessageBus publish/subscribe to topics"}),"\n",(0,t.jsx)(s.h4,{id:"concept",children:"Concept"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"MessageBus"})," is the central hub for all messages in NautilusTrader. It enables a ",(0,t.jsx)(s.strong,{children:"publish/subscribe"})," pattern\nwhere components can publish events to ",(0,t.jsx)(s.strong,{children:"named topics"}),", and other components can subscribe to receive those messages.\nThis decouples components, allowing them to interact indirectly via the message bus."]}),"\n",(0,t.jsx)(s.h4,{id:"key-benefits-and-use-cases",children:"Key benefits and use cases"}),"\n",(0,t.jsx)(s.p,{children:"The message bus approach is ideal when you need:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Cross-component communication"})," within the system."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Flexibility"})," to define any topic and send any type of payload (any Python object)."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Decoupling"})," between publishers and subscribers who don't need to know about each other."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Global Reach"})," where messages can be received by multiple subscribers."]}),"\n",(0,t.jsxs)(s.li,{children:["Working with events that don't fit within the predefined ",(0,t.jsx)(s.code,{children:"Actor"})," model."]}),"\n",(0,t.jsx)(s.li,{children:"Advanced scenarios requiring full control over messaging."}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"considerations",children:"Considerations"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"You must track topic names manually (typos could result in missed messages)."}),"\n",(0,t.jsx)(s.li,{children:"You must define handlers manually."}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"quick-overview-code",children:"Quick overview code"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:'from nautilus_trader.core.message import Event\n\n# Define a custom event\nclass Each10thBarEvent(Event):\n    TOPIC = "each_10th_bar"  # Topic name\n    def __init__(self, bar):\n        self.bar = bar\n\n# Subscribe in a component (in Strategy)\nself.msgbus.subscribe(Each10thBarEvent.TOPIC, self.on_each_10th_bar)\n\n# Publish an event (in Strategy)\nevent = Each10thBarEvent(bar)\nself.msgbus.publish(Each10thBarEvent.TOPIC, event)\n\n# Handler (in Strategy)\ndef on_each_10th_bar(self, event: Each10thBarEvent):\n    self.log.info(f"Received 10th bar: {event.bar}")\n'})}),"\n",(0,t.jsx)(s.h4,{id:"full-example",children:"Full example"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.a,{href:"https://github.com/nautechsystems/nautilus_trader/tree/develop/examples/backtest/example_09_messaging_with_msgbus",children:"MessageBus Example"})}),"\n",(0,t.jsx)(s.h3,{id:"actor-based-publishsubscribe-data",children:"Actor-based publish/subscribe data"}),"\n",(0,t.jsx)(s.h4,{id:"concept-1",children:"Concept"}),"\n",(0,t.jsxs)(s.p,{children:["This approach provides a way to exchange trading specific data between ",(0,t.jsx)(s.code,{children:"Actor"}),"s in the system.\n(note: each ",(0,t.jsx)(s.code,{children:"Strategy"})," inherits from ",(0,t.jsx)(s.code,{children:"Actor"}),"). It inherits from ",(0,t.jsx)(s.code,{children:"Data"}),", which ensures proper timestamping\nand ordering of events - crucial for correct backtest processing."]}),"\n",(0,t.jsx)(s.h4,{id:"key-benefits-and-use-cases-1",children:"Key Benefits and Use Cases"}),"\n",(0,t.jsx)(s.p,{children:"The Data publish/subscribe approach excels when you need:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Exchange of structured trading data"})," like market data, indicators, custom metrics, or option greeks."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Proper event ordering"})," via built-in timestamps (",(0,t.jsx)(s.code,{children:"ts_event"}),", ",(0,t.jsx)(s.code,{children:"ts_init"}),") crucial for backtest accuracy."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Data persistence and serialization"})," through the ",(0,t.jsx)(s.code,{children:"@customdataclass"})," decorator, integrating seamlessly with NautilusTrader's data catalog system."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Standardized trading data exchange"})," between system components."]}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"considerations-1",children:"Considerations"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Requires defining a class that inherits from ",(0,t.jsx)(s.code,{children:"Data"})," or uses ",(0,t.jsx)(s.code,{children:"@customdataclass"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(s.h4,{id:"inheriting-from-data-vs-using-customdataclass",children:["Inheriting from ",(0,t.jsx)(s.code,{children:"Data"})," vs. using ",(0,t.jsx)(s.code,{children:"@customdataclass"})]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsxs)(s.strong,{children:["Inheriting from ",(0,t.jsx)(s.code,{children:"Data"})," class:"]})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Defines abstract properties ",(0,t.jsx)(s.code,{children:"ts_event"})," and ",(0,t.jsx)(s.code,{children:"ts_init"})," that must be implemented by the subclass. These ensure proper data ordering in backtests based on timestamps."]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsxs)(s.strong,{children:["The ",(0,t.jsx)(s.code,{children:"@customdataclass"})," decorator:"]})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Adds ",(0,t.jsx)(s.code,{children:"ts_event"})," and ",(0,t.jsx)(s.code,{children:"ts_init"})," attributes if they are not already present."]}),"\n",(0,t.jsxs)(s.li,{children:["Provides serialization functions: ",(0,t.jsx)(s.code,{children:"to_dict()"}),", ",(0,t.jsx)(s.code,{children:"from_dict()"}),", ",(0,t.jsx)(s.code,{children:"to_bytes()"}),", ",(0,t.jsx)(s.code,{children:"to_arrow()"}),", etc."]}),"\n",(0,t.jsx)(s.li,{children:"Enables data persistence and external communication."}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"quick-overview-code-1",children:"Quick overview code"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:'from nautilus_trader.core.data import Data\nfrom nautilus_trader.model.custom import customdataclass\n\n@customdataclass\nclass GreeksData(Data):\n    delta: float\n    gamma: float\n\n# Publish data (in Actor / Strategy)\ndata = GreeksData(delta=0.75, gamma=0.1, ts_event=1_630_000_000_000_000_000, ts_init=1_630_000_000_000_000_000)\nself.publish_data(GreeksData, data)\n\n# Subscribe to receiving data  (in Actor / Strategy)\nself.subscribe_data(GreeksData)\n\n# Handler (this is static callback function with fixed name)\ndef on_data(self, data: Data):\n    if isinstance(data, GreeksData):\n        self.log.info(f"Delta: {data.delta}, Gamma: {data.gamma}")\n'})}),"\n",(0,t.jsx)(s.h4,{id:"full-example-1",children:"Full example"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.a,{href:"https://github.com/nautechsystems/nautilus_trader/tree/develop/examples/backtest/example_10_messaging_with_actor_data",children:"Actor-Based Data Example"})}),"\n",(0,t.jsx)(s.h3,{id:"actor-based-publishsubscribe-signal",children:"Actor-based publish/subscribe signal"}),"\n",(0,t.jsx)(s.h4,{id:"concept-2",children:"Concept"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Signals"})," are a lightweight way to publish and subscribe to simple notifications within the actor framework.\nThis is the simplest messaging approach, requiring no custom class definitions."]}),"\n",(0,t.jsx)(s.h4,{id:"key-benefits-and-use-cases-2",children:"Key Benefits and Use Cases"}),"\n",(0,t.jsx)(s.p,{children:"The Signal messaging approach shines when you need:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Simple, lightweight notifications/alerts"}),' like "RiskThresholdExceeded" or "TrendUp".']}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Quick, on-the-fly messaging"})," without defining custom classes."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Broadcasting alerts or flags"})," as primitive data (",(0,t.jsx)(s.code,{children:"int"}),", ",(0,t.jsx)(s.code,{children:"float"}),", or ",(0,t.jsx)(s.code,{children:"str"}),")."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Easy API integration"})," with straightforward methods (",(0,t.jsx)(s.code,{children:"publish_signal"}),", ",(0,t.jsx)(s.code,{children:"subscribe_signal"}),")."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Multiple subscriber communication"})," where all subscribers receive signals when published."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Minimal setup overhead"})," with no class definitions required."]}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"considerations-2",children:"Considerations"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Each signal can contain only ",(0,t.jsx)(s.strong,{children:"single value"})," of type: ",(0,t.jsx)(s.code,{children:"int"}),", ",(0,t.jsx)(s.code,{children:"float"}),", and ",(0,t.jsx)(s.code,{children:"str"}),". That means no support for complex data structures or other Python types."]}),"\n",(0,t.jsxs)(s.li,{children:["In the ",(0,t.jsx)(s.code,{children:"on_signal"})," handler, you can only differentiate between signals using ",(0,t.jsx)(s.code,{children:"signal.value"}),", as the signal name is not accessible in the handler."]}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"quick-overview-code-2",children:"Quick overview code"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:'# Define signal constants for better organization (optional but recommended)\nimport types\nfrom nautilus_trader.core.datetime import unix_nanos_to_dt\nfrom nautilus_trader.common.enums import LogColor\n\nsignals = types.SimpleNamespace()\nsignals.NEW_HIGHEST_PRICE = "NewHighestPriceReached"\nsignals.NEW_LOWEST_PRICE = "NewLowestPriceReached"\n\n# Subscribe to signals (in Actor/Strategy)\nself.subscribe_signal(signals.NEW_HIGHEST_PRICE)\nself.subscribe_signal(signals.NEW_LOWEST_PRICE)\n\n# Publish a signal (in Actor/Strategy)\nself.publish_signal(\n    name=signals.NEW_HIGHEST_PRICE,\n    value=signals.NEW_HIGHEST_PRICE,  # value can be the same as name for simplicity\n    ts_event=bar.ts_event,  # timestamp from triggering event\n)\n\n# Handler (this is static callback function with fixed name)\ndef on_signal(self, signal):\n    # IMPORTANT: We match against signal.value, not signal.name\n    match signal.value:\n        case signals.NEW_HIGHEST_PRICE:\n            self.log.info(\n                f"New highest price was reached. | "\n                f"Signal value: {signal.value} | "\n                f"Signal time: {unix_nanos_to_dt(signal.ts_event)}",\n                color=LogColor.GREEN\n            )\n        case signals.NEW_LOWEST_PRICE:\n            self.log.info(\n                f"New lowest price was reached. | "\n                f"Signal value: {signal.value} | "\n                f"Signal time: {unix_nanos_to_dt(signal.ts_event)}",\n                color=LogColor.RED\n            )\n'})}),"\n",(0,t.jsx)(s.h4,{id:"full-example-2",children:"Full example"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.a,{href:"https://github.com/nautechsystems/nautilus_trader/tree/develop/examples/backtest/example_11_messaging_with_actor_signals",children:"Actor-Based Signal Example"})}),"\n",(0,t.jsx)(s.h3,{id:"summary-and-decision-guide",children:"Summary and decision guide"}),"\n",(0,t.jsx)(s.p,{children:"Here's a quick reference to help you decide which messaging style to use:"}),"\n",(0,t.jsx)(s.h4,{id:"decision-guide-which-style-to-choose",children:"Decision guide: Which style to choose?"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{style:{textAlign:"left"},children:(0,t.jsx)(s.strong,{children:"Use Case"})}),(0,t.jsx)(s.th,{style:{textAlign:"left"},children:(0,t.jsx)(s.strong,{children:"Recommended Approach"})}),(0,t.jsx)(s.th,{style:{textAlign:"left"},children:(0,t.jsx)(s.strong,{children:"Setup required"})})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"Custom events or system-level communication"}),(0,t.jsxs)(s.td,{style:{textAlign:"left"},children:[(0,t.jsx)(s.code,{children:"MessageBus"})," + Pub/Sub to topic"]}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"Topic + Handler management"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"Structured trading data"}),(0,t.jsxs)(s.td,{style:{textAlign:"left"},children:[(0,t.jsx)(s.code,{children:"Actor"})," + Pub/Sub Data + optional ",(0,t.jsx)(s.code,{children:"@customdataclass"})," if serialization is needed"]}),(0,t.jsxs)(s.td,{style:{textAlign:"left"},children:["New class definition inheriting from ",(0,t.jsx)(s.code,{children:"Data"})," (handler ",(0,t.jsx)(s.code,{children:"on_data"})," is predefined)"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"Simple alerts/notifications"}),(0,t.jsxs)(s.td,{style:{textAlign:"left"},children:[(0,t.jsx)(s.code,{children:"Actor"})," + Pub/Sub Signal"]}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"Just signal name"})]})]})]}),"\n",(0,t.jsx)(s.h2,{id:"external-publishing",children:"External publishing"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"MessageBus"})," can be ",(0,t.jsx)(s.em,{children:"backed"})," with any database or message broker technology which has an\nintegration written for it, this then enables external publishing of messages."]}),"\n",(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsxs)(s.p,{children:["Redis is currently supported for all serializable messages which are published externally.\nThe minimum supported Redis version is 6.2 (required for ",(0,t.jsx)(s.a,{href:"https://redis.io/docs/latest/develop/data-types/streams/",children:"streams"})," functionality)."]})}),"\n",(0,t.jsx)(s.p,{children:"Under the hood, when a backing database (or any other compatible technology) is configured,\nall outgoing messages are first serialized, then transmitted via a Multiple-Producer Single-Consumer (MPSC) channel to a separate thread (implemented in Rust).\nIn this separate thread, the message is written to its final destination, which is presently Redis streams."}),"\n",(0,t.jsx)(s.p,{children:"This design is primarily driven by performance considerations. By offloading the I/O operations to a separate thread,\nwe ensure that the main thread remains unblocked and can continue its tasks without being hindered by the potentially\ntime-consuming operations involved in interacting with a database or client."}),"\n",(0,t.jsx)(s.h3,{id:"serialization",children:"Serialization"}),"\n",(0,t.jsx)(s.p,{children:"Nautilus supports serialization for:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["All Nautilus built-in types (serialized as dictionaries ",(0,t.jsx)(s.code,{children:"dict[str, Any]"})," containing serializable primitives)."]}),"\n",(0,t.jsxs)(s.li,{children:["Python primitive types (",(0,t.jsx)(s.code,{children:"str"}),", ",(0,t.jsx)(s.code,{children:"int"}),", ",(0,t.jsx)(s.code,{children:"float"}),", ",(0,t.jsx)(s.code,{children:"bool"}),", ",(0,t.jsx)(s.code,{children:"bytes"}),")."]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["You can add serialization support for custom types by registering them through the ",(0,t.jsx)(s.code,{children:"serialization"})," subpackage."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:"def register_serializable_type(\n    cls,\n    to_dict: Callable[[Any], dict[str, Any]],\n    from_dict: Callable[[dict[str, Any]], Any],\n):\n    ...\n"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"cls"}),": The type to register."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"to_dict"}),": The delegate to instantiate a dict of primitive types from the object."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"from_dict"}),": The delegate to instantiate the object from a dict of primitive types."]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsxs)(s.p,{children:["The message bus external backing technology can be configured by importing the ",(0,t.jsx)(s.code,{children:"MessageBusConfig"})," object and passing this to\nyour ",(0,t.jsx)(s.code,{children:"TradingNodeConfig"}),". Each of these config options will be described below."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:'...  # Other config omitted\nmessage_bus=MessageBusConfig(\n    database=DatabaseConfig(),\n    encoding="json",\n    timestamps_as_iso8601=True,\n    buffer_interval_ms=100,\n    autotrim_mins=30,\n    use_trader_prefix=True,\n    use_trader_id=True,\n    use_instance_id=False,\n    streams_prefix="streams",\n    types_filter=[QuoteTick, TradeTick],\n)\n...\n'})}),"\n",(0,t.jsx)(s.h3,{id:"database-config",children:"Database config"}),"\n",(0,t.jsxs)(s.p,{children:["A ",(0,t.jsx)(s.code,{children:"DatabaseConfig"})," must be provided, for a default Redis setup on the local\nloopback you can pass a ",(0,t.jsx)(s.code,{children:"DatabaseConfig()"}),", which will use defaults to match."]}),"\n",(0,t.jsx)(s.h3,{id:"encoding",children:"Encoding"}),"\n",(0,t.jsxs)(s.p,{children:["Two encodings are currently supported by the built-in ",(0,t.jsx)(s.code,{children:"Serializer"})," used by the ",(0,t.jsx)(s.code,{children:"MessageBus"}),":"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["JSON (",(0,t.jsx)(s.code,{children:"json"}),")"]}),"\n",(0,t.jsxs)(s.li,{children:["MessagePack (",(0,t.jsx)(s.code,{children:"msgpack"}),")"]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["Use the ",(0,t.jsx)(s.code,{children:"encoding"})," config option to control the message writing encoding."]}),"\n",(0,t.jsx)(s.admonition,{type:"tip",children:(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"msgpack"})," encoding is used by default as it offers the most optimal serialization and memory performance.\nWe recommend using ",(0,t.jsx)(s.code,{children:"json"})," encoding for human readability when performance is not a primary concern."]})}),"\n",(0,t.jsx)(s.h3,{id:"timestamp-formatting",children:"Timestamp formatting"}),"\n",(0,t.jsxs)(s.p,{children:["By default timestamps are formatted as UNIX epoch nanosecond integers. Alternatively you can\nconfigure ISO 8601 string formatting by setting the ",(0,t.jsx)(s.code,{children:"timestamps_as_iso8601"})," to ",(0,t.jsx)(s.code,{children:"True"}),"."]}),"\n",(0,t.jsx)(s.h3,{id:"message-stream-keys",children:"Message stream keys"}),"\n",(0,t.jsx)(s.p,{children:"Message stream keys are essential for identifying individual trader nodes and organizing messages within streams.\nThey can be tailored to meet your specific requirements and use cases. In the context of message bus streams, a trader key is typically structured as follows:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"trader:{trader_id}:{instance_id}:{streams_prefix}\n"})}),"\n",(0,t.jsx)(s.p,{children:"The following options are available for configuring message stream keys:"}),"\n",(0,t.jsx)(s.h4,{id:"trader-prefix",children:"Trader prefix"}),"\n",(0,t.jsxs)(s.p,{children:["If the key should begin with the ",(0,t.jsx)(s.code,{children:"trader"})," string."]}),"\n",(0,t.jsx)(s.h4,{id:"trader-id",children:"Trader ID"}),"\n",(0,t.jsx)(s.p,{children:"If the key should include the trader ID for the node."}),"\n",(0,t.jsx)(s.h4,{id:"instance-id",children:"Instance ID"}),"\n",(0,t.jsxs)(s.p,{children:["Each trader node is assigned a unique 'instance ID,' which is a UUIDv4. This instance ID helps distinguish individual traders when messages\nare distributed across multiple streams. You can include the instance ID in the trader key by setting the ",(0,t.jsx)(s.code,{children:"use_instance_id"})," configuration option to ",(0,t.jsx)(s.code,{children:"True"}),".\nThis is particularly useful when you need to track and identify traders across various streams in a multi-node trading system."]}),"\n",(0,t.jsx)(s.h4,{id:"streams-prefix",children:"Streams prefix"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"streams_prefix"})," string enables you to group all streams for a single trader instance or organize\nmessages for multiple instances. Configure this by passing a string to the ",(0,t.jsx)(s.code,{children:"streams_prefix"})," configuration\noption, ensuring other prefixes are set to false."]}),"\n",(0,t.jsx)(s.h4,{id:"stream-per-topic",children:"Stream per topic"}),"\n",(0,t.jsx)(s.p,{children:"Indicates whether the producer will write a separate stream for each topic. This is particularly\nuseful for Redis backings, which do not support wildcard topics when listening to streams.\nIf set to False, all messages will be written to the same stream."}),"\n",(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsx)(s.p,{children:"Redis does not support wildcard stream topics. For better compatibility with Redis, it is recommended to set this option to False."})}),"\n",(0,t.jsx)(s.h3,{id:"types-filtering",children:"Types filtering"}),"\n",(0,t.jsx)(s.p,{children:"When messages are published on the message bus, they are serialized and written to a stream if a backing\nfor the message bus is configured and enabled. To prevent flooding the stream with data like high-frequency\nquotes, you may filter out certain types of messages from external publication."}),"\n",(0,t.jsxs)(s.p,{children:["To enable this filtering mechanism, pass a list of ",(0,t.jsx)(s.code,{children:"type"})," objects to the ",(0,t.jsx)(s.code,{children:"types_filter"})," parameter in the message bus configuration,\nspecifying which types of messages should be excluded from external publication."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:"from nautilus_trader.config import MessageBusConfig\nfrom nautilus_trader.data import TradeTick\nfrom nautilus_trader.data import QuoteTick\n\n# Create a MessageBusConfig instance with types filtering\nmessage_bus = MessageBusConfig(\n    types_filter=[QuoteTick, TradeTick]\n)\n\n"})}),"\n",(0,t.jsx)(s.h3,{id:"stream-auto-trimming",children:"Stream auto-trimming"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"autotrim_mins"})," configuration parameter allows you to specify the lookback window in minutes for automatic stream trimming in your message streams.\nAutomatic stream trimming helps manage the size of your message streams by removing older messages, ensuring that the streams remain manageable in terms of storage and performance."]}),"\n",(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsxs)(s.p,{children:["The current Redis implementation will maintain the ",(0,t.jsx)(s.code,{children:"autotrim_mins"})," as a maximum width (plus roughly a minute, as streams are trimmed no more than once per minute).\nRather than a maximum lookback window based on the current wall clock time."]})}),"\n",(0,t.jsx)(s.h2,{id:"external-streams",children:"External streams"}),"\n",(0,t.jsxs)(s.p,{children:["The message bus within a ",(0,t.jsx)(s.code,{children:"TradingNode"}),' (node) is referred to as the "internal message bus".\nA producer node is one which publishes messages onto an external stream (see ',(0,t.jsx)(s.a,{href:"#external-publishing",children:"external publishing"}),").\nThe consumer node listens to external streams to receive and publish deserialized message payloads on its internal message bus."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                  \u2502                           \u2502\n                  \u2502                           \u2502\n                  \u2502                           \u2502\n                  \u2502      Producer Node        \u2502\n                  \u2502                           \u2502\n                  \u2502                           \u2502\n                  \u2502                           \u2502\n                  \u2502                           \u2502\n                  \u2502                           \u2502\n                  \u2502                           \u2502\n                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                \u2502\n                                \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                                                              \u2502\n\u2502                            Stream                            \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n              \u2502                                    \u2502\n              \u2502                                    \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         \u2502          \u2502                         \u2502\n\u2502                         \u2502          \u2502                         \u2502\n\u2502     Consumer Node 1     \u2502          \u2502     Consumer Node 2     \u2502\n\u2502                         \u2502          \u2502                         \u2502\n\u2502                         \u2502          \u2502                         \u2502\n\u2502                         \u2502          \u2502                         \u2502\n\u2502                         \u2502          \u2502                         \u2502\n\u2502                         \u2502          \u2502                         \u2502\n\u2502                         \u2502          \u2502                         \u2502\n\u2502                         \u2502          \u2502                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(s.admonition,{type:"tip",children:(0,t.jsxs)(s.p,{children:["Set the ",(0,t.jsx)(s.code,{children:"LiveDataEngineConfig.external_clients"})," with the list of ",(0,t.jsx)(s.code,{children:"client_id"}),"s intended to represent the external streaming clients.\nThe ",(0,t.jsx)(s.code,{children:"DataEngine"})," will filter out subscription commands for these clients, ensuring that the external streaming provides the necessary data for any subscriptions to these clients."]})}),"\n",(0,t.jsx)(s.h3,{id:"example-configuration",children:"Example configuration"}),"\n",(0,t.jsx)(s.p,{children:"The following example details a streaming setup where a producer node publishes Binance data externally,\nand a downstream consumer node publishes these data messages onto its internal message bus."}),"\n",(0,t.jsx)(s.h4,{id:"producer-node",children:"Producer node"}),"\n",(0,t.jsxs)(s.p,{children:["We configure the ",(0,t.jsx)(s.code,{children:"MessageBus"})," of the producer node to publish to a ",(0,t.jsx)(s.code,{children:'"binance"'})," stream.\nThe settings ",(0,t.jsx)(s.code,{children:"use_trader_id"}),", ",(0,t.jsx)(s.code,{children:"use_trader_prefix"}),", and ",(0,t.jsx)(s.code,{children:"use_instance_id"})," are all set to ",(0,t.jsx)(s.code,{children:"False"}),"\nto ensure a simple and predictable stream key that the consumer nodes can register for."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:'message_bus=MessageBusConfig(\n    database=DatabaseConfig(timeout=2),\n    use_trader_id=False,\n    use_trader_prefix=False,\n    use_instance_id=False,\n    streams_prefix="binance",  # <---\n    stream_per_topic=False,\n    autotrim_mins=30,\n),\n'})}),"\n",(0,t.jsx)(s.h4,{id:"consumer-node",children:"Consumer node"}),"\n",(0,t.jsxs)(s.p,{children:["We configure the ",(0,t.jsx)(s.code,{children:"MessageBus"})," of the consumer node to receive messages from the same ",(0,t.jsx)(s.code,{children:'"binance"'})," stream.\nThe node will listen to the external stream keys to publish these messages onto its internal message bus.\nAdditionally, we declare the client ID ",(0,t.jsx)(s.code,{children:'"BINANCE_EXT"'})," as an external client. This ensures that the\n",(0,t.jsx)(s.code,{children:"DataEngine"})," does not attempt to send data commands to this client ID, as we expect these messages to be\npublished onto the internal message bus from the external stream, to which the node has subscribed to the relevant topics."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:'data_engine=LiveDataEngineConfig(\n    external_clients=[ClientId("BINANCE_EXT")],\n),\nmessage_bus=MessageBusConfig(\n    database=DatabaseConfig(timeout=2),\n    external_streams=["binance"],  # <---\n),\n'})})]})}function h(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},9087:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>l});var i=n(6363);const t={},a=i.createContext(t);function r(e){const s=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(a.Provider,{value:s},e.children)}}}]);