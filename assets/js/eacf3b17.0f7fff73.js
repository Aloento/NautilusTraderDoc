"use strict";(globalThis.webpackChunknautilus_trader=globalThis.webpackChunknautilus_trader||[]).push([[7321],{2357:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"developer_guide/rust","title":"Rust \u98ce\u683c\u6307\u5357","description":"Rust \u8bed\u8a00\u975e\u5e38\u9002\u5408\u5b9e\u73b0\u5e73\u53f0\u548c\u7cfb\u7edf\u7684\u5173\u952e\u6838\u5fc3\u90e8\u5206\u3002","source":"@site/docs/developer_guide/rust.md","sourceDirName":"developer_guide","slug":"/developer_guide/rust","permalink":"/developer_guide/rust","draft":false,"unlisted":false,"editUrl":"https://github.com/Aloento/NautilusTraderDoc/tree/main/docs/developer_guide/rust.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u6253\u5305\u6570\u636e","permalink":"/developer_guide/packaged_data"},"next":{"title":"\u6d4b\u8bd5","permalink":"/developer_guide/testing"}}');var i=s(7259),l=s(9087);const c={},d="Rust \u98ce\u683c\u6307\u5357",t={},a=[{value:"Cargo \u6e05\u5355\uff08manifest\uff09\u7ea6\u5b9a",id:"cargo-\u6e05\u5355manifest\u7ea6\u5b9a",level:2},{value:"\u7248\u672c\u7ba1\u7406\u5efa\u8bae",id:"\u7248\u672c\u7ba1\u7406\u5efa\u8bae",level:2},{value:"\u7279\u6027\uff08feature\uff09\u7ea6\u5b9a",id:"\u7279\u6027feature\u7ea6\u5b9a",level:2},{value:"\u6a21\u5757\u7ec4\u7ec7",id:"\u6a21\u5757\u7ec4\u7ec7",level:2},{value:"\u4ee3\u7801\u98ce\u683c\u4e0e\u7ea6\u5b9a",id:"\u4ee3\u7801\u98ce\u683c\u4e0e\u7ea6\u5b9a",level:2},{value:"\u6587\u4ef6\u5934\u8981\u6c42",id:"\u6587\u4ef6\u5934\u8981\u6c42",level:3},{value:"\u4ee3\u7801\u683c\u5f0f\u5316",id:"\u4ee3\u7801\u683c\u5f0f\u5316",level:3},{value:"\u5b57\u7b26\u4e32\u683c\u5f0f",id:"\u5b57\u7b26\u4e32\u683c\u5f0f",level:4},{value:"\u65e5\u5fd7\uff08Logging\uff09",id:"\u65e5\u5fd7logging",level:3},{value:"\u9519\u8bef\u5904\u7406",id:"\u9519\u8bef\u5904\u7406",level:3},{value:"\u5f02\u6b65\u6a21\u5f0f\uff08Async patterns\uff09",id:"\u5f02\u6b65\u6a21\u5f0fasync-patterns",level:3},{value:"\u5c5e\u6027\uff08attribute\uff09\u4f7f\u7528\u89c4\u8303",id:"\u5c5e\u6027attribute\u4f7f\u7528\u89c4\u8303",level:3},{value:"\u6784\u9020\u51fd\u6570\u6a21\u5f0f",id:"\u6784\u9020\u51fd\u6570\u6a21\u5f0f",level:3},{value:"\u5e38\u91cf\u4e0e\u547d\u540d\u7ea6\u5b9a",id:"\u5e38\u91cf\u4e0e\u547d\u540d\u7ea6\u5b9a",level:3},{value:"\u54c8\u5e0c\u96c6\u5408\uff08Hash collections\uff09",id:"\u54c8\u5e0c\u96c6\u5408hash-collections",level:3},{value:"Re-export \u7ea6\u5b9a",id:"re-export-\u7ea6\u5b9a",level:3},{value:"\u6587\u6863\u6807\u51c6",id:"\u6587\u6863\u6807\u51c6",level:3},{value:"\u6a21\u5757\u7ea7\u6587\u6863",id:"\u6a21\u5757\u7ea7\u6587\u6863",level:4},{value:"\u5b57\u6bb5\u6587\u6863",id:"\u5b57\u6bb5\u6587\u6863",level:4},{value:"\u51fd\u6570\u6587\u6863",id:"\u51fd\u6570\u6587\u6863",level:4},{value:"\u9519\u8bef\u4e0e panic \u7684\u6587\u6863\u683c\u5f0f",id:"\u9519\u8bef\u4e0e-panic-\u7684\u6587\u6863\u683c\u5f0f",level:4},{value:"\u5b89\u5168\uff08Safety\uff09\u6587\u6863\u683c\u5f0f",id:"\u5b89\u5168safety\u6587\u6863\u683c\u5f0f",level:4},{value:"Python \u7ed1\u5b9a",id:"python-\u7ed1\u5b9a",level:2},{value:"PyO3 \u547d\u540d\u7ea6\u5b9a",id:"pyo3-\u547d\u540d\u7ea6\u5b9a",level:3},{value:"\u6d4b\u8bd5\u7ea6\u5b9a",id:"\u6d4b\u8bd5\u7ea6\u5b9a",level:3},{value:"\u6d4b\u8bd5\u7ec4\u7ec7",id:"\u6d4b\u8bd5\u7ec4\u7ec7",level:4},{value:"\u53c2\u6570\u5316\u6d4b\u8bd5",id:"\u53c2\u6570\u5316\u6d4b\u8bd5",level:4},{value:"\u6d4b\u8bd5\u547d\u540d",id:"\u6d4b\u8bd5\u547d\u540d",level:4},{value:"Rust \u4e0e Python \u5185\u5b58\u7ba1\u7406",id:"rust-\u4e0e-python-\u5185\u5b58\u7ba1\u7406",level:2},{value:"\u5f15\u7528\u73af\u95ee\u9898",id:"\u5f15\u7528\u73af\u95ee\u9898",level:3},{value:"\u89e3\u51b3\u65b9\u6848\uff1a\u57fa\u4e8e GIL \u7684\u514b\u9686\uff08GIL-based cloning\uff09",id:"\u89e3\u51b3\u65b9\u6848\u57fa\u4e8e-gil-\u7684\u514b\u9686gil-based-cloning",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:3},{value:"1. \u4f7f\u7528 <code>clone_py_object()</code> \u8fdb\u884c Python \u5bf9\u8c61\u514b\u9686",id:"1-\u4f7f\u7528-clone_py_object-\u8fdb\u884c-python-\u5bf9\u8c61\u514b\u9686",level:4},{value:"2. \u4ece\u6301\u6709\u56de\u8c03\u7684\u7ed3\u6784\u4f53\u79fb\u9664 <code>#[derive(Clone)]</code>",id:"2-\u4ece\u6301\u6709\u56de\u8c03\u7684\u7ed3\u6784\u4f53\u79fb\u9664-deriveclone",level:4},{value:"3. \u66f4\u65b0\u51fd\u6570\u7b7e\u540d\u4ee5\u63a5\u53d7 <code>PyObject</code>",id:"3-\u66f4\u65b0\u51fd\u6570\u7b7e\u540d\u4ee5\u63a5\u53d7-pyobject",level:4},{value:"4. \u521b\u5efa Python \u56de\u8c03\u65f6\u907f\u514d\u4f7f\u7528 <code>Arc::new()</code>",id:"4-\u521b\u5efa-python-\u56de\u8c03\u65f6\u907f\u514d\u4f7f\u7528-arcnew",level:4},{value:"\u4e3a\u4ec0\u4e48\u8fd9\u6837\u53ef\u884c",id:"\u4e3a\u4ec0\u4e48\u8fd9\u6837\u53ef\u884c",level:3},{value:"\u5e38\u89c1\u53cd\u6a21\u5f0f",id:"\u5e38\u89c1\u53cd\u6a21\u5f0f",level:2},{value:"\u4e0d\u5b89\u5168\u7684 Rust\uff08Unsafe Rust\uff09",id:"\u4e0d\u5b89\u5168\u7684-rustunsafe-rust",level:2},{value:"\u5b89\u5168\u7b56\u7565",id:"\u5b89\u5168\u7b56\u7565",level:3},{value:"\u5de5\u5177\u94fe\u914d\u7f6e",id:"\u5de5\u5177\u94fe\u914d\u7f6e",level:2},{value:"\u53c2\u8003\u8d44\u6599",id:"\u53c2\u8003\u8d44\u6599",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"rust-\u98ce\u683c\u6307\u5357",children:"Rust \u98ce\u683c\u6307\u5357"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://www.rust-lang.org/learn",children:"Rust"})," \u8bed\u8a00\u975e\u5e38\u9002\u5408\u5b9e\u73b0\u5e73\u53f0\u548c\u7cfb\u7edf\u7684\u5173\u952e\u6838\u5fc3\u90e8\u5206\u3002\n\u5b83\u5f3a\u7c7b\u578b\u7cfb\u7edf\u3001\u6240\u6709\u6743\u6a21\u578b\u4e0e\u7f16\u8bd1\u671f\u68c0\u67e5\u5728\u8bbe\u8ba1\u4e0a\u6d88\u9664\u4e86\u5185\u5b58\u9519\u8bef\u548c\u6570\u636e\u7ade\u4e89\uff0c\n\u800c\u96f6\u6210\u672c\u62bd\u8c61\u4e0e\u65e0\u5783\u573e\u56de\u6536\u673a\u5236\u5219\u63d0\u4f9b\u4e86\u63a5\u8fd1 C \u7684\u6027\u80fd\uff0c\u8fd9\u5bf9\u9ad8\u9891\u4ea4\u6613\u8fd9\u7c7b\u5bf9\u5ef6\u8fdf\u548c\u541e\u5410\u654f\u611f\u7684\u5de5\u4f5c\u8d1f\u8f7d\u81f3\u5173\u91cd\u8981\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"cargo-\u6e05\u5355manifest\u7ea6\u5b9a",children:"Cargo \u6e05\u5355\uff08manifest\uff09\u7ea6\u5b9a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u5728 ",(0,i.jsx)(n.code,{children:"[dependencies]"})," \u4e2d\uff1a\u5148\u6309\u5b57\u6bcd\u987a\u5e8f\u5217\u51fa\u5185\u90e8 crate\uff08\u4f8b\u5982 ",(0,i.jsx)(n.code,{children:"nautilus-*"}),"\uff09\uff0c\u63d2\u5165\u4e00\u4e2a\u7a7a\u884c\uff0c\u518d\u6309\u5b57\u6bcd\u987a\u5e8f\u5217\u51fa\u5916\u90e8\u5fc5\u9700\u4f9d\u8d56\uff1b\u968f\u540e\u518d\u63d2\u5165\u4e00\u4e2a\u7a7a\u884c\uff0c\u6700\u540e\u6309\u5b57\u6bcd\u987a\u5e8f\u5217\u51fa\u53ef\u9009\u4f9d\u8d56\uff08\u5373\u5e26\u6709 ",(0,i.jsx)(n.code,{children:"optional = true"})," \u7684\u9879\uff09\u3002\u4fdd\u7559\u6bcf\u4e2a\u4f9d\u8d56\u884c\u4e0a\u7684\u5185\u8054\u6ce8\u91ca\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5bf9\u4e8e\u4f1a\u6784\u5efa Python \u5de5\u4ef6\u7684 ",(0,i.jsx)(n.code,{children:"extension-module"})," \u7279\u6027\u5217\u8868\uff0c\u8bf7\u59cb\u7ec8\u628a ",(0,i.jsx)(n.code,{children:'"python"'})," \u52a0\u5165\u5176\u4e2d\uff0c\u5e76\u4e0e ",(0,i.jsx)(n.code,{children:'"pyo3/extension-module"'})," \u76f8\u90bb\uff0c\u4ee5\u4fbf\u4e00\u773c\u770b\u51fa\u5b8c\u6574\u7684 Python \u6808\u4f9d\u8d56\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5f53 manifest \u5c06\u9002\u914d\u5668\uff08adapters\uff09\u5355\u72ec\u5206\u7ec4\u65f6\uff08\u4f8b\u5982 ",(0,i.jsx)(n.code,{children:"crates/pyo3"}),"\uff09\uff0c\u628a ",(0,i.jsx)(n.code,{children:"# Adapters"})," \u5757\u653e\u5728\u5185\u90e8 crate \u5217\u8868\u4e0b\u65b9\uff0c\u4fbf\u4e8e\u4e0b\u6e38\u6d88\u8d39\u8005\u5feb\u901f\u67e5\u770b\u9002\u914d\u5668\u8986\u76d6\u60c5\u51b5\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5728 ",(0,i.jsx)(n.code,{children:"[dev-dependencies]"})," \u548c ",(0,i.jsx)(n.code,{children:"[build-dependencies]"})," \u8282\u4e4b\u524d\u59cb\u7ec8\u4fdd\u7559\u4e00\u4e2a\u7a7a\u884c\u3002"]}),"\n",(0,i.jsx)(n.li,{children:"\u5f53\u76f8\u5173 manifest \u7684\u7279\u6027\u6216\u4f9d\u8d56\u96c6\u5408\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u4fdd\u6301\u76f8\u540c\u5e03\u5c40\u4ee5\u907f\u514d\u5404\u4e2a crate \u4e4b\u95f4\u51fa\u73b0\u6837\u5f0f\u6f02\u79fb\u3002"}),"\n",(0,i.jsxs)(n.li,{children:["\u5bf9 ",(0,i.jsx)(n.code,{children:"bin/"})," \u4e0b\u7684\u6e90\u6587\u4ef6\u4f7f\u7528 snake_case \u6587\u4ef6\u540d\uff08\u4f8b\u5982 ",(0,i.jsx)(n.code,{children:"bin/ws_data.rs"}),"\uff09\uff0c\u5e76\u5728\u6bcf\u4e2a ",(0,i.jsx)(n.code,{children:"[[bin]]"})," \u90e8\u5206\u4e2d\u53cd\u6620\u76f8\u5e94\u8def\u5f84\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:["\u4fdd\u6301 ",(0,i.jsx)(n.code,{children:"[[bin]] name"})," \u6761\u76ee\u4f7f\u7528 kebab-case\uff08\u4f8b\u5982 ",(0,i.jsx)(n.code,{children:'name = "hyperliquid-ws-data"'}),"\uff09\uff0c\u4ee5\u4fdd\u8bc1\u7f16\u8bd1\u51fa\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u62e5\u6709\u9884\u671f\u7684 CLI \u540d\u79f0\u3002"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u7248\u672c\u7ba1\u7406\u5efa\u8bae",children:"\u7248\u672c\u7ba1\u7406\u5efa\u8bae"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u5bf9\u4e8e\u5171\u4eab\u4f9d\u8d56\u4f7f\u7528 workspace \u7ee7\u627f\uff08\u4f8b\u5982 ",(0,i.jsx)(n.code,{children:"serde = { workspace = true }"}),"\uff09\u3002"]}),"\n",(0,i.jsx)(n.li,{children:"\u4ec5\u5bf9\u4e0d\u5c5e\u4e8e workspace \u7684 crate \u7279\u6709\u4f9d\u8d56\u76f4\u63a5\u56fa\u5b9a\u7248\u672c\uff08pin\uff09\u3002"}),"\n",(0,i.jsx)(n.li,{children:"\u628a workspace \u63d0\u4f9b\u7684\u4f9d\u8d56\u653e\u5728 crate \u4e13\u5c5e\u4f9d\u8d56\u4e4b\u524d\uff0c\u4fbf\u4e8e\u5ba1\u8ba1\u7ee7\u627f\u5173\u7cfb\u3002"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u7279\u6027feature\u7ea6\u5b9a",children:"\u7279\u6027\uff08feature\uff09\u7ea6\u5b9a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4f18\u5148\u91c7\u7528\u201c\u53ef\u53e0\u52a0\u201d\uff08additive\uff09\u7684\u7279\u6027\u5f00\u5173\u2014\u2014\u542f\u7528\u67d0\u7279\u6027\u4e0d\u5e94\u7834\u574f\u73b0\u6709\u529f\u80fd\u3002"}),"\n",(0,i.jsx)(n.li,{children:"\u4f7f\u7528\u63cf\u8ff0\u6027\u540d\u79f0\u6765\u8bf4\u660e\u7279\u6027\u542f\u7528\u540e\u4f1a\u5e26\u6765\u4ec0\u4e48\u80fd\u529b\u3002"}),"\n",(0,i.jsx)(n.li,{children:"\u5728 crate \u7ea7\u522b\u6587\u6863\u4e2d\u8bb0\u5f55\u6bcf\u4e2a\u7279\u6027\uff0c\u65b9\u4fbf\u4f7f\u7528\u8005\u4e86\u89e3\u5176\u5f71\u54cd\u3002"}),"\n",(0,i.jsxs)(n.li,{children:["\u5e38\u89c1\u6a21\u5f0f\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"high-precision"}),"\uff1a\u5207\u6362\u5e95\u5c42\u6570\u503c\u7c7b\u578b\uff0864 \u4f4d\u6216 128 \u4f4d\u6574\u6570\uff09\uff0c\u4ee5\u652f\u6301\u9700\u8981\u66f4\u9ad8\u7cbe\u5ea6\u7684\u573a\u666f\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"default = []"}),"\uff1a\u4fdd\u6301\u9ed8\u8ba4\u96c6\u5c3d\u53ef\u80fd\u7cbe\u7b80\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"python"}),"\uff1a\u542f\u7528 Python \u7ed1\u5b9a\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"extension-module"}),"\uff1a\u6784\u5efa Python \u6269\u5c55\u6a21\u5757\uff08\u59cb\u7ec8\u540c\u65f6\u5305\u542b ",(0,i.jsx)(n.code,{children:"python"}),"\uff09\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ffi"}),"\uff1a\u542f\u7528 C \u8bed\u8a00 FFI \u7ed1\u5b9a\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"stubs"}),"\uff1a\u66b4\u9732\u7528\u4e8e\u6d4b\u8bd5\u7684\u6869\uff08stubs\uff09\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u6a21\u5757\u7ec4\u7ec7",children:"\u6a21\u5757\u7ec4\u7ec7"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4fdd\u6301\u6a21\u5757\u805a\u7126\u5355\u4e00\u804c\u8d23\u3002"}),"\n",(0,i.jsxs)(n.li,{children:["\u5728\u5b9a\u4e49\u5b50\u6a21\u5757\u65f6\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"mod.rs"})," \u4f5c\u4e3a\u6a21\u5757\u6839\u6587\u4ef6\u3002"]}),"\n",(0,i.jsx)(n.li,{children:"\u76f8\u8f83\u4e8e\u6df1\u5ea6\u5d4c\u5957\uff0c\u66f4\u503e\u5411\u4e8e\u4f7f\u7528\u76f8\u5bf9\u6241\u5e73\u7684\u5c42\u7ea7\uff0c\u4ee5\u4fbf\u8def\u5f84\u66f4\u6613\u7ba1\u7406\u3002"}),"\n",(0,i.jsx)(n.li,{children:"\u5bf9\u5e38\u7528\u9879\u5728 crate \u6839\u5904\u8fdb\u884c re-export\uff0c\u63d0\u5347\u4f7f\u7528\u65b9\u4fbf\u6027\u3002"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u4ee3\u7801\u98ce\u683c\u4e0e\u7ea6\u5b9a",children:"\u4ee3\u7801\u98ce\u683c\u4e0e\u7ea6\u5b9a"}),"\n",(0,i.jsx)(n.h3,{id:"\u6587\u4ef6\u5934\u8981\u6c42",children:"\u6587\u4ef6\u5934\u8981\u6c42"}),"\n",(0,i.jsx)(n.p,{children:"\u6240\u6709 Rust \u6587\u4ef6\u5fc5\u987b\u5305\u542b\u6807\u51c6\u5316\u7684\u7248\u6743\u5934\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'// -------------------------------------------------------------------------------------------------\n//  Copyright (C) 2015-2025 Nautech Systems Pty Ltd. All rights reserved.\n//  https://nautechsystems.io\n//\n//  Licensed under the GNU Lesser General Public License Version 3.0 (the "License");\n//  You may not use this file except in compliance with the License.\n//  You may obtain a copy of the License at https://www.gnu.org/licenses/lgpl-3.0.en.html\n//\n//  Unless required by applicable law or agreed to in writing, software\n//  distributed under the License is distributed on an "AS IS" BASIS,\n//  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n//  See the License for the specific language governing permissions and\n//  limitations under the License.\n// -------------------------------------------------------------------------------------------------\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u4ee3\u7801\u683c\u5f0f\u5316",children:"\u4ee3\u7801\u683c\u5f0f\u5316"}),"\n",(0,i.jsxs)(n.p,{children:["\u8fd0\u884c ",(0,i.jsx)(n.code,{children:"make format"})," \u65f6\uff0c",(0,i.jsx)(n.code,{children:"rustfmt"})," \u4f1a\u81ea\u52a8\u5904\u7406\u5bfc\u5165\uff08import\uff09\u7684\u683c\u5f0f\u5316\u3002\n\u8be5\u5de5\u5177\u4f1a\u5c06\u5bfc\u5165\u6309\u7ec4\uff08\u6807\u51c6\u5e93\u3001\u5916\u90e8 crate\u3001\u672c\u5730\u5bfc\u5165\uff09\u5212\u5206\uff0c\u5e76\u5728\u6bcf\u4e2a\u7ec4\u5185\u6309\u5b57\u6bcd\u987a\u5e8f\u6392\u5e8f\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u672c\u8282\u5185\uff0c\u8bf7\u9075\u5faa\u4ee5\u4e0b\u7a7a\u884c\u89c4\u5219\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u5728\u51fd\u6570\u4e4b\u95f4\uff08\u5305\u62ec\u6d4b\u8bd5\uff09\u4fdd\u7559",(0,i.jsx)(n.strong,{children:"\u4e00\u884c\u7a7a\u884c"}),"\u2014\u2014\u8fd9\u6709\u52a9\u4e8e\u53ef\u8bfb\u6027\uff0c\u4e5f\u4e0e ",(0,i.jsx)(n.code,{children:"rustfmt"})," \u7684\u9ed8\u8ba4\u884c\u4e3a\u4e00\u81f4\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5728\u6bcf\u4e2a\u6587\u6863\u6ce8\u91ca\uff08",(0,i.jsx)(n.code,{children:"///"})," \u6216 ",(0,i.jsx)(n.code,{children:"//!"}),"\uff09\u4e0a\u65b9\u4fdd\u7559",(0,i.jsx)(n.strong,{children:"\u4e00\u884c\u7a7a\u884c"}),"\uff0c\u4ee5\u4fbf\u5c06\u6ce8\u91ca\u4e0e\u524d\u9762\u7684\u4ee3\u7801\u5757\u660e\u663e\u5206\u79bb\u3002"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"\u5b57\u7b26\u4e32\u683c\u5f0f",children:"\u5b57\u7b26\u4e32\u683c\u5f0f"}),"\n",(0,i.jsx)(n.p,{children:"\u4f18\u5148\u4f7f\u7528\u5e26\u53d8\u91cf\u540d\u7684\u5185\u8054\u683c\u5f0f\u5b57\u7b26\u4e32\uff0c\u800c\u975e\u4f4d\u7f6e\u53c2\u6570\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'// Preferred - inline format with variable names\nanyhow::bail!("Failed to subtract {n} months from {datetime}");\n\n// Instead of - positional arguments\nanyhow::bail!("Failed to subtract {} months from {}", n, datetime);\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u79cd\u65b9\u5f0f\u4f7f\u5f97\u9519\u8bef\u6d88\u606f\u66f4\u5177\u53ef\u8bfb\u6027\u4e0e\u81ea\u8bf4\u660e\u6027\uff0c\u5c24\u5176\u5728\u53d8\u91cf\u8f83\u591a\u65f6\u66f4\u660e\u663e\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u65e5\u5fd7logging",children:"\u65e5\u5fd7\uff08Logging\uff09"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u660e\u786e\u9650\u5b9a\u65e5\u5fd7\u5b8f\u7684\u8def\u5f84\u4ee5\u6307\u660e\u540e\u7aef\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u5728\u540c\u6b65\u6838\u5fc3 crate \u4e2d\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"log::\u2026"}),"\uff08\u5982 ",(0,i.jsx)(n.code,{children:"log::info!"}),", ",(0,i.jsx)(n.code,{children:"log::warn!"})," \u7b49\uff09\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5728\u5f02\u6b65\u8fd0\u884c\u65f6\u3001\u9002\u914d\u5668\u53ca\u5916\u56f4\u7ec4\u4ef6\u4e2d\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"tracing::\u2026"}),"\uff08\u5982 ",(0,i.jsx)(n.code,{children:"tracing::debug!"}),", ",(0,i.jsx)(n.code,{children:"tracing::info!"})," \u7b49\uff09\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:'\u65e5\u5fd7\u6d88\u606f\u4ee5\u9996\u5b57\u6bcd\u5927\u5199\u5f00\u5934\uff0c\u4f18\u5148\u4f7f\u7528\u5b8c\u6574\u53e5\u5b50\uff0c\u4f46\u7701\u7565\u7ed3\u5c3e\u53e5\u53f7\uff08\u4f8b\u5982\u4f7f\u7528 "Processing batch" \u800c\u4e0d\u662f "Processing batch."\uff09\u3002'}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u9519\u8bef\u5904\u7406",children:"\u9519\u8bef\u5904\u7406"}),"\n",(0,i.jsx)(n.p,{children:"\u4e00\u81f4\u5730\u91c7\u7528\u7ed3\u6784\u5316\u7684\u9519\u8bef\u5904\u7406\u6a21\u5f0f\uff1a"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u4e3b\u8981\u6a21\u5f0f"}),"\uff1a\u5bf9\u53ef\u80fd\u5931\u8d25\u7684\u51fd\u6570\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"anyhow::Result<T>"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"pub fn calculate_balance(&mut self) -> anyhow::Result<Money> {\n    // Implementation\n}\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u81ea\u5b9a\u4e49\u9519\u8bef\u7c7b\u578b"}),"\uff1a\u5bf9\u9886\u57df\u7279\u5b9a\u9519\u8bef\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"thiserror"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'#[derive(Error, Debug)]\npub enum NetworkError {\n    #[error("Connection failed: {0}")]\n    ConnectionFailed(String),\n    #[error("Timeout occurred")]\n    Timeout,\n}\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u9519\u8bef\u4f20\u64ad"}),"\uff1a\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"?"})," \u8fd0\u7b97\u7b26\u5b9e\u73b0\u6e05\u6670\u7684\u9519\u8bef\u4f20\u64ad\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u6784\u9020\u9519\u8bef"}),"\uff1a\u504f\u597d\u7528 ",(0,i.jsx)(n.code,{children:"anyhow::bail!"})," \u505a\u65e9\u671f\u8fd4\u56de\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'// Preferred - using bail! for early returns\npub fn process_value(value: i32) -> anyhow::Result<i32> {\n    if value < 0 {\n        anyhow::bail!("Value cannot be negative: {value}");\n    }\n    Ok(value * 2)\n}\n\n// Instead of - verbose return statement\nif value < 0 {\n    return Err(anyhow::anyhow!("Value cannot be negative: {value}"));\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u6ce8\u610f\uff1a\u5728\u9700\u8981\u95ed\u5305\u4e0a\u4e0b\u6587\uff08\u5982 ",(0,i.jsx)(n.code,{children:"ok_or_else()"}),"\uff09\u800c\u65e0\u6cd5\u65e9\u671f\u8fd4\u56de\u65f6\uff0c\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"anyhow::anyhow!"}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u5f02\u6b65\u6a21\u5f0fasync-patterns",children:"\u5f02\u6b65\u6a21\u5f0f\uff08Async patterns\uff09"}),"\n",(0,i.jsx)(n.p,{children:"\u4fdd\u6301\u5f02\u6b65/await \u7684\u4e00\u81f4\u4f7f\u7528\u60ef\u4f8b\uff1a"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u5f02\u6b65\u51fd\u6570\u547d\u540d"}),"\uff1a\u65e0\u9700\u7279\u6b8a\u540e\u7f00\uff0c\u4f7f\u7528\u81ea\u7136\u547d\u540d\u5373\u53ef\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Tokio \u4f7f\u7528"}),"\uff1a\u5bf9 fire-and-forget \u7c7b\u578b\u7684\u5de5\u4f5c\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"tokio::spawn"}),"\uff0c\u5e76\u5728\u6587\u6863\u4e2d\u8bf4\u660e\u8be5\u540e\u53f0\u4efb\u52a1\u4f55\u65f6\u5e94\u8be5\u5b8c\u6210\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u9519\u8bef\u5904\u7406"}),"\uff1a\u5f02\u6b65\u51fd\u6570\u4e5f\u8fd4\u56de ",(0,i.jsx)(n.code,{children:"anyhow::Result"}),"\uff0c\u4ee5\u4e0e\u540c\u6b65\u7ea6\u5b9a\u4e00\u81f4\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u53d6\u6d88\u5b89\u5168\uff08cancellation safety\uff09"}),"\uff1a\u5728\u6587\u6863\u4e2d\u8bf4\u660e\u51fd\u6570\u662f\u5426\u5bf9\u53d6\u6d88\u5b89\u5168\u4ee5\u53ca\u88ab\u53d6\u6d88\u540e\u4ecd\u4fdd\u6301\u7684\u4e0d\u53d8\u5f0f\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u6d41\u5904\u7406"}),"\uff1a\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"tokio_stream"}),"\uff08\u6216 ",(0,i.jsx)(n.code,{children:"futures::Stream"}),"\uff09\u5b9e\u73b0\u5f02\u6b65\u8fed\u4ee3\u5668\uff0c\u4ece\u800c\u663e\u5f0f\u5904\u7406\u80cc\u538b\uff08back-pressure\uff09\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u8d85\u65f6\u6a21\u5f0f"}),"\uff1a\u5bf9\u7f51\u7edc\u6216\u957f\u8017\u65f6\u7684 await \u4f7f\u7528\u8d85\u65f6\u5c01\u88c5\uff08",(0,i.jsx)(n.code,{children:"tokio::time::timeout"}),"\uff09\uff0c\u5e76\u4f20\u64ad\u6216\u5904\u7406\u8d85\u65f6\u9519\u8bef\u3002"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u5c5e\u6027attribute\u4f7f\u7528\u89c4\u8303",children:"\u5c5e\u6027\uff08attribute\uff09\u4f7f\u7528\u89c4\u8303"}),"\n",(0,i.jsx)(n.p,{children:"\u4e00\u81f4\u5730\u4f7f\u7528\u5c5e\u6027\u5e76\u4fdd\u6301\u56fa\u5b9a\u987a\u5e8f\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'#[repr(C)]\n#[derive(Clone, Copy, Debug, Hash, PartialEq, Eq, PartialOrd, Ord)]\n#[cfg_attr(\n    feature = "python",\n    pyo3::pyclass(module = "nautilus_trader.model")\n)]\npub struct Symbol(Ustr);\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u5bf9\u4e8e\u5e26\u5927\u91cf derive \u5c5e\u6027\u7684\u679a\u4e3e\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'#[repr(C)]\n#[derive(\n    Copy,\n    Clone,\n    Debug,\n    Display,\n    Hash,\n    PartialEq,\n    Eq,\n    PartialOrd,\n    Ord,\n    AsRefStr,\n    FromRepr,\n    EnumIter,\n    EnumString,\n)\n#[strum(ascii_case_insensitive)]\n#[strum(serialize_all = "SCREAMING_SNAKE_CASE")]\n#[cfg_attr(\n    feature = "python",\n    pyo3::pyclass(eq, eq_int, module = "nautilus_trader.model")\n)]\npub enum AccountType {\n    /// An account with unleveraged cash assets only.\n    Cash = 1,\n    /// An account which facilitates trading on margin, using account assets as collateral.\n    Margin = 2,\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u6784\u9020\u51fd\u6570\u6a21\u5f0f",children:"\u6784\u9020\u51fd\u6570\u6a21\u5f0f"}),"\n",(0,i.jsxs)(n.p,{children:["\u5728 ",(0,i.jsx)(n.code,{children:"new()"})," \u4e0e ",(0,i.jsx)(n.code,{children:"new_checked()"})," \u4e4b\u95f4\u4fdd\u7559\u4e00\u81f4\u7ea6\u5b9a\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"/// Creates a new [`Symbol`] instance with correctness checking.\n///\n/// # Errors\n///\n/// Returns an error if `value` is not a valid string.\n///\n/// # Notes\n///\n/// PyO3 requires a `Result` type for proper error handling and stacktrace printing in Python.\npub fn new_checked<T: AsRef<str>>(value: T) -> anyhow::Result<Self> {\n    // Implementation\n}\n\n/// Creates a new [`Symbol`] instance.\n///\n/// # Panics\n///\n/// Panics if `value` is not a valid string.\npub fn new<T: AsRef<str>>(value: T) -> Self {\n    Self::new_checked(value).expect(FAILED)\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u59cb\u7ec8\u5728\u4e0e\u6b63\u786e\u6027\u68c0\u67e5\u76f8\u5173\u7684 ",(0,i.jsx)(n.code,{children:".expect()"})," \u4fe1\u606f\u4e2d\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"FAILED"})," \u5e38\u91cf\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"use nautilus_core::correctness::FAILED;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u5e38\u91cf\u4e0e\u547d\u540d\u7ea6\u5b9a",children:"\u5e38\u91cf\u4e0e\u547d\u540d\u7ea6\u5b9a"}),"\n",(0,i.jsx)(n.p,{children:"\u5bf9\u63cf\u8ff0\u6027\u5e38\u91cf\u4f7f\u7528 SCREAMING_SNAKE_CASE\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"/// Number of nanoseconds in one second.\npub const NANOSECONDS_IN_SECOND: u64 = 1_000_000_000;\n\n/// Bar specification for 1-minute last price bars.\npub const BAR_SPEC_1_MINUTE_LAST: BarSpecification = BarSpecification {\n    step: NonZero::new(1).unwrap(),\n    aggregation: BarAggregation::Minute,\n    price_type: PriceType::Last,\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u54c8\u5e0c\u96c6\u5408hash-collections",children:"\u54c8\u5e0c\u96c6\u5408\uff08Hash collections\uff09"}),"\n",(0,i.jsxs)(n.p,{children:["\u4f18\u5148\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"ahash"})," crate \u63d0\u4f9b\u7684 ",(0,i.jsx)(n.code,{children:"AHashMap"})," \u548c ",(0,i.jsx)(n.code,{children:"AHashSet"}),"\uff0c\u66ff\u4ee3\u6807\u51c6\u5e93\u7684 ",(0,i.jsx)(n.code,{children:"HashMap"})," \u548c ",(0,i.jsx)(n.code,{children:"HashSet"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"use ahash::{AHashMap, AHashSet};\n\n// Preferred - using AHashMap/AHashSet\nlet mut symbols: AHashSet<Symbol> = AHashSet::new();\nlet mut prices: AHashMap<InstrumentId, Price> = AHashMap::new();\n\n// Instead of - standard library HashMap/HashSet\nuse std::collections::{HashMap, HashSet};\nlet mut symbols: HashSet<Symbol> = HashSet::new();\nlet mut prices: HashMap<InstrumentId, Price> = HashMap::new();\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["\u4e3a\u4ec0\u4e48\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"ahash"}),"\uff1f"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u66f4\u4f18\u7684\u6027\u80fd"}),"\uff1aAHash \u5728\u53ef\u7528\u65f6\u5229\u7528 AES-NI \u786c\u4ef6\u6307\u4ee4\uff0c\u76f8\u8f83\u9ed8\u8ba4\u7684 SipHash \u53ef\u63d0\u4f9b 2-3 \u500d\u7684\u54c8\u5e0c\u901f\u5ea6\u63d0\u5347\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u4f4e\u78b0\u649e\u7387"}),"\uff1a\u5c3d\u7ba1\u4e0d\u662f\u52a0\u5bc6\u54c8\u5e0c\uff0c\u4f46 AHash \u5728\u5178\u578b\u6570\u636e\u4e0b\u4ecd\u80fd\u63d0\u4f9b\u826f\u597d\u7684\u5206\u5e03\u4e0e\u8f83\u4f4e\u7684\u78b0\u649e\u6982\u7387\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u65e0\u7f1d\u66ff\u6362"}),"\uff1a\u4e0e\u6807\u51c6\u5e93\u96c6\u5408\u517c\u5bb9\u7684 API\uff0c\u4fbf\u4e8e\u76f4\u63a5\u66ff\u6362\u3002"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["\u4f55\u65f6\u4f7f\u7528\u6807\u51c6 ",(0,i.jsx)(n.code,{children:"HashMap"}),"/",(0,i.jsx)(n.code,{children:"HashSet"}),"\uff1a"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u9700\u8981\u52a0\u5bc6\u5b89\u5168"}),"\uff1a\u5f53\u54c8\u5e0c\u6cdb\u6ee5\u653b\u51fb\uff08hash flooding\uff09\u662f\u5173\u6ce8\u70b9\uff08\u4f8b\u5982\u5904\u7406\u6765\u81ea\u4e0d\u53d7\u4fe1\u4efb\u7528\u6237\u7684\u7f51\u7edc\u8f93\u5165\uff09\u65f6\uff0c\u8bf7\u4f7f\u7528\u6807\u51c6\u7684 ",(0,i.jsx)(n.code,{children:"HashMap"}),"\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u9762\u5411\u7f51\u7edc\u7684\u5ba2\u6237\u7aef"}),"\uff1a\u5bf9\u4e8e\u7f51\u7edc\u76f8\u5173\u7ec4\u4ef6\uff0c\u76ee\u524d\u66f4\u503e\u5411\u4e8e\u4f7f\u7528\u6807\u51c6\u5e93\u7684 ",(0,i.jsx)(n.code,{children:"HashMap"}),"\uff0c\u56e0\u4e3a\u5b89\u5168\u6027\u4f18\u5148\u4e8e\u6027\u80fd\u3002"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"re-export-\u7ea6\u5b9a",children:"Re-export \u7ea6\u5b9a"}),"\n",(0,i.jsxs)(n.p,{children:["\u6309\u5b57\u6bcd\u987a\u5e8f\u7ec4\u7ec7 re-export\uff0c\u5e76\u653e\u5728 ",(0,i.jsx)(n.code,{children:"lib.rs"})," \u6587\u4ef6\u672b\u5c3e\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"// Re-exports\npub use crate::{\n    nanos::UnixNanos,\n    time::AtomicTime,\n    uuid::UUID4,\n};\n\n// Module-level re-exports\npub use crate::identifiers::{\n    account_id::AccountId,\n    actor_id::ActorId,\n    client_id::ClientId,\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u6587\u6863\u6807\u51c6",children:"\u6587\u6863\u6807\u51c6"}),"\n",(0,i.jsx)(n.h4,{id:"\u6a21\u5757\u7ea7\u6587\u6863",children:"\u6a21\u5757\u7ea7\u6587\u6863"}),"\n",(0,i.jsx)(n.p,{children:"\u6240\u6709\u6a21\u5757\u5fc5\u987b\u6709\u6a21\u5757\u7ea7\u6587\u6863\uff0c\u5e76\u4ee5\u7b80\u77ed\u63cf\u8ff0\u5f00\u59cb\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"//! Functions for correctness checks similar to the *design by contract* philosophy.\n//!\n//! This module provides validation checking of function or method conditions.\n//!\n//! A condition is a predicate which must be true just prior to the execution of\n//! some section of code - for correct behavior as per the design specification.\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5bf9\u4e8e\u5e26\u6709\u7279\u6027\u5f00\u5173\u7684\u6a21\u5757\uff0c\u8981\u6e05\u6670\u5730\u8bb0\u5f55\u8fd9\u4e9b\u7279\u6027\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"//! # Feature flags\n//!\n//! This crate provides feature flags to control source code inclusion during compilation,\n//! depending on the intended use case:\n//!\n//! - `ffi`: Enables the C foreign function interface (FFI) from [cbindgen](https://github.com/mozilla/cbindgen).\n//! - `python`: Enables Python bindings from [PyO3](https://pyo3.rs).\n//! - `extension-module`: Builds as a Python extension module (used with `python`).\n//! - `stubs`: Enables type stubs for use in testing scenarios.\n"})}),"\n",(0,i.jsx)(n.h4,{id:"\u5b57\u6bb5\u6587\u6863",children:"\u5b57\u6bb5\u6587\u6863"}),"\n",(0,i.jsx)(n.p,{children:"\u6240\u6709\u7ed3\u6784\u4f53\u548c\u679a\u4e3e\u5b57\u6bb5\u5fc5\u987b\u6709\u4ee5\u53e5\u53f7\u7ed3\u5c3e\u7684\u6587\u6863\u6ce8\u91ca\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'pub struct Currency {\n    /// The currency code as an alpha-3 string (e.g., "USD", "EUR").\n    pub code: Ustr,\n    /// The currency decimal precision.\n    pub precision: u8,\n    /// The ISO 4217 currency code.\n    pub iso4217: u16,\n    /// The full name of the currency.\n    pub name: Ustr,\n    /// The currency type, indicating its category (e.g. Fiat, Crypto).\n    pub currency_type: CurrencyType,\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"\u51fd\u6570\u6587\u6863",children:"\u51fd\u6570\u6587\u6863"}),"\n",(0,i.jsx)(n.p,{children:"\u5bf9\u6240\u6709\u516c\u5171\u51fd\u6570\u8bf7\u8bb0\u5f55\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u76ee\u7684\u4e0e\u884c\u4e3a"}),"\n",(0,i.jsx)(n.li,{children:"\u53c2\u6570\u7684\u4f7f\u7528\u8bf4\u660e"}),"\n",(0,i.jsx)(n.li,{children:"\u53ef\u80fd\u51fa\u73b0\u7684\u9519\u8bef\u6761\u4ef6\uff08\u5982\u9002\u7528\uff09"}),"\n",(0,i.jsx)(n.li,{children:"\u53ef\u80fd\u89e6\u53d1\u7684 panic \u6761\u4ef6\uff08\u5982\u9002\u7528\uff09"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"/// Returns a reference to the `AccountBalance` for the specified currency, or `None` if absent.\n///\n/// # Panics\n///\n/// Panics if `currency` is `None` and `self.base_currency` is `None`.\npub fn base_balance(&self, currency: Option<Currency>) -> Option<&AccountBalance> {\n    // Implementation\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"\u9519\u8bef\u4e0e-panic-\u7684\u6587\u6863\u683c\u5f0f",children:"\u9519\u8bef\u4e0e panic \u7684\u6587\u6863\u683c\u5f0f"}),"\n",(0,i.jsx)(n.p,{children:"\u9488\u5bf9\u5355\u884c\u9519\u8bef\u4e0e panic \u7684\u6587\u6863\uff0c\u4f7f\u7528\u53e5\u5b50\u5f0f\u5927\u5c0f\u5199\u5e76\u9075\u5faa\u4e0b\u5217\u7ea6\u5b9a\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"/// Returns a reference to the `AccountBalance` for the specified currency, or `None` if absent.\n///\n/// # Errors\n///\n/// Returns an error if the currency conversion fails.\n///\n/// # Panics\n///\n/// Panics if `currency` is `None` and `self.base_currency` is `None`.\npub fn base_balance(&self, currency: Option<Currency>) -> anyhow::Result<Option<&AccountBalance>> {\n    // Implementation\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5bf9\u4e8e\u591a\u884c\u7684\u9519\u8bef\u4e0e panic \u6587\u6863\uff0c\u4f7f\u7528\u53e5\u5b50\u5f0f\u5927\u5c0f\u5199\uff0c\u5e76\u4ee5\u8981\u70b9\u5f62\u5f0f\u5217\u51fa\u6bcf\u9879\uff0c\u53e5\u5c3e\u4ee5\u53e5\u53f7\u7ed3\u675f\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"/// Calculates the unrealized profit and loss for the position.\n///\n/// # Errors\n///\n/// Returns an error if:\n/// - The market price for the instrument cannot be found.\n/// - The conversion rate calculation fails.\n/// - Invalid position state is encountered.\n///\n/// # Panics\n///\n/// This function panics if:\n/// - The instrument ID is invalid or uninitialized.\n/// - Required market data is missing from the cache.\n/// - Internal state consistency checks fail.\npub fn calculate_unrealized_pnl(&self, market_price: Price) -> anyhow::Result<Money> {\n    // Implementation\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"\u5b89\u5168safety\u6587\u6863\u683c\u5f0f",children:"\u5b89\u5168\uff08Safety\uff09\u6587\u6863\u683c\u5f0f"}),"\n",(0,i.jsxs)(n.p,{children:["\u5bf9\u4e8e Safety \u6587\u6863\uff0c\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"SAFETY:"})," \u524d\u7f00\uff0c\u7b80\u8981\u8bf4\u660e\u4e3a\u4f55\u8be5 unsafe \u64cd\u4f5c\u662f\u5b89\u5168\u7684\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"/// Creates a new instance from raw components without validation.\n///\n/// # Safety\n///\n/// The caller must ensure that all input parameters are valid and properly initialized.\npub unsafe fn from_raw_parts(ptr: *const u8, len: usize) -> Self {\n    // SAFETY: Caller guarantees ptr is valid and len is correct\n    Self {\n        data: std::slice::from_raw_parts(ptr, len),\n    }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u5bf9\u4e8e\u5185\u8054\u7684 unsafe \u5757\uff0c\u5728 unsafe \u4ee3\u7801\u4e0a\u65b9\u76f4\u63a5\u6dfb\u52a0 ",(0,i.jsx)(n.code,{children:"SAFETY:"})," \u6ce8\u91ca\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"impl Send for MessageBus {\n    fn send(&self) {\n        // SAFETY: Message bus is not meant to be passed between threads\n        unsafe {\n            // unsafe operation here\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"python-\u7ed1\u5b9a",children:"Python \u7ed1\u5b9a"}),"\n",(0,i.jsxs)(n.p,{children:["\u901a\u8fc7 Cython \u548c ",(0,i.jsx)(n.a,{href:"https://pyo3.rs",children:"PyO3"})," \u63d0\u4f9b Python \u7ed1\u5b9a\uff0c\u4f7f\u7528\u6237\u65e0\u9700 Rust \u5de5\u5177\u94fe\u5373\u53ef\u5728 Python \u4e2d\u76f4\u63a5\u5bfc\u5165 NautilusTrader \u7684 crate\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"pyo3-\u547d\u540d\u7ea6\u5b9a",children:"PyO3 \u547d\u540d\u7ea6\u5b9a"}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u901a\u8fc7 PyO3 \u5411 Python \u66b4\u9732 Rust \u51fd\u6570\u65f6\uff1a"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Rust \u7b26\u53f7\u5728\u4ee3\u7801\u5e93\u5185\u90e8\u5e94\u4ee5 ",(0,i.jsx)(n.code,{children:"py_*"})," \u4e3a\u524d\u7f00\u4ee5\u660e\u786e\u5176\u7528\u9014\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:["\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:'#[pyo3(name = "\u2026")]'})," \u5c5e\u6027\u5728 Python \u5c42\u516c\u5f00\u540d\u79f0\uff08\u4e0d\u5e26 ",(0,i.jsx)(n.code,{children:"py_"})," \u524d\u7f00\uff09\uff0c\u4ee5\u4fdd\u6301 Python API \u7684\u7b80\u6d01\u3002"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'#[pyo3(name = "do_something")]\npub fn py_do_something() -> PyResult<()> {\n    // \u2026\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u6d4b\u8bd5\u7ea6\u5b9a",children:"\u6d4b\u8bd5\u7ea6\u5b9a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"mod tests"})," \u4f5c\u4e3a\u6807\u51c6\u6d4b\u8bd5\u6a21\u5757\u540d\uff0c\u9664\u975e\u9700\u8981\u7279\u6b8a\u5212\u5206\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:["\u4e00\u81f4\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"#[rstest]"})," \u5c5e\u6027\uff0c\u964d\u4f4e\u8ba4\u77e5\u5f00\u9500\u3002"]}),"\n",(0,i.jsx)(n.li,{children:"\u4e0d\u8981\u5728 Rust \u6d4b\u8bd5\u4e2d\u4f7f\u7528 Arrange\u3001Act\u3001Assert \u5206\u9694\u6ce8\u91ca\u3002"}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"\u6d4b\u8bd5\u7ec4\u7ec7",children:"\u6d4b\u8bd5\u7ec4\u7ec7"}),"\n",(0,i.jsx)(n.p,{children:"\u4f7f\u7528\u5e26\u8282\u5206\u9694\u7b26\u7684\u4e00\u81f4\u6d4b\u8bd5\u6a21\u5757\u7ed3\u6784\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'////////////////////////////////////////////////////////////////////////////////\n// Tests\n////////////////////////////////////////////////////////////////////////////////\n\n#[cfg(test)]\nmod tests {\n    use rstest::rstest;\n    use super::*;\n    use crate::identifiers::{Symbol, stubs::*};\n\n    #[rstest]\n    fn test_string_reprs(symbol_eth_perp: Symbol) {\n        assert_eq!(symbol_eth_perp.as_str(), "ETH-PERP");\n        assert_eq!(format!("{symbol_eth_perp}"), "ETH-PERP");\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"\u53c2\u6570\u5316\u6d4b\u8bd5",children:"\u53c2\u6570\u5316\u6d4b\u8bd5"}),"\n",(0,i.jsxs)(n.p,{children:["\u5bf9\u53c2\u6570\u5316\u6d4b\u8bd5\u4e00\u81f4\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"rstest"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'#[rstest]\n#[case("AUDUSD", false)]\n#[case("AUD/USD", false)]\n#[case("CL.FUT", true)]\nfn test_symbol_is_composite(#[case] input: &str, #[case] expected: bool) {\n    let symbol = Symbol::new(input);\n    assert_eq!(symbol.is_composite(), expected);\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"\u6d4b\u8bd5\u547d\u540d",children:"\u6d4b\u8bd5\u547d\u540d"}),"\n",(0,i.jsx)(n.p,{children:"\u4f7f\u7528\u80fd\u8bf4\u660e\u573a\u666f\u7684\u63cf\u8ff0\u6027\u6d4b\u8bd5\u540d\u79f0\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"fn test_sma_with_no_inputs()\nfn test_sma_with_single_input()\nfn test_symbol_is_composite()\n"})}),"\n",(0,i.jsx)(n.h2,{id:"rust-\u4e0e-python-\u5185\u5b58\u7ba1\u7406",children:"Rust \u4e0e Python \u5185\u5b58\u7ba1\u7406"}),"\n",(0,i.jsxs)(n.p,{children:["\u5728\u5904\u7406 PyO3 \u7ed1\u5b9a\u65f6\uff0c\u5fc5\u987b\u7406\u89e3\u5e76\u907f\u514d Rust \u7684 ",(0,i.jsx)(n.code,{children:"Arc"})," \u5f15\u7528\u8ba1\u6570\u4e0e Python \u5783\u573e\u56de\u6536\u5668\u4e4b\u95f4\u4ea7\u751f\u7684\u5f15\u7528\u73af\u3002\n\u672c\u8282\u8bb0\u5f55\u4e86\u5728\u6301\u6709\u56de\u8c03\u7684\u7ed3\u6784\u4f53\u4e2d\u5904\u7406 Python \u5bf9\u8c61\u7684\u6700\u4f73\u5b9e\u8df5\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"\u5f15\u7528\u73af\u95ee\u9898",children:"\u5f15\u7528\u73af\u95ee\u9898"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u95ee\u9898"}),"\uff1a\u5728\u6301\u6709\u56de\u8c03\u7684\u7ed3\u6784\u4f53\u4e2d\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"Arc<PyObject>"})," \u4f1a\u4ea7\u751f\u5faa\u73af\u5f15\u7528\uff1a"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Rust \u7684 ",(0,i.jsx)(n.code,{children:"Arc"})," \u6301\u6709 Python \u5bf9\u8c61"]})," \u2192 \u589e\u52a0 Python \u7684\u5f15\u7528\u8ba1\u6570\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Python \u5bf9\u8c61\u53ef\u80fd\u5f15\u7528 Rust \u5bf9\u8c61"})," \u2192 \u5f62\u6210\u5faa\u73af\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u4e24\u7aef\u90fd\u65e0\u6cd5\u88ab\u56de\u6536"})," \u2192 \u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u95ee\u9898\u6a21\u5f0f\u793a\u4f8b"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"// AVOID: This creates reference cycles\nstruct CallbackHolder {\n    handler: Option<Arc<PyObject>>,  // \u274c Arc wrapper causes cycles\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u89e3\u51b3\u65b9\u6848\u57fa\u4e8e-gil-\u7684\u514b\u9686gil-based-cloning",children:"\u89e3\u51b3\u65b9\u6848\uff1a\u57fa\u4e8e GIL \u7684\u514b\u9686\uff08GIL-based cloning\uff09"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u89e3\u51b3\u601d\u8def"}),"\uff1a\u4f7f\u7528\u666e\u901a\u7684 ",(0,i.jsx)(n.code,{children:"PyObject"})," \u5e76\u901a\u8fc7 ",(0,i.jsx)(n.code,{children:"clone_py_object()"})," \u5728\u83b7\u53d6 GIL \u7684\u4e0a\u4e0b\u6587\u4e2d\u5b89\u5168\u514b\u9686\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"use nautilus_core::python::clone_py_object;\n\n// CORRECT: Use plain PyObject without Arc wrapper\nstruct CallbackHolder {\n    handler: Option<PyObject>,  // \u2705 No Arc wrapper\n}\n\n// Manual Clone implementation using clone_py_object\nimpl Clone for CallbackHolder {\n    fn clone(&self) -> Self {\n        Self {\n            handler: self.handler.as_ref().map(clone_py_object),\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,i.jsxs)(n.h4,{id:"1-\u4f7f\u7528-clone_py_object-\u8fdb\u884c-python-\u5bf9\u8c61\u514b\u9686",children:["1. \u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"clone_py_object()"})," \u8fdb\u884c Python \u5bf9\u8c61\u514b\u9686"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"// When cloning Python callbacks\nlet cloned_callback = clone_py_object(&original_callback);\n\n// In manual Clone implementations\nself.py_handler.as_ref().map(clone_py_object)\n"})}),"\n",(0,i.jsxs)(n.h4,{id:"2-\u4ece\u6301\u6709\u56de\u8c03\u7684\u7ed3\u6784\u4f53\u79fb\u9664-deriveclone",children:["2. \u4ece\u6301\u6709\u56de\u8c03\u7684\u7ed3\u6784\u4f53\u79fb\u9664 ",(0,i.jsx)(n.code,{children:"#[derive(Clone)]"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"// BEFORE: Automatic derive causes issues with PyObject\n#[derive(Clone)]  // \u274c Remove this\nstruct Config {\n    handler: Option<PyObject>,\n}\n\n// AFTER: Manual implementation with proper cloning\nstruct Config {\n    handler: Option<PyObject>,\n}\n\nimpl Clone for Config {\n    fn clone(&self) -> Self {\n        Self {\n            // Clone regular fields normally\n            url: self.url.clone(),\n            // Use clone_py_object for Python objects\n            handler: self.handler.as_ref().map(clone_py_object),\n        }\n    }\n}\n"})}),"\n",(0,i.jsxs)(n.h4,{id:"3-\u66f4\u65b0\u51fd\u6570\u7b7e\u540d\u4ee5\u63a5\u53d7-pyobject",children:["3. \u66f4\u65b0\u51fd\u6570\u7b7e\u540d\u4ee5\u63a5\u53d7 ",(0,i.jsx)(n.code,{children:"PyObject"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"// BEFORE: Arc wrapper in function signatures\nfn spawn_task(handler: Arc<PyObject>) { ... }  // \u274c\n\n// AFTER: Plain PyObject\nfn spawn_task(handler: PyObject) { ... }  // \u2705\n"})}),"\n",(0,i.jsxs)(n.h4,{id:"4-\u521b\u5efa-python-\u56de\u8c03\u65f6\u907f\u514d\u4f7f\u7528-arcnew",children:["4. \u521b\u5efa Python \u56de\u8c03\u65f6\u907f\u514d\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"Arc::new()"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"// BEFORE: Wrapping in Arc\nlet callback = Arc::new(py_function);  // \u274c\n\n// AFTER: Use directly\nlet callback = py_function;  // \u2705\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u4e3a\u4ec0\u4e48\u8fd9\u6837\u53ef\u884c",children:"\u4e3a\u4ec0\u4e48\u8fd9\u6837\u53ef\u884c"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"clone_py_object()"})," \u7684\u5b9e\u73b0\u8981\u70b9\uff1a"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u5728\u514b\u9686\u64cd\u4f5c\u524d\u83b7\u53d6 Python GIL"}),"\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u4f7f\u7528 Python \u7684\u672c\u5730\u5f15\u7528\u8ba1\u6570"}),"\uff08\u4f8b\u5982 ",(0,i.jsx)(n.code,{children:"clone_ref()"}),"\uff09\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u907f\u514d\u4f7f\u7528 Rust \u7684 Arc \u5305\u88c5"}),"\uff0c\u4ece\u800c\u4e0d\u5e72\u6270 Python \u7684 GC\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u901a\u8fc7\u6b63\u786e\u7684 GIL \u7ba1\u7406\u4fdd\u6301\u7ebf\u7a0b\u5b89\u5168"}),"\u3002"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u79cd\u65b9\u6cd5\u5141\u8bb8 Rust \u4e0e Python \u7684\u5783\u573e\u56de\u6536\u673a\u5236\u534f\u540c\u5de5\u4f5c\uff0c\u907f\u514d\u56e0\u5f15\u7528\u73af\u5bfc\u81f4\u7684\u5185\u5b58\u6cc4\u6f0f\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u5e38\u89c1\u53cd\u6a21\u5f0f",children:"\u5e38\u89c1\u53cd\u6a21\u5f0f"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["\u5728\u70ed\u70b9\u8def\u5f84\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:".clone()"})]}),"\u2014\u2014\u5e94\u4f18\u5148\u8003\u8651\u501f\u7528\u6216\u901a\u8fc7 ",(0,i.jsx)(n.code,{children:"Arc"})," \u5171\u4eab\u6240\u6709\u6743\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["\u5728\u751f\u4ea7\u4ee3\u7801\u4e2d\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:".unwrap()"})]}),"\u2014\u2014\u901a\u5e38\u5e94\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"?"})," \u4f20\u64ad\u9519\u8bef\u6216\u5c06\u5176\u6620\u5c04\u4e3a\u9886\u57df\u9519\u8bef\uff0c\u4f46\u5bf9\u9501\u4e2d\u6bd2\uff08lock poisoning\uff09\u8fdb\u884c unwrap \u662f\u53ef\u63a5\u53d7\u7684\uff0c\u56e0\u4e3a\u8fd9\u901a\u5e38\u8868\u660e\u5e94\u5f53\u5feb\u901f\u4e2d\u6b62\u7684\u4e25\u91cd\u7a0b\u5e8f\u72b6\u6001\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["\u5728\u80fd\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"&str"})," \u7684\u5730\u65b9\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"String"})]}),"\u2014\u2014\u5728\u7d27\u5faa\u73af\u4e2d\u5c3d\u91cf\u51cf\u5c11\u5206\u914d\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u66b4\u9732\u5185\u90e8\u53ef\u53d8\u6027\uff08interior mutability\uff09"}),"\u2014\u2014\u5c3d\u91cf\u901a\u8fc7\u5b89\u5168 API \u9690\u85cf ",(0,i.jsx)(n.code,{children:"Mutex"}),"/",(0,i.jsx)(n.code,{children:"RefCell"}),"\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["\u5728 ",(0,i.jsx)(n.code,{children:"Result<T, E>"})," \u4e2d\u653e\u5165\u5927\u578b\u7ed3\u6784\u4f53"]}),"\u2014\u2014\u5bf9\u5927\u578b\u9519\u8bef\u8f7d\u8377\u4f7f\u7528 boxing\uff08",(0,i.jsx)(n.code,{children:"Box<dyn Error + Send + Sync>"}),"\uff09\u3002"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u4e0d\u5b89\u5168\u7684-rustunsafe-rust",children:"\u4e0d\u5b89\u5168\u7684 Rust\uff08Unsafe Rust\uff09"}),"\n",(0,i.jsxs)(n.p,{children:["\u4e3a\u4e86\u5728 Cython \u4e0e Rust \u4e4b\u95f4\u5b9e\u73b0\u4e92\u64cd\u4f5c\uff0c\u7f16\u5199 ",(0,i.jsx)(n.code,{children:"unsafe"})," Rust \u4ee3\u7801\u662f\u5fc5\u8981\u7684\u3002\u8df3\u51fa\u5b89\u5168 Rust \u7684\u8fb9\u754c\u4f7f\u6211\u4eec\u80fd\u5b9e\u73b0\u8bb8\u591a Rust \u8bed\u8a00\u81ea\u8eab\u7684\u5e95\u5c42\u7279\u6027\uff0c\u6b63\u5982 C \u548c C++ \u7528\u4e8e\u5b9e\u73b0\u5b83\u4eec\u81ea\u5df1\u7684\u6807\u51c6\u5e93\u4e00\u6837\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u5728\u4f7f\u7528 Rust \u7684 ",(0,i.jsx)(n.code,{children:"unsafe"})," \u529f\u80fd\u65f6\u52a1\u5fc5\u975e\u5e38\u8c28\u614e\u2014\u2014",(0,i.jsx)(n.code,{children:"unsafe"})," \u53ea\u662f\u542f\u7528\u4e00\u5c0f\u90e8\u5206\u989d\u5916\u7684\u8bed\u8a00\u80fd\u529b\uff0c\u5b83\u6539\u53d8\u4e86\u63a5\u53e3\u4e0e\u8c03\u7528\u8005\u4e4b\u95f4\u7684\u5951\u7ea6\uff0c\u5c06\u90e8\u5206\u6b63\u786e\u6027\u4fdd\u8bc1\u7684\u8d23\u4efb\u4ece\u7f16\u8bd1\u5668\u8f6c\u79fb\u7ed9\u6211\u4eec\u3002\u76ee\u6807\u662f\u5728\u5229\u7528 ",(0,i.jsx)(n.code,{children:"unsafe"})," \u5e26\u6765\u80fd\u529b\u7684\u540c\u65f6\uff0c\u907f\u514d\u4efb\u4f55\u672a\u5b9a\u4e49\u884c\u4e3a\uff08undefined behavior\uff09\u3002\n\u5173\u4e8e Rust \u8bed\u8a00\u8bbe\u8ba1\u8005\u5bf9\u672a\u5b9a\u4e49\u884c\u4e3a\u7684\u5b9a\u4e49\uff0c\u8bf7\u53c2\u89c1",(0,i.jsx)(n.a,{href:"https://doc.rust-lang.org/stable/reference/behavior-considered-undefined.html",children:"\u8bed\u8a00\u53c2\u8003"}),"\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"\u5b89\u5168\u7b56\u7565",children:"\u5b89\u5168\u7b56\u7565"}),"\n",(0,i.jsxs)(n.p,{children:["\u4e3a\u4fdd\u6301\u6b63\u786e\u6027\uff0c\u4efb\u4f55\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"unsafe"})," \u7684\u4ee3\u7801\u90fd\u5fc5\u987b\u9075\u5faa\u6211\u4eec\u7684\u7b56\u7565\uff1a"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u5982\u679c\u4e00\u4e2a\u51fd\u6570\u5728\u8c03\u7528\u4e0a\u662f ",(0,i.jsx)(n.code,{children:"unsafe"})," \u7684\uff0c\u6587\u6863\u4e2d",(0,i.jsx)(n.strong,{children:"\u5fc5\u987b"}),"\u5305\u542b ",(0,i.jsx)(n.code,{children:"Safety"})," \u5c0f\u8282\uff0c\u89e3\u91ca\u4e3a\u4f55\u8be5\u51fd\u6570\u4e3a ",(0,i.jsx)(n.code,{children:"unsafe"}),"\uff0c\u5e76\u8bf4\u660e\u8c03\u7528\u8005\u9700\u8981\u6ee1\u8db3\u7684\u5404\u9879\u4e0d\u53d8\u5f0f\u4ee5\u53ca\u5982\u4f55\u5c65\u884c\u8fd9\u4e9b\u4e49\u52a1\u3002\n\u5e76\u8986\u76d6\u6240\u6709 ",(0,i.jsx)(n.code,{children:"unsafe"})," \u533a\u5757\u7684\u5355\u5143\u6d4b\u8bd5\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5728\u6587\u6863\u6ce8\u91ca\u7684 Safety \u5c0f\u8282\u4e2d\u8bf4\u660e\u4e3a\u4f55\u51fd\u6570\u4e3a ",(0,i.jsx)(n.code,{children:"unsafe"}),"\uff0c\u5e76\u4e3a\u6240\u6709 ",(0,i.jsx)(n.code,{children:"unsafe"})," \u5757\u63d0\u4f9b\u5355\u5143\u6d4b\u8bd5\u8986\u76d6\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:["\u59cb\u7ec8\u5305\u542b ",(0,i.jsx)(n.code,{children:"SAFETY:"})," \u6ce8\u91ca\u8bf4\u660e\u4e3a\u4f55\u8be5 unsafe \u64cd\u4f5c\u662f\u6709\u6548\u7684\uff1a"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"// SAFETY: Message bus is not meant to be passed between threads\n#[allow(unsafe_code)]\n\nunsafe impl Send for MessageBus {}\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Crate \u7ea7 lint"})," \u2014\u2014\u6bcf\u4e2a\u5bfc\u51fa FFI \u7b26\u53f7\u7684 crate \u90fd\u5e94\u542f\u7528\n",(0,i.jsx)(n.code,{children:"#![deny(unsafe_op_in_unsafe_fn)]"}),"\u3002\u5373\u4fbf\u4f4d\u4e8e ",(0,i.jsx)(n.code,{children:"unsafe fn"})," \u5185\u90e8\uff0c\u6bcf\u6b21\u6307\u9488\u89e3\u9664\u5f15\u7528\u6216\u5176\u4ed6\u5371\u9669\u64cd\u4f5c\u4e5f\u5fc5\u987b\u7528\u72ec\u7acb\u7684 ",(0,i.jsx)(n.code,{children:"unsafe { \u2026 }"})," \u5305\u88f9\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"CVec \u5408\u7ea6"})," \u2014\u2014\u5bf9\u4e8e\u8de8 FFI \u8fb9\u754c\u7684\u539f\u59cb\u5411\u91cf\uff0c\u8bf7\u9605\u8bfb ",(0,i.jsx)(n.a,{href:"/developer_guide/ffi",children:"FFI Memory Contract"}),"\u3002\u5916\u90e8\u4ee3\u7801\u4f1a\u6210\u4e3a\u8be5\u5206\u914d\u7684\u6240\u6709\u8005\uff0c",(0,i.jsx)(n.strong,{children:"\u5fc5\u987b"}),"\u6070\u597d\u8c03\u7528\u4e00\u6b21\u5bf9\u5e94\u7684 ",(0,i.jsx)(n.code,{children:"vec_drop_*"})," \u51fd\u6570\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u5de5\u5177\u94fe\u914d\u7f6e",children:"\u5de5\u5177\u94fe\u914d\u7f6e"}),"\n",(0,i.jsx)(n.p,{children:"\u9879\u76ee\u4f7f\u7528\u82e5\u5e72\u5de5\u5177\u6765\u4fdd\u8bc1\u4ee3\u7801\u8d28\u91cf\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"rustfmt"}),"\uff1a\u81ea\u52a8\u4ee3\u7801\u683c\u5f0f\u5316\uff08\u53c2\u89c1 ",(0,i.jsx)(n.code,{children:"rustfmt.toml"}),"\uff09\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"clippy"}),"\uff1a\u4ee3\u7801 lint \u4e0e\u6700\u4f73\u5b9e\u8df5\uff08\u53c2\u89c1 ",(0,i.jsx)(n.code,{children:"clippy.toml"}),"\uff09\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"cbindgen"}),"\uff1a\u4e3a FFI \u751f\u6210 C \u5934\u6587\u4ef6\u3002"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u53c2\u8003\u8d44\u6599",children:"\u53c2\u8003\u8d44\u6599"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://doc.rust-lang.org/nomicon/",children:"The Rustonomicon"})," \u2013 The Dark Arts of Unsafe Rust."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://doc.rust-lang.org/stable/reference/unsafety.html",children:"The Rust Reference \u2013 Unsafety"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://www.abubalay.com/blog/2020/08/22/safe-bindings-in-rust",children:"Safe Bindings in Rust \u2013 Russell Johnston"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://www.chromium.org/Home/chromium-security/memory-safety/rust-and-c-interoperability/",children:"Google \u2013 Rust and C interoperability"}),"."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},9087:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>d});var r=s(6363);const i={},l=r.createContext(i);function c(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);