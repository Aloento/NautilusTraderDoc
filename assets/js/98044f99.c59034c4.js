"use strict";(globalThis.webpackChunknautilus_trader=globalThis.webpackChunknautilus_trader||[]).push([[8500],{7286:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>g,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"concepts/logging","title":"Logging","description":"The platform provides logging for both backtesting and live trading using a high-performance logging subsystem implemented in Rust","source":"@site/docs/concepts/logging.md","sourceDirName":"concepts","slug":"/concepts/logging","permalink":"/concepts/logging","draft":false,"unlisted":false,"editUrl":"https://github.com/Aloento/NautilusTraderDoc/tree/main/docs/concepts/logging.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Live Trading","permalink":"/concepts/live"},"next":{"title":"Message Bus","permalink":"/concepts/message_bus"}}');var o=i(7259),l=i(9087);const r={},t="Logging",d={},c=[{value:"Configuration",id:"configuration",level:2},{value:"Standard output logging",id:"standard-output-logging",level:3},{value:"File logging",id:"file-logging",level:3},{value:"Log file rotation",id:"log-file-rotation",level:4},{value:"Log file naming convention",id:"log-file-naming-convention",level:4},{value:"Component log filtering",id:"component-log-filtering",level:3},{value:"Components-only logging",id:"components-only-logging",level:3},{value:"Log Colors",id:"log-colors",level:3},{value:"Using a logger directly",id:"using-a-logger-directly",level:2},{value:"LogGuard: managing log lifecycle",id:"logguard-managing-log-lifecycle",level:2},{value:"Reference Counting Implementation",id:"reference-counting-implementation",level:3},{value:"Why use LogGuard?",id:"why-use-logguard",level:3},{value:"Running multiple engines",id:"running-multiple-engines",level:2},{value:"Steps",id:"steps",level:3},{value:"Considerations",id:"considerations",level:3},{value:"Platform-specific considerations",id:"platform-specific-considerations",level:2},{value:"Windows shutdown behavior",id:"windows-shutdown-behavior",level:3}];function a(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"logging",children:"Logging"})}),"\n",(0,o.jsxs)(n.p,{children:["The platform provides logging for both backtesting and live trading using a high-performance logging subsystem implemented in Rust\nwith a standardized facade from the ",(0,o.jsx)(n.code,{children:"log"})," crate."]}),"\n",(0,o.jsx)(n.p,{children:"The core logger operates in a separate thread and uses a multi-producer single-consumer (MPSC) channel to receive log messages.\nThis design ensures that the main thread remains performant, avoiding potential bottlenecks caused by log string formatting or file I/O operations."}),"\n",(0,o.jsx)(n.p,{children:"Logging output is configurable and supports:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"stdout/stderr writer"})," for console output"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"file writer"})," for persistent storage of logs"]}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["Infrastructure such as ",(0,o.jsx)(n.a,{href:"https://github.com/vectordotdev/vector",children:"Vector"})," can be integrated to collect and aggregate events within your system."]})}),"\n",(0,o.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,o.jsxs)(n.p,{children:["Logging can be configured by importing the ",(0,o.jsx)(n.code,{children:"LoggingConfig"})," object.\nBy default, log events with an 'INFO' ",(0,o.jsx)(n.code,{children:"LogLevel"})," and higher are written to stdout/stderr."]}),"\n",(0,o.jsxs)(n.p,{children:["Log level (",(0,o.jsx)(n.code,{children:"LogLevel"}),") values include (and generally match Rust's ",(0,o.jsx)(n.code,{children:"tracing"})," level filters)."]}),"\n",(0,o.jsx)(n.p,{children:"Python loggers expose the following levels:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"OFF"})}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"TRACE"})," (can be set as a filter level, but not directly generated from Python)"]}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"DEBUG"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"INFO"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"WARNING"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"ERROR"})}),"\n"]}),"\n",(0,o.jsxs)(n.admonition,{type:"warning",children:[(0,o.jsxs)(n.p,{children:["The Python ",(0,o.jsx)(n.code,{children:"Logger"})," does not provide a ",(0,o.jsx)(n.code,{children:"trace()"})," method; ",(0,o.jsx)(n.code,{children:"TRACE"})," level logs are only emitted by the underlying Rust components and cannot be generated directly from Python code. However, you can set ",(0,o.jsx)(n.code,{children:"TRACE"})," as a logging level filter to see trace logs from Rust components."]}),(0,o.jsxs)(n.p,{children:["See the ",(0,o.jsx)(n.code,{children:"LoggingConfig"})," ",(0,o.jsx)(n.a,{href:"/api_reference/config#class-loggingconfig",children:"API Reference"})," for further details."]})]}),"\n",(0,o.jsx)(n.p,{children:"Logging can be configured in the following ways:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Minimum ",(0,o.jsx)(n.code,{children:"LogLevel"})," for stdout/stderr."]}),"\n",(0,o.jsxs)(n.li,{children:["Minimum ",(0,o.jsx)(n.code,{children:"LogLevel"})," for log files."]}),"\n",(0,o.jsx)(n.li,{children:"Maximum size before rotating a log file."}),"\n",(0,o.jsx)(n.li,{children:"Maximum number of backup log files to maintain when rotating."}),"\n",(0,o.jsx)(n.li,{children:"Automatic log file naming with date or timestamp components, or custom log file name."}),"\n",(0,o.jsx)(n.li,{children:"Directory for writing log files."}),"\n",(0,o.jsx)(n.li,{children:"Plain text or JSON log file formatting."}),"\n",(0,o.jsx)(n.li,{children:"Filtering of individual components by log level."}),"\n",(0,o.jsx)(n.li,{children:"ANSI colors in log lines."}),"\n",(0,o.jsx)(n.li,{children:"Bypass logging entirely."}),"\n",(0,o.jsx)(n.li,{children:"Print Rust config to stdout at initialization."}),"\n",(0,o.jsxs)(n.li,{children:["Optionally initialize logging via the PyO3 bridge (",(0,o.jsx)(n.code,{children:"use_pyo3"}),") to capture log events emitted by Rust components."]}),"\n",(0,o.jsxs)(n.li,{children:["Truncate existing log file on startup if it already exists (",(0,o.jsx)(n.code,{children:"clear_log_file"}),")"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"standard-output-logging",children:"Standard output logging"}),"\n",(0,o.jsxs)(n.p,{children:["Log messages are written to the console via stdout/stderr writers. The minimum log level can be configured using the ",(0,o.jsx)(n.code,{children:"log_level"})," parameter."]}),"\n",(0,o.jsx)(n.h3,{id:"file-logging",children:"File logging"}),"\n",(0,o.jsx)(n.p,{children:"Log files are written to the current working directory by default. The naming convention and rotation behavior are configurable and follow specific patterns based on your settings."}),"\n",(0,o.jsxs)(n.p,{children:["You can specify a custom log directory using ",(0,o.jsx)(n.code,{children:"log_directory"})," and/or a custom file basename using ",(0,o.jsx)(n.code,{children:"log_file_name"}),". Log files are always suffixed with ",(0,o.jsx)(n.code,{children:".log"})," (plain text) or ",(0,o.jsx)(n.code,{children:".json"})," (JSON)."]}),"\n",(0,o.jsxs)(n.p,{children:["For detailed information about log file naming conventions and rotation behavior, see the ",(0,o.jsx)(n.a,{href:"#log-file-rotation",children:"Log file rotation"})," and ",(0,o.jsx)(n.a,{href:"#log-file-naming-convention",children:"Log file naming convention"})," sections below."]}),"\n",(0,o.jsx)(n.h4,{id:"log-file-rotation",children:"Log file rotation"}),"\n",(0,o.jsx)(n.p,{children:"Rotation behavior depends on both the presence of a size limit and whether a custom file name is provided:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Size-based rotation"}),":","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Enabled by specifying the ",(0,o.jsx)(n.code,{children:"log_file_max_size"})," parameter (e.g., ",(0,o.jsx)(n.code,{children:"100_000_000"})," for 100 MB)."]}),"\n",(0,o.jsx)(n.li,{children:"When writing a log entry would make the current file exceed this size, the file is closed and a new one is created."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Date-based rotation (default naming only)"}),":","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Applies when no ",(0,o.jsx)(n.code,{children:"log_file_max_size"})," is specified and no custom ",(0,o.jsx)(n.code,{children:"log_file_name"})," is provided."]}),"\n",(0,o.jsx)(n.li,{children:"At each UTC date change (midnight), the current log file is closed and a new one is started, creating one file per UTC day."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"No rotation"}),":","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["When a custom ",(0,o.jsx)(n.code,{children:"log_file_name"})," is provided without a ",(0,o.jsx)(n.code,{children:"log_file_max_size"}),", logs continue to append to the same file."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Backup file management"}),":","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Controlled by the ",(0,o.jsx)(n.code,{children:"log_file_max_backup_count"})," parameter (default: 5), limiting the total number of rotated files kept."]}),"\n",(0,o.jsx)(n.li,{children:"When this limit is exceeded, the oldest backup files are automatically removed."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"log-file-naming-convention",children:"Log file naming convention"}),"\n",(0,o.jsx)(n.p,{children:"The default naming convention ensures log files are uniquely identifiable and timestamped.\nThe format depends on whether file rotation is enabled:"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"With file rotation enabled"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Format"}),": ",(0,o.jsx)(n.code,{children:"{trader_id}_{%Y-%m-%d_%H%M%S:%3f}_{instance_id}.{log|json}"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Example"}),": ",(0,o.jsx)(n.code,{children:"TESTER-001_2025-04-09_210721:521_d7dc12c8-7008-4042-8ac4-017c3db0fc38.log"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Components"}),":","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"{trader_id}"}),": The trader identifier (e.g., ",(0,o.jsx)(n.code,{children:"TESTER-001"}),")."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"{%Y-%m-%d_%H%M%S:%3f}"}),": Full ISO 8601-compliant datetime with millisecond resolution."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"{instance_id}"}),": A unique instance identifier."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"{log|json}"}),": File suffix based on format setting."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Without size-based rotation (default naming)"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Format"}),": ",(0,o.jsx)(n.code,{children:"{trader_id}_{%Y-%m-%d}_{instance_id}.{log|json}"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Example"}),": ",(0,o.jsx)(n.code,{children:"TESTER-001_2025-04-09_d7dc12c8-7008-4042-8ac4-017c3db0fc38.log"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Components"}),":","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"{trader_id}"}),": The trader identifier."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"{%Y-%m-%d}"}),": Date only (YYYY-MM-DD)."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"{instance_id}"}),": A unique instance identifier."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"{log|json}"}),": File suffix based on format setting."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Note"}),": With default naming and no size limit, logs rotate daily at UTC midnight."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Custom naming"}),":"]}),"\n",(0,o.jsxs)(n.p,{children:["If ",(0,o.jsx)(n.code,{children:"log_file_name"})," is set (e.g., ",(0,o.jsx)(n.code,{children:"my_custom_log"}),"):"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["With rotation disabled: The file will be named exactly as provided (e.g., ",(0,o.jsx)(n.code,{children:"my_custom_log.log"}),")."]}),"\n",(0,o.jsxs)(n.li,{children:["With rotation enabled: The file will include the custom name and timestamp (e.g., ",(0,o.jsx)(n.code,{children:"my_custom_log_2025-04-09_210721:521.log"}),")."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"component-log-filtering",children:"Component log filtering"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"log_component_levels"})," parameter can be used to set log levels for each component individually.\nThe input value should be a dictionary of component ID strings to log level strings: ",(0,o.jsx)(n.code,{children:"dict[str, str]"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"Below is an example of a trading node logging configuration that includes some of the options mentioned above:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'from nautilus_trader.config import LoggingConfig\nfrom nautilus_trader.config import TradingNodeConfig\n\nconfig_node = TradingNodeConfig(\n    trader_id="TESTER-001",\n    logging=LoggingConfig(\n        log_level="INFO",\n        log_level_file="DEBUG",\n        log_file_format="json",\n        log_component_levels={ "Portfolio": "INFO" },\n    ),\n    ... # Omitted\n)\n'})}),"\n",(0,o.jsxs)(n.p,{children:["For backtesting, the ",(0,o.jsx)(n.code,{children:"BacktestEngineConfig"})," class can be used instead of ",(0,o.jsx)(n.code,{children:"TradingNodeConfig"}),", as the same options are available."]}),"\n",(0,o.jsx)(n.h3,{id:"components-only-logging",children:"Components-only logging"}),"\n",(0,o.jsxs)(n.p,{children:["When focusing on a subset of noisy systems, enable ",(0,o.jsx)(n.code,{children:"log_components_only"})," to log messages only from components explicitly listed in ",(0,o.jsx)(n.code,{children:"log_component_levels"}),". All other components are suppressed regardless of the global ",(0,o.jsx)(n.code,{children:"log_level"})," or file level."]}),"\n",(0,o.jsx)(n.p,{children:"Example (Python configuration):"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'logging = LoggingConfig(\n    log_level="INFO",\n    log_component_levels={\n        "RiskEngine": "DEBUG",\n        "Portfolio": "INFO",\n    },\n    log_components_only=True,\n)\n'})}),"\n",(0,o.jsxs)(n.p,{children:["If configuring via the environment using the Rust spec string, include ",(0,o.jsx)(n.code,{children:"log_components_only"})," alongside component filters, for example:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'export NAUTILUS_LOG="stdout=Info;log_components_only;RiskEngine=Debug;Portfolio=Info"\n'})}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsxs)(n.p,{children:["If ",(0,o.jsx)(n.code,{children:"log_components_only=True"})," (or ",(0,o.jsx)(n.code,{children:"log_components_only"})," is present in the spec string) and ",(0,o.jsx)(n.code,{children:"log_component_levels"})," is empty, no log messages will be emitted to stdout/stderr or files. Add at least one component filter or disable components-only logging."]})}),"\n",(0,o.jsx)(n.h3,{id:"log-colors",children:"Log Colors"}),"\n",(0,o.jsx)(n.p,{children:"ANSI color codes are utilized to enhance the readability of logs when viewed in a terminal.\nThese color codes can make it easier to distinguish different parts of log messages.\nIn environments that do not support ANSI color rendering (such as some cloud environments or text editors),\nthese color codes may not be appropriate as they can appear as raw text."}),"\n",(0,o.jsxs)(n.p,{children:["To accommodate for such scenarios, the ",(0,o.jsx)(n.code,{children:"LoggingConfig.log_colors"})," option can be set to ",(0,o.jsx)(n.code,{children:"false"}),".\nDisabling ",(0,o.jsx)(n.code,{children:"log_colors"})," will prevent the addition of ANSI color codes to the log messages, ensuring\ncompatibility across different environments where color rendering is not supported."]}),"\n",(0,o.jsx)(n.h2,{id:"using-a-logger-directly",children:"Using a logger directly"}),"\n",(0,o.jsxs)(n.p,{children:["It's possible to use ",(0,o.jsx)(n.code,{children:"Logger"})," objects directly, and these can be initialized anywhere (very similar to the Python built-in ",(0,o.jsx)(n.code,{children:"logging"})," API)."]}),"\n",(0,o.jsxs)(n.p,{children:["If you ",(0,o.jsx)(n.em,{children:(0,o.jsx)(n.strong,{children:"aren't"})})," using an object which already initializes a ",(0,o.jsx)(n.code,{children:"NautilusKernel"})," (and logging) such as ",(0,o.jsx)(n.code,{children:"BacktestEngine"})," or ",(0,o.jsx)(n.code,{children:"TradingNode"}),",\nthen you can activate logging in the following way:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'from nautilus_trader.common.component import init_logging\nfrom nautilus_trader.common.component import Logger\n\nlog_guard = init_logging()\nlogger = Logger("MyLogger")\n'})}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["See the ",(0,o.jsx)(n.code,{children:"init_logging"})," ",(0,o.jsx)(n.a,{href:"../api_reference/common",children:"API Reference"})," for further details."]})}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsxs)(n.p,{children:["Only one logging subsystem can be initialized per process with an ",(0,o.jsx)(n.code,{children:"init_logging"})," call. Multiple ",(0,o.jsx)(n.code,{children:"LogGuard"})," instances (up to 255) can exist concurrently, and the logging thread will remain active until all guards are dropped."]})}),"\n",(0,o.jsx)(n.h2,{id:"logguard-managing-log-lifecycle",children:"LogGuard: managing log lifecycle"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"LogGuard"})," ensures that the logging subsystem remains active and operational throughout the lifecycle of a process.\nIt prevents premature shutdown of the logging subsystem when running multiple engines in the same process."]}),"\n",(0,o.jsx)(n.h3,{id:"reference-counting-implementation",children:"Reference Counting Implementation"}),"\n",(0,o.jsxs)(n.p,{children:["The logging system uses reference counting to track active ",(0,o.jsx)(n.code,{children:"LogGuard"})," instances:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Counter increments"}),": When a new ",(0,o.jsx)(n.code,{children:"LogGuard"})," is created, an atomic counter is incremented."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Counter decrements"}),": When a ",(0,o.jsx)(n.code,{children:"LogGuard"})," is dropped, the counter is decremented."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Logging thread termination"}),": When the counter reaches zero (last ",(0,o.jsx)(n.code,{children:"LogGuard"})," dropped), the logging thread is properly joined to ensure all pending log messages are written before the process terminates."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Maximum guards"}),": The system supports up to 255 concurrent ",(0,o.jsx)(n.code,{children:"LogGuard"})," instances. Attempting to create more will cause a panic."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"This mechanism ensures that:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Log messages are never lost due to premature thread termination."}),"\n",(0,o.jsxs)(n.li,{children:["The logging thread remains active as long as any ",(0,o.jsx)(n.code,{children:"LogGuard"})," exists."]}),"\n",(0,o.jsx)(n.li,{children:"All buffered logs are properly flushed to their destinations when the program ends."}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"why-use-logguard",children:"Why use LogGuard?"}),"\n",(0,o.jsxs)(n.p,{children:["Without a ",(0,o.jsx)(n.code,{children:"LogGuard"}),", any attempt to run sequential engines in the same process may result in errors such as:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Error sending log event: [INFO] ...\n"})}),"\n",(0,o.jsxs)(n.p,{children:["This occurs because the logging subsystem's underlying channel and Rust ",(0,o.jsx)(n.code,{children:"Logger"})," are closed when the first engine is disposed.\nAs a result, subsequent engines lose access to the logging subsystem, leading to these errors."]}),"\n",(0,o.jsxs)(n.p,{children:["By leveraging a ",(0,o.jsx)(n.code,{children:"LogGuard"}),", you can ensure robust logging behavior across multiple backtests or engine runs in the same process.\nThe ",(0,o.jsx)(n.code,{children:"LogGuard"})," retains the resources of the logging subsystem and ensures that logs continue to function correctly,\neven as engines are disposed and initialized."]}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["Using ",(0,o.jsx)(n.code,{children:"LogGuard"})," is critical to maintain consistent logging behavior throughout a process with multiple engines."]})}),"\n",(0,o.jsx)(n.h2,{id:"running-multiple-engines",children:"Running multiple engines"}),"\n",(0,o.jsxs)(n.p,{children:["The following example demonstrates how to use a ",(0,o.jsx)(n.code,{children:"LogGuard"})," when running multiple engines sequentially in the same process:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"log_guard = None  # Initialize LogGuard reference\n\nfor i in range(number_of_backtests):\n    engine = setup_engine(...)\n\n    # Assign reference to LogGuard\n    if log_guard is None:\n        log_guard = engine.get_log_guard()\n\n    # Add actors and execute the engine\n    actors = setup_actors(...)\n    engine.add_actors(actors)\n    engine.run()\n    engine.dispose()  # Dispose safely\n"})}),"\n",(0,o.jsx)(n.h3,{id:"steps",children:"Steps"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Initialize LogGuard once"}),": The ",(0,o.jsx)(n.code,{children:"LogGuard"})," is obtained from the first engine (",(0,o.jsx)(n.code,{children:"engine.get_log_guard()"}),") and is retained throughout the process. This ensures that the logging subsystem remains active."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Dispose engines safely"}),": Each engine is safely disposed of after its backtest completes, without affecting the logging subsystem."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Reuse LogGuard"}),": The same ",(0,o.jsx)(n.code,{children:"LogGuard"})," instance is reused for subsequent engines, preventing the logging subsystem from shutting down prematurely."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"considerations",children:"Considerations"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Multiple LogGuards per process"}),": The system supports up to 255 concurrent ",(0,o.jsx)(n.code,{children:"LogGuard"})," instances per process. Each guard increments a reference counter when created and decrements it when dropped."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Thread safety"}),": The logging subsystem, including ",(0,o.jsx)(n.code,{children:"LogGuard"}),", is thread-safe, ensuring consistent behavior even in multi-threaded environments."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Automatic cleanup"}),": When the last ",(0,o.jsx)(n.code,{children:"LogGuard"})," is dropped (reference count reaches zero), the logging thread is properly joined to ensure all pending logs are written before the process terminates."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"platform-specific-considerations",children:"Platform-specific considerations"}),"\n",(0,o.jsx)(n.h3,{id:"windows-shutdown-behavior",children:"Windows shutdown behavior"}),"\n",(0,o.jsxs)(n.p,{children:["On Windows, non-deterministic garbage collection during interpreter shutdown can occasionally\nprevent the logging thread from joining properly. When the last ",(0,o.jsx)(n.code,{children:"LogGuard"})," is dropped, the\nlogging subsystem signals the background thread to close and joins it to ensure all pending\nmessages are written. If Python's garbage collector delays dropping the guard until after\ninterpreter shutdown has begun, this join may not complete, resulting in truncated logs."]}),"\n",(0,o.jsxs)(n.p,{children:["This issue is tracked in GitHub ",(0,o.jsx)(n.a,{href:"https://github.com/nautechsystems/nautilus_trader/issues/3027",children:"issue #3027"}),".\nA more deterministic shutdown mechanism is under consideration."]})]})}function g(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},9087:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>t});var s=i(6363);const o={},l=s.createContext(o);function r(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);