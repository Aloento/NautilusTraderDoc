"use strict";(globalThis.webpackChunknautilus_trader=globalThis.webpackChunknautilus_trader||[]).push([[4914],{8941:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"tutorials/loading_external_data","title":"\u52a0\u8f7d\u5916\u90e8\u6570\u636e","description":"\u672c\u6559\u7a0b\u6f14\u793a\u5982\u4f55\u5c06\u5916\u90e8\u6570\u636e\u52a0\u8f7d\u5230 ParquetDataCatalog\uff0c\u5e76\u57fa\u4e8e\u8be5\u6570\u636e\u76ee\u5f55\u4f7f\u7528 BacktestNode \u8fd0\u884c\u4e00\u6b21\u6027\u56de\u6d4b\uff08one-shot backtest\uff09\u3002","source":"@site/docs/tutorials/loading_external_data.md","sourceDirName":"tutorials","slug":"/tutorials/loading_external_data","permalink":"/tutorials/loading_external_data","draft":false,"unlisted":false,"editUrl":"https://github.com/Aloento/NautilusTraderDoc/tree/main/docs/tutorials/loading_external_data.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Databento \u6982\u89c8","permalink":"/tutorials/databento_overview"},"next":{"title":"Parquet \u63a2\u7d22\uff08Explorer\uff09","permalink":"/tutorials/parquet_explorer"}}');var r=n(7259),s=n(9087);const o={},i="\u52a0\u8f7d\u5916\u90e8\u6570\u636e",l={},c=[];function d(t){const e={blockquote:"blockquote",code:"code",h1:"h1",header:"header",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...t.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"\u52a0\u8f7d\u5916\u90e8\u6570\u636e",children:"\u52a0\u8f7d\u5916\u90e8\u6570\u636e"})}),"\n",(0,r.jsxs)(e.p,{children:["\u672c\u6559\u7a0b\u6f14\u793a\u5982\u4f55\u5c06\u5916\u90e8\u6570\u636e\u52a0\u8f7d\u5230 ",(0,r.jsx)(e.code,{children:"ParquetDataCatalog"}),"\uff0c\u5e76\u57fa\u4e8e\u8be5\u6570\u636e\u76ee\u5f55\u4f7f\u7528 ",(0,r.jsx)(e.code,{children:"BacktestNode"})," \u8fd0\u884c\u4e00\u6b21\u6027\u56de\u6d4b\uff08one-shot backtest\uff09\u3002"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u6ce8\u610f"}),"\uff1a"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u5efa\u8bae\u5728\u88f8\u673a\u73af\u5883\u8fd0\u884c\uff08\u4e0d\u8981\u5728 jupyterlab Docker \u5bb9\u5668\u4e2d\u6267\u884c\uff09"})}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"import os\nimport shutil\nfrom decimal import Decimal\nfrom pathlib import Path\n\nimport pandas as pd\n\nfrom nautilus_trader.backtest.node import BacktestDataConfig\nfrom nautilus_trader.backtest.node import BacktestEngineConfig\nfrom nautilus_trader.backtest.node import BacktestNode\nfrom nautilus_trader.backtest.node import BacktestRunConfig\nfrom nautilus_trader.backtest.node import BacktestVenueConfig\nfrom nautilus_trader.config import ImportableStrategyConfig\nfrom nautilus_trader.core.datetime import dt_to_unix_nanos\nfrom nautilus_trader.model import BarType\nfrom nautilus_trader.model import QuoteTick\nfrom nautilus_trader.persistence.catalog import ParquetDataCatalog\nfrom nautilus_trader.persistence.wranglers import QuoteTickDataWrangler\nfrom nautilus_trader.test_kit.providers import CSVTickDataLoader\nfrom nautilus_trader.test_kit.providers import TestInstrumentProvider\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'DATA_DIR = "~/Downloads/Data/"\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'path = Path(DATA_DIR).expanduser() / "HISTDATA"\nraw_files = list(path.iterdir())\nassert raw_files, f"Unable to find any histdata files in directory {path}"\nraw_files\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'# \u672c\u4f8b\u53d6\u627e\u5230\u7684\u7b2c\u4e00\u4e2a\u539f\u59cb\u6570\u636e\u6587\u4ef6\u5e76\u52a0\u8f7d\u4e3a pandas DataFrame\ndf = CSVTickDataLoader.load(raw_files[0], index_col=0, datetime_format="%Y%m%d %H%M%S%f")\ndf.columns = ["timestamp", "bid_price", "ask_price"]\n\n# \u4f7f\u7528 wrangler \u5904\u7406\u62a5\u4ef7\u6570\u636e\uff0c\u751f\u6210 Nautilus \u7684 QuoteTick \u5bf9\u8c61\nEURUSD = TestInstrumentProvider.default_fx_ccy("EUR/USD")\nwrangler = QuoteTickDataWrangler(EURUSD)\n\nticks = wrangler.process(df)\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'CATALOG_PATH = os.getcwd() + "/catalog"\n\n# \u82e5\u76ee\u5f55\u5b58\u5728\u5219\u5148\u5220\u9664\u4ee5\u786e\u4fdd\u5e72\u51c0\u7684\u73af\u5883\nif os.path.exists(CATALOG_PATH):\n    shutil.rmtree(CATALOG_PATH)\nos.mkdir(CATALOG_PATH)\n\n# \u521b\u5efa ParquetDataCatalog \u5b9e\u4f8b\ncatalog = ParquetDataCatalog(CATALOG_PATH)\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"# \u5c06 instrument \u4e0e ticks \u5199\u5165 catalog\ncatalog.write_data([EURUSD])\ncatalog.write_data(ticks)\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"# \u4ece catalog \u4e2d\u83b7\u53d6\u6240\u6709 instruments\uff08\u7528\u4e8e\u6821\u9a8c\uff09\ncatalog.instruments()\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'start = dt_to_unix_nanos(pd.Timestamp("2020-01-03", tz="UTC"))\nend =  dt_to_unix_nanos(pd.Timestamp("2020-01-04", tz="UTC"))\n\nticks = catalog.quote_ticks(instrument_ids=[EURUSD.id.value], start=start, end=end)\nticks[:10]\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'instrument = catalog.instruments()[0]\n\nvenue_configs = [\n    BacktestVenueConfig(\n        name="SIM",\n        oms_type="HEDGING",\n        account_type="MARGIN",\n        base_currency="USD",\n        starting_balances=["1000000 USD"],\n    ),\n]\n\ndata_configs = [\n    BacktestDataConfig(\n        catalog_path=str(catalog.path),\n        data_cls=QuoteTick,\n        instrument_id=instrument.id,\n        start_time=start,\n        end_time=end,\n    ),\n]\n\nstrategies = [\n    ImportableStrategyConfig(\n        strategy_path="nautilus_trader.examples.strategies.ema_cross:EMACross",\n        config_path="nautilus_trader.examples.strategies.ema_cross:EMACrossConfig",\n        config={\n            "instrument_id": instrument.id,\n            "bar_type": BarType.from_str(f"{instrument.id.value}-15-MINUTE-BID-INTERNAL"),\n            "fast_ema_period": 10,\n            "slow_ema_period": 20,\n            "trade_size": Decimal(1_000_000),\n        },\n    ),\n]\n\nconfig = BacktestRunConfig(\n    engine=BacktestEngineConfig(strategies=strategies),\n    data=data_configs,\n    venues=venue_configs,\n)\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"node = BacktestNode(configs=[config])\n\n[result] = node.run()\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"result\n"})})]})}function u(t={}){const{wrapper:e}={...(0,s.R)(),...t.components};return e?(0,r.jsx)(e,{...t,children:(0,r.jsx)(d,{...t})}):d(t)}},9087:(t,e,n)=>{n.d(e,{R:()=>o,x:()=>i});var a=n(6363);const r={},s=a.createContext(r);function o(t){const e=a.useContext(s);return a.useMemo(function(){return"function"==typeof t?t(e):{...e,...t}},[e,t])}function i(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(r):t.components||r:o(t.components),a.createElement(s.Provider,{value:e},t.children)}}}]);